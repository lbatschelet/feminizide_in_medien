<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lukas Batschelet">
<meta name="author" content="Linus Kiener">
<meta name="dcterms.date" content="2026-01-26">

<title>From “Family Tragedy” to “Feminicide”?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Notebook_files/libs/clipboard/clipboard.min.js"></script>
<script src="Notebook_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/popper.min.js"></script>
<script src="Notebook_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Notebook_files/libs/quarto-html/anchor.min.js"></script>
<link href="Notebook_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Notebook_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Notebook_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Notebook_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Notebook_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="Notebook_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Notebook_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="Notebook_files/libs/plotly-binding-4.12.0/plotly.js"></script>
<script src="Notebook_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="Notebook_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="Notebook_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="Notebook_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="Notebook_files/libs/plotly-htmlwidgets-css-2.25.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="Notebook_files/libs/plotly-main-2.25.2/plotly-latest.min.js"></script>
<link href="Notebook_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Notebook_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">From “Family Tragedy” to “Feminicide”?</h1>
            <p class="subtitle lead">Exploring Discursive Change in Swiss Media Reporting on the Killing of Women since 1990</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Lukas Batschelet <a href="mailto:lukas.batschelet@students.unibe.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
               <p>Linus Kiener <a href="mailto:linus.kiener@students.unibe.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 26, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>The language used in media reporting on the killing of women reflects and shapes broader social understandings of gender-based violence. This paper presents an exploratory analysis of discursive change in German-language Swiss media reporting on feminicides since 1990. Drawing on the Swissdox media archive, we apply diachronic word2vec models to examine how key terms and their semantic neighbourhoods have evolved over time. Rather than offering definitive causal explanations, the study aims to detect patterns of continuity and change in terminology, framing, and contextual associations. The findings indicate a gradual shift from individualising and relational framings toward more politicised and gender-specific vocabularies, while certain narrative conventions remain remarkably stable. By combining computational text analysis with a critical perspective on discourse, the paper highlights both the potential and the limits of word embedding methods for studying long-term transformations in media representations of feminicide.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#document-setup" id="toc-document-setup" class="nav-link" data-scroll-target="#document-setup">Document Setup</a></li>
  <li><a href="#keyword-definitions" id="toc-keyword-definitions" class="nav-link" data-scroll-target="#keyword-definitions">Keyword Definitions</a></li>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">Data collection</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation</a></li>
  <li><a href="#corpus-and-preprocessing" id="toc-corpus-and-preprocessing" class="nav-link" data-scroll-target="#corpus-and-preprocessing">Corpus and preprocessing</a></li>
  <li><a href="#word2vec-frame-shift-diachronic" id="toc-word2vec-frame-shift-diachronic" class="nav-link" data-scroll-target="#word2vec-frame-shift-diachronic">Word2Vec frame shift (diachronic)</a></li>
  <li><a href="#local-embedding-visualization" id="toc-local-embedding-visualization" class="nav-link" data-scroll-target="#local-embedding-visualization">Local embedding visualization</a></li>
  <li><a href="#iterative-query-expansion" id="toc-iterative-query-expansion" class="nav-link" data-scroll-target="#iterative-query-expansion">Iterative query expansion</a></li>
  <li><a href="#second-pass-api-query-manual-curation" id="toc-second-pass-api-query-manual-curation" class="nav-link" data-scroll-target="#second-pass-api-query-manual-curation">Second-pass API query (manual curation)</a></li>
  <li><a href="#second-pass-data-preparation" id="toc-second-pass-data-preparation" class="nav-link" data-scroll-target="#second-pass-data-preparation">Second-pass data preparation</a></li>
  <li><a href="#top-sources" id="toc-top-sources" class="nav-link" data-scroll-target="#top-sources">Top sources</a></li>
  <li><a href="#normalized-contrast-early-vs.-late-periods-per-million-words" id="toc-normalized-contrast-early-vs.-late-periods-per-million-words" class="nav-link" data-scroll-target="#normalized-contrast-early-vs.-late-periods-per-million-words">Normalized contrast: early vs.&nbsp;late periods (per million words)</a>
  <ul class="collapse">
  <li><a href="#second-pass-semantic-expansion-iteration-2" id="toc-second-pass-semantic-expansion-iteration-2" class="nav-link" data-scroll-target="#second-pass-semantic-expansion-iteration-2">Second-pass semantic expansion (iteration 2)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Media coverage of the topic of femicide has always been controversial. The term “femicide” itself is the subject of complex debate in the media and politics. For example, in its statement of August 12, 2020, on interpellation 20.3505<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, the Federal Council said: “There are currently no plans to use the term ‘femicide’,” in response to the question of whether “[it] intends to promote the use of the term ‘femicide’ in diplomacy and in relations with the media”.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> However, it also points out that “[t]he FSO, on the other hand, [reports] the gender of the victims and the relationship between the victims and the accused in the police crime statistics (PKS) for violent crimes, so that homicides against women are visible in the statistics”.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Information such as this can then be used by projects like <a href="https://stopfemizid.ch">stopfemizid.ch</a> to crowdsource reports of such incidents. However, the debate surrounding the use of different terms has now progressed further, with the term “feminicide” gradually becoming established. (As we can also show in our subsequent analysis.) The term was coined by Mexican feminist activist Marcela Lagarde, who wanted to use the neologism “feminicidio” expanding the concept of “femicidio” to include, among other things, the dimension of institutional violence and responsibility <span class="citation" data-cites="saccomano_femicide_2015 ggf_femizid_2023">(cf. <a href="#ref-saccomano_femicide_2015" role="doc-biblioref">Saccomano 2015, 5</a>; as seen in <a href="#ref-ggf_femizid_2023" role="doc-biblioref">GgF 2023</a>)</span>. However, <span class="citation" data-cites="saccomano_femicide_2015">Saccomano (<a href="#ref-saccomano_femicide_2015" role="doc-biblioref">2015</a>)</span> <!-- [p. 33] --> notes that the popularization of the term has also led to confusion and that it is often mistakenly used for any killing of a woman.</p>
<p>In its press release on case No.&nbsp;20/2025, the Swiss Press Council also stated that “[…] it is in the public interest to report on femicides and draw attention to the issue” <span class="citation" data-cites="presserat_berichterstattung_2025">(<a href="#ref-presserat_berichterstattung_2025" role="doc-biblioref">Presserat 2025</a>)</span>. Similar trends can also be observed in academic literature. An overview by <span class="citation" data-cites="meltzer_gewalt_2023">Meltzer (<a href="#ref-meltzer_gewalt_2023" role="doc-biblioref">2023</a>)</span> summarizes extensive findings on media coverage in Germany and mentions “that the term ‘femicide’ did not play a major role in the media until 2019.” According to the report, it was only used in about 1% <!-- escape für % sollte nicht nötig sein --> of the articles examined. We will attempt to replicate this finding, among others, for Switzerland using data from Swissdox via the LiRI (Linguistic Research Infrastructure) API. Moreover, <span class="citation" data-cites="wetzstein_femicide_2024">Wetzstein, Prinzellner, and Kröpfl (<a href="#ref-wetzstein_femicide_2024" role="doc-biblioref">2024</a>)</span> finds that, for posts from the entire DACH region during the observation period between 2018 and 2020, euphemistic terms such as “relationship drama” or “blood deed” vary significantly depending on the type of relationship between the victim and the perpetrator. These and other terms such as “family tragedies” or “jealousy dramas” “trivialize violence against women and turn femicides into fateful isolated cases” <span class="citation" data-cites="journalistde_kein_2023">(<a href="#ref-journalistde_kein_2023" role="doc-biblioref">journalist.de 2023</a>)</span>. Apart from that, the use of terms such as “femicide” (which focus on the gender of the victim) is more common when the perpetrator’s migrant background is mentioned in parallel <span class="citation" data-cites="wetzstein_femicide_2024 ustpat_studie_2024">(<a href="#ref-wetzstein_femicide_2024" role="doc-biblioref">Wetzstein, Prinzellner, and Kröpfl 2024</a>; via <a href="#ref-ustpat_studie_2024" role="doc-biblioref">ustp.at 2024</a>)</span>.</p>
<p>Based on this initial literature review, we have concluded that there is a substantial need for the availability and analysis of data related to the topic of femi(ni)cide, particularly in the recent past within the Swiss media landscape. Our work aims to construct a framework for obtaining relevant data and then demonstrates possible approaches and methods of analysis.</p>
<!-- *** -->
<!-- redundant durch fussnoten separator -->
<!-- Achtung: Quarto sollte gehen, aber R Markdown ist "lightweight markup" und unterstützt fussnoten nicht -->
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Large files and long compute times ahead!</strong></p>
<p>This pipeline relies on multithreaded processing wherever possible.</p>
<p>Please make sure that <strong><code>quanteda</code> is running in parallel mode</strong>.<br>
If parallelisation is disabled, several steps (especially tokenisation and feature extraction) may take <em>extremely</em> long.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>How to check whether <code>quanteda</code> runs in parallel
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In R, run (quanteda is already loaded in the setup chunk):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quanteda_options</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you see:</p>
<pre><code>Parallel computing: disabled</code></pre>
<p>then multithreading is <strong>not</strong> active and performance will be severely reduced.</p>
<p>You can also inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quanteda_options</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For setup instructions and troubleshooting, see: <a href="https://quanteda.io/articles/pkgdown/parallelisation.html" class="uri">https://quanteda.io/articles/pkgdown/parallelisation.html</a></p>
</div>
</div>
</div>
<p>Swissdox API calls are also inherently slow and may take hours for large queries.</p>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"httr"</span>, <span class="st">"jsonlite"</span>, <span class="st">"yaml"</span>, <span class="st">"dotenv"</span>, <span class="st">"R6"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"stringr"</span>, <span class="st">"tidytext"</span>, <span class="st">"readr"</span>, <span class="st">"tidyr"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"quanteda"</span>, <span class="st">"quanteda.textplots"</span>, <span class="st">"quanteda.textstats"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tm"</span>, <span class="st">"topicmodels"</span>, <span class="st">"wordcloud"</span>, <span class="st">"RColorBrewer"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"umap"</span>, <span class="st">"plotly"</span>, <span class="st">"hunspell"</span>, <span class="st">"word2vec"</span>, <span class="st">"progress"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"qs2"</span>, <span class="st">"tibble"</span>, <span class="st">"scales"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>missing_packages <span class="ot">&lt;-</span> required_packages[</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">vapply</span>(required_packages, requireNamespace, <span class="fu">logical</span>(<span class="dv">1</span>), <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_packages) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(missing_packages)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(required_packages, <span class="cf">function</span>(pkg) {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># API Wrapper laden</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"swissdox_api.R"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="document-setup" class="level2">
<h2 class="anchored" data-anchor-id="document-setup">Document Setup</h2>
<p>Centralized API access, checkpoint utilities, and text configuration.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load environment variables from local.env</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"local.env"</span>)) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load_dot_env</span>(<span class="st">"local.env"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"\u2713 Environment variables loaded from local.env"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"WARN: local.env not found - using system environment"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>✓ Environment variables loaded from local.env</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize API client with credentials</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>client <span class="ot">&lt;-</span> SwissdoxAPI<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_KEY"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">api_secret =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_SECRET"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Guard flags to prevent accidental duplicate API calls</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Query guards:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - RUN_* enables the API call at all</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - FORCE_* re-runs even if a checkpoint already exists</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>RUN_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>FORCE_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>RUN_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>FORCE_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Second-pass Word2Vec guards</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>RUN_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>FORCE_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint helpers (load/save latest timestamped files)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>find_latest <span class="ot">&lt;-</span> <span class="cf">function</span>(pattern, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> pattern, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prefer timestamp in filename (YYYYMMDD_HHMMSS). Fall back to mtime.</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>latest_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  patterns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.rds$"</span>),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.qs2$"</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(patterns, <span class="cf">function</span>(p) <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> p, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reuse find_latest logic on the combined list</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>save_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, prefix, <span class="at">dir =</span> <span class="st">"data"</span>, <span class="at">format =</span> <span class="st">"qs2"</span>, <span class="at">compress =</span> <span class="st">"xz"</span>) {</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  timestamp <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format <span class="sc">==</span> <span class="st">"qs2"</span>) {</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot save .qs2 checkpoint"</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".qs2"</span>))</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    qs2<span class="sc">::</span><span class="fu">qs_save</span>(obj, file)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".rds"</span>))</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(obj, file, <span class="at">compress =</span> compress)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Saved checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  file</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>load_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, var_name) {</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  file <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(prefix)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(file)) {</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No checkpoint found for: "</span>, prefix)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.qs2$"</span>, file)) {</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot read: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(var_name, qs2<span class="sc">::</span><span class="fu">qs_read</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(var_name, <span class="fu">readRDS</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Loaded checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  file</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Text analysis defaults</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>SAVE_CORPUS <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>USE_STEMMING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>TRAIN_FULL_MODEL <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>FULL_MODEL_LABEL <span class="ot">&lt;-</span> <span class="st">"all_2000-2025"</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Multi-word patterns after stemming (used in preprocessing + word2vec)</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>simplified_patterns <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"hauslich"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"partnerschaft"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"partner"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"sexuell"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"körperl"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"psychisch"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"töt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"mord"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"drama"</span>),</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"tragödi"</span>),</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"tat"</span>),</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"eh"</span>, <span class="st">"streit"</span>),</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"opf"</span>, <span class="st">"schutz"</span>),</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"schutz"</span>)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize terms to match Word2Vec vocabulary (lowercase, optional stemming)</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>normalize_terms_for_model <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>  norm <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(terms)</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>  toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens</span>(norm, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens_wordstem</span>(toks, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(toks, <span class="cf">function</span>(x) <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">"_"</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="keyword-definitions" class="level2">
<h2 class="anchored" data-anchor-id="keyword-definitions">Keyword Definitions</h2>
<p>These terms are the basis for the queries. We define them centrally to keep usage consistent across analysis and API calls.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>feminizid_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span>, <span class="st">"Gewalt gegen Frauen"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="data-collection" class="level2">
<h2 class="anchored" data-anchor-id="data-collection">Data collection</h2>
<p>Build and run the Swissdox query. Use the checkpoint load block to resume without re-running the API call.</p>
<p>We start with a broad exploratory query using the original keyword list (OR).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint load (raw data)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_raw_data_20260127_094655.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip if a checkpoint exists unless explicitly forced</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>existing_firstpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_FIRST_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_FIRST_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_firstpass))) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"First-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_firstpass))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Full data collection with API wrapper</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>collection_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">client =</span> client,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">content_terms =</span> feminizid_keywords,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_from =</span> <span class="st">"2000-01-01"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>               <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>, </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>               <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_Collection"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">"Comprehensive feminicide media analysis dataset"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Store results and save checkpoint</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(collection_result<span class="sc">$</span>data)) {</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  media_data <span class="ot">&lt;-</span> collection_result<span class="sc">$</span>data</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"\u2713 "</span>, collection_result<span class="sc">$</span>message)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Error while loading data"</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>First-pass query skipped. Existing checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data preparation</h2>
<p>Load raw data (from checkpoint or TSV), clean fields, and prepare time variables used in analysis.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (checkpoint first, TSV fallback)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>raw_file <span class="ot">&lt;-</span> <span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(raw_file)) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  tsv_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.tsv(</span><span class="sc">\\</span><span class="st">.xz)?$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(tsv_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"WARN: No data files found - run the API call"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"No .rds file found, loading .tsv files..."</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    media_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">lapply</span>(tsv_files, <span class="cf">function</span>(file) {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Loading: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_tsv</span>(file, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"\u2713 Combined "</span>, <span class="fu">length</span>(tsv_files), <span class="st">" files: "</span>, <span class="fu">nrow</span>(media_data), <span class="st">" articles"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data (if not already done)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert dates and create time variables</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>media_data<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>media_data<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>media_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>media_data<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%m"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>media_data<span class="sc">$</span>month_year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep German-only articles (drop French)</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>media_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"German articles after filtering: "</span>, <span class="fu">nrow</span>(media_data))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>German articles after filtering: 36509</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Date range: "</span>, <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">" to "</span>, <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Date range: 2000-01-03 to 2026-01-25</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Media outlets: "</span>, <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Media outlets: 158</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Articles per year</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>yearly_counts <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(yearly_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feminicide coverage over time"</span>, </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"German media 2000-2025"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Top outlets</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>top_media <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(medium_name, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_media, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(medium_name, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 15 outlets"</span>, <span class="at">x =</span> <span class="st">"Outlet"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Monthly trend (last 5 years)</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>recent_trend <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(month_year) <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(month_year)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recent_trend, <span class="fu">aes</span>(<span class="at">x =</span> month_year, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly trend 2020-2026"</span>, <span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== DATA OVERVIEW ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DATA OVERVIEW ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"German articles:"</span>, <span class="fu">nrow</span>(media_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>German articles: 36509 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Date range:"</span>, <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"to"</span>, <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Date range: 10959 to 20478 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Media outlets:"</span>, <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Media outlets: 158 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average per year:"</span>, <span class="fu">round</span>(<span class="fu">nrow</span>(media_data) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>year))), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average per year: 1352 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keyword frequency in headlines (central definition)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>keyword_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">keyword =</span> <span class="fu">character</span>(), <span class="at">count =</span> <span class="fu">numeric</span>())</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(media_data<span class="sc">$</span>head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  keyword_counts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(keyword_counts, <span class="fu">data.frame</span>(<span class="at">keyword =</span> kw, <span class="at">count =</span> count))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>keyword_counts <span class="ot">&lt;-</span> keyword_counts <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(keyword, count), <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword frequency in headlines"</span>, </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Keyword"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/keyword-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print top keywords</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== KEYWORD FREQUENCY ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== KEYWORD FREQUENCY ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>keyword_counts</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["keyword"],"name":[1],"type":["chr"],"align":["left"]},{"label":["count"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"häusliche Gewalt","2":"1064"},{"1":"Femizid","2":"832"},{"1":"Familiendrama","2":"549"},{"1":"Gewalt gegen Frauen","2":"387"},{"1":"Frauenmord","2":"106"},{"1":"Familientragödie","2":"89"},{"1":"Ehestreit","2":"65"},{"1":"Beziehungstat","2":"20"},{"1":"Mord an Frau","2":"4"},{"1":"Feminizid","2":"1"},{"1":"Tötung von Frau","2":"1"},{"1":"Partnergewalt","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keyword time trends (central definition)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>keyword_timeline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  yearly_kw <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span><span class="fu">is.na</span>(head)) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">has_keyword =</span> <span class="fu">str_detect</span>(head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_articles =</span> <span class="fu">n</span>(),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyword_articles =</span> <span class="fu">sum</span>(has_keyword, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">percentage =</span> (keyword_articles <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">keyword =</span> kw)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  keyword_timeline <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(keyword_timeline, yearly_kw)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep relevant keywords and years</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>keyword_timeline <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">sum</span>(keyword_articles) <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least 10 articles overall</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Absolute counts over time</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_timeline, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword_articles, <span class="at">color =</span> keyword)) <span class="sc">+</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Time trends: keyword usage in headlines"</span>,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Absolute article counts per year"</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>, <span class="at">color =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap: keywords x years</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>keyword_matrix <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, keyword, keyword_articles) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> keyword, <span class="at">values_from =</span> keyword_articles, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"keyword"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_matrix, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword, <span class="at">fill =</span> count)) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Articles"</span>) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword intensity over time"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p5)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/time-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p6)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/time-trends-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Key trends</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== TIME TREND ANALYSIS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== TIME TREND ANALYSIS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>trend_summary <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_articles =</span> <span class="fu">sum</span>(keyword_articles),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">peak_year =</span> year[<span class="fu">which.max</span>(keyword_articles)],</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">peak_count =</span> <span class="fu">max</span>(keyword_articles),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_articles))</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>trend_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["keyword"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total_articles"],"name":[2],"type":["int"],"align":["right"]},{"label":["peak_year"],"name":[3],"type":["chr"],"align":["left"]},{"label":["peak_count"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"häusliche Gewalt","2":"1062","3":"2021","4":"190"},{"1":"Femizid","2":"831","3":"2025","4":"374"},{"1":"Familiendrama","2":"549","3":"2009","4":"49"},{"1":"Gewalt gegen Frauen","2":"387","3":"2025","4":"93"},{"1":"Frauenmord","2":"106","3":"2021","4":"37"},{"1":"Familientragödie","2":"89","3":"2009","4":"19"},{"1":"Ehestreit","2":"65","3":"2021","4":"8"},{"1":"Beziehungstat","2":"20","3":"2016","4":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="corpus-and-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="corpus-and-preprocessing">Corpus and preprocessing</h2>
<p>Build a quanteda corpus and a trimmed DFM from the cleaned articles. Use the checkpoint load block to resume without reprocessing.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint load (corpus/dfm)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_corpus"</span>, <span class="st">"feminizid_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: feminizid_corpus</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_dfm"</span>, <span class="st">"feminizid_dfm_trimmed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: feminizid_dfm</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>corpus_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Articles for corpus: "</span>, <span class="fu">nrow</span>(corpus_data))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Articles for corpus: 35776</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>corpus_data<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>corpus_data <span class="ot">&lt;-</span> corpus_data <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clean_content), clean_content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(clean_content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>feminizid_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(corpus_data,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">docid_field =</span> <span class="st">"unique_id"</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"original_id"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>id</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"medium"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>medium_name</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"date"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>pub_date</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"year"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>year</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"headline"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>head</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"char_count"</span>) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(corpus_data<span class="sc">$</span>char_count)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== QUANTEDA CORPUS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== QUANTEDA CORPUS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Documents:"</span>, <span class="fu">ndoc</span>(feminizid_corpus), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Documents: 35776 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tokens:"</span>, <span class="fu">sum</span>(<span class="fu">ntoken</span>(feminizid_corpus)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tokens: 37221149 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Range:"</span>, <span class="fu">min</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"to"</span>, <span class="fu">max</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Range: 10959 to 20478 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(feminizid_corpus, <span class="at">n =</span> <span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 35776 documents, showing 3 documents:

  Text Types Tokens Sentences       id             pubtime medium_code
 doc_1    65     81         5  6045314 2010-04-19 22:00:00        NZZO
 doc_2    87    123         7 12774039 2003-11-12 23:00:00          TA
 doc_3   406    776        32 38217916 2019-11-06 23:00:00         AZM
            medium_name      rubric       regional doctype
                 nzz.ch        &lt;NA&gt;       Panorama     WWE
         Tages-Anzeiger        &lt;NA&gt;         Inland     PND
 Aargauer Zeitung / MLZ Leserbriefe AZ Fernausgabe     PND
      doctype_description language char_count    dateline
            Online medium       de        519        &lt;NA&gt;
 National daily newspaper       de        792        &lt;NA&gt;
 National daily newspaper       de       4582 Leserbriefe
                                    head subhead article_link
 Zwei Tote bei Schiesserei vor US-Spital    &lt;NA&gt;         &lt;NA&gt;
      Schutz für Opfer häuslicher Gewalt    &lt;NA&gt;         &lt;NA&gt;
          Wo bleiben Liebe und Hoffnung?    &lt;NA&gt;         &lt;NA&gt;
                           content_id
 00026c57-62b2-e220-e815-80def2bba2ae
 000843dc-d164-c7a1-e6a2-376ab92330c4
 00089c2a-ee93-2f21-3188-4e2b315e743c
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  content
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          &lt;tx&gt;&lt;p&gt;(ddp) Bei einer Schiesserei vor einem Spital im US-Teilstaat Tennessee sind eine Frau getötet und zwei weitere verwundet worden. Der Täter nahm sich anschliessend selbst das Leben, wie die Polizei mitteilte. Bei den Opfern handelte es sich um Angestellte, beziehungsweise ehemalige Mitarbeiter des Parkwest Medical Center in Knoxville. Das Motiv für die Bluttat am Montagnachmittag (Ortszeit) war zunächst nicht bekannt.&nbsp; Gemäss ersten Erkenntnissen handelte es sich nicht um eine Beziehungstat.&lt;/p&gt;&lt;/tx&gt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        &lt;tx&gt;&lt;p&gt;Bern. - Opfer häuslicher Gewalt sollen besser geschützt werden. In Zukunft sollen Richter gewalttätige Personen aus der gemeinsamen oder ehemals gemeinsamen Wohnung ausweisen und ihnen das Betreten der Wohnung für eine bestimmte Zeit verbieten können. Damit hätten die Opfer eine Alternative zur Flucht aus der eigenen Wohnung. Der Richter soll der verletzenden Person auch verbieten können, mit dem Opfer telefonisch, schriftlich, elektronisch oder sonstwie Kontakt aufzunehmen. Der Bundesrat hat am Mittwoch einen entsprechenden Entwurf für einen neuen Artikel im Zivilgesetzbuch bis Ende Februar in die Vernehmlassung geschickt. Dieser sieht auch vor, dass die Kantone Informations- und Beratungsstellen einrichten, um häusliche Gewalt zu vermeiden und Rückfälle zu verhindern. (AP)&lt;/p&gt;&lt;/tx&gt;
 &lt;tx&gt;&lt;p&gt;Leserbrief: Die göttliche Ordnung bedeutet fast nichts mehr&lt;/p&gt;&lt;p&gt;Ausgabe vom 5. 11.&lt;/p&gt;&lt;p&gt;Es läuft mir kalt den Rücken runter, wenn ich lese, dass ein ehemaliger Gemeinderat einer Nachbargemeinde die Abweisung der Zwillinge gutheisst, mit dem Verweis auf die «göttliche Ordnung», die in dieser Familie missachtet werde. Man muss nicht bibelfest sein, um zu wissen, dass zum Glauben auch Liebe und Hoffnung gehören.&lt;/p&gt;&lt;p&gt;Marianna Matt, Reinach&lt;/p&gt;&lt;zt&gt;Heuchlerischer geht nicht mehr&lt;/zt&gt;&lt;p&gt;Also noch heuchlerischer geht es fast nicht mehr, wenn Heinz Rohr, Präsident EDU Bezirk Brugg und alt Gemeinderat Lupfig, beim Thema Regenbogenfamilie die «göttliche Ordnung über Ehe und Familie» bemüht und dabei behauptet, es gehe nicht um Diskriminierung gleichgeschlechtlicher Paare und ihrer Kinder. Im Laufe der Jahrtausende hat die «göttliche Ordnung von Ehe und Familie» viele Varianten gekannt, welche in den jeweiligen Gesellschaften akzeptiert waren. Die Bibel nennt z.B. die Vielehe, die Geschwisterehe und die Schwagerehe. Diese Ehe-Formen waren Teil der damaligen gesellschaftlichen Norm. In der Familie waren die Kinder Eigentum des Vaters, der das Recht hatte, z.B. Töchter als Sklavinnen zu verkaufen; auch dies gehörte zur Ordnung, über die wir in der Bibel lesen. Der Autor soll jetzt nicht einwenden, das stehe alles im Alten Testament und habe keinen Bezug zu unserer Zeit. Das würde zwar zutreffen, doch sind es seine Kreise, welche gerne aus den Sündenkatalogen des Alten Testaments zitieren und sie bedenkenlos über die Jahrtausende hinweg in die heutige Zeit transferieren. Auch die mittelalterliche Gesellschaftsordnung, in der Adel und Klerus das gemeine Volk gnadenlos ausbeuteten und unterdrückten, galt damals als gottgegeben. Sie machen sich Sorgen um die Werte, welche Kindern vermittelt werden, die in Regenbogenfamilien aufwachsen. Als alt Gemeinderat sollte der Leserbriefschreiber wissen, wie viel Leid Kinder in zerrütteten «normalen» Familien erdulden müssen, in denen häusliche Gewalt an der Tagesordnung ist. Hat er sich schon gefragt, welches Menschenbild wohl diesen Kindern vermittelt wird? Lieber Herr Rohr, auch zwei Frauen oder zwei Männer können ihren Kindern Zuneigung und Geborgenheit in ihrem Zuhause geben, auch sie sind in der Lage, ihnen biblische Werte beizubringen; Achtung und Respekt vor anderen Menschen und der Natur sind nur zwei davon, die ich erwähnen möchte. So zu tun, als sei nur seine Definition von gottgegebener Ordnung oder biblischen Werten gültig, ist anmassend.&lt;/p&gt;&lt;p&gt;Paul Streiff, Baden&lt;/p&gt;&lt;zt&gt;Die Bedeutung der göttlichen Ordnung&lt;/zt&gt;&lt;p&gt;Fundamentalistische Islamisten sprechen vom «göttlichen Gesetz» und meinen damit die Scharia. Wenn diese «göttliche Ordnung» dazu beiträgt, dass gleichgeschlechtlich liebende Menschen samt ihrer Kinder ausgegrenzt werden mit der fadenscheinigen Begründung, sie entsprächen nicht den biblischen Wertvorstellungen von Ehe und Familie, fällt mir der Verzicht darauf nicht schwer. Vor allem, wenn ich davon ausgehen muss, dass es sich um dieselbe «göttliche Ordnung» handelt, welche bis 1971 das Frauenstimmrecht und ein anständiges Eherecht zu verhindern vermochte. Bei dieser Gelegenheit möchte ich mich bei Karin Rüegg und Eva Schweizer für ihren klugen und mutigen Beitrag bedanken. Ich bin mir absolut sicher, dass nicht ihr die göttlichen Ausrutscher seid.&lt;/p&gt;&lt;p&gt;Andreas Hasenfratz, Seengen&lt;/p&gt;&lt;p&gt;Das Problem mit der Umwelt&lt;/p&gt;&lt;p&gt;Diverse Artikel zur Debatte über den Umweltschutz&lt;/p&gt;&lt;p&gt;Das Problem mit der Umwelt besteht ja eigentlich nicht erst seit gestern. Aber was jetzt damit gemacht wird, ist ein bisschen übertrieben! Schüler gehen statt in die Schule auf die Strasse, demonstrieren für eine bessere Umwelt und haben das Gefühl, etwas zu erreichen. Man nimmt sie zwar wahr, wird auf das Thema aufmerksam, und ein gewisses Umdenken findet statt. Die Politiker diskutieren dieses Thema, aber man redet und redet und sagt nichts! Und wenn sie etwas machen, hat es weder Hand noch Fuss! Auch das ganze Downsizing, das jetzt gross in Mode ist, ist ein Witz. Alle Autohersteller tun so, als hätten sie den Motor neu erfunden. Aber so was gab es schon im Zweiten Weltkrieg, Und nützen tut es gar nichts, ausser dem Hersteller, der es verkauft. Würden die verantwortlichen Politiker auf jene hören, die diese Problematik verstehen, würde es viel weniger nichts bringende Versuche zur Rettung der Umwelt geben. Denn diejenigen, die jetzt auf der Strasse wichtig auffallen, sind die Ersten die mit dem Flugzeug in den Urlaub fliegen. Also so gesehen, könnten wir das ganze Theater sparen.&lt;/p&gt;&lt;p&gt;Martin Bolli, Uerkheim&lt;/p&gt;&lt;/tx&gt;
   pub_date year month month_year original_id                 medium       date
 2010-04-19 2010    04    2010-04     6045314                 nzz.ch 2010-04-19
 2003-11-12 2003    11    2003-11    12774039         Tages-Anzeiger 2003-11-12
 2019-11-06 2019    11    2019-11    38217916 Aargauer Zeitung / MLZ 2019-11-06
                                headline
 Zwei Tote bei Schiesserei vor US-Spital
      Schutz für Opfer häuslicher Gewalt
          Wo bleiben Liebe und Hoffnung?</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_corpus_20260127_100908.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_corpus_20260127_100908.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load German stopwords</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>german_stopwords <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"german_stopwords_full.txt"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>german_stopwords <span class="ot">&lt;-</span> german_stopwords[german_stopwords <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Media-specific stopwords</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>media_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"uhr"</span>, <span class="st">"jahr"</span>, <span class="st">"jahre"</span>, <span class="st">"jahren"</span>, <span class="st">"prozent"</span>, <span class="st">"franken"</span>, <span class="st">"chf"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"artikel"</span>, <span class="st">"bericht"</span>, <span class="st">"zeitung"</span>, <span class="st">"medium"</span>, <span class="st">"redaktion"</span>, <span class="st">"autor"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"quelle"</span>, <span class="st">"foto"</span>, <span class="st">"bild"</span>, <span class="st">"video"</span>, <span class="st">"online"</span>, <span class="st">"www"</span>, <span class="st">"http"</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"montag"</span>, <span class="st">"dienstag"</span>, <span class="st">"mittwoch"</span>, <span class="st">"donnerstag"</span>, <span class="st">"freitag"</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"samstag"</span>, <span class="st">"sonntag"</span>, <span class="st">"januar"</span>, <span class="st">"februar"</span>, <span class="st">"märz"</span>, <span class="st">"april"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"mai"</span>, <span class="st">"juni"</span>, <span class="st">"juli"</span>, <span class="st">"august"</span>, <span class="st">"september"</span>, <span class="st">"oktober"</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"november"</span>, <span class="st">"dezember"</span>, <span class="st">"schweiz"</span>, <span class="st">"schweizer"</span>, <span class="st">"schweizerin"</span>)</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(german_stopwords, media_stopwords)</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">unique</span>(stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(all_stopwords))</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>all_stopwords <span class="ot">&lt;-</span> all_stopwords[<span class="fu">nzchar</span>(all_stopwords)]</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Tokenisierung und Preprocessing</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(feminizid_corpus,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>                          <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Stemming (optional)</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(feminizid_tokens, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Then multi-word expressions (now with base forms)</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplified patterns - base forms are sufficient</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Uses simplified_patterns defined in text-config</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Compound multi-word expressions into single tokens</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(feminizid_tokens, </span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== TEXT PREPROCESSING STEPS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== TEXT PREPROCESSING STEPS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"1. Stemming first: reduces inflectional variants</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. Stemming first: reduces inflectional variants</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   häusliche/häuslicher \u2192 häusl, tötung \u2192 töt, frauen \u2192 frau</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   häusliche/häuslicher → häusl, tötung → töt, frauen → frau</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"2. Then multi-word expressions:"</span>, <span class="fu">length</span>(simplified_patterns), <span class="st">"word pairs</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. Then multi-word expressions: 16 word pairs</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"   häusl + gewalt \u2192 häusl_gewalt (captures all inflections)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   häusl + gewalt → häusl_gewalt (captures all inflections)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"3. Benefit: one pattern captures multiple variants</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3. Benefit: one pattern captures multiple variants</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Document-Feature-Matrix</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>feminizid_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(feminizid_tokens)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Trimming: consistent parameters (both as proportions)</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on quanteda documentation: https://quanteda.io/reference/dfm_trim.html</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>feminizid_dfm_trimmed <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(feminizid_dfm, </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">min_docfreq =</span> <span class="fl">0.0003</span>,  <span class="co"># Min 0.03% (~11 docs at 35k)</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">max_docfreq =</span> <span class="fl">0.90</span>,    <span class="co"># Max 90% of documents</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">docfreq_type =</span> <span class="st">"prop"</span>)  <span class="co"># Both as proportions</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== TEXT PREPROCESSING ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== TEXT PREPROCESSING ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Documents:"</span>, <span class="fu">ndoc</span>(feminizid_dfm), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Documents: 35776 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original Features:"</span>, <span class="fu">nfeat</span>(feminizid_dfm), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Features: 515236 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"After trimming:"</span>, <span class="fu">nfeat</span>(feminizid_dfm_trimmed), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>After trimming: 71177 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sparsity:"</span>, <span class="fu">round</span>(<span class="fu">sparsity</span>(feminizid_dfm_trimmed), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sparsity: 0.997 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most frequent words</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">25</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== MOST FREQUENT WORDS ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(top_features)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">WARN: No features after trimming - adjust parameters</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== MOST FREQUENT WORDS ===
           frau            kind hauslich_gewalt            mann           gross 
          83622           51100           40580           38561           37180 
        polizei          gewalt          mensch             opf             leb 
          36128           33921           32198           31412           28886 
         kanton            lang             tag             tat          famili 
          27691           27109           26331           25932           24921 
            alt            land            zeit          person           polit 
          24441           24233           24003           23443           22465 
           fall            mutt            haus            film          zurich 
          21931           21573           20818           20134           19681 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint save (DFM and optional corpus)</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save_checkpoint</span>(feminizid_dfm_trimmed, <span class="st">"feminizid_dfm"</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_dfm_20260127_101136.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_dfm_20260127_101136.qs2"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (SAVE_CORPUS) {</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use quanteda.textplots if available, otherwise fallback to wordcloud</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"textplot_wordcloud"</span> <span class="sc">%in%</span> <span class="fu">ls</span>(<span class="st">"package:quanteda.textplots"</span>)) {</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">textplot_wordcloud</span>(feminizid_dfm_trimmed, </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min_count =</span> <span class="dv">30</span>,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alternative mit wordcloud package</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  freq_data <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">100</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wordcloud</span>(<span class="fu">names</span>(freq_data), freq_data, </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">min.freq =</span> <span class="dv">30</span>, <span class="at">max.words =</span> <span class="dv">100</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>),</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">random.order =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature frequency over time (normalized)</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 features by year</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">10</span>))</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency of these terms over years</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>yearly_terms <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(feminizid_dfm_trimmed, <span class="at">groups =</span> <span class="fu">docvars</span>(feminizid_dfm_trimmed, <span class="st">"year"</span>))</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Articles per year for normalization</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>articles_per_year <span class="ot">&lt;-</span> feminizid_corpus <span class="sc">%&gt;%</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">docvars</span>() <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span>  <span class="co"># Convert year to numeric</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, <span class="at">name =</span> <span class="st">"total_articles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct conversion for quanteda 3.0+ - without doc_id column</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>term_data <span class="ot">&lt;-</span> <span class="fu">convert</span>(yearly_terms[, top_terms], <span class="at">to =</span> <span class="st">"data.frame"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>doc_id) <span class="sc">%&gt;%</span>  <span class="co"># Remove doc_id column</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(yearly_terms)))</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Absolute frequencies</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>term_timeline_abs <span class="ot">&lt;-</span> term_data <span class="sc">%&gt;%</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"term"</span>, <span class="at">values_to =</span> <span class="st">"frequency"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalized frequencies (per 1000 articles)</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>term_timeline_norm <span class="ot">&lt;-</span> term_timeline_abs <span class="sc">%&gt;%</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(articles_per_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frequency_per_1000 =</span> (frequency <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_articles), total_articles <span class="sc">&gt;</span> <span class="dv">10</span>)  <span class="co"># Only years with &gt;10 articles</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: Absolute frequencies</span></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>p7a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_abs, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (absolute)"</span>, </span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Absolute frequency"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Normalized frequencies (per 1000 articles)</span></span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>p7b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_norm, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency_per_1000, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (normalized per 1000 articles)"</span>, </span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency per 1000 articles"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: Article distribution over time (sanity check)</span></span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a>p7c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(articles_per_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_articles)) <span class="sc">+</span></span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb99-51"><a href="#cb99-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-52"><a href="#cb99-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Article distribution over time"</span>, </span>
<span id="cb99-53"><a href="#cb99-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb99-54"><a href="#cb99-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)</span>
<span id="cb99-55"><a href="#cb99-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-56"><a href="#cb99-56" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p7a)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p7b) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p7c)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalization summary</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== NORMALIZATION SUMMARY ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== NORMALIZATION SUMMARY ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> articles_per_year <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_articles =</span> <span class="fu">min</span>(total_articles),</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_articles =</span> <span class="fu">max</span>(total_articles),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_articles =</span> <span class="fu">round</span>(<span class="fu">mean</span>(total_articles)),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_articles =</span> <span class="fu">median</span>(total_articles),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio_max_min =</span> <span class="fu">round</span>(<span class="fu">max</span>(total_articles) <span class="sc">/</span> <span class="fu">min</span>(total_articles), <span class="dv">1</span>)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Min articles per year:"</span>, summary_stats<span class="sc">$</span>min_articles, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Min articles per year: 305 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Max articles per year:"</span>, summary_stats<span class="sc">$</span>max_articles, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Max articles per year: 3296 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Durchschnitt:"</span>, summary_stats<span class="sc">$</span>mean_articles, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Durchschnitt: 1369 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Median:"</span>, summary_stats<span class="sc">$</span>median_articles, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Median: 917.5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Max/min ratio:"</span>, summary_stats<span class="sc">$</span>ratio_max_min, <span class="st">"x</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Max/min ratio: 10.8 x</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (summary_stats<span class="sc">$</span>ratio_max_min <span class="sc">&gt;</span> <span class="dv">5</span>) {</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"WARN: Strong distortion detected - normalized view recommended</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARN: Strong distortion detected - normalized view recommended</code></pre>
</div>
</div>
</section>
<section id="word2vec-frame-shift-diachronic" class="level2">
<h2 class="anchored" data-anchor-id="word2vec-frame-shift-diachronic">Word2Vec frame shift (diachronic)</h2>
<p>Train one Word2Vec model per time window and compare nearest neighbors across periods. Use the checkpoint load block to resume without retraining.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint load (Word2Vec)</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_models"</span>, <span class="st">"word2vec_models"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: word2vec_models</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_frame_shifts"</span>, <span class="st">"all_frame_shifts"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: word2vec_frame_shifts</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time windows (5-year bins)</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>time_windows <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2000-2004"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2004</span>),</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2005-2009"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">2009</span>), </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2010-2014"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2014</span>),</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2015-2019"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2015</span>, <span class="dv">2019</span>),</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2020-2025"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2025</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Target terms for frame-shift analysis</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>target_words <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Feminicide terms</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"feminizid"</span>, <span class="st">"femizid"</span>, <span class="st">"frauenmord"</span>,</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Violence terms (base forms after stemming)</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"hauslich_gewalt"</span>, <span class="st">"partnerschaft_gewalt"</span>, <span class="st">"bezieh_gewalt"</span>,</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Family framing</span></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"famili_drama"</span>, <span class="st">"famili_tragodi"</span>, <span class="st">"bezieh_tat"</span>,</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perpetrator terms</span></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ehemann"</span>, <span class="st">"partner"</span>, <span class="st">"freund"</span>, <span class="st">"expartner"</span>,</span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Victim terms</span></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"frau"</span>, <span class="st">"ehefrau"</span>, <span class="st">"partnerin"</span>, <span class="st">"opf"</span></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>target_map <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> target_words,</span>
<span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">normalized =</span> <span class="fu">normalize_terms_for_model</span>(target_words),</span>
<span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== WORD2VEC DIACHRONIC ANALYSIS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== WORD2VEC DIACHRONIC ANALYSIS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Time windows:"</span>, <span class="fu">length</span>(time_windows), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time windows: 5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Target words:"</span>, <span class="fu">length</span>(target_words), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Target words: 17 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Strategy: one model per window</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy: one model per window</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (TRAIN_FULL_MODEL) {</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Full-period model:"</span>, FULL_MODEL_LABEL, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Full-period model: all_2000-2025 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train models for each window + optional full-period model</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>word2vec_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>word2vec_embeddings <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional progress bar (per window)</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>use_progress <span class="ot">&lt;-</span> <span class="fu">requireNamespace</span>(<span class="st">"progress"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>use_progress) {</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Tip: install.packages('progress') for a progress bar."</span>)</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>build_w2v_text <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus_obj) {</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>  tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_obj,</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_obj, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(tokens_obj,</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> <span class="fu">sapply</span>(tokens_obj, paste, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>  txt[<span class="fu">nchar</span>(txt) <span class="sc">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>train_w2v <span class="ot">&lt;-</span> <span class="cf">function</span>(label, corpus_obj) {</span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a>  n_docs <span class="ot">&lt;-</span> <span class="fu">ndoc</span>(corpus_obj)</span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>  txt <span class="ot">&lt;-</span> <span class="fu">build_w2v_text</span>(corpus_obj)</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n_docs <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">||</span> <span class="fu">length</span>(txt) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"WARN: Skip"</span>, label, <span class="st">"- too little data</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Training Word2Vec for"</span>, label, <span class="st">"("</span>, n_docs, <span class="st">"docs,"</span>, <span class="fu">length</span>(txt), <span class="st">"texts)...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a>  w2v_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> txt,</span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"skip-gram"</span>,</span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">dim =</span> <span class="dv">100</span>,</span>
<span id="cb132-43"><a href="#cb132-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">20</span>,</span>
<span id="cb132-44"><a href="#cb132-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_count =</span> <span class="dv">5</span>,</span>
<span id="cb132-45"><a href="#cb132-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb132-46"><a href="#cb132-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">threads =</span> <span class="fu">max</span>(<span class="dv">1</span>, parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb132-47"><a href="#cb132-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb132-48"><a href="#cb132-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(word2vec<span class="sc">::</span>word2vec, w2v_args)</span>
<span id="cb132-49"><a href="#cb132-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-50"><a href="#cb132-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-51"><a href="#cb132-51" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="cf">if</span> (use_progress) progress<span class="sc">::</span>progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb132-52"><a href="#cb132-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"Training :current/:total [:bar] :percent :eta"</span>,</span>
<span id="cb132-53"><a href="#cb132-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> <span class="fu">length</span>(time_windows),</span>
<span id="cb132-54"><a href="#cb132-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">clear =</span> <span class="cn">FALSE</span>,</span>
<span id="cb132-55"><a href="#cb132-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">60</span></span>
<span id="cb132-56"><a href="#cb132-56" aria-hidden="true" tabindex="-1"></a>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb132-57"><a href="#cb132-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-58"><a href="#cb132-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows)) {</span>
<span id="cb132-59"><a href="#cb132-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_progress) pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb132-60"><a href="#cb132-60" aria-hidden="true" tabindex="-1"></a>  window_years <span class="ot">&lt;-</span> time_windows[[window_name]]</span>
<span id="cb132-61"><a href="#cb132-61" aria-hidden="true" tabindex="-1"></a>  window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb132-62"><a href="#cb132-62" aria-hidden="true" tabindex="-1"></a>    feminizid_corpus,</span>
<span id="cb132-63"><a href="#cb132-63" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb132-64"><a href="#cb132-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb132-65"><a href="#cb132-65" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb132-66"><a href="#cb132-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(model)) <span class="cf">next</span></span>
<span id="cb132-67"><a href="#cb132-67" aria-hidden="true" tabindex="-1"></a>  word2vec_models[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb132-68"><a href="#cb132-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-69"><a href="#cb132-69" aria-hidden="true" tabindex="-1"></a>  target_terms_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb132-70"><a href="#cb132-70" aria-hidden="true" tabindex="-1"></a>  available_words <span class="ot">&lt;-</span> <span class="fu">intersect</span>(target_terms_model, <span class="fu">rownames</span>(<span class="fu">as.matrix</span>(model)))</span>
<span id="cb132-71"><a href="#cb132-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_words) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb132-72"><a href="#cb132-72" aria-hidden="true" tabindex="-1"></a>    word2vec_embeddings[[window_name]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, available_words, <span class="at">type =</span> <span class="st">"embedding"</span>)</span>
<span id="cb132-73"><a href="#cb132-73" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb132-74"><a href="#cb132-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"WARN: No target words found in"</span>, window_name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb132-75"><a href="#cb132-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-76"><a href="#cb132-76" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training Word2Vec for 2000-2004 ( 2519 docs, 2519 texts)...
Training Word2Vec for 2005-2009 ( 3847 docs, 3847 texts)...
Training Word2Vec for 2010-2014 ( 4230 docs, 4230 texts)...
Training Word2Vec for 2015-2019 ( 7190 docs, 7190 texts)...
Training Word2Vec for 2020-2025 ( 17802 docs, 17802 texts)...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (TRAIN_FULL_MODEL) {</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  full_model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(FULL_MODEL_LABEL, feminizid_corpus)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(full_model)) {</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    word2vec_models[[FULL_MODEL_LABEL]] <span class="ot">&lt;-</span> full_model</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training Word2Vec for all_2000-2025 ( 35776 docs, 35776 texts)...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== TRAINING DONE ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== TRAINING DONE ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Models:"</span>, <span class="fu">length</span>(word2vec_models), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Models: 6 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Always save a checkpoint after training (expensive step)</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_checkpoint</span>(word2vec_models, <span class="st">"word2vec_models"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: word2vec_models_20260127_102649.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_models_20260127_102649.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>window_models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_models), <span class="fu">names</span>(time_windows))</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(window_models) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Frame-shift analysis: what is near what?</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  frame_shift_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(target_map))) {</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>    target_word <span class="ot">&lt;-</span> target_map<span class="sc">$</span>original[i]</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>    target_norm <span class="ot">&lt;-</span> target_map<span class="sc">$</span>normalized[i]</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find nearest neighbors for each time window</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>    neighbors_over_time <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (window_name <span class="cf">in</span> window_models) {</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>      model <span class="ot">&lt;-</span> word2vec_models[[window_name]]</span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check whether term exists in model vocabulary</span></span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (target_norm <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">as.matrix</span>(model))) {</span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find top 10 nearest words</span></span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>        similar_words <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, target_norm, <span class="at">type =</span> <span class="st">"nearest"</span>, <span class="at">top_n =</span> <span class="dv">10</span>)</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(similar_words) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(similar_words) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>          neighbors_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">period =</span> window_name,</span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">target =</span> target_word,</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">neighbor =</span> similar_words[[<span class="dv">1</span>]]<span class="sc">$</span>term2,</span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">similarity =</span> similar_words[[<span class="dv">1</span>]]<span class="sc">$</span>similarity,</span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">rank =</span> similar_words[[<span class="dv">1</span>]]<span class="sc">$</span>rank,</span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a>          neighbors_over_time[[window_name]] <span class="ot">&lt;-</span> neighbors_df</span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine all time windows for this target term</span></span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(neighbors_over_time) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a>      combined_neighbors <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, neighbors_over_time)</span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a>      frame_shift_results[[target_word]] <span class="ot">&lt;-</span> combined_neighbors</span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Alle Ergebnisse kombinieren</span></span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(frame_shift_results) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb143-46"><a href="#cb143-46" aria-hidden="true" tabindex="-1"></a>    all_frame_shifts <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, frame_shift_results)</span>
<span id="cb143-47"><a href="#cb143-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save_checkpoint</span>(all_frame_shifts, <span class="st">"word2vec_frame_shifts"</span>)</span>
<span id="cb143-48"><a href="#cb143-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-49"><a href="#cb143-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"=== FRAME SHIFT ANALYSIS ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb143-50"><a href="#cb143-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Analyzed terms:"</span>, <span class="fu">length</span>(frame_shift_results), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb143-51"><a href="#cb143-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Total neighbor relations:"</span>, <span class="fu">nrow</span>(all_frame_shifts), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb143-52"><a href="#cb143-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-53"><a href="#cb143-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top 3 neighbors per time window for all target terms</span></span>
<span id="cb143-54"><a href="#cb143-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (term <span class="cf">in</span> <span class="fu">names</span>(frame_shift_results)) {</span>
<span id="cb143-55"><a href="#cb143-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== TARGET:"</span>, term, <span class="st">"===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb143-56"><a href="#cb143-56" aria-hidden="true" tabindex="-1"></a>      term_shifts <span class="ot">&lt;-</span> frame_shift_results[[term]]</span>
<span id="cb143-57"><a href="#cb143-57" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb143-58"><a href="#cb143-58" aria-hidden="true" tabindex="-1"></a>      top_neighbors <span class="ot">&lt;-</span> term_shifts <span class="sc">%&gt;%</span></span>
<span id="cb143-59"><a href="#cb143-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb143-60"><a href="#cb143-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(period, neighbor, similarity) <span class="sc">%&gt;%</span></span>
<span id="cb143-61"><a href="#cb143-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(period, <span class="sc">-</span>similarity)</span>
<span id="cb143-62"><a href="#cb143-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb143-63"><a href="#cb143-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(top_neighbors)</span>
<span id="cb143-64"><a href="#cb143-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-65"><a href="#cb143-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb143-66"><a href="#cb143-66" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: word2vec_frame_shifts_20260127_102706.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>=== FRAME SHIFT ANALYSIS ===
Analyzed terms: 11 
Total neighbor relations: 490 

=== TARGET: feminizid ===
               period        neighbor similarity
2005-2009.1 2005-2009        monárrez  0.7821793
2005-2009.2 2005-2009         femizid  0.7408340
2005-2009.3 2005-2009     zuzuschreib  0.7262739
2015-2019.1 2015-2019        zumthema  0.8412773
2015-2019.2 2015-2019 internetprasenz  0.8279375
2015-2019.3 2015-2019    anprangerten  0.8179348
2020-2025.1 2020-2025         femizid  0.8123344
2020-2025.2 2020-2025       videolaut  0.7944704
2020-2025.3 2020-2025      frauenmord  0.7886227

=== TARGET: femizid ===
               period            neighbor similarity
2005-2009.1 2005-2009            monárrez  0.7949943
2005-2009.2 2005-2009          anprangert  0.7626025
2005-2009.3 2005-2009                frau  0.7469070
2015-2019.1 2015-2019         geschlechts  0.8093230
2015-2019.2 2015-2019       demonstranten  0.7996460
2015-2019.3 2015-2019           lohnabbau  0.7904671
2020-2025.1 2020-2025              jahrin  0.8432729
2020-2025.2 2020-2025 demrechercheprojekt  0.8315135
2020-2025.3 2020-2025     frauenmordezwar  0.8274826

=== TARGET: frauenmord ===
               period             neighbor similarity
2000-2004.1 2000-2004                 mord  0.7105407
2000-2004.2 2000-2004             begangen  0.7098951
2000-2004.3 2000-2004            serientat  0.7033059
2005-2009.1 2005-2009          guatemaltek  0.7423420
2005-2009.2 2005-2009            guatemala  0.7311273
2005-2009.3 2005-2009                 mord  0.7078151
2010-2014.1 2010-2014         femminicidio  0.7563847
2010-2014.2 2010-2014          drogenkrieg  0.7128879
2010-2014.3 2010-2014           grenzstadt  0.7033897
2015-2019.1 2015-2019 geschlechtsselektion  0.7903392
2015-2019.2 2015-2019        demonstranten  0.7857287
2015-2019.3 2015-2019            heldenduo  0.7567490
2020-2025.1 2020-2025         behauptetein  0.8008795
2020-2025.2 2020-2025              femizid  0.8008451
2020-2025.3 2020-2025            feminizid  0.7886227

=== TARGET: ehemann ===
               period      neighbor similarity
2000-2004.1 2000-2004       ehefrau  0.7565253
2000-2004.2 2000-2004         hafft  0.7480690
2000-2004.3 2000-2004       mathild  0.7474957
2005-2009.1 2005-2009       ehefrau  0.7816455
2005-2009.2 2005-2009       zehntag  0.7536196
2005-2009.3 2005-2009    schorndorf  0.7437881
2010-2014.1 2010-2014     durchlitt  0.7947401
2010-2014.2 2010-2014   portugiesin  0.7786648
2010-2014.3 2010-2014    entfliehen  0.7784390
2015-2019.1 2015-2019          tink  0.7938489
2015-2019.2 2015-2019 lebensgefahrt  0.7787259
2015-2019.3 2015-2019    einmischen  0.7604018
2020-2025.1 2020-2025       ehefrau  0.8138151
2020-2025.2 2020-2025     kusterbei  0.8082872
2020-2025.3 2020-2025        vivenn  0.8079073

=== TARGET: partner ===
               period     neighbor similarity
2000-2004.1 2000-2004    gewalttat  0.7728138
2000-2004.2 2000-2004  lebenspartn  0.7646855
2000-2004.3 2000-2004 sanktioniert  0.7596838
2005-2009.1 2005-2009      expartn  0.8570114
2005-2009.2 2005-2009    gewalttat  0.7994906
2005-2009.3 2005-2009      partner  0.7854999
2010-2014.1 2010-2014      partner  0.7557749
2010-2014.2 2010-2014    partnerin  0.7533453
2010-2014.3 2010-2014     verfloss  0.7438560
2015-2019.1 2015-2019     weberall  0.8131511
2015-2019.2 2015-2019      bircher  0.8108395
2015-2019.3 2015-2019      expartn  0.8066231
2020-2025.1 2020-2025     selected  0.8463517
2020-2025.2 2020-2025      honored  0.8450118
2020-2025.3 2020-2025    umbringen  0.8278512

=== TARGET: freund ===
               period      neighbor similarity
2000-2004.1 2000-2004    niederlenz  0.7617286
2000-2004.2 2000-2004   schulkolleg  0.7441838
2000-2004.3 2000-2004         funkt  0.7384567
2005-2009.1 2005-2009      freundin  0.7628064
2005-2009.2 2005-2009       gehangt  0.7489575
2005-2009.3 2005-2009         gotti  0.7206666
2010-2014.1 2010-2014    mitansehen  0.8043091
2010-2014.2 2010-2014      freundin  0.7941930
2010-2014.3 2010-2014          gjyl  0.7602950
2015-2019.1 2015-2019 abschlussball  0.8057320
2015-2019.2 2015-2019    alarmieren  0.7899480
2015-2019.3 2015-2019       olbaron  0.7878486
2020-2025.1 2020-2025       grussei  0.9409749
2020-2025.2 2020-2025       grussea  0.9372072
2020-2025.3 2020-2025      freundin  0.7969713

=== TARGET: expartner ===
               period     neighbor similarity
2005-2009.1 2005-2009        partn  0.8570114
2005-2009.2 2005-2009      partner  0.8404580
2005-2009.3 2005-2009       eheahn  0.8160830
2015-2019.1 2015-2019        partn  0.8066231
2015-2019.2 2015-2019 100angestieg  0.7716145
2015-2019.3 2015-2019     parisauf  0.7604225
2020-2025.1 2020-2025        partn  0.7892953
2020-2025.2 2020-2025      jahrbei  0.7725000
2020-2025.3 2020-2025    ausweisen  0.7705716

=== TARGET: frau ===
               period            neighbor similarity
2000-2004.1 2000-2004                mann  0.8591373
2000-2004.2 2000-2004              gewalt  0.8416671
2000-2004.3 2000-2004           vaterlaus  0.8049695
2005-2009.1 2005-2009                mann  0.8681588
2005-2009.2 2005-2009 menschenrechtsprobl  0.8292652
2005-2009.3 2005-2009             expartn  0.7979239
2010-2014.1 2010-2014                mann  0.8577321
2010-2014.2 2010-2014              gewalt  0.8397373
2010-2014.3 2010-2014   beziehungspartner  0.8122747
2015-2019.1 2015-2019                mann  0.8499315
2015-2019.2 2015-2019    gegenuberstellen  0.8203056
2015-2019.3 2015-2019              gewalt  0.8149727
2020-2025.1 2020-2025     mehrbettzimmern  0.8410741
2020-2025.2 2020-2025                mann  0.8368466
2020-2025.3 2020-2025      reflexionwarum  0.8345147

=== TARGET: ehefrau ===
               period            neighbor similarity
2000-2004.1 2000-2004            erschoss  0.8118369
2000-2004.2 2000-2004          erschossen  0.7997985
2000-2004.3 2000-2004             toteein  0.7958543
2005-2009.1 2005-2009       handfeuerwaff  0.7836727
2005-2009.2 2005-2009       schwiegermutt  0.7834464
2005-2009.3 2005-2009             ehemann  0.7816455
2010-2014.1 2010-2014               peilz  0.8237371
2010-2014.2 2010-2014 verdunkelungsgefahr  0.7839897
2010-2014.3 2010-2014       schwiegermutt  0.7796716
2015-2019.1 2015-2019             driburg  0.7731094
2015-2019.2 2015-2019       dringlichkeit  0.7689864
2015-2019.3 2015-2019          verbrennen  0.7641038
2020-2025.1 2020-2025          chselenska  0.8479235
2020-2025.2 2020-2025             warntal  0.8472535
2020-2025.3 2020-2025     niedergestochen  0.8383755

=== TARGET: partnerin ===
               period            neighbor similarity
2000-2004.1 2000-2004               partn  0.7155887
2000-2004.2 2000-2004          partnerinn  0.7097885
2000-2004.3 2000-2004           gewalttat  0.7075956
2005-2009.1 2005-2009   rechtsvertreterin  0.8127255
2005-2009.2 2005-2009 desinteressenerklar  0.8024815
2005-2009.3 2005-2009  desinteresseerklar  0.7831761
2010-2014.1 2010-2014               partn  0.7533453
2010-2014.2 2010-2014               luela  0.7353637
2010-2014.3 2010-2014              marlèn  0.7307681
2015-2019.1 2015-2019               partn  0.7647541
2015-2019.2 2015-2019           erstochen  0.7621194
2015-2019.3 2015-2019               plagt  0.7577505
2020-2025.1 2020-2025     augenscheinlich  0.8155651
2020-2025.2 2020-2025             abmahnt  0.8024435
2020-2025.3 2020-2025              vétroz  0.8006422

=== TARGET: opf ===
               period                   neighbor similarity
2000-2004.1 2000-2004                        tat  0.8662112
2000-2004.2 2000-2004                 ungeahndet  0.8063393
2000-2004.3 2000-2004                    anzeige  0.8021130
2005-2009.1 2005-2009                        tat  0.8610573
2005-2009.2 2005-2009                    expartn  0.7901979
2005-2009.3 2005-2009                  aggressor  0.7799734
2010-2014.1 2010-2014                        tat  0.8754184
2010-2014.2 2010-2014                   taterinn  0.8060829
2010-2014.3 2010-2014          beziehungspartner  0.7946025
2015-2019.1 2015-2019                        tat  0.8452027
2015-2019.2 2015-2019                   ausgehen  0.8076611
2015-2019.3 2015-2019          mitverantwortlich  0.7979091
2020-2025.1 2020-2025                        tat  0.8688772
2020-2025.2 2020-2025 mannlichkeitsvorstellungen  0.8176686
2020-2025.3 2020-2025           erlebnisberichte  0.8134930</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisierung 1: Heatmap der Frame-Shifts</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Top neighbors across all time windows</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>top_shifts <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity), </span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(periods_present <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least in 2 time windows</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(target, <span class="sc">-</span>avg_similarity)</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for selected target terms</span></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a>selected_targets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hauslich_gewalt"</span>, <span class="st">"feminizid"</span>, <span class="st">"famili_drama"</span>)</span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a>available_targets <span class="ot">&lt;-</span> <span class="fu">intersect</span>(selected_targets, <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target))</span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(available_targets) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>  heatmap_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(target <span class="sc">%in%</span> available_targets, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(period, target, neighbor, similarity)</span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a>  p_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heatmap_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>target, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Ähnlichkeit"</span>) <span class="sc">+</span></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word2Vec frame shifts over time"</span>,</span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Which words are close to the target terms?"</span>,</span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbor terms"</span>)</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_heatmap)</span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot per target (top 5 neighbors per time window)</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (term <span class="cf">in</span> <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target)) {</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  term_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(target <span class="sc">==</span> term, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(period, neighbor, similarity)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(term_data) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  p_term <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec frame shifts:"</span>, term),</span>
<span id="cb147-16"><a href="#cb147-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbors"</span>)</span>
<span id="cb147-17"><a href="#cb147-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-18"><a href="#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_term)</span>
<span id="cb147-19"><a href="#cb147-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization 2: stability vs. change</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>stability_analysis <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">similarity_sd =</span> <span class="fu">sd</span>(similarity),</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">stability =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Stable"</span>,</span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">"Moderately stable"</span>, </span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Changing"</span></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== STABILITY OF FRAME RELATIONS ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== STABILITY OF FRAME RELATIONS ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>stability_summary <span class="ot">&lt;-</span> stability_analysis <span class="sc">%&gt;%</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stability) <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>stability_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stability"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["percentage"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Changing","2":"439","3":"98.0"},{"1":"Moderately stable","2":"3","3":"0.7"},{"1":"Stable","2":"6","3":"1.3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="local-embedding-visualization" class="level2">
<h2 class="anchored" data-anchor-id="local-embedding-visualization">Local embedding visualization</h2>
<p>We reduce the 100-dimensional Word2Vec space to 3D with UMAP to inspect local semantic neighborhoods. UMAP builds a nearest-neighbor graph in the original space and optimizes a low-dimensional layout that preserves those local neighborhoods. The plotted axes are not interpretable dimensions; they are coordinates of a layout that preserves local structure.</p>
<p>Interpretation: - Points close in 3D usually appear in similar contexts in the corpus. - Tight clusters suggest a coherent framing or shared discourse context. - Isolated points can indicate rare usage or distinct framing.</p>
<p>Caveats: - Distances are mainly meaningful locally (nearest neighbors). - Global positions and axis directions should not be over-interpreted.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prefer full-period model if available, otherwise latest window</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (FULL_MODEL_LABEL <span class="sc">%in%</span> <span class="fu">names</span>(word2vec_models)) {</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  viz_window <span class="ot">&lt;-</span> FULL_MODEL_LABEL</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  available_windows <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_models), <span class="fu">names</span>(time_windows))</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_windows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(available_windows, <span class="dv">1</span>)</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">names</span>(word2vec_models), <span class="dv">1</span>)</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Using window: "</span>, viz_window)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using window: all_2000-2025</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> word2vec_models[[viz_window]]</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>target_terms_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(target_terms_model, <span class="fu">rownames</span>(<span class="fu">as.matrix</span>(model)))</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(in_vocab) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No target words found in model vocabulary."</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>  neighbor_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(in_vocab, <span class="cf">function</span>(term) {</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    nn <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, term, <span class="at">type =</span> <span class="st">"nearest"</span>, <span class="at">top_n =</span> <span class="dv">10</span>)[[<span class="dv">1</span>]]<span class="sc">$</span>term2</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(<span class="fu">c</span>(term, nn))</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>  vocab <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(neighbor_list))</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>  vectors <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(model)[vocab, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>  umap_coords <span class="ot">&lt;-</span> umap<span class="sc">::</span><span class="fu">umap</span>(vectors, <span class="at">n_components =</span> <span class="dv">3</span>)<span class="sc">$</span>layout</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>  embedding_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> vocab,</span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> umap_coords[, <span class="dv">1</span>],</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> umap_coords[, <span class="dv">2</span>],</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> umap_coords[, <span class="dv">3</span>],</span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">ifelse</span>(vocab <span class="sc">%in%</span> in_vocab, <span class="st">"target"</span>, <span class="st">"neighbor"</span>),</span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a>  p_umap <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(</span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a>    embedding_df,</span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z, <span class="at">color =</span> <span class="sc">~</span>type, <span class="at">text =</span> <span class="sc">~</span>term,</span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.85</span>)</span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a>    plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec embeddings (UMAP 3D):"</span>, viz_window),</span>
<span id="cb153-34"><a href="#cb153-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb153-35"><a href="#cb153-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 1"</span>),</span>
<span id="cb153-36"><a href="#cb153-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 2"</span>),</span>
<span id="cb153-37"><a href="#cb153-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 3"</span>)</span>
<span id="cb153-38"><a href="#cb153-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb153-39"><a href="#cb153-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb153-40"><a href="#cb153-40" aria-hidden="true" tabindex="-1"></a>  p_umap</span>
<span id="cb153-41"><a href="#cb153-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-9eceb20dc2a931752ae4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9eceb20dc2a931752ae4">{"x":{"visdat":{"d6c842c4963b":["function () ","plotlyVisDat"]},"cur_data":"d6c842c4963b","attrs":{"d6c842c4963b":{"x":{},"y":{},"z":{},"text":{},"mode":"markers","marker":{"size":7,"opacity":0.84999999999999998},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Word2Vec embeddings (UMAP 3D): all_2000-2025","scene":{"xaxis":{"title":"UMAP dim 1"},"yaxis":{"title":"UMAP dim 2"},"zaxis":{"title":"UMAP dim 3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.18946750665213852,0.38257678852290194,-0.22294890441955656,0.19103260361011121,0.15181118402324972,0.2656286085471648,0.20468312692186069,0.67010847849234512,0.19412959143943234,0.28784132414665325,0.47128619486235912,-0.088559331247471312,-0.043021371145040156,-0.30738296229977791,0.38624805284524333,0.22304496000030372,-0.022586536605182683,0.54871252778356505,0.17274060133155331,0.062267718259281693,0.57822675279705538,-0.20583138677129395,0.071578857865049847,-0.41156410205969945,0.55825246406184492,0.0085811293535332234,-0.0084649226111296362,0.50854136084806845,0.31813241339496851,-0.38131491098626352,0.26367593089178382,-0.36160068509654281,0.36378194899902083,0.47514149411294287,-0.17243783985053182,-0.38113140499331766,0.33516559407824281,0.039513633346509466,0.21681038173828521,-0.095295989524262881,-0.545098562262745,-0.30198328869335667,-0.13555568963326475,-0.081778641604766819,-0.80697709278597807,-0.45788141163331947,-0.39173339501978821,-0.44744304286838199,-0.36295435510642582,-0.48406897091881845,-0.055998764476092394,0.018317497291223225,0.73781563201084743,-0.36451334393424079,-0.0062666205973842337,0.0031390427199853095,-0.57950348328591039,0.76347413774666628,0.29072312095165587,0.23939808774559193,0.68840352834830765,0.86156165212064684,0.020646315344138921,0.7457148289905996,0.38919784764728993,0.24056587155984038,-0.030007388257986708,-0.40778395764699293,0.096322128027145723,-0.57184459900640583,-0.43252651559724692,-0.054059291961852315,-0.58525632271331762,-0.40210239956930632,-0.26240258745181022,0.26893753064960524,-0.66220364110580854,0.53908063037819876,0.52561340022743053,0.35033188244199209,-0.11319536084304531,-0.10893933421520154,-0.60281194775222424,-0.38391234168765304,-0.41455102555607154,-0.18689846432573134,-0.20968788726533508,-0.52358550607448429,-0.16508719409120479,-0.67191698848870007,-0.52341338357757183],"y":[1.979554618942875,2.0253262550852544,2.0911501872661988,1.9126435502484758,1.7215041225889895,1.6459789786362518,2.0974675044792308,2.2405443073539173,2.4205798165628853,2.6096717717005875,2.5608417083734287,2.7709149408470961,2.9272457532220724,2.792960285611263,2.556974129062763,2.7341830329165231,2.9578414719169204,2.1772318055400848,2.0846452477953559,2.1600321046458957,2.4703184876001534,2.0554547922598685,2.2589495556050032,-0.92460105087117406,-0.88876713355901016,-1.3831926831619676,-1.4650408511426232,-0.88081874973305552,-1.3690840410086953,-0.73583361714480677,-1.4290309588844019,-2.1105716530716911,-0.80983800672149298,-0.7659477002400874,-0.55821187662030536,-1.0016152437539487,-0.97226929989008648,-1.286548357123966,-0.71735939445809405,0.72684262004031053,-2.3835554907196403,-2.1111126781271619,-2.5762384945271246,-2.4909857287923245,-2.136880639155867,-2.4142879607371701,-2.5715012278799305,-2.6786231782584577,-2.1882670671578341,-1.4656217423755351,0.82620334579590349,0.63994832971414162,-1.0565884132099428,0.14583023842056433,0.42569140434755098,0.31363427820353457,-0.13757978674055138,1.0598367062246643,1.547595331998151,1.3509231857156434,1.5403750953302362,1.1098990036720062,1.306121822270649,0.77870118166798885,1.6697263509999654,1.5393997828990869,-1.8713303134295236,-1.6350671223501063,-1.7475911837031943,-1.875914461384109,-2.2103759969136241,-2.1046731291447704,-2.1162229485523207,-2.3196186294401864,-2.1206577425576665,-1.3435044220337278,-2.1536764018407286,-1.758400133040904,-1.7325469213645306,-1.8424695323914859,-2.3016570164083943,-2.204131425599988,0.10417201985795478,0.81281729835124616,0.62314375916420417,0.57458996939501583,0.9824365553211073,0.34668692616735231,0.98524634576868608,-0.20892123267548768,-0.25796033783600641],"z":[-2.0286625517977996,-1.3229183003857377,-1.6766473886726376,-1.0070025743405959,-0.032502732009286106,-1.0817645139833205,-1.6086585479613027,-1.4523962096464333,-0.99607176818184362,-1.3666124909162396,-1.2498838991461696,-1.2939792050849679,-1.4634206021083194,-1.3960010447687856,-1.7247012913585258,-1.3969480838020547,-1.6204206927621114,-2.2804302744546079,-2.4655017408500544,-2.0565766493686408,-2.1425538906659898,-2.0674027694374204,-2.3178448431992273,0.426258935166973,0.81448655298552941,0.52385527999705372,1.3802878241306531,0.78410808185946057,1.1624789139801421,1.5238965439712833,0.91782701795317023,0.95118711924681865,0.0029253557740034353,-0.053593352671910122,-0.31055277029971018,-0.044718509604952494,-0.11880419984596413,0.013666662229874227,-0.46860594604551409,0.27224246949360564,-0.032274855637367317,-0.18679526680743175,-0.22925780343511404,-0.10151494727735777,-0.40382508834611608,-0.077512844036086825,-0.71889499598179363,-0.25511121959082406,-0.44152092417956545,-0.18743384263626783,-0.54844175598830969,-0.72668600768342584,0.80235457794411813,-0.51902325103618807,-0.26348954609360131,-0.35747228966098543,-0.36397329609699858,0.54763403334949112,0.56696187894244199,0.59442796863705194,0.55464522166750596,0.63508408362739699,1.0156144513942051,0.60746169744397083,0.36867542925898444,0.96233398072530196,1.8275938142648747,1.7630693694268089,1.7799998901174146,1.7741551800263653,1.6519233593933098,2.001881201277115,1.5910067959157062,1.3383063174459751,2.0466833110485121,0.073535817005426551,1.3296780604998502,-0.6459200067618216,0.15954489016043372,-0.52905023010510455,0.7440857253541473,-0.62059209905539037,1.6020710935835258,0.88675891170230936,1.3554706211026051,1.2982395785880285,1.0727827267360763,1.4960141057865757,1.216840210909419,1.7015822538058019,1.5637079103587086],"text":["fehlanzeige","femiziden","femizidrat","regierungszahl","anprangerten","zumthema","klassist","beratunggenau","monatenal","bernsollt","frauenmordezwar","demrechercheprojekt","rechercheprojekt","totung","kernforder","riedener23","behauptetein","bordierd","menos","mord","einereportag","bestraftdi","kingein","lebenspartn","kusterbei","prozessgeg","zwangen","vivenn","verkauftist","tatverdachtig","keystonemodel","mitansehen","honored","selected","familienmitglied","vétroz","partnern","ex","partner","94’000","grussei","grussea","freundin","niethammerim","bekannten","rechtsextremismusverharmlos","intimus","freundinn","besitzanspruche","monzes","wurdenpro","ausweisen","burchard","familienangehor","109","mannern00","getotet","mann","menschenrechtsverletzung","800’00","verharmlosen","kinderlilli","aufzustocken","dieberat","gewalt","karrierechancen","chselenska","manntotet","warntal","umbrachte","driburg","betitelte","niedergestochen","eingestochen","omid","augenscheinlich","lebenspartnerin","abmahnt","webersean","eifersucht","obstbergquartier","umbringen","tat","11’508","erlebnisberichte","guggisbergbabys","schamenweit","gewarntdi","aufzufangen","taterin","polizeibekanntbei"],"mode":"markers","marker":{"color":"rgba(102,194,165,1)","size":7,"opacity":0.84999999999999998,"line":{"color":"rgba(102,194,165,1)"}},"type":"scatter3d","name":"neighbor","textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[0.12705756687003797,-0.012504395203601477,0.26416504622172815,-0.25280457224201985,-0.21543462309639863,0.14537672996566869,0.29958781350087965,0.059101305141520476,-0.39107204794117695,0.52158601205171906,-0.42720005077649975],"y":[1.8684493413095211,2.5121998774093206,2.4380747816953234,-1.4171163370462567,-1.9306215907606026,-0.81568119925136395,-1.5555432216563099,0.14547363083497125,-2.3479625550630163,1.3014240836765805,0.45415918499846664],"z":[-1.4445361021781014,-1.5290902041716072,-2.1457079426740076,1.2280608950405922,1.8812439783884285,-0.43075948120329954,-0.3461347995240307,-0.49257854943350088,-0.18633742038021994,0.62838677629888373,1.3880747393285728],"text":["feminizid","femizid","frauenmord","ehemann","ehefrau","partn","partnerin","expartn","freund","frau","opf"],"mode":"markers","marker":{"color":"rgba(141,160,203,1)","size":7,"opacity":0.84999999999999998,"line":{"color":"rgba(141,160,203,1)"}},"type":"scatter3d","name":"target","textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="iterative-query-expansion" class="level2">
<h2 class="anchored" data-anchor-id="iterative-query-expansion">Iterative query expansion</h2>
<p>We use the word2vec neighborhoods to suggest additional search terms that may reflect earlier or alternative framing. It provides a ranked candidate list for curation which can then be added to a subsequent API query in an iterative proggress.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split original keywords into action vs. relation/context (no new terms)</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gewalt gegen Frauen"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span>,</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-13"><a href="#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Seeds in the model vocabulary (normalized form)</span></span>
<span id="cb154-14"><a href="#cb154-14" aria-hidden="true" tabindex="-1"></a>seed_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb154-15"><a href="#cb154-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-16"><a href="#cb154-16" aria-hidden="true" tabindex="-1"></a>collect_neighbors <span class="ot">&lt;-</span> <span class="cf">function</span>(model, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb154-17"><a href="#cb154-17" aria-hidden="true" tabindex="-1"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(<span class="fu">as.matrix</span>(model)))</span>
<span id="cb154-18"><a href="#cb154-18" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb154-19"><a href="#cb154-19" aria-hidden="true" tabindex="-1"></a>    nn <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, seed, <span class="at">type =</span> <span class="st">"nearest"</span>, <span class="at">top_n =</span> top_n)[[<span class="dv">1</span>]]</span>
<span id="cb154-20"><a href="#cb154-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb154-21"><a href="#cb154-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb154-22"><a href="#cb154-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> nn<span class="sc">$</span>term2,</span>
<span id="cb154-23"><a href="#cb154-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">similarity =</span> nn<span class="sc">$</span>similarity,</span>
<span id="cb154-24"><a href="#cb154-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">rank =</span> nn<span class="sc">$</span>rank,</span>
<span id="cb154-25"><a href="#cb154-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb154-26"><a href="#cb154-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb154-27"><a href="#cb154-27" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb154-28"><a href="#cb154-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb154-29"><a href="#cb154-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb154-30"><a href="#cb154-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-31"><a href="#cb154-31" aria-hidden="true" tabindex="-1"></a>neighbors_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_models), <span class="cf">function</span>(w) {</span>
<span id="cb154-32"><a href="#cb154-32" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> word2vec_models[[w]]</span>
<span id="cb154-33"><a href="#cb154-33" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors</span>(model, seed_terms, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb154-34"><a href="#cb154-34" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb154-35"><a href="#cb154-35" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb154-36"><a href="#cb154-36" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb154-37"><a href="#cb154-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-38"><a href="#cb154-38" aria-hidden="true" tabindex="-1"></a>candidate_summary <span class="ot">&lt;-</span> neighbors_all <span class="sc">%&gt;%</span></span>
<span id="cb154-39"><a href="#cb154-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(term <span class="sc">%in%</span> seed_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb154-40"><a href="#cb154-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb154-41"><a href="#cb154-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb154-42"><a href="#cb154-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb154-43"><a href="#cb154-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_similarity =</span> <span class="fu">max</span>(similarity),</span>
<span id="cb154-44"><a href="#cb154-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb154-45"><a href="#cb154-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb154-46"><a href="#cb154-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb154-47"><a href="#cb154-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb154-48"><a href="#cb154-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity))</span>
<span id="cb154-49"><a href="#cb154-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-50"><a href="#cb154-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Heuristic: candidates that are close to multiple seeds and appear across windows</span></span>
<span id="cb154-51"><a href="#cb154-51" aria-hidden="true" tabindex="-1"></a>suggested_terms <span class="ot">&lt;-</span> candidate_summary <span class="sc">%&gt;%</span></span>
<span id="cb154-52"><a href="#cb154-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean_similarity <span class="sc">&gt;=</span> <span class="fl">0.35</span>, seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb154-53"><a href="#cb154-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(term)</span>
<span id="cb154-54"><a href="#cb154-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-55"><a href="#cb154-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic cleanup: keep alpha tokens, remove very short / rare items</span></span>
<span id="cb154-56"><a href="#cb154-56" aria-hidden="true" tabindex="-1"></a>term_freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(feminizid_dfm_trimmed, <span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span></span>
<span id="cb154-57"><a href="#cb154-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(feature, frequency)</span>
<span id="cb154-58"><a href="#cb154-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-59"><a href="#cb154-59" aria-hidden="true" tabindex="-1"></a>suggested_terms_clean <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(suggested_terms)</span>
<span id="cb154-60"><a href="#cb154-60" aria-hidden="true" tabindex="-1"></a>suggested_terms_clean <span class="ot">&lt;-</span> suggested_terms_clean[</span>
<span id="cb154-61"><a href="#cb154-61" aria-hidden="true" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(suggested_terms_clean, <span class="st">"^[[:alpha:]_]+$"</span>)</span>
<span id="cb154-62"><a href="#cb154-62" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb154-63"><a href="#cb154-63" aria-hidden="true" tabindex="-1"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">unique</span>(suggested_terms_clean)</span>
<span id="cb154-64"><a href="#cb154-64" aria-hidden="true" tabindex="-1"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">Filter</span>(<span class="cf">function</span>(x) <span class="fu">nchar</span>(x) <span class="sc">&gt;=</span> <span class="dv">4</span>, suggested_terms_clean)</span>
<span id="cb154-65"><a href="#cb154-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-66"><a href="#cb154-66" aria-hidden="true" tabindex="-1"></a>suggested_terms_clean <span class="ot">&lt;-</span> term_freq <span class="sc">%&gt;%</span></span>
<span id="cb154-67"><a href="#cb154-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(feature <span class="sc">%in%</span> suggested_terms_clean, frequency <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb154-68"><a href="#cb154-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frequency)) <span class="sc">%&gt;%</span></span>
<span id="cb154-69"><a href="#cb154-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(feature)</span>
<span id="cb154-70"><a href="#cb154-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-71"><a href="#cb154-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Map stems back to likely surface forms (approximation)</span></span>
<span id="cb154-72"><a href="#cb154-72" aria-hidden="true" tabindex="-1"></a>MAP_DOCS_LIMIT <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb154-73"><a href="#cb154-73" aria-hidden="true" tabindex="-1"></a>corpus_for_map <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">ndoc</span>(feminizid_corpus) <span class="sc">&gt;</span> MAP_DOCS_LIMIT) {</span>
<span id="cb154-74"><a href="#cb154-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corpus_sample</span>(feminizid_corpus, <span class="at">size =</span> MAP_DOCS_LIMIT)</span>
<span id="cb154-75"><a href="#cb154-75" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb154-76"><a href="#cb154-76" aria-hidden="true" tabindex="-1"></a>  feminizid_corpus</span>
<span id="cb154-77"><a href="#cb154-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb154-78"><a href="#cb154-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-79"><a href="#cb154-79" aria-hidden="true" tabindex="-1"></a>tokens_raw <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_for_map,</span>
<span id="cb154-80"><a href="#cb154-80" aria-hidden="true" tabindex="-1"></a>                     <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb154-81"><a href="#cb154-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb154-82"><a href="#cb154-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb154-83"><a href="#cb154-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb154-84"><a href="#cb154-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb154-85"><a href="#cb154-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb154-86"><a href="#cb154-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-87"><a href="#cb154-87" aria-hidden="true" tabindex="-1"></a>tokens_stem <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_raw, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb154-88"><a href="#cb154-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-89"><a href="#cb154-89" aria-hidden="true" tabindex="-1"></a>stem_map <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb154-90"><a href="#cb154-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">stem =</span> <span class="fu">unlist</span>(tokens_stem),</span>
<span id="cb154-91"><a href="#cb154-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">form =</span> <span class="fu">unlist</span>(tokens_raw)</span>
<span id="cb154-92"><a href="#cb154-92" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb154-93"><a href="#cb154-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stem, form, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-94"><a href="#cb154-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-95"><a href="#cb154-95" aria-hidden="true" tabindex="-1"></a>suggested_terms_surface <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stem =</span> suggested_terms_clean) <span class="sc">%&gt;%</span></span>
<span id="cb154-96"><a href="#cb154-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb154-97"><a href="#cb154-97" aria-hidden="true" tabindex="-1"></a>    stem_map <span class="sc">%&gt;%</span></span>
<span id="cb154-98"><a href="#cb154-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(stem) <span class="sc">%&gt;%</span></span>
<span id="cb154-99"><a href="#cb154-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb154-100"><a href="#cb154-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">forms =</span> <span class="fu">paste</span>(form, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>),</span>
<span id="cb154-101"><a href="#cb154-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"stem"</span></span>
<span id="cb154-102"><a href="#cb154-102" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb154-103"><a href="#cb154-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-104"><a href="#cb154-104" aria-hidden="true" tabindex="-1"></a>available_dicts <span class="ot">&lt;-</span> hunspell<span class="sc">::</span><span class="fu">list_dictionaries</span>()</span>
<span id="cb154-105"><a href="#cb154-105" aria-hidden="true" tabindex="-1"></a>dict_id <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"de_DE_frami"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb154-106"><a href="#cb154-106" aria-hidden="true" tabindex="-1"></a>  <span class="st">"de_DE_frami"</span></span>
<span id="cb154-107"><a href="#cb154-107" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"de_DE"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb154-108"><a href="#cb154-108" aria-hidden="true" tabindex="-1"></a>  <span class="st">"de_DE"</span></span>
<span id="cb154-109"><a href="#cb154-109" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb154-110"><a href="#cb154-110" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA_character_</span></span>
<span id="cb154-111"><a href="#cb154-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb154-112"><a href="#cb154-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-113"><a href="#cb154-113" aria-hidden="true" tabindex="-1"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb154-114"><a href="#cb154-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb154-115"><a href="#cb154-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">word</span>(forms, <span class="dv">1</span>, <span class="at">sep =</span> <span class="st">", "</span>),</span>
<span id="cb154-116"><a href="#cb154-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(primary_form, <span class="st">"_"</span>, <span class="st">" "</span>),</span>
<span id="cb154-117"><a href="#cb154-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">dict_ok =</span> <span class="cf">if</span> (<span class="fu">is.na</span>(dict_id)) <span class="cn">TRUE</span> <span class="cf">else</span> hunspell<span class="sc">::</span><span class="fu">hunspell_check</span>(primary_form, <span class="at">dict =</span> dict_id)</span>
<span id="cb154-118"><a href="#cb154-118" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb154-119"><a href="#cb154-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-120"><a href="#cb154-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Co-occurrence filter: candidate should appear with relation terms</span></span>
<span id="cb154-121"><a href="#cb154-121" aria-hidden="true" tabindex="-1"></a>relation_terms_model <span class="ot">&lt;-</span> <span class="fu">normalize_terms_for_model</span>(relation_terms)</span>
<span id="cb154-122"><a href="#cb154-122" aria-hidden="true" tabindex="-1"></a>dfm_model <span class="ot">&lt;-</span> feminizid_dfm_trimmed</span>
<span id="cb154-123"><a href="#cb154-123" aria-hidden="true" tabindex="-1"></a>relation_in_docs <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(</span>
<span id="cb154-124"><a href="#cb154-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> relation_terms_model)</span>
<span id="cb154-125"><a href="#cb154-125" aria-hidden="true" tabindex="-1"></a>)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb154-126"><a href="#cb154-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-127"><a href="#cb154-127" aria-hidden="true" tabindex="-1"></a>cand_dfm <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> suggested_terms_clean)</span>
<span id="cb154-128"><a href="#cb154-128" aria-hidden="true" tabindex="-1"></a>cand_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cand_dfm) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb154-129"><a href="#cb154-129" aria-hidden="true" tabindex="-1"></a>cand_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat)</span>
<span id="cb154-130"><a href="#cb154-130" aria-hidden="true" tabindex="-1"></a>cooccur_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat[relation_in_docs, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb154-131"><a href="#cb154-131" aria-hidden="true" tabindex="-1"></a>cooccur_ratio <span class="ot">&lt;-</span> cooccur_docs <span class="sc">/</span> <span class="fu">pmax</span>(cand_docs, <span class="dv">1</span>)</span>
<span id="cb154-132"><a href="#cb154-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-133"><a href="#cb154-133" aria-hidden="true" tabindex="-1"></a>candidate_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb154-134"><a href="#cb154-134" aria-hidden="true" tabindex="-1"></a>  <span class="at">stem =</span> <span class="fu">colnames</span>(cand_mat),</span>
<span id="cb154-135"><a href="#cb154-135" aria-hidden="true" tabindex="-1"></a>  <span class="at">cand_docs =</span> cand_docs,</span>
<span id="cb154-136"><a href="#cb154-136" aria-hidden="true" tabindex="-1"></a>  <span class="at">cooccur_docs =</span> cooccur_docs,</span>
<span id="cb154-137"><a href="#cb154-137" aria-hidden="true" tabindex="-1"></a>  <span class="at">cooccur_ratio =</span> cooccur_ratio</span>
<span id="cb154-138"><a href="#cb154-138" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb154-139"><a href="#cb154-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-140"><a href="#cb154-140" aria-hidden="true" tabindex="-1"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb154-141"><a href="#cb154-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(candidate_scores, <span class="at">by =</span> <span class="st">"stem"</span>)</span>
<span id="cb154-142"><a href="#cb154-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-143"><a href="#cb154-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Heuristic cleanup for glued function words / artifacts</span></span>
<span id="cb154-144"><a href="#cb154-144" aria-hidden="true" tabindex="-1"></a>JUNK_SUFFIXES <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zwar"</span>, <span class="st">"pro"</span>, <span class="st">"und"</span>, <span class="st">"oder"</span>, <span class="st">"aber"</span>, <span class="st">"doch"</span>, <span class="st">"weil"</span>, <span class="st">"dass"</span>, <span class="st">"nicht"</span>)</span>
<span id="cb154-145"><a href="#cb154-145" aria-hidden="true" tabindex="-1"></a>junk_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">paste</span>(JUNK_SUFFIXES, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")$"</span>)</span>
<span id="cb154-146"><a href="#cb154-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-147"><a href="#cb154-147" aria-hidden="true" tabindex="-1"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb154-148"><a href="#cb154-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">junk_suffix =</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(primary_form, junk_regex))</span>
<span id="cb154-149"><a href="#cb154-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-150"><a href="#cb154-150" aria-hidden="true" tabindex="-1"></a>suggested_terms_final <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb154-151"><a href="#cb154-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb154-152"><a href="#cb154-152" aria-hidden="true" tabindex="-1"></a>    dict_ok,</span>
<span id="cb154-153"><a href="#cb154-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nchar</span>(primary_form) <span class="sc">&gt;=</span> <span class="dv">4</span>,</span>
<span id="cb154-154"><a href="#cb154-154" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>junk_suffix,</span>
<span id="cb154-155"><a href="#cb154-155" aria-hidden="true" tabindex="-1"></a>    cooccur_docs <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb154-156"><a href="#cb154-156" aria-hidden="true" tabindex="-1"></a>    cooccur_ratio <span class="sc">&gt;=</span> <span class="fl">0.2</span></span>
<span id="cb154-157"><a href="#cb154-157" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb154-158"><a href="#cb154-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb154-159"><a href="#cb154-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb154-160"><a href="#cb154-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(primary_form)</span>
<span id="cb154-161"><a href="#cb154-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-162"><a href="#cb154-162" aria-hidden="true" tabindex="-1"></a>suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb154-163"><a href="#cb154-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(primary_form)) <span class="sc">%&gt;%</span></span>
<span id="cb154-164"><a href="#cb154-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   stem          forms primary_form dict_ok cand_docs cooccur_docs cooccur_ratio
   &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;        &lt;lgl&gt;       &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
 1 wurdenpro     wurd… wurdenpro    TRUE           18            0        0     
 2 waffendelikt  waff… waffendelik… TRUE           11            0        0     
 3 umgebracht    umge… umgebracht   TRUE         1437          431        0.300 
 4 totung        tötu… tötung       TRUE         2233          498        0.223 
 5 taterinn      täte… täterinnen   TRUE          447           23        0.0515
 6 tocht         toch… tochter      TRUE         6056         2648        0.437 
 7 sexuell       sexu… sexuelle     TRUE         5213          398        0.0763
 8 serientat     seri… serientäter  TRUE           69            5        0.0725
 9 schwagerin    schw… schwägerin   TRUE          112           81        0.723 
10 schwiegermutt schw… schwiegermu… TRUE          238          115        0.483 
# ℹ 20 more rows
# ℹ 1 more variable: junk_suffix &lt;lgl&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>suggested_terms_final</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "civica"             "eifersucht"         "eingestochen"      
 [4] "erschlug"           "familienmitglieder" "femicide"          
 [7] "freundin"           "gattin"             "getötet"           
[10] "guatemala"          "kopfschuss"         "lebensgefährten"   
[13] "mord"               "mutmassliche"       "nebenbuhler"       
[16] "schwiegermutter"    "schwägerin"         "tochter"           
[19] "tötung"             "umgebracht"        </code></pre>
</div>
</div>
</section>
<section id="second-pass-api-query-manual-curation" class="level2">
<h2 class="anchored" data-anchor-id="second-pass-api-query-manual-curation">Second-pass API query (manual curation)</h2>
<p>We run a stricter AND query to keep results manageable. The original keywords are split into two groups (action vs.&nbsp;relation) and combined with curated extra terms. Wildcards are included for single-word terms.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wildcards only for single-word terms from the original list</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>add_wildcards_single <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  single <span class="ot">&lt;-</span> terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)]</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(single, <span class="st">"*"</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, <span class="fu">add_wildcards_single</span>(action_terms)))</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, <span class="fu">add_wildcards_single</span>(relation_terms)))</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual split from suggested_terms_final</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>SECOND_PASS_EXCLUDE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gewalt"</span>)</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ermordet"</span>, <span class="st">"erschossen"</span>, <span class="st">"erstochen"</span>, <span class="st">"getötet"</span>,</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tötung"</span>, <span class="st">"tötungsversuch"</span>, <span class="st">"frauentötungen"</span>,</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"stranguliert"</span>, <span class="st">"kopfschuss"</span>, <span class="st">"küchenmesser"</span>,</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mordopfer"</span>, <span class="st">"umgebracht"</span>, <span class="st">"tötete"</span>, <span class="st">"totschlag"</span>,</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"misshandlung"</span>, <span class="st">"misshandelt"</span>, <span class="st">"stalking"</span>,</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"eifersucht"</span>, <span class="st">"eifersüchtig"</span>, <span class="st">"eifersüchtige"</span>, <span class="st">"eifersüchtigen"</span>,</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mord"</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ehepartner"</span>, <span class="st">"exmann"</span>, <span class="st">"intimpartner"</span>, <span class="st">"lebensgefährt"</span>,</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lebensgemeinschaft"</span>, <span class="st">"Partner"</span>, <span class="st">"schwägerin"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Frau"</span>,</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ehefrau"</span>, <span class="st">"freundin"</span>, <span class="st">"beziehung"</span>, <span class="st">"geschieden"</span>, <span class="st">"mutter"</span>, <span class="st">"vater"</span>,</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sohn"</span>, <span class="st">"tochter"</span>, <span class="st">"schwiegersohn"</span>, <span class="st">"ex-partner"</span>, <span class="st">"ex-mann"</span>, <span class="st">"ex-frau"</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropped terms (noisy/too generic): aufwies, desinteresseerklärung,</span></span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a><span class="co"># desinteressenerklärung, erleben, erwachsenenleben, fünfte, häusliche,</span></span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a><span class="co"># körper, männer, menos, mutmassliche, physische, rechercheplattformen,</span></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a><span class="co"># rechercheprojekt, sexuelle, straftatbestand, tatverdächtigen, türkin</span></span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(action_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(relation_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, action_terms_extra))</span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, relation_terms_extra))</span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a>normalize_wildcards <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">*+$"</span>, <span class="st">""</span>, terms)</span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(terms, <span class="fu">paste0</span>(terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)], <span class="st">"*"</span>))</span>
<span id="cb158-48"><a href="#cb158-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb158-49"><a href="#cb158-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-50"><a href="#cb158-50" aria-hidden="true" tabindex="-1"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(action_terms_second)</span>
<span id="cb158-51"><a href="#cb158-51" aria-hidden="true" tabindex="-1"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(relation_terms_second)</span>
<span id="cb158-52"><a href="#cb158-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-53"><a href="#cb158-53" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Second-pass action terms: "</span>, <span class="fu">paste</span>(action_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass action terms: Feminizid, Femizid, Frauenmord, Tötung von Frau, Mord an Frau, Gewalt gegen Frauen, Partnergewalt, Beziehungsgewalt, häusliche Gewalt, Partnerschaftsgewalt, ermordet, erschossen, erstochen, getötet, tötung, tötungsversuch, frauentötungen, stranguliert, kopfschuss, küchenmesser, mordopfer, umgebracht, tötete, totschlag, misshandlung, misshandelt, stalking, eifersucht, eifersüchtig, eifersüchtige, eifersüchtigen, mord, Feminizid*, Femizid*, Frauenmord*, Partnergewalt*, Beziehungsgewalt*, Partnerschaftsgewalt*, ermordet*, erschossen*, erstochen*, getötet*, tötung*, tötungsversuch*, frauentötungen*, stranguliert*, kopfschuss*, küchenmesser*, mordopfer*, umgebracht*, tötete*, totschlag*, misshandlung*, misshandelt*, stalking*, eifersucht*, eifersüchtig*, eifersüchtige*, eifersüchtigen*, mord*</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Second-pass relation terms: "</span>, <span class="fu">paste</span>(relation_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass relation terms: Familiendrama, Familientragödie, Beziehungstat, Ehestreit, ehepartner, exmann, intimpartner, lebensgefährt, lebensgemeinschaft, Partner, schwägerin, Peiniger, Frau, ehefrau, freundin, beziehung, geschieden, mutter, vater, sohn, tochter, schwiegersohn, ex-partner, ex-mann, ex-frau, Familiendrama*, Familientragödie*, Beziehungstat*, Ehestreit*, ehepartner*, exmann*, intimpartner*, lebensgefährt*, lebensgemeinschaft*, Partner*, schwägerin*, Peiniger*, Frau*, ehefrau*, freundin*, beziehung*, geschieden*, mutter*, vater*, sohn*, tochter*, schwiegersohn*, ex-partner*, ex-mann*, ex-frau*</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>existing_secondpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_SECOND_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_secondpass))) {</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Second-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_secondpass))</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  second_pass_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">client =</span> client,</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">content_groups =</span> <span class="fu">list</span>(</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> action_terms_second),</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> relation_terms_second)</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_from =</span> <span class="st">"1990-01-01"</span>,</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>,</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>,</span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_SecondPass"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="st">"Second-pass query with curated action+relation terms (1990+)"</span>,</span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb162-25"><a href="#cb162-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb162-26"><a href="#cb162-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-27"><a href="#cb162-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save second-pass result for reuse</span></span>
<span id="cb162-28"><a href="#cb162-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(second_pass_result<span class="sc">$</span>data)) {</span>
<span id="cb162-29"><a href="#cb162-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save_checkpoint</span>(second_pass_result<span class="sc">$</span>data, <span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb162-30"><a href="#cb162-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb162-31"><a href="#cb162-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass query skipped. Existing checkpoint: feminizid_raw_data_secondpass_20260127_094656.qs2</code></pre>
</div>
</div>
</section>
<section id="second-pass-data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="second-pass-data-preparation">Second-pass data preparation</h2>
<p>Clean the second-pass data and build a corpus for downstream analysis.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>, <span class="st">"media_data_second"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_secondpass_20260127_094656.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_raw_data_secondpass_20260127_094656.qs2"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>media_data_second<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(media_data_second<span class="sc">$</span>pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>media_data_second<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data_second<span class="sc">$</span>pubtime)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>media_data_second<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(media_data_second<span class="sc">$</span>pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1990</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>media_data_second<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> media_data_second<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb167-17"><a href="#cb167-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-18"><a href="#cb167-18" aria-hidden="true" tabindex="-1"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb167-19"><a href="#cb167-19" aria-hidden="true" tabindex="-1"></a>  media_data_second,</span>
<span id="cb167-20"><a href="#cb167-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb167-21"><a href="#cb167-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb167-22"><a href="#cb167-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb167-23"><a href="#cb167-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-24"><a href="#cb167-24" aria-hidden="true" tabindex="-1"></a><span class="fu">save_checkpoint</span>(secondpass_corpus, <span class="st">"feminizid_secondpass_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_secondpass_corpus_20260127_110217.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_secondpass_corpus_20260127_110217.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out broad international rubrics for a more focused second-pass set</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (keeps the raw checkpoint intact; only affects downstream analysis)</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rubric_clean =</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(<span class="fu">str_squish</span>(rubric))) <span class="sc">%&gt;%</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>rubric_clean <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ausland"</span>, <span class="st">"international"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>rubric_clean)</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  media_data_second,</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic distribution: article counts per year (1990-present)</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>articles_second_by_year <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pubtime =</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">1990</span>, year <span class="sc">&lt;=</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year)</span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== SECOND-PASS: ARTICLES PER YEAR ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== SECOND-PASS: ARTICLES PER YEAR ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>articles_second_by_year</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"1991","2":"14"},{"1":"1992","2":"11"},{"1":"1993","2":"142"},{"1":"1994","2":"961"},{"1":"1995","2":"1319"},{"1":"1996","2":"1815"},{"1":"1997","2":"1913"},{"1":"1998","2":"2313"},{"1":"1999","2":"3035"},{"1":"2000","2":"3535"},{"1":"2001","2":"3753"},{"1":"2002","2":"4575"},{"1":"2003","2":"4359"},{"1":"2004","2":"4914"},{"1":"2005","2":"4522"},{"1":"2006","2":"4780"},{"1":"2007","2":"4517"},{"1":"2008","2":"4442"},{"1":"2009","2":"5700"},{"1":"2010","2":"5319"},{"1":"2011","2":"5689"},{"1":"2012","2":"5382"},{"1":"2013","2":"6284"},{"1":"2014","2":"6460"},{"1":"2015","2":"6793"},{"1":"2016","2":"7930"},{"1":"2017","2":"8507"},{"1":"2018","2":"9582"},{"1":"2019","2":"10143"},{"1":"2020","2":"12733"},{"1":"2021","2":"14636"},{"1":"2022","2":"17895"},{"1":"2023","2":"14794"},{"1":"2024","2":"14479"},{"1":"2025","2":"13039"},{"1":"2026","2":"787"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="top-sources" class="level1">
<h1>Top sources</h1>
<p>cat(“=== SECOND-PASS: TOP MEDIA ===”) top_media_second &lt;- media_data_second %&gt;% count(medium_name, sort = TRUE) %&gt;% head(15) top_media_second</p>
<pre><code>
# Top rubric categories
cat("\n=== SECOND-PASS: TOP RUBRICS ===\n")
top_rubrics_second &lt;- media_data_second %&gt;%
  mutate(rubric = na_if(str_squish(rubric), "")) %&gt;%
  count(rubric, sort = TRUE) %&gt;%
  head(15)
top_rubrics_second</code></pre>
</section>
<section id="normalized-contrast-early-vs.-late-periods-per-million-words" class="level1">
<h1>Normalized contrast: early vs.&nbsp;late periods (per million words)</h1>
<p>tokens_raw &lt;- tokens( secondpass_corpus, remove_punct = TRUE, remove_symbols = TRUE, remove_numbers = TRUE, remove_url = TRUE )</p>
<p>dfm_raw &lt;- dfm(tokens_raw, tolower = TRUE) dfm_raw &lt;- dfm_remove(dfm_raw, all_stopwords, valuetype = “fixed”) dfm_raw &lt;- dfm_remove( dfm_raw, pattern = c( “^uhr”, “^(montag|dienstag|mittwoch|donnerstag|freitag|samstag|sonntag)<span class="math inline">\(",
    ".*\\d+.*",
    "^[a-zäöüß]{1,2}\)</span>” ), valuetype = “regex”, case_insensitive = TRUE ) dfm_raw &lt;- dfm_trim(dfm_raw, min_termfreq = 10)</p>
<p>doc_ids &lt;- docnames(dfm_raw) year_lookup &lt;- media_data_second<span class="math inline">\(year[match(doc_ids, media_data_second\)</span>unique_id)] period_vec &lt;- ifelse(is.na(year_lookup), “Unknown”, ifelse(year_lookup &lt; 2005, “1990-2004”, “2005-2026”)) docvars(dfm_raw, “period”) &lt;- period_vec</p>
<p>dfm_period &lt;- dfm_group(dfm_raw, groups = docvars(dfm_raw, “period”)) dfm_prop &lt;- dfm_weight(dfm_period, scheme = “prop”)</p>
<p>term_prop &lt;- convert(dfm_prop, to = “data.frame”) %&gt;% select(-doc_id) %&gt;% mutate(period = rownames(dfm_prop))</p>
<p>term_long &lt;- term_prop %&gt;% pivot_longer(-period, names_to = “term”, values_to = “prop”)</p>
<p>term_wide &lt;- term_long %&gt;% pivot_wider(names_from = period, values_from = prop, values_fill = 0) %&gt;% mutate( early_per_million = <code>1990-2004</code> * 1e6, late_per_million = <code>2005-2026</code> * 1e6, log2_ratio = log2((late_per_million + 1) / (early_per_million + 1)) )</p>
<p>top_contrast &lt;- bind_rows( head(arrange(term_wide, desc(log2_ratio)), 15), head(arrange(term_wide, log2_ratio), 15) ) %&gt;% mutate(direction = ifelse(log2_ratio &gt; 0, “Later period”, “Earlier period”))</p>
<p>cat(“=== SECOND-PASS: KEY TERMS BY PERIOD (LOG2 RATIO) ===”) top_contrast %&gt;% select(term, log2_ratio, direction)</p>
<pre><code>

::: {.cell}

```{.r .cell-code}
# Checkpoint save (Second-pass analysis outputs)
save_checkpoint(top_contrast, "secondpass_key_terms")</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: secondpass_key_terms_20260127_113451.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/secondpass_key_terms_20260127_113451.qs2"</code></pre>
</div>
<p>:::</p>
<section id="second-pass-semantic-expansion-iteration-2" class="level2">
<h2 class="anchored" data-anchor-id="second-pass-semantic-expansion-iteration-2">Second-pass semantic expansion (iteration 2)</h2>
<p>We run a second, focused embedding pass on the filtered second-pass corpus. The goal is to surface terms that describe feminicide framing across 5-year windows.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build 5-year windows based on available second-pass years</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>min_year_sp <span class="ot">&lt;-</span> <span class="fu">min</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>max_year_sp <span class="ot">&lt;-</span> <span class="fu">max</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>window_starts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">floor</span>(min_year_sp <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>, max_year_sp, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>time_windows_secondpass <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(window_starts, <span class="cf">function</span>(y) <span class="fu">c</span>(y, <span class="fu">min</span>(y <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))),</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(window_starts, <span class="st">"-"</span>, <span class="fu">pmin</span>(window_starts <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>seed_terms_secondpass <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train one model per window for the second-pass corpus.</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Always export plain vectors (no external pointers) for reuse.</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>existing_vectors <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_W2V_TRAINING) {</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec training disabled (RUN_SECOND_PASS_W2V_TRAINING = FALSE)."</span>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>FORCE_SECOND_PASS_W2V_TRAINING <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec vectors already exist; skipping training."</span>)</span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>  word2vec_models_secondpass <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows_secondpass)) {</span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a>    window_years <span class="ot">&lt;-</span> time_windows_secondpass[[window_name]]</span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a>    window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>      secondpass_corpus,</span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(model)) {</span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a>      word2vec_models_secondpass[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>  word2vec_vectors_secondpass <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_models_secondpass, as.matrix)</span>
<span id="cb179-28"><a href="#cb179-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save_checkpoint</span>(word2vec_vectors_secondpass, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb179-29"><a href="#cb179-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass Word2Vec vectors already exist; skipping training.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint load (Second-pass Word2Vec vectors)</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect nearest neighbors for seed terms across windows</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>collect_neighbors_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(vectors))</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(seeds_in_vocab) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>  vectors_norm <span class="ot">&lt;-</span> vectors <span class="sc">/</span> norms</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>    seed_vec <span class="ot">&lt;-</span> vectors_norm[seed, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(seed_vec))</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> seed]</span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">names</span>(top),</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a>neighbors_secondpass <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_vectors_secondpass), <span class="cf">function</span>(w) {</span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a>  vectors <span class="ot">&lt;-</span> word2vec_vectors_secondpass[[w]]</span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors_vectors</span>(vectors, seed_terms_secondpass, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a><span class="fu">save_checkpoint</span>(neighbors_secondpass, <span class="st">"word2vec_neighbors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: word2vec_neighbors_secondpass_20260127_163752.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_neighbors_secondpass_20260127_163752.qs2"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>candidate_terms_secondpass <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity)) <span class="sc">%&gt;%</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== SECOND-PASS: CANDIDATE TERMS (ITERATION 2) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== SECOND-PASS: CANDIDATE TERMS (ITERATION 2) ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>candidate_terms_secondpass</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_similarity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["seed_hits"],"name":[3],"type":["int"],"align":["right"]},{"label":["window_hits"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"ehefrau","2":"0.7270274","3":"2","4":"7"},{"1":"ehemann","2":"0.7233748","3":"3","4":"7"},{"1":"gattin","2":"0.6790379","3":"2","4":"6"},{"1":"tocht","2":"0.6644148","3":"2","4":"4"},{"1":"gatt","2":"0.6636772","3":"3","4":"5"},{"1":"freundin","2":"0.6520655","3":"5","4":"7"},{"1":"rechercheprojekt","2":"0.6406193","3":"2","4":"2"},{"1":"geschied","2":"0.6394915","3":"3","4":"5"},{"1":"ehepaar","2":"0.6320771","3":"2","4":"5"},{"1":"totungsdelikt","2":"0.6287441","3":"3","4":"3"},{"1":"schwagerin","2":"0.6286987","3":"2","4":"2"},{"1":"partnerin","2":"0.6278488","3":"4","4":"7"},{"1":"schwiegertocht","2":"0.6269674","3":"2","4":"2"},{"1":"geliebt","2":"0.6214185","3":"4","4":"5"},{"1":"freundinn","2":"0.6206314","3":"2","4":"7"},{"1":"partn","2":"0.6203972","3":"2","4":"7"},{"1":"lebenspartnerin","2":"0.6193070","3":"3","4":"6"},{"1":"frauenmord","2":"0.6160603","3":"2","4":"4"},{"1":"scheidung","2":"0.6139958","3":"2","4":"5"},{"1":"schwiegervat","2":"0.6134064","3":"2","4":"2"},{"1":"liebhab","2":"0.6127684","3":"3","4":"5"},{"1":"gewaltverbrech","2":"0.6117881","3":"2","4":"2"},{"1":"weiblich","2":"0.6117671","3":"2","4":"5"},{"1":"bekannte","2":"0.6093075","3":"2","4":"2"},{"1":"schwiegermutt","2":"0.6058557","3":"2","4":"3"},{"1":"partnerschaft","2":"0.6018198","3":"3","4":"7"},{"1":"straftatbestand","2":"0.6016796","3":"2","4":"2"},{"1":"sohn","2":"0.6013578","3":"3","4":"3"},{"1":"expartn","2":"0.6009090","3":"2","4":"4"},{"1":"feminizid","2":"0.6008742","3":"3","4":"3"},{"1":"verheiratet","2":"0.5994937","3":"2","4":"7"},{"1":"schwag","2":"0.5979706","3":"2","4":"2"},{"1":"lebenspartn","2":"0.5969972","3":"5","4":"5"},{"1":"verlobt","2":"0.5960518","3":"2","4":"2"},{"1":"femizid","2":"0.5945183","3":"4","4":"5"},{"1":"nebenbuhl","2":"0.5918896","3":"3","4":"2"},{"1":"femiziden","2":"0.5872106","3":"2","4":"2"},{"1":"trennungsphas","2":"0.5871151","3":"2","4":"2"},{"1":"ex","2":"0.5860109","3":"6","4":"6"},{"1":"partner","2":"0.5841795","3":"2","4":"4"},{"1":"partnerinn","2":"0.5815668","3":"4","4":"5"},{"1":"gewalt","2":"0.5803474","3":"4","4":"5"},{"1":"exfrau","2":"0.5787322","3":"2","4":"3"},{"1":"lebensgefahrtin","2":"0.5781691","3":"2","4":"3"},{"1":"geschlechtsspezif","2":"0.5778614","3":"2","4":"3"},{"1":"geschlechts","2":"0.5766927","3":"2","4":"2"},{"1":"gewaltbetroff","2":"0.5758527","3":"2","4":"2"},{"1":"bezieh","2":"0.5742653","3":"3","4":"7"},{"1":"menos","2":"0.5742351","3":"3","4":"3"},{"1":"lebensgefahrt","2":"0.5736089","3":"5","4":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive 3D view across time windows (aligned spaces)</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Important: align vectors across windows before comparing positions.</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Controls for density and focus</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>TOP_NEIGHBORS_PER_TARGET <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>MAX_MOVERS <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>MAX_POINTS_PER_WINDOW <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>MAX_TARGETS <span class="ot">&lt;-</span> <span class="dv">6</span>  <span class="co"># reduce for clarity; increase to show more targets</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Select neighbors per target and window</span></span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a>targets_focus <span class="ot">&lt;-</span> <span class="fu">head</span>(seed_terms_secondpass, MAX_TARGETS)</span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a>neighbors_top <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(seed <span class="sc">%in%</span> targets_focus) <span class="sc">%&gt;%</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(window, seed) <span class="sc">%&gt;%</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> TOP_NEIGHBORS_PER_TARGET, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Dominant target per term/window (for coloring)</span></span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>dominant_seed <span class="ot">&lt;-</span> neighbors_top <span class="sc">%&gt;%</span></span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(window, term) <span class="sc">%&gt;%</span></span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(window, term, seed)</span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a compact term set: targets + top neighbors</span></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a>terms_all <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(targets_focus, neighbors_top<span class="sc">$</span>term))</span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>terms_all <span class="ot">&lt;-</span> terms_all[<span class="sc">!</span><span class="fu">is.na</span>(terms_all)]</span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>vectors_list <span class="ot">&lt;-</span> word2vec_vectors_secondpass</span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>windows <span class="ot">&lt;-</span> <span class="fu">names</span>(vectors_list)</span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Need at least two time windows for an interactive timeline."</span>)</span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Reference window for alignment</span></span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>ref_window <span class="ot">&lt;-</span> windows[<span class="dv">1</span>]</span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a>ref_vectors <span class="ot">&lt;-</span> vectors_list[[ref_window]]</span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Common terms used for alignment (must exist in all windows)</span></span>
<span id="cb195-43"><a href="#cb195-43" aria-hidden="true" tabindex="-1"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(vectors_list, rownames))</span>
<span id="cb195-44"><a href="#cb195-44" aria-hidden="true" tabindex="-1"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(common_terms, <span class="fu">rownames</span>(ref_vectors))</span>
<span id="cb195-45"><a href="#cb195-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(common_terms) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb195-46"><a href="#cb195-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"WARN: Few common terms for alignment ("</span>, <span class="fu">length</span>(common_terms), <span class="st">")."</span>)</span>
<span id="cb195-47"><a href="#cb195-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-48"><a href="#cb195-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-49"><a href="#cb195-49" aria-hidden="true" tabindex="-1"></a>align_to_reference <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, ref_vec, anchor_terms) {</span>
<span id="cb195-50"><a href="#cb195-50" aria-hidden="true" tabindex="-1"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchor_terms, <span class="fu">rownames</span>(vec))</span>
<span id="cb195-51"><a href="#cb195-51" aria-hidden="true" tabindex="-1"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchors, <span class="fu">rownames</span>(ref_vec))</span>
<span id="cb195-52"><a href="#cb195-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(anchors) <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="fu">return</span>(vec)</span>
<span id="cb195-53"><a href="#cb195-53" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> ref_vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb195-54"><a href="#cb195-54" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb195-55"><a href="#cb195-55" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">t</span>(B) <span class="sc">%*%</span> A</span>
<span id="cb195-56"><a href="#cb195-56" aria-hidden="true" tabindex="-1"></a>  sv <span class="ot">&lt;-</span> <span class="fu">svd</span>(M)</span>
<span id="cb195-57"><a href="#cb195-57" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> sv<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">t</span>(sv<span class="sc">$</span>v)</span>
<span id="cb195-58"><a href="#cb195-58" aria-hidden="true" tabindex="-1"></a>  vec <span class="sc">%*%</span> R</span>
<span id="cb195-59"><a href="#cb195-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-60"><a href="#cb195-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-61"><a href="#cb195-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Align all windows to reference</span></span>
<span id="cb195-62"><a href="#cb195-62" aria-hidden="true" tabindex="-1"></a>aligned_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vectors_list, <span class="cf">function</span>(v) {</span>
<span id="cb195-63"><a href="#cb195-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align_to_reference</span>(v, ref_vectors, common_terms)</span>
<span id="cb195-64"><a href="#cb195-64" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb195-65"><a href="#cb195-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-66"><a href="#cb195-66" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA basis from reference window on shared terms (for comparable axes)</span></span>
<span id="cb195-67"><a href="#cb195-67" aria-hidden="true" tabindex="-1"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms_all, <span class="fu">rownames</span>(aligned_list[[ref_window]]))</span>
<span id="cb195-68"><a href="#cb195-68" aria-hidden="true" tabindex="-1"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(ref_anchor_terms, common_terms)</span>
<span id="cb195-69"><a href="#cb195-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(ref_anchor_terms) <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb195-70"><a href="#cb195-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Not enough shared terms for stable PCA alignment."</span>)</span>
<span id="cb195-71"><a href="#cb195-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-72"><a href="#cb195-72" aria-hidden="true" tabindex="-1"></a>ref_mat <span class="ot">&lt;-</span> aligned_list[[ref_window]][ref_anchor_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb195-73"><a href="#cb195-73" aria-hidden="true" tabindex="-1"></a>pca_ref <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(ref_mat, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb195-74"><a href="#cb195-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-75"><a href="#cb195-75" aria-hidden="true" tabindex="-1"></a>project_window <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, terms, pca_obj) {</span>
<span id="cb195-76"><a href="#cb195-76" aria-hidden="true" tabindex="-1"></a>  terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms, <span class="fu">rownames</span>(vectors))</span>
<span id="cb195-77"><a href="#cb195-77" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> vectors[terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb195-78"><a href="#cb195-78" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">scale</span>(mat, <span class="at">center =</span> pca_obj<span class="sc">$</span>center, <span class="at">scale =</span> <span class="cn">FALSE</span>) <span class="sc">%*%</span> pca_obj<span class="sc">$</span>rotation[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb195-79"><a href="#cb195-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb195-80"><a href="#cb195-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> terms,</span>
<span id="cb195-81"><a href="#cb195-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> coords[, <span class="dv">1</span>],</span>
<span id="cb195-82"><a href="#cb195-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> coords[, <span class="dv">2</span>],</span>
<span id="cb195-83"><a href="#cb195-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> coords[, <span class="dv">3</span>],</span>
<span id="cb195-84"><a href="#cb195-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb195-85"><a href="#cb195-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb195-86"><a href="#cb195-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-87"><a href="#cb195-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-88"><a href="#cb195-88" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(windows, <span class="cf">function</span>(w) {</span>
<span id="cb195-89"><a href="#cb195-89" aria-hidden="true" tabindex="-1"></a>  vectors <span class="ot">&lt;-</span> aligned_list[[w]]</span>
<span id="cb195-90"><a href="#cb195-90" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">project_window</span>(vectors, terms_all, pca_ref)</span>
<span id="cb195-91"><a href="#cb195-91" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb195-92"><a href="#cb195-92" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>term <span class="sc">%in%</span> seed_terms_secondpass, <span class="st">"target"</span>, <span class="st">"neighbor"</span>)</span>
<span id="cb195-93"><a href="#cb195-93" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb195-94"><a href="#cb195-94" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb195-95"><a href="#cb195-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-96"><a href="#cb195-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Track movers: terms with largest displacement across windows</span></span>
<span id="cb195-97"><a href="#cb195-97" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb195-98"><a href="#cb195-98" aria-hidden="true" tabindex="-1"></a>  mover_candidates <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb195-99"><a href="#cb195-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb195-100"><a href="#cb195-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="fu">length</span>(windows)) <span class="sc">%&gt;%</span></span>
<span id="cb195-101"><a href="#cb195-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb195-102"><a href="#cb195-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">dx =</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x),</span>
<span id="cb195-103"><a href="#cb195-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">dy =</span> <span class="fu">max</span>(y) <span class="sc">-</span> <span class="fu">min</span>(y),</span>
<span id="cb195-104"><a href="#cb195-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">dz =</span> <span class="fu">max</span>(z) <span class="sc">-</span> <span class="fu">min</span>(z),</span>
<span id="cb195-105"><a href="#cb195-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">displacement =</span> <span class="fu">sqrt</span>(dx<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dy<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dz<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb195-106"><a href="#cb195-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb195-107"><a href="#cb195-107" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb195-108"><a href="#cb195-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(displacement)) <span class="sc">%&gt;%</span></span>
<span id="cb195-109"><a href="#cb195-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_MOVERS) <span class="sc">%&gt;%</span></span>
<span id="cb195-110"><a href="#cb195-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(term)</span>
<span id="cb195-111"><a href="#cb195-111" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb195-112"><a href="#cb195-112" aria-hidden="true" tabindex="-1"></a>  mover_candidates <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb195-113"><a href="#cb195-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb195-114"><a href="#cb195-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-115"><a href="#cb195-115" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb195-116"><a href="#cb195-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dominant_seed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"window"</span>, <span class="st">"term"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb195-117"><a href="#cb195-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb195-118"><a href="#cb195-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_mover =</span> term <span class="sc">%in%</span> mover_candidates</span>
<span id="cb195-119"><a href="#cb195-119" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb195-120"><a href="#cb195-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-121"><a href="#cb195-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep: all targets + top neighbors + movers</span></span>
<span id="cb195-122"><a href="#cb195-122" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb195-123"><a href="#cb195-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(seed) <span class="sc">|</span> is_mover)</span>
<span id="cb195-124"><a href="#cb195-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-125"><a href="#cb195-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Cap total points per window</span></span>
<span id="cb195-126"><a href="#cb195-126" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb195-127"><a href="#cb195-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(window) <span class="sc">%&gt;%</span></span>
<span id="cb195-128"><a href="#cb195-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_POINTS_PER_WINDOW) <span class="sc">%&gt;%</span></span>
<span id="cb195-129"><a href="#cb195-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb195-130"><a href="#cb195-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-131"><a href="#cb195-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Split targets vs neighbors for clearer rendering and stable traces</span></span>
<span id="cb195-132"><a href="#cb195-132" aria-hidden="true" tabindex="-1"></a>targets_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span>)</span>
<span id="cb195-133"><a href="#cb195-133" aria-hidden="true" tabindex="-1"></a>neighbors_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"neighbor"</span>)</span>
<span id="cb195-134"><a href="#cb195-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-135"><a href="#cb195-135" aria-hidden="true" tabindex="-1"></a>p_w2v_3d <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb195-136"><a href="#cb195-136" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb195-137"><a href="#cb195-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> neighbors_plot,</span>
<span id="cb195-138"><a href="#cb195-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb195-139"><a href="#cb195-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb195-140"><a href="#cb195-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb195-141"><a href="#cb195-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb195-142"><a href="#cb195-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray70"</span>),</span>
<span id="cb195-143"><a href="#cb195-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span>term,</span>
<span id="cb195-144"><a href="#cb195-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb195-145"><a href="#cb195-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Neighbors"</span></span>
<span id="cb195-146"><a href="#cb195-146" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-147"><a href="#cb195-147" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb195-148"><a href="#cb195-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> targets_plot,</span>
<span id="cb195-149"><a href="#cb195-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb195-150"><a href="#cb195-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb195-151"><a href="#cb195-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb195-152"><a href="#cb195-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"markers+text"</span>,</span>
<span id="cb195-153"><a href="#cb195-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.95</span>, <span class="at">color =</span> <span class="st">"crimson"</span>),</span>
<span id="cb195-154"><a href="#cb195-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span>term,</span>
<span id="cb195-155"><a href="#cb195-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">textposition =</span> <span class="st">"top center"</span>,</span>
<span id="cb195-156"><a href="#cb195-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb195-157"><a href="#cb195-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Targets"</span></span>
<span id="cb195-158"><a href="#cb195-158" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-159"><a href="#cb195-159" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb195-160"><a href="#cb195-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Word2Vec 3D timeline (aligned windows)"</span>,</span>
<span id="cb195-161"><a href="#cb195-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb195-162"><a href="#cb195-162" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC1"</span>),</span>
<span id="cb195-163"><a href="#cb195-163" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC2"</span>),</span>
<span id="cb195-164"><a href="#cb195-164" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC3"</span>)</span>
<span id="cb195-165"><a href="#cb195-165" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb195-166"><a href="#cb195-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">"h"</span>)</span>
<span id="cb195-167"><a href="#cb195-167" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb195-168"><a href="#cb195-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-169"><a href="#cb195-169" aria-hidden="true" tabindex="-1"></a>p_w2v_3d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3da01c0acf122fbe70f5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3da01c0acf122fbe70f5">{"x":{"visdat":{"1174f23e77490":["function () ","plotlyVisDat"],"1174f3095ac5a":["function () ","data"],"1174f326661a1":["function () ","data"]},"cur_data":"1174f326661a1","attrs":{"1174f3095ac5a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"frame":{},"type":"scatter3d","mode":"markers","marker":{"size":3,"opacity":0.5,"color":"gray70"},"text":{},"hoverinfo":"text","name":"Neighbors","inherit":true},"1174f326661a1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"frame":{},"type":"scatter3d","mode":"markers+text","marker":{"size":7,"opacity":0.94999999999999996,"color":"crimson"},"text":{},"textposition":"top center","hoverinfo":"text","name":"Targets","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Word2Vec 3D timeline (aligned windows)","scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"legend":{"orientation":"h"},"hovermode":"closest","showlegend":true,"xaxis":{"range":[-4.7572130541651525,6.0888032492444317]},"yaxis":{"range":[-4.5945332262487355,4.5675571603807787]},"sliders":[{"currentvalue":{"prefix":"window: ","xanchor":"right","font":{"size":16,"color":"rgba(204,204,204,1)"}},"steps":[{"method":"animate","args":[["1990-1994"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"1990-1994","value":"1990-1994"},{"method":"animate","args":[["1995-1999"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"1995-1999","value":"1995-1999"},{"method":"animate","args":[["2000-2004"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2000-2004","value":"2000-2004"},{"method":"animate","args":[["2005-2009"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2005-2009","value":"2005-2009"},{"method":"animate","args":[["2010-2014"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2010-2014","value":"2010-2014"},{"method":"animate","args":[["2015-2019"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2015-2019","value":"2015-2019"},{"method":"animate","args":[["2020-2024"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2020-2024","value":"2020-2024"},{"method":"animate","args":[["2025-2026"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2025-2026","value":"2025-2026"}],"visible":true,"pad":{"t":40}}],"updatemenus":[{"type":"buttons","direction":"right","showactive":false,"y":0,"x":0,"yanchor":"top","xanchor":"right","pad":{"t":60,"r":5},"buttons":[{"label":"Play","method":"animate","args":[null,{"fromcurrent":true,"mode":"immediate","transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true}}]}]}]},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-4.2642123131010807,0.54065087955493962,-1.0045959786178764,-2.5476129181186691,-3.2208796465933784,-2.3354458636356519,-2.0826341485445679,-1.6221733557309994,-2.8423525236641005,-2.800323014523054,-2.4119687055814611,0.45237562027208489,-3.5121973061649179,3.6027521294699265,-0.25321671996449086,4.1720302131453657,-2.2909405572314978,-0.93110820976778486,-2.2950722993678463,1.0592860966005602,5.0165387928014411,-1.0186388104715312,0.027623469173095761,-0.83802502703380799,2.6406416572184925,2.5672781918739824,5.59580250818036,4.5191966217921733],"y":[1.644972998433899,-3.3982617893493678,-0.44464852511443909,2.9972342969244377,1.3390931644285324,0.57967388506490092,0.71504694244083755,0.71033000414680203,3.8466765929283202,1.075116701092063,-0.63350090523419322,-1.9555510702021432,3.0029402059743453,-3.1859125146812932,-2.0575613513103601,-0.82475195240329779,0.37147467395531553,-3.2456001909606411,3.1257899776555931,-4.1780745723110302,4.1510985064430734,-3.8231334799352741,-1.7122747173597404,-1.042546357184617,3.3894273964100101,-3.0085721194716215,3.6339792477279973,1.6397335169847049],"z":[0.6117662461114225,0.44191626538543111,-2.7123058277577026,-1.0091405983608075,0.44508565918250281,1.0206129074500647,0.33751606944021345,-0.47628297503928529,0.30012457311464502,-0.74790871611348086,-0.27722340080539448,-2.9162998881311104,0.36116230024610979,-1.523644517312696,-1.3676553525592519,2.5403066547366713,1.1743576546474122,-0.047559043309833578,0.33943573677395,-0.033720168121006963,3.4558397503567266,-0.087713809671818146,3.8769513670771496,-3.1656152673807245,4.7280175454532642,5.3677598852408002,-3.6601725634613582,-2.9606091359308899],"frame":"1990-1994","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","darios","hauert","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.4307099311065237,4.0434052697417115],"y":[0.31481281182305776,1.529995220159257],"z":[-0.58402316783467767,-3.60713658535097],"frame":"1990-1994","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["frauenmord","frau"],"textposition":["top center","top center"],"hoverinfo":["text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"frames":[{"name":"1990-1994","data":[{"x":[-4.2642123131010807,0.54065087955493962,-1.0045959786178764,-2.5476129181186691,-3.2208796465933784,-2.3354458636356519,-2.0826341485445679,-1.6221733557309994,-2.8423525236641005,-2.800323014523054,-2.4119687055814611,0.45237562027208489,-3.5121973061649179,3.6027521294699265,-0.25321671996449086,4.1720302131453657,-2.2909405572314978,-0.93110820976778486,-2.2950722993678463,1.0592860966005602,5.0165387928014411,-1.0186388104715312,0.027623469173095761,-0.83802502703380799,2.6406416572184925,2.5672781918739824,5.59580250818036,4.5191966217921733],"y":[1.644972998433899,-3.3982617893493678,-0.44464852511443909,2.9972342969244377,1.3390931644285324,0.57967388506490092,0.71504694244083755,0.71033000414680203,3.8466765929283202,1.075116701092063,-0.63350090523419322,-1.9555510702021432,3.0029402059743453,-3.1859125146812932,-2.0575613513103601,-0.82475195240329779,0.37147467395531553,-3.2456001909606411,3.1257899776555931,-4.1780745723110302,4.1510985064430734,-3.8231334799352741,-1.7122747173597404,-1.042546357184617,3.3894273964100101,-3.0085721194716215,3.6339792477279973,1.6397335169847049],"z":[0.6117662461114225,0.44191626538543111,-2.7123058277577026,-1.0091405983608075,0.44508565918250281,1.0206129074500647,0.33751606944021345,-0.47628297503928529,0.30012457311464502,-0.74790871611348086,-0.27722340080539448,-2.9162998881311104,0.36116230024610979,-1.523644517312696,-1.3676553525592519,2.5403066547366713,1.1743576546474122,-0.047559043309833578,0.33943573677395,-0.033720168121006963,3.4558397503567266,-0.087713809671818146,3.8769513670771496,-3.1656152673807245,4.7280175454532642,5.3677598852408002,-3.6601725634613582,-2.9606091359308899],"frame":"1990-1994","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","darios","hauert","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.4307099311065237,4.0434052697417115],"y":[0.31481281182305776,1.529995220159257],"z":[-0.58402316783467767,-3.60713658535097],"frame":"1990-1994","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["frauenmord","frau"],"textposition":["top center","top center"],"hoverinfo":["text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"1995-1999","data":[{"x":[-0.41101372066306324,1.3921023848242613,-0.69656783052668425,0.63190001439298804,-2.6583353690313776,-1.3676032508703,0.20352763997802586,-2.3220419274151549,-2.7785611902729643,-3.0728075945436331,-0.35433619752345835,-3.7477934767792305,0.059462552923623666,0.77127654734189477,0.15797144646631575,1.6340147838331514,-0.87986300611495827,-0.13404351718087662,-0.85722925245812454,-2.7622966402609608,-1.986273041004299,-0.46430197432636328,4.0446959429695069,-0.63711673700296245,0.33030952374975631,-1.2752743012321139,2.7116783203616399,2.224542076994374,3.059041158700555,3.2856159698141374],"y":[0.30524469837408341,-3.4281860435836564,1.9556816403057742,1.4795245643470281,1.0582102526877877,2.2569255375927439,0.96098772575457136,0.12122641094467007,0.87572770071962458,-0.64522092655593022,-1.2249019687418177,1.8983389686544097,-2.4134510925376826,-2.8135500965638007,-0.44180312901076135,-1.653580020847198,0.68166756072746781,-2.5042115721847202,1.976403700571101,-1.6256414406551625,1.0817388531281367,-0.035450455501649471,1.7354831863836349,-0.74938647043160933,-1.0611169138889456,-0.085134422132106119,1.5677888464854448,-0.50370966401479034,1.0628782016595939,0.99811139154056228],"z":[1.2322469347513554,-1.1857511429433425,-1.7063025534572407,-0.57248865345945898,0.045101961548297119,1.3444410094856116,1.0742005424473462,-0.011162156024708082,-0.56887930906582507,-0.89388607259522179,-1.697758916631942,0.35970711171742664,-1.7446031198147209,-0.83322803429300218,0.099065206720371474,-0.14975404803678824,-0.52639034127181483,0.90120094509747983,-1.9065845879466876,-0.03688819920384602,-0.49974303337469139,0.36629372984230429,1.4311309318315522,-1.2838526750902952,-0.11424014404382539,-0.67227504798734428,3.149271737039157,3.4978638670992099,-1.3437475999884929,-1.7787340481546305],"frame":"1995-1999","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","sexualmord","mord","serienmord","hafturlaub","serienkill","morderpupp","kriminalgeschicht","unheim","gifthex","katt","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-1.9660178283759637,3.1810047034980897],"y":[-0.067354371300168359,2.8744366839356346],"z":[-0.84008643787038084,-2.6287876995679653],"frame":"1995-1999","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["frauenmord","frau"],"textposition":["top center","top center"],"hoverinfo":["text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2000-2004","data":[{"x":[0.41144068478610113,1.8713840764853245,-0.8490141170784179,0.75619387829264517,-2.7812302870989565,-1.2668321707117804,-1.1743613313827217,-1.673475684698412,-2.9506451368736921,-1.7744203849419311,-2.7474886777603822,-0.27855047907226743,-1.1411215703332922,2.4878445498408879,-1.825232309849959,-2.3179164171427136,-1.798467133167291,-1.2054105975174991,-1.833586854523477,-1.365553906528165,-0.81857109993917809,4.911897401192479,-0.50908256172955724,-0.080805263508859387,-1.3135067293175267,2.3120630124454955,2.7569233558983823,1.2577901733728398,2.2737396182253908],"y":[0.9039925656602491,-2.2541810371452171,2.07302409162277,1.0533497122044866,1.0939658260252105,2.2430345724883547,1.2302655448703024,-0.15948662368165606,-0.49589447571472617,-1.0170490091673077,2.9139284823482456,-2.1452202880162727,-0.9484629743365377,-0.22009025541091715,0.32281640703587133,-1.3538261384685748,-0.56526621350348838,-0.29036524805205627,1.036638741479853,-0.11663400335636531,-0.35933281470984618,1.6328116939854831,-0.55157091861685748,-2.0054117679258336,-0.13265180614638108,0.76982914976747385,0.23390037577282929,1.0101378411208213,0.99266441511010273],"z":[1.3909465821509845,1.2643580838525448,-1.1507011072360291,-0.36697864040749223,-0.43081251172458029,0.87152037475634592,0.64487702816661963,-1.0054878916180272,-1.1921569882399914,-0.68697922113190724,0.90939742266452361,-0.92787772523082201,-0.37339494883566254,-0.028113816560944801,-1.4841357108467528,-0.97594492895657048,1.1993167345904401,-1.0413179768069776,-1.0477827486016071,-0.39894953410273931,0.42317794519913909,0.61497327090396336,-1.2783178977436811,-0.1483116596386535,-1.3416408152560289,3.223170683423791,3.283119565563259,-1.5156539594618448,-2.6094571538937945],"frame":"2000-2004","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","mitternachts","serientat","totungsdelikt","morders","fahnd","unterschied","mordseri","kriminalfall","verbrech","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.0844871307202513,2.90987160695409],"y":[-0.56327432977970893,3.1682353788966342],"z":[-1.329925462976195,-1.4182499060585376],"frame":"2000-2004","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["frauenmord","frau"],"textposition":["top center","top center"],"hoverinfo":["text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2005-2009","data":[{"x":[0.99001498695240187,1.2943518689682159,-0.55851434373736875,1.4008556844728639,-3.0341007618489932,-1.2155919691233286,-0.15362739026753774,-1.4304730874468918,-3.4161251176561227,-0.89050651694433158,-1.6880710963396657,-0.061829948169736845,-0.61987039375528075,2.6064809400068278,-1.1219406457840286,-1.9217703632358702,-0.61591519814871265,-1.7815004018216769,-0.33054645162927093,1.5644997140668933,-1.147276540832727,2.3077261406715439,1.2423015566781341,3.4220331924313445,0.42885116410240487,1.975217093632194,0.39973758252733066,2.2314208982217227,1.7269751352732057,3.0071446865177389,2.8809292678580305,2.5106223028380499,3.2300440217293289,2.3375790675671806,2.3575909696641504,3.7776497242029996,1.0644573281090912,-0.08679785138217623,-1.2447208499652866,2.0664819705600914,-0.75459844626376793,-0.83375028025830733,-1.2785399602778138,1.8079837042307678,2.2547719452303259,1.6139171141704876,2.4833020838291224],"y":[1.0824598321962895,-2.7234399251009522,0.98148756113241498,1.0958796588515549,1.4529851083033511,1.4170641102128396,0.67913136489837778,0.57238586950842629,-0.58544424101565251,-2.1881167488860176,1.30220731611342,-2.4793616310420385,-0.62283318236699547,-1.2967008118882637,0.89536472353794339,-1.0286670523820516,-0.62527088072138093,2.1880508330213373,-0.63794828535353076,1.5290965715310587,2.3604396703210031,0.2919895025634282,-0.38835551412939173,0.3527859425804698,0.43169796522280984,1.9153819384206714,3.0625810787644046,1.729962374264727,0.18920228420864757,1.6614962859322031,1.2931458394167137,3.1656781645241541,1.481611790384086,2.3214311394370637,2.2264697597272307,1.9606356064612172,0.15988824193885151,2.202361469252677,-0.79698171801022355,0.049660254707731145,-1.0501196945320488,-1.0722663927886036,0.27903101319347401,0.92779939599457861,-2.5386255800834738,2.114540442321545,2.0793306690235558],"z":[0.29538179062375336,1.761711946113611,0.067974327598216311,-1.231560836126931,-0.058287106749701979,1.0850783646219733,0.37504868026262517,-0.071132982307342066,-0.86974173395698895,-0.91215748291803944,-0.3282863526177468,-1.2263365380700819,-0.0095180511127614647,-0.076539955544063398,-1.8370355600018107,-0.36662091921531376,-0.48898483444267199,-0.48703001696846165,-0.90554437788077546,-2.0587873742813025,0.60533818875640377,-1.1297256253903909,0.0031365664772593088,0.16732339004850713,-0.35745615759776922,1.1464824426536206,0.5433294718910493,-1.4684024333925587,-0.11516354180131655,-0.87580209150168153,1.2347919684575703,-0.15463228821895281,0.1559869094771994,-0.57649161498871715,-1.4572587523671308,1.2288131604655672,-1.2019712981607824,0.52058368205198779,0.38422266173402858,-1.3984055489604217,-1.1224787390945408,0.45956831418133609,-0.35001918661724563,2.3686561770170007,2.9850018631714446,-2.765625257411664,-3.5517026314601536],"frame":"2005-2009","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","serientat","totungsdelikt","fahnd","monárrez","tatbestand","juárez","frauenhass","vorher","araceli","landesdurchschnitt","madchennam","lebenspartnerschaft","todesfalle","sextourismus","aufschlussel","jahresdurchschnitt","heyz","familienmodell","gendefekt","unterschied","nordmexikan","mitternachtsmord","serienvergewalt","ciudad","mordseri","kriminalfall","verbrech","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[0.96178567221638245,3.0142020040130877,-1.0424920024198678,3.5877927475878715],"y":[2.3110854731578825,0.94213761644733274,-0.27590580996728958,3.2367875162200934],"z":[-1.124930206544311,-0.22092409175071342,-0.8676056853314893,-2.5316432668617059],"frame":"2005-2009","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["feminizid","femizid","frauenmord","frau"],"textposition":["top center","top center","top center","top center"],"hoverinfo":["text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2010-2014","data":[{"x":[-1.6003813397900251,2.4270796327595803,-0.43301991650519139,0.37161858970938094,-2.6326453394412224,-1.1297605559226767,-0.29839015335527003,-1.9457399934137152,-3.0757941966110702,-1.0016275648838935,-1.2682541311577271,0.10581290928602222,-0.7626497972267986,2.3615421912818748,-1.496054397247905,-2.3494429054157222,-2.0864329735466605,-0.76113119332271761,1.7046013077543494,3.9947887317405004,1.4304914723455,1.5410926016227517,-0.93104559034773859,-0.37249281584054411,2.659369088453142,1.2732231764919388,-1.7496958489174046,1.9588885793758541,-0.90326920937701705,2.5580260697629336,-0.22736466961456539,2.2298181011240907,1.4284125716721829,0.15011393343344062,2.2864931941286715,1.4470823727834281,2.5543923186294748,1.4911857436425151,2.8796934194639339,1.5836660980192991,2.0951207510208425],"y":[0.74194477955756122,-2.5089925857723085,1.5067550188139101,1.3400545094691625,1.4204274408349178,1.0847403408627028,0.4193742334572888,0.68567872649088912,-0.68483734083873127,-1.7087394196836752,2.1562663241061286,-2.933187334547239,-1.2134999443209027,-1.5338959293579262,0.40835950897857853,-1.1202623080422958,1.4670296893755819,-0.91747544702477868,-0.32555477489385376,1.3880578196507856,-0.027231503777085622,-0.58087576561706344,-1.2462011844599952,-1.5888495267764897,0.1497452246706166,-0.06998655224278183,-0.60315437314152021,0.38806490383365216,1.0301988596682048,-0.39358527658665377,0.52753420238439119,-1.7108945073722792,0.1942756986385758,-2.5764766587390779,-2.1783177981438735,0.073736038449424543,-1.1053340582528164,1.3705808982976166,-1.1132386619168579,2.0702111113101092,2.1763545486223839],"z":[-0.084758280052571258,0.65910863008885101,-0.53642102836048022,0.77039985875117734,-0.074628666876057348,0.44619128637858535,0.36041833047700261,-1.3044536593176026,-0.3279870808772542,-1.666396831562001,0.57157602999817203,-1.4955056502915391,0.2956516798953569,0.11961281818812557,-0.76180619161942065,0.86524081049754042,0.56885004549122442,-0.24564991283119902,-0.47063914773971088,1.3223637353959528,-1.4232669294397349,-1.0755107678812179,-0.31323882339710607,0.68214187362711887,-0.60586383841320213,0.34556721527098833,-0.6673262814448585,-0.80182865509142898,0.21299420677062569,-1.0988589842087588,-0.27804481925703234,-0.4238191747318889,-1.7473802521620505,-0.73477192236487032,1.3924816858672475,-1.0641372026420941,-0.12467547383950926,3.6629445812423254,4.4555495861540848,-1.8160933805543875,-2.2865956240606535],"frame":"2010-2014","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","juárez","unterschied","nordmexikan","ciudad","mordseri","kriminalfall","nordmexiko","drogenkrieg","verbrech","gewaltkriminalitat","horrormeld","michoacana","kapitalstraf","marchenstoff","indianerinn","adventkill","feuillad","bandenkriminalitat","revert","frankreich","tout","hauslich","gewalt"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[0.73853013858686145,-0.21796741355473057,2.7449543753109298],"y":[0.83688708539541889,-1.2614056870307175,3.7764773414790507],"z":[-1.3294883329431062,-1.3194282157034762,-3.2701995748858774],"frame":"2010-2014","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["femizid","frauenmord","frau"],"textposition":["top center","top center","top center"],"hoverinfo":["text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2015-2019","data":[{"x":[-0.81437799517194454,0.82640330589582489,-1.8543398122741404,3.2269426067743208,-2.6924161431311968,-0.284368813610541,1.0954648080651268,-2.825691077748254,-2.9951178507276301,-0.24120129353581476,-2.7652239421835012,0.83846346204493238,-0.1444828992176391,2.6111544719514601,-1.7855850746491346,-2.095869792162135,-1.8754710001180939,-0.86443973254706941,3.296287129083026,-0.60948141074892015,0.88724538740992109,-1.2695656001002977,0.069916962083846013,2.3334484724247466,3.5338166117150078,2.0806229906813254,1.740925318045524,1.5215911355548122,0.12600388515742608,2.3914802731486384,2.0343409313472218,2.4876038084189149,1.2578074038627434,1.2138769682152157,2.0203268485382058,2.275280202016146,2.1135960933064633,2.193279409480509,2.3229992096387435,2.1972187951652953,1.3759755374372358,1.4843246273445752,2.7023826928809469,-0.20993210313285496],"y":[0.80017497630379941,0.55825190281499959,0.76039809993648555,1.2205807388567163,1.2231040646633875,0.86545185002188207,1.9952495628256646,-0.28614394091030776,-0.45688790088841325,-1.8680833701821553,1.1310804536485297,-1.568660504205684,-1.3533892883242811,-2.3292443561043452,1.4591423678783861,-0.58450814415328489,1.7661028630821582,-0.69631515025213075,1.7357025403369097,-1.4688839262276829,-0.9250858736930252,-0.20860418598723207,-0.01172139739242316,-0.14294245815917683,-0.27557967160751201,1.2340799685898678,-0.92847710293244146,0.81561266383518494,1.2447826428782927,0.66692186389423758,-0.93680997278482703,0.12216622153475686,1.8978716596103806,2.1102057512764345,0.47558042717119425,0.98208651411985104,2.8654400900430885,1.1554786912139829,1.850635184158004,0.17329761057724632,1.802779263903169,-0.87955972801965288,1.8600955601798872,-0.14317866418815828],"z":[-0.058721599071795937,0.18208711841376504,-0.90119535106508297,0.64251103002222065,0.041329784296886496,0.18075048870695523,0.24162135664532719,1.084918877251233,-1.2130435856110131,-1.5638602753852859,0.66622364172463744,-1.3386650537690485,-0.51713356348167361,0.98039412520332792,-1.4669642690588505,-0.33695697291931598,-1.2831414489474577,-0.0015212924034449171,0.91770975231659146,-1.2334630002952542,-0.35450813275575105,-1.519938278735069,0.68144836102133288,1.7234851084944962,1.5266511378533167,-0.925288294730919,0.20953085965240875,-0.43261583403400578,0.39848488920144165,3.5538266598664117,3.3012292836700494,-0.42078124517880461,0.7663835857845096,1.0208583734215606,-0.7318339952656765,-1.3635235308098781,-0.15947948492580388,-1.0059574304632695,-0.70280254788641539,-0.65388789714151441,-2.4216889434846114,-0.46984111146376473,-2.7259066490489627,-1.7992701861021516],"frame":"2015-2019","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","zumthema","internetprasenz","schiappas","anprangerten","bouqueval","verwedelnd","frauentot","frankreich","tout","menos","regierungszahl","lohnabbau","niunamenos","argentinierinn","femizidin","machtunterschied","geschlechtsselektion","tesis","hauslich","pisarenko","gewalt","zypernhat"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[1.2566668273819135,0.58373206333925598,0.25113644998069268,3.1967785791990617],"y":[0.33795456628038267,2.3329542236633611,1.2815559542971857,2.4928856528195866],"z":[1.199380080577501,-0.43027570170998836,-0.86999642565086344,-2.5498488673624511],"frame":"2015-2019","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["feminizid","femizid","frauenmord","frau"],"textposition":["top center","top center","top center","top center"],"hoverinfo":["text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2020-2024","data":[{"x":[0.28247613876486921,1.5808619619050104,-0.99759598544805062,1.0257462773760984,-3.1074376561854407,-0.73798027022514789,0.93311709489081562,-3.1651987935011707,-3.1976821730595568,-0.18591008486133317,-2.1039414851088942,1.340100900646888,0.093933790390362509,2.5364330678900262,0.28221670818028904,-2.5321215473744259,-1.650024627561383,-0.27496691843968224,3.2980403654132155,-0.36196972094861252,-0.84240716987728781,-1.6787049917539907,0.9561559262367143,2.8076518172231326,2.2540914641257372,2.060323461699328,2.4487276381957672,2.828370827969831,1.8767164206727547,1.9650765220563342,1.7183604815085218,2.3999867504564882,0.99491130342980394,2.8539854414515555,2.4593183994907908,2.2394910585626846,2.4909392296197765,1.4416825805577946,2.2221629398879572,2.0264556879602522,1.275480406085848,0.80032801068574355,1.1233998115415007,1.6837526581494007,0.83546442061362047,1.5432105897760957,3.0334392735796749,1.8825321817439804],"y":[0.58737370346176132,-1.7720771046858066,1.5008932690090433,0.29533665704574125,1.180466330007093,1.7452677253419144,1.43480867157078,0.49521491904255932,-0.36402629070850623,-1.6790947602750186,3.2753262215371683,-2.8197092781078674,-0.90607492880256302,-1.2677766997735551,0.071441689808448686,-0.99094199657176929,1.4208789430768349,-0.71676845668314304,1.8656694639670262,-1.4531775079876716,-0.90905813347806708,-0.29109038764596873,1.6425317987674819,1.1977418518677778,-0.92461123763079645,0.74281940708455485,0.76478417572247803,1.0260529358394475,1.1305672925426375,0.29052405557232297,0.90687536884348208,0.91351422632326951,0.34313235922379148,-0.17544006477010546,-0.54507421371064346,0.0068178177906545274,-0.23744566718423937,1.3977441563001505,-0.57805485918186905,-0.21575808030366303,1.49736104795715,2.7126028786414667,1.9089855748269646,0.43910282631035846,-0.16879711933689279,-0.19001293206703015,-1.560825373025029,-0.45581871681246156],"z":[-0.68280952274096518,0.027410627085557433,0.86936710542209927,1.3910029300555624,-0.59750465590335244,0.36204567498072937,0.53999785945162626,-0.39976881672701459,-0.66558985387954517,0.064249490540740875,0.14040683418957964,-1.2390407939346619,0.11115427046020822,0.48110384090617414,-1.4538149416592696,-0.53674809416437708,-0.97430620618265729,1.3250730041685435,0.63541410725917635,-1.6715864098783544,0.17142304681921444,-0.97699110103962872,-1.2342659543159147,3.1789594644890444,2.2660936827610327,-0.15072848750084958,-1.2824964856347132,-2.2711242425836287,0.48803783630498732,-1.0229080541888107,-0.88493607414959752,-0.8696068491327239,-0.16758711552307293,-0.39026993535235155,0.16908151915136832,0.67509748993006424,0.25465577460060362,-0.45382475162115338,-0.51214374046516187,0.47255341448740978,0.081711652542600141,0.043062075426444565,-0.34840018562179065,-0.11542222783220075,-0.76205002461041871,0.20156314458910723,0.6386956430726779,0.0035215414842780014],"frame":"2020-2024","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","frauentot","frankreich","tout","menos","hauslich","gewalt","videolaut","femizidzuerst","kingein","geschlechtsspezif","angezeigtd","frauenwahljahr","toutes","stopfemizid","rechercheprojekt","femizide","statistiken","gruhnwald","frauenmordezwar","osterreichwi","auslandergewalt","gureldeniz","bordierd","buchivon","behauptetein","totprugeln"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[1.5952767616482748,1.1939003305096183,0.94651130934728978,3.2434666556761376],"y":[0.058459514659898466,0.97135234882526456,0.45100297514010473,2.4820506694647748],"z":[0.34603712127165159,-0.82682090427480337,-1.2728679470553477,-2.0364491684808459],"frame":"2020-2024","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["feminizid","femizid","frauenmord","frau"],"textposition":["top center","top center","top center","top center"],"hoverinfo":["text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2025-2026","data":[{"x":[-0.89950532162758778,1.3641950521343138,-0.65852624876039478,2.186304097207203,-1.8852156718487134,1.1918281446489261,0.053947276267671242,-2.0391814070799943,-2.8990774638726196,-0.30359147921511037,-0.62619377220984074,-0.44286941906337923,-0.84097791566959779,2.6176295993850744,0.14558610690542773,-1.2567278774553037,-0.014139831894698402,0.27100715584380525,3.9719154918848156,-0.1426082417051282,0.38508078142555346,-1.1847350681314939,2.3492691379992112,2.8925539262720332,3.1303475335469799,1.2582991480054819,2.0194836334532114,1.0295967923078309,2.2787784328074498,1.9374618976956368,1.9819139977700155,1.6929940266377079,0.57222505041384031,2.5758779509821514,1.7692429245370078,3.1804134710397927,1.2470344190029297,0.49543867662906155,1.5498484824108123,2.1339553114110634,3.2392014512185945,1.9312544916542618,1.7261504599440678,1.4808399601716833,2.1342156850237695],"y":[-0.057488228057474854,-1.5682584175592067,1.1296422870266321,0.57205910996760811,0.98800697111148106,1.2989574256276826,1.1936919410226905,-0.76720491353774589,-0.19162131859802681,-2.226958025040255,2.7403209301377065,-0.54444911069060942,-0.7980959182264008,-1.9287600907858238,0.75919604808945518,-0.97923318955964933,1.891890904735386,0.22897641130222229,2.2440319649957527,-1.221276396531656,-0.45382903507283689,-0.13994596263498207,1.6985182600797379,-1.0925048178012697,1.2502299671128776,2.3187033520220068,2.5144684953923844,1.352887879485499,1.733342833126168,0.76292299943618691,1.2065434615821247,1.8547358348784635,1.7927948799965616,1.0851914420740152,0.79173576919628441,1.4199509365872289,2.2879466374593904,1.6904114720932419,1.0096588930594386,1.5387635135534081,0.60759852857849295,0.73384248904508553,1.8073274233539982,-0.052356939270028116,1.0619863381683616],"z":[0.044717255969524985,1.1883364306338111,-0.17113514666562193,1.3134453363239156,-0.42802353800325027,0.69346149008337488,-1.136561322432337,0.69280045289971692,-0.84257243912001978,-1.6904633665199178,0.63510105285983853,-0.3626251747638336,1.116775607417368,1.2815559272492223,-1.3449903860601506,-0.23559649907694005,-0.96993461683044158,1.1876148085674287,1.2663087352539359,-0.24558879589913624,-0.038875729352398566,-0.54185545192872164,2.4873312943060042,2.7253020762439917,-0.49896195970902057,-1.7480747361059479,-2.464047469826502,-0.6433484965167563,-0.57456805450427173,0.65257677854986118,-0.53383528180057072,0.034576372626314467,0.3236634603281146,-0.13550815551274575,0.42135705361060288,0.64846004146592051,0.089118012796869789,0.91737081821500976,0.91015692934934234,-1.6678628105494393,0.78838995053505234,-0.76185159174098716,-1.8005572001838908,-0.80483144299454001,-1.1974243455492699],"frame":"2025-2026","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","doppelmord","mord","serienmord","hafturlaub","serienkill","kriminalgeschicht","unheim","gewaltverbrech","mordfall","totungsdelikt","fahnd","unterschied","mordseri","kriminalfall","verbrech","frankreich","tout","menos","hauslich","gewalt","geschlechtsspezif","rechercheprojekt","2020in","einreichen","jansjustizminist","vielausgab","julibundesrat","riedener23","oktoberw","demrechercheprojekt","septembergefragt","strafartikeln","richte","mitreden","strafrechtsexpertinn","gleichstellungsministerin","familienkonstellation","femiziddi"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[0.97721550372312493,1.5912643953194245,2.2840015272777165,3.858682737022014],"y":[1.5384506444700343,1.9432871767222395,0.95509924137927638,2.8688734137525431],"z":[0.24145498194036463,0.037301894085930869,-1.6955944332291761,-2.6025329096665293],"frame":"2025-2026","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["feminizid","femizid","frauenmord","frau"],"textposition":["top center","top center","top center","top center"],"hoverinfo":["text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]}],"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>

</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-carobbio_giscetti_interpellation_2020" class="csl-entry" role="listitem">
Carobbio Giscetti, Marina. 2020. <span>“Interpellation: <span>Frauenmorde</span> in Der <span>Schweiz</span> Müssen Gestoppt Werden.”</span> <a href="https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505">https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505</a>.
</div>
<div id="ref-ggf_femizid_2023" class="csl-entry" role="listitem">
GgF. 2023. <span>“Femizid Oder <span>Feminizid</span>? – <span>Gemeinsam</span> Gegen <span>Feminizide</span>.”</span> <em>Gemeinsam Gegen Feminizide</em>. <a href="https://contre-les-feminicides.ch/femizid-oder-feminizid/">https://contre-les-feminicides.ch/femizid-oder-feminizid/</a>.
</div>
<div id="ref-journalistde_kein_2023" class="csl-entry" role="listitem">
journalist.de. 2023. <span>“Kein <span>Familiendrama</span>: <span>Berichterstattung</span> Über <span>Femizide</span> Und Der <span>Umgang</span> Mit Überlebenden Und <span>Angehörigen</span>.”</span> Leitfaden. <em>Journalist.de</em>. Bonn: Journalismus3000. <a href="https://www.journalist.de/werkstatt/werkstatt-detail/kein-familiendrama-berichterstattung-ueber-femizide-und-der-umgang-mit-ueberlebenden-und-angehoerigen/">https://www.journalist.de/werkstatt/werkstatt-detail/kein-familiendrama-berichterstattung-ueber-femizide-und-der-umgang-mit-ueberlebenden-und-angehoerigen/</a>.
</div>
<div id="ref-meltzer_gewalt_2023" class="csl-entry" role="listitem">
Meltzer, Christine E. 2023. <span>“Gewalt Gegen <span>Frauen</span> in Den <span>Nachrichten</span>.”</span> Bundeszentrale für politische Bildung pbp. <a href="https://www.bpb.de/shop/zeitschriften/apuz/femizid-2023/519673/gewalt-gegen-frauen-in-den-nachrichten/">https://www.bpb.de/shop/zeitschriften/apuz/femizid-2023/519673/gewalt-gegen-frauen-in-den-nachrichten/</a>.
</div>
<div id="ref-presserat_berichterstattung_2025" class="csl-entry" role="listitem">
Presserat. 2025. <span>“Berichterstattung Zu <span>Femizid</span>.”</span> <em>Schweizer Presserat</em>. <a href="https://presserat.ch/news_40_2025/">https://presserat.ch/news_40_2025/</a>.
</div>
<div id="ref-saccomano_femicide_2015" class="csl-entry" role="listitem">
Saccomano, Celeste. 2015. <span>“Femicide and <span>Violence</span> <span>Against</span> <span>Women</span>.”</span> Institut Barcelona d’Estudis Internacionals (IBEI). <a href="https://www.jstor.org/stable/resrep14204.5">https://www.jstor.org/stable/resrep14204.5</a>.
</div>
<div id="ref-ustpat_studie_2024" class="csl-entry" role="listitem">
ustp.at. 2024. <span>“Studie Zur <span>Berichterstattung</span> Über <span>Femizide</span>.”</span> <em>USTP - University of Applied Sciences St. Pölten</em>. St. Pölten. <a href="https://www.ustp.at/de/stories/news/studie-zur-berichterstattung-ueber-femizide">https://www.ustp.at/de/stories/news/studie-zur-berichterstattung-ueber-femizide</a>.
</div>
<div id="ref-wetzstein_femicide_2024" class="csl-entry" role="listitem">
Wetzstein, Irmgard, Yvonne Prinzellner, and Elisabeth Kröpfl. 2024. <span>“Femicide Coverage in <span>German</span>-Language News. <span>A</span> Content Analysis of <span>Austrian</span>, <span>German</span>, and <span>Swiss</span> Newspaper Articles from 2018 to 2020.”</span> <em>Feminist Media Studies</em>, October, 1–25. <a href="https://doi.org/10.1080/14680777.2024.2417996">https://doi.org/10.1080/14680777.2024.2417996</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Swiss Federal Council, August 12, 2020, https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505 <span class="citation" data-cites="carobbio_giscetti_interpellation_2020">(via <a href="#ref-carobbio_giscetti_interpellation_2020" role="doc-biblioref">Carobbio Giscetti 2020</a>)</span> <!-- evtl. heikel in Fussnote zu zitieren? --><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>German: „[er] die Verwendung des Terminus ‘Femizid’ in der Diplomatie und im Umgang mit den Medien zu fördern [beabsichtigt]” <!-- evtl. italic? --><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>German: “[d]as BFS hingegen in der polizeilichen Kriminalstatistik (PKS) bei Gewaltstraftaten das Geschlecht der geschädigten Personen sowie die Beziehung zwischen geschädigten und beschuldigten Personen [ausweist], so dass Tötungsdelikte an Frauen in der Statistik sichtbar werden” <!-- evtl. italic? --><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>CC-BY-NC-SA</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>