<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lukas Batschelet">
<meta name="author" content="Linus Kiener">
<meta name="dcterms.date" content="2026-01-26">

<title>From “Family Tragedy” to “Feminicide”?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Notebook_files/libs/clipboard/clipboard.min.js"></script>
<script src="Notebook_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Notebook_files/libs/quarto-html/popper.min.js"></script>
<script src="Notebook_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Notebook_files/libs/quarto-html/anchor.min.js"></script>
<link href="Notebook_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Notebook_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Notebook_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Notebook_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Notebook_files/libs/bootstrap/bootstrap-fc78cc84e086300a0584af8142339858.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="Notebook_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Notebook_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="Notebook_files/libs/plotly-binding-4.12.0/plotly.js"></script>
<script src="Notebook_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="Notebook_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="Notebook_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="Notebook_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="Notebook_files/libs/plotly-htmlwidgets-css-2.25.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="Notebook_files/libs/plotly-main-2.25.2/plotly-latest.min.js"></script>
<link href="Notebook_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Notebook_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">From “Family Tragedy” to “Feminicide”?</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Exploring Discursive Change in Swiss Media Reporting on the Killing of Women since 1990</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Lukas Batschelet <a href="mailto:lukas.batschelet@students.unibe.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
               <p>Linus Kiener <a href="mailto:linus.kiener@students.unibe.ch" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 26, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>The language used in media reporting on the killing of women reflects and shapes broader social understandings of gender-based violence. This paper presents an exploratory analysis of discursive change in German-language Swiss media reporting on feminicides since 1990. Drawing on the Swissdox media archive, we apply diachronic word2vec models to examine how key terms and their semantic neighbourhoods have evolved over time. Rather than offering definitive causal explanations, the study aims to detect patterns of continuity and change in terminology, framing, and contextual associations. The findings indicate a gradual shift from individualising and relational framings toward more politicised and gender-specific vocabularies, while certain narrative conventions remain remarkably stable. By combining computational text analysis with a critical perspective on discourse, the paper highlights both the potential and the limits of word embedding methods for studying long-term transformations in media representations of feminicide.</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">0.1</span> Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">0.2</span> Setup</a></li>
  <li><a href="#document-setup" id="toc-document-setup" class="nav-link" data-scroll-target="#document-setup"><span class="header-section-number">0.3</span> Document Setup</a></li>
  <li><a href="#keyword-definitions" id="toc-keyword-definitions" class="nav-link" data-scroll-target="#keyword-definitions"><span class="header-section-number">0.4</span> Keyword Definitions</a></li>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection"><span class="header-section-number">0.5</span> Data collection</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><span class="header-section-number">0.6</span> Data preparation</a></li>
  <li><a href="#descriptive-results" id="toc-descriptive-results" class="nav-link" data-scroll-target="#descriptive-results"><span class="header-section-number">0.7</span> Descriptive results</a></li>
  <li><a href="#corpus-and-preprocessing" id="toc-corpus-and-preprocessing" class="nav-link" data-scroll-target="#corpus-and-preprocessing"><span class="header-section-number">0.8</span> Corpus and preprocessing</a></li>
  <li><a href="#word2vec-frame-shift-diachronic" id="toc-word2vec-frame-shift-diachronic" class="nav-link" data-scroll-target="#word2vec-frame-shift-diachronic"><span class="header-section-number">0.9</span> Word2Vec frame shift (diachronic)</a></li>
  <li><a href="#local-embedding-visualization" id="toc-local-embedding-visualization" class="nav-link" data-scroll-target="#local-embedding-visualization"><span class="header-section-number">0.10</span> Local embedding visualization</a></li>
  <li><a href="#iterative-query-expansion" id="toc-iterative-query-expansion" class="nav-link" data-scroll-target="#iterative-query-expansion"><span class="header-section-number">0.11</span> Iterative query expansion</a></li>
  <li><a href="#second-pass-api-query-manual-curation" id="toc-second-pass-api-query-manual-curation" class="nav-link" data-scroll-target="#second-pass-api-query-manual-curation"><span class="header-section-number">0.12</span> Second-pass API query (manual curation)</a></li>
  <li><a href="#second-pass-data-preparation" id="toc-second-pass-data-preparation" class="nav-link" data-scroll-target="#second-pass-data-preparation"><span class="header-section-number">0.13</span> Second-pass data preparation</a></li>
  <li><a href="#top-sources" id="toc-top-sources" class="nav-link" data-scroll-target="#top-sources"><span class="header-section-number">1</span> Top sources</a></li>
  <li><a href="#normalized-contrast-early-vs.-late-periods-per-million-words" id="toc-normalized-contrast-early-vs.-late-periods-per-million-words" class="nav-link" data-scroll-target="#normalized-contrast-early-vs.-late-periods-per-million-words"><span class="header-section-number">2</span> Normalized contrast: early vs.&nbsp;late periods (per million words)</a>
  <ul class="collapse">
  <li><a href="#second-pass-semantic-expansion-iteration-2" id="toc-second-pass-semantic-expansion-iteration-2" class="nav-link" data-scroll-target="#second-pass-semantic-expansion-iteration-2"><span class="header-section-number">2.1</span> Second-pass semantic expansion (iteration 2)</a></li>
  <li><a href="#interpretation-and-limitations" id="toc-interpretation-and-limitations" class="nav-link" data-scroll-target="#interpretation-and-limitations"><span class="header-section-number">2.2</span> Interpretation and limitations</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">0.1</span> Introduction</h2>
<p>Media coverage of the topic of femicide has always been controversial. The term “femicide” itself is the subject of complex debate in the media and politics. For example, in its statement of August 12, 2020, on interpellation 20.3505<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, the Federal Council said: “There are currently no plans to use the term ‘femicide’,” in response to the question of whether “[it] intends to promote the use of the term ‘femicide’ in diplomacy and in relations with the media”.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> However, it also points out that “[t]he FSO, on the other hand, [reports] the gender of the victims and the relationship between the victims and the accused in the police crime statistics (PKS) for violent crimes, so that homicides against women are visible in the statistics”.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Information such as this can then be used by projects like <a href="https://stopfemizid.ch">stopfemizid.ch</a> to crowdsource reports of such incidents. However, the debate surrounding the use of different terms has now progressed further, with the term “feminicide” gradually becoming established. (As we can also show in our subsequent analysis.) The term was coined by Mexican feminist activist Marcela Lagarde, who wanted to use the neologism “feminicidio” expanding the concept of “femicidio” to include, among other things, the dimension of institutional violence and responsibility <span class="citation" data-cites="saccomano_femicide_2015 ggf_femizid_2023">(cf. <a href="#ref-saccomano_femicide_2015" role="doc-biblioref">Saccomano 2015, 5</a>; as seen in <a href="#ref-ggf_femizid_2023" role="doc-biblioref">GgF 2023</a>)</span>. However, <span class="citation" data-cites="saccomano_femicide_2015">Saccomano (<a href="#ref-saccomano_femicide_2015" role="doc-biblioref">2015</a>)</span> <!-- [p. 33] --> notes that the popularization of the term has also led to confusion and that it is often mistakenly used for any killing of a woman.</p>
<p>In its press release on case No.&nbsp;20/2025, the Swiss Press Council also stated that “[…] it is in the public interest to report on femicides and draw attention to the issue” <span class="citation" data-cites="presserat_berichterstattung_2025">(<a href="#ref-presserat_berichterstattung_2025" role="doc-biblioref">Presserat 2025</a>)</span>. Similar trends can also be observed in academic literature. An overview by <span class="citation" data-cites="meltzer_gewalt_2023">Meltzer (<a href="#ref-meltzer_gewalt_2023" role="doc-biblioref">2023</a>)</span> summarizes extensive findings on media coverage in Germany and mentions “that the term ‘femicide’ did not play a major role in the media until 2019.” According to the report, it was only used in about 1% <!-- escape für % sollte nicht nötig sein --> of the articles examined. We will attempt to replicate this finding, among others, for Switzerland using data from Swissdox via the LiRI (Linguistic Research Infrastructure) API. Moreover, <span class="citation" data-cites="wetzstein_femicide_2024">Wetzstein, Prinzellner, and Kröpfl (<a href="#ref-wetzstein_femicide_2024" role="doc-biblioref">2024</a>)</span> finds that, for posts from the entire DACH region during the observation period between 2018 and 2020, euphemistic terms such as “relationship drama” or “blood deed” vary significantly depending on the type of relationship between the victim and the perpetrator. These and other terms such as “family tragedies” or “jealousy dramas” “trivialize violence against women and turn femicides into fateful isolated cases” <span class="citation" data-cites="journalistde_kein_2023">(<a href="#ref-journalistde_kein_2023" role="doc-biblioref">journalist.de 2023</a>)</span>. Apart from that, the use of terms such as “femicide” (which focus on the gender of the victim) is more common when the perpetrator’s migrant background is mentioned in parallel <span class="citation" data-cites="wetzstein_femicide_2024 ustpat_studie_2024">(<a href="#ref-wetzstein_femicide_2024" role="doc-biblioref">Wetzstein, Prinzellner, and Kröpfl 2024</a>; via <a href="#ref-ustpat_studie_2024" role="doc-biblioref">ustp.at 2024</a>)</span>.</p>
<p>Based on this initial literature review, we have concluded that there is a substantial need for the availability and analysis of data related to the topic of femi(ni)cide, particularly in the recent past within the Swiss media landscape. Our work aims to construct a framework for obtaining relevant data and then demonstrates possible approaches and methods of analysis.</p>
<p>This paper asks whether Swiss media language has shifted from euphemistic or relational framings (e.g., “family tragedy”) toward more explicit, feminist terms (e.g., “femicide”). We combine a two-stage retrieval from Swissdox with descriptive frequency analysis and diachronic word embeddings. The aim is not causal explanation but a systematic description of framing change over time.</p>
<!-- *** -->
<!-- redundant durch fussnoten separator -->
<!-- Achtung: Quarto sollte gehen, aber R Markdown ist "lightweight markup" und unterstützt fussnoten nicht -->
</section>
<section id="setup" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="setup"><span class="header-section-number">0.2</span> Setup</h2>
<p>This section initializes the environment, dependencies, and shared configuration used across all analyses. Heavy steps (API calls, embeddings) are guarded to avoid accidental re-runs.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Large files and long compute times ahead!</strong></p>
<p>This pipeline relies on multithreaded processing wherever possible.</p>
<p>Please make sure that <strong><code>quanteda</code> is running in parallel mode</strong>.<br>
If parallelisation is disabled, several steps (especially tokenisation and feature extraction) may take <em>extremely</em> long.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>How to check whether <code>quanteda</code> runs in parallel
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In R, run (quanteda is already loaded in the setup chunk):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">quanteda_options</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you see:</p>
<pre><code>Parallel computing: disabled</code></pre>
<p>then multithreading is <strong>not</strong> active and performance will be severely reduced.</p>
<p>You can also inspect:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">quanteda_options</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>For setup instructions and troubleshooting, see: <a href="https://quanteda.io/articles/pkgdown/parallelisation.html" class="uri">https://quanteda.io/articles/pkgdown/parallelisation.html</a></p>
</div>
</div>
</div>
<p>Swissdox API calls are also inherently slow and may take hours for large queries.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="st">"httr"</span>, <span class="st">"jsonlite"</span>, <span class="st">"yaml"</span>, <span class="st">"dotenv"</span>, <span class="st">"R6"</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"stringr"</span>, <span class="st">"tidytext"</span>, <span class="st">"readr"</span>, <span class="st">"tidyr"</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="st">"quanteda"</span>, <span class="st">"quanteda.textplots"</span>, <span class="st">"quanteda.textstats"</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="st">"tm"</span>, <span class="st">"topicmodels"</span>, <span class="st">"wordcloud"</span>, <span class="st">"RColorBrewer"</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="st">"umap"</span>, <span class="st">"plotly"</span>, <span class="st">"hunspell"</span>, <span class="st">"word2vec"</span>, <span class="st">"progress"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="st">"qs2"</span>, <span class="st">"tibble"</span>, <span class="st">"scales"</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a>missing_packages <span class="ot">&lt;-</span> required_packages[</span>
<span id="cb4-11"><a href="#cb4-11"></a>  <span class="sc">!</span><span class="fu">vapply</span>(required_packages, requireNamespace, <span class="fu">logical</span>(<span class="dv">1</span>), <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a>]</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_packages) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="fu">install.packages</span>(missing_packages)</span>
<span id="cb4-15"><a href="#cb4-15"></a>}</span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(required_packages, <span class="cf">function</span>(pkg) {</span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-19"><a href="#cb4-19"></a>}))</span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co"># API Wrapper laden</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="fu">source</span>(<span class="st">"swissdox_api.R"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="document-setup" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="document-setup"><span class="header-section-number">0.3</span> Document Setup</h2>
<p>Centralized API access, checkpoint utilities, and text configuration.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Load environment variables from local.env</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"local.env"</span>)) {</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">load_dot_env</span>(<span class="st">"local.env"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">message</span>(<span class="st">"\u2713 Environment variables loaded from local.env"</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>} <span class="cf">else</span> {</span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">message</span>(<span class="st">"WARN: local.env not found - using system environment"</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>✓ Environment variables loaded from local.env</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Initialize API client with credentials</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>client <span class="ot">&lt;-</span> SwissdoxAPI<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_KEY"</span>),</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">api_secret =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_SECRET"</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># Guard flags to prevent accidental duplicate API calls</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co"># Query guards:</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># - RUN_* enables the API call at all</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co"># - FORCE_* re-runs even if a checkpoint already exists</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>RUN_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>FORCE_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>RUN_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>FORCE_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co"># Word2Vec guards (first-pass)</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>RUN_WORD2VEC_TRAINING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>FORCE_WORD2VEC_TRAINING <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co"># Second-pass Word2Vec guards</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>RUN_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>FORCE_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co"># Checkpoint helpers (load/save latest timestamped files)</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>find_latest <span class="ot">&lt;-</span> <span class="cf">function</span>(pattern, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb7-23"><a href="#cb7-23"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> pattern, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-24"><a href="#cb7-24"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-25"><a href="#cb7-25"></a>  <span class="co"># Prefer timestamp in filename (YYYYMMDD_HHMMSS). Fall back to mtime.</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb7-28"><a href="#cb7-28"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb7-29"><a href="#cb7-29"></a>  }</span>
<span id="cb7-30"><a href="#cb7-30"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb7-31"><a href="#cb7-31"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb7-32"><a href="#cb7-32"></a>}</span>
<span id="cb7-33"><a href="#cb7-33"></a></span>
<span id="cb7-34"><a href="#cb7-34"></a>latest_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb7-35"><a href="#cb7-35"></a>  patterns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-36"><a href="#cb7-36"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.rds$"</span>),</span>
<span id="cb7-37"><a href="#cb7-37"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.qs2$"</span>)</span>
<span id="cb7-38"><a href="#cb7-38"></a>  )</span>
<span id="cb7-39"><a href="#cb7-39"></a>  files <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(patterns, <span class="cf">function</span>(p) <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> p, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb7-40"><a href="#cb7-40"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-41"><a href="#cb7-41"></a>  <span class="co"># Reuse find_latest logic on the combined list</span></span>
<span id="cb7-42"><a href="#cb7-42"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb7-43"><a href="#cb7-43"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb7-44"><a href="#cb7-44"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb7-45"><a href="#cb7-45"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb7-47"><a href="#cb7-47"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb7-48"><a href="#cb7-48"></a>}</span>
<span id="cb7-49"><a href="#cb7-49"></a></span>
<span id="cb7-50"><a href="#cb7-50"></a>save_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, prefix, <span class="at">dir =</span> <span class="st">"data"</span>, <span class="at">format =</span> <span class="st">"qs2"</span>, <span class="at">compress =</span> <span class="st">"xz"</span>) {</span>
<span id="cb7-51"><a href="#cb7-51"></a>  timestamp <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)</span>
<span id="cb7-52"><a href="#cb7-52"></a>  <span class="cf">if</span> (format <span class="sc">==</span> <span class="st">"qs2"</span>) {</span>
<span id="cb7-53"><a href="#cb7-53"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb7-54"><a href="#cb7-54"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot save .qs2 checkpoint"</span>)</span>
<span id="cb7-55"><a href="#cb7-55"></a>    }</span>
<span id="cb7-56"><a href="#cb7-56"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".qs2"</span>))</span>
<span id="cb7-57"><a href="#cb7-57"></a>    qs2<span class="sc">::</span><span class="fu">qs_save</span>(obj, file)</span>
<span id="cb7-58"><a href="#cb7-58"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-59"><a href="#cb7-59"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".rds"</span>))</span>
<span id="cb7-60"><a href="#cb7-60"></a>    <span class="fu">saveRDS</span>(obj, file, <span class="at">compress =</span> compress)</span>
<span id="cb7-61"><a href="#cb7-61"></a>  }</span>
<span id="cb7-62"><a href="#cb7-62"></a>  <span class="fu">message</span>(<span class="st">"Saved checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-63"><a href="#cb7-63"></a>  file</span>
<span id="cb7-64"><a href="#cb7-64"></a>}</span>
<span id="cb7-65"><a href="#cb7-65"></a></span>
<span id="cb7-66"><a href="#cb7-66"></a>load_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, var_name) {</span>
<span id="cb7-67"><a href="#cb7-67"></a>  file <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(prefix)</span>
<span id="cb7-68"><a href="#cb7-68"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(file)) {</span>
<span id="cb7-69"><a href="#cb7-69"></a>    <span class="fu">message</span>(<span class="st">"No checkpoint found for: "</span>, prefix)</span>
<span id="cb7-70"><a href="#cb7-70"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-71"><a href="#cb7-71"></a>  }</span>
<span id="cb7-72"><a href="#cb7-72"></a>  <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.qs2$"</span>, file)) {</span>
<span id="cb7-73"><a href="#cb7-73"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb7-74"><a href="#cb7-74"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot read: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-75"><a href="#cb7-75"></a>    }</span>
<span id="cb7-76"><a href="#cb7-76"></a>    <span class="fu">assign</span>(var_name, qs2<span class="sc">::</span><span class="fu">qs_read</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb7-77"><a href="#cb7-77"></a>  } <span class="cf">else</span> {</span>
<span id="cb7-78"><a href="#cb7-78"></a>    <span class="fu">assign</span>(var_name, <span class="fu">readRDS</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb7-79"><a href="#cb7-79"></a>  }</span>
<span id="cb7-80"><a href="#cb7-80"></a>  <span class="fu">message</span>(<span class="st">"Loaded checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb7-81"><a href="#cb7-81"></a>  file</span>
<span id="cb7-82"><a href="#cb7-82"></a>}</span>
<span id="cb7-83"><a href="#cb7-83"></a><span class="co"># Text analysis defaults</span></span>
<span id="cb7-84"><a href="#cb7-84"></a>SAVE_CORPUS <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-85"><a href="#cb7-85"></a>USE_STEMMING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-86"><a href="#cb7-86"></a>TRAIN_FULL_MODEL <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-87"><a href="#cb7-87"></a>FULL_MODEL_LABEL <span class="ot">&lt;-</span> <span class="st">"all_2000-2025"</span></span>
<span id="cb7-88"><a href="#cb7-88"></a></span>
<span id="cb7-89"><a href="#cb7-89"></a><span class="co"># Multi-word patterns after stemming (used in preprocessing + word2vec)</span></span>
<span id="cb7-90"><a href="#cb7-90"></a>simplified_patterns <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-91"><a href="#cb7-91"></a>  <span class="fu">c</span>(<span class="st">"hauslich"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-92"><a href="#cb7-92"></a>  <span class="fu">c</span>(<span class="st">"partnerschaft"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-93"><a href="#cb7-93"></a>  <span class="fu">c</span>(<span class="st">"partner"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-94"><a href="#cb7-94"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-95"><a href="#cb7-95"></a>  <span class="fu">c</span>(<span class="st">"sexuell"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-96"><a href="#cb7-96"></a>  <span class="fu">c</span>(<span class="st">"körperl"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-97"><a href="#cb7-97"></a>  <span class="fu">c</span>(<span class="st">"psychisch"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb7-98"><a href="#cb7-98"></a>  <span class="fu">c</span>(<span class="st">"töt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-99"><a href="#cb7-99"></a>  <span class="fu">c</span>(<span class="st">"mord"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-100"><a href="#cb7-100"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb7-101"><a href="#cb7-101"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"drama"</span>),</span>
<span id="cb7-102"><a href="#cb7-102"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"tragödi"</span>),</span>
<span id="cb7-103"><a href="#cb7-103"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"tat"</span>),</span>
<span id="cb7-104"><a href="#cb7-104"></a>  <span class="fu">c</span>(<span class="st">"eh"</span>, <span class="st">"streit"</span>),</span>
<span id="cb7-105"><a href="#cb7-105"></a>  <span class="fu">c</span>(<span class="st">"opf"</span>, <span class="st">"schutz"</span>),</span>
<span id="cb7-106"><a href="#cb7-106"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"schutz"</span>)</span>
<span id="cb7-107"><a href="#cb7-107"></a>)</span>
<span id="cb7-108"><a href="#cb7-108"></a></span>
<span id="cb7-109"><a href="#cb7-109"></a><span class="co"># Normalize terms to match Word2Vec vocabulary (lowercase, optional stemming)</span></span>
<span id="cb7-110"><a href="#cb7-110"></a>normalize_terms_for_model <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb7-111"><a href="#cb7-111"></a>  norm <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(terms)</span>
<span id="cb7-112"><a href="#cb7-112"></a>  toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens</span>(norm, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-113"><a href="#cb7-113"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb7-114"><a href="#cb7-114"></a>    toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens_wordstem</span>(toks, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb7-115"><a href="#cb7-115"></a>  }</span>
<span id="cb7-116"><a href="#cb7-116"></a>  <span class="fu">vapply</span>(toks, <span class="cf">function</span>(x) <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">"_"</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb7-117"><a href="#cb7-117"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="keyword-definitions" class="level2" data-number="0.4">
<h2 data-number="0.4" class="anchored" data-anchor-id="keyword-definitions"><span class="header-section-number">0.4</span> Keyword Definitions</h2>
<p>These terms are the basis for the queries. We define them centrally to keep usage consistent across analysis and API calls.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>feminizid_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span>, <span class="st">"Gewalt gegen Frauen"</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="data-collection" class="level2" data-number="0.5">
<h2 data-number="0.5" class="anchored" data-anchor-id="data-collection"><span class="header-section-number">0.5</span> Data collection</h2>
<p>We retrieve relevant Swissdox articles with an initial broad keyword query. The API call is guarded by flags and checkpoints, so re-runs can reuse cached results without repeating the full download.</p>
<p>Build and run the Swissdox query. Use the checkpoint load block to resume without re-running the API call.</p>
<p>We start with a broad exploratory query using the original keyword list (OR).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Checkpoint load (raw data)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_raw_data_20260127_094655.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Skip if a checkpoint exists unless explicitly forced</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>existing_firstpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_FIRST_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_FIRST_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_firstpass))) {</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">message</span>(<span class="st">"First-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_firstpass))</span>
<span id="cb12-5"><a href="#cb12-5"></a>} <span class="cf">else</span> {</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co"># Full data collection with API wrapper</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>collection_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="at">client =</span> client,</span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb12-10"><a href="#cb12-10"></a>    <span class="at">content_terms =</span> feminizid_keywords,</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="at">date_from =</span> <span class="st">"2000-01-01"</span>,</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb12-16"><a href="#cb12-16"></a>               <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>, </span>
<span id="cb12-17"><a href="#cb12-17"></a>               <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>, </span>
<span id="cb12-18"><a href="#cb12-18"></a>               <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a>  ),</span>
<span id="cb12-20"><a href="#cb12-20"></a>  <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_Collection"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb12-21"><a href="#cb12-21"></a>  <span class="at">comment =</span> <span class="st">"Comprehensive feminicide media analysis dataset"</span>,</span>
<span id="cb12-22"><a href="#cb12-22"></a>  <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-23"><a href="#cb12-23"></a>  <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb12-24"><a href="#cb12-24"></a>)</span>
<span id="cb12-25"><a href="#cb12-25"></a></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co"># Store results and save checkpoint</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(collection_result<span class="sc">$</span>data)) {</span>
<span id="cb12-28"><a href="#cb12-28"></a>  media_data <span class="ot">&lt;-</span> collection_result<span class="sc">$</span>data</span>
<span id="cb12-29"><a href="#cb12-29"></a>  <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb12-30"><a href="#cb12-30"></a>  <span class="fu">message</span>(<span class="st">"\u2713 "</span>, collection_result<span class="sc">$</span>message)</span>
<span id="cb12-31"><a href="#cb12-31"></a>} <span class="cf">else</span> {</span>
<span id="cb12-32"><a href="#cb12-32"></a>  <span class="fu">message</span>(<span class="st">"Error while loading data"</span>)</span>
<span id="cb12-33"><a href="#cb12-33"></a>}</span>
<span id="cb12-34"><a href="#cb12-34"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>First-pass query skipped. Existing checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
</div>
</section>
<section id="data-preparation" class="level2" data-number="0.6">
<h2 data-number="0.6" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">0.6</span> Data preparation</h2>
<p>We load raw documents, clean fields, and create time variables for later aggregation. All transformations are documented here to keep the analysis pipeline transparent.</p>
<p>Load raw data (from checkpoint or TSV), clean fields, and prepare time variables used in analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Load data (checkpoint first, TSV fallback)</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>raw_file <span class="ot">&lt;-</span> <span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_20260127_094655.qs2</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(raw_file)) {</span>
<span id="cb16-2"><a href="#cb16-2"></a>  tsv_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.tsv(</span><span class="sc">\\</span><span class="st">.xz)?$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="cf">if</span> (<span class="fu">length</span>(tsv_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="fu">message</span>(<span class="st">"WARN: No data files found - run the API call"</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="fu">message</span>(<span class="st">"No .rds file found, loading .tsv files..."</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a>    media_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">lapply</span>(tsv_files, <span class="cf">function</span>(file) {</span>
<span id="cb16-8"><a href="#cb16-8"></a>      <span class="fu">message</span>(<span class="st">"Loading: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb16-9"><a href="#cb16-9"></a>      <span class="fu">read_tsv</span>(file, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb16-10"><a href="#cb16-10"></a>    })) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a>    <span class="fu">message</span>(<span class="st">"\u2713 Combined "</span>, <span class="fu">length</span>(tsv_files), <span class="st">" files: "</span>, <span class="fu">nrow</span>(media_data), <span class="st">" articles"</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a>    <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb16-13"><a href="#cb16-13"></a>  }</span>
<span id="cb16-14"><a href="#cb16-14"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Prepare data (if not already done)</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># Convert dates and create time variables</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>media_data<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb17-4"><a href="#cb17-4"></a>media_data<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb17-5"><a href="#cb17-5"></a>media_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y"</span>)</span>
<span id="cb17-6"><a href="#cb17-6"></a>media_data<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%m"</span>)</span>
<span id="cb17-7"><a href="#cb17-7"></a>media_data<span class="sc">$</span>month_year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># Keep German-only articles (drop French)</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>media_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="fu">message</span>(<span class="st">"German articles after filtering: "</span>, <span class="fu">nrow</span>(media_data))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>German articles after filtering: 36509</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">message</span>(<span class="st">"Date range: "</span>, <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">" to "</span>, <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Date range: 2000-01-03 to 2026-01-25</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">message</span>(<span class="st">"Media outlets: "</span>, <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Media outlets: 158</code></pre>
</div>
</div>
</section>
<section id="descriptive-results" class="level2" data-number="0.7">
<h2 data-number="0.7" class="anchored" data-anchor-id="descriptive-results"><span class="header-section-number">0.7</span> Descriptive results</h2>
<p>We first summarize coverage over time and identify the most frequent terms and sources. These descriptive statistics provide a baseline for interpreting later embedding results.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 1. Articles per year</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>yearly_counts <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">count</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a></span>
<span id="cb23-6"><a href="#cb23-6"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(yearly_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feminicide coverage over time"</span>, </span>
<span id="cb23-10"><a href="#cb23-10"></a>       <span class="at">subtitle =</span> <span class="st">"German media 2000-2025"</span>,</span>
<span id="cb23-11"><a href="#cb23-11"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb23-13"><a href="#cb23-13"></a></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co"># 2. Top outlets</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>top_media <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-16"><a href="#cb23-16"></a>  <span class="fu">count</span>(medium_name, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb23-18"><a href="#cb23-18"></a></span>
<span id="cb23-19"><a href="#cb23-19"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_media, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(medium_name, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-20"><a href="#cb23-20"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 15 outlets"</span>, <span class="at">x =</span> <span class="st">"Outlet"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="co"># 3. Monthly trend (last 5 years)</span></span>
<span id="cb23-26"><a href="#cb23-26"></a>recent_trend <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-28"><a href="#cb23-28"></a>  <span class="fu">count</span>(month_year) <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>  <span class="fu">arrange</span>(month_year)</span>
<span id="cb23-30"><a href="#cb23-30"></a></span>
<span id="cb23-31"><a href="#cb23-31"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recent_trend, <span class="fu">aes</span>(<span class="at">x =</span> month_year, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-32"><a href="#cb23-32"></a>  <span class="fu">geom_line</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-33"><a href="#cb23-33"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb23-34"><a href="#cb23-34"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-35"><a href="#cb23-35"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly trend 2020-2026"</span>, <span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb23-36"><a href="#cb23-36"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">print</span>(p1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">print</span>(p2) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">print</span>(p3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/overview-analysis-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Summary</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>data_overview <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="at">german_articles =</span> <span class="fu">nrow</span>(media_data),</span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="at">date_start =</span> <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="at">date_end =</span> <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="at">media_outlets =</span> <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)),</span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="at">avg_per_year =</span> <span class="fu">round</span>(<span class="fu">nrow</span>(media_data) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>year)))</span>
<span id="cb28-8"><a href="#cb28-8"></a>)</span>
<span id="cb28-9"><a href="#cb28-9"></a>data_overview</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["german_articles"],"name":[1],"type":["int"],"align":["right"]},{"label":["date_start"],"name":[2],"type":["date"],"align":["right"]},{"label":["date_end"],"name":[3],"type":["date"],"align":["right"]},{"label":["media_outlets"],"name":[4],"type":["int"],"align":["right"]},{"label":["avg_per_year"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"36509","2":"2000-01-03","3":"2026-01-25","4":"158","5":"1352"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Keyword frequency in headlines (central definition)</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>keyword_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">keyword =</span> <span class="fu">character</span>(), <span class="at">count =</span> <span class="fu">numeric</span>())</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb29-5"><a href="#cb29-5"></a>  count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(media_data<span class="sc">$</span>head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a>  keyword_counts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(keyword_counts, <span class="fu">data.frame</span>(<span class="at">keyword =</span> kw, <span class="at">count =</span> count))</span>
<span id="cb29-7"><a href="#cb29-7"></a>}</span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a>keyword_counts <span class="ot">&lt;-</span> keyword_counts <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(keyword, count), <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword frequency in headlines"</span>, </span>
<span id="cb29-18"><a href="#cb29-18"></a>       <span class="at">x =</span> <span class="st">"Keyword"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb29-19"><a href="#cb29-19"></a></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="fu">print</span>(p4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/keyword-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Print top keywords</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>keyword_counts</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["keyword"],"name":[1],"type":["chr"],"align":["left"]},{"label":["count"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"häusliche Gewalt","2":"1064"},{"1":"Femizid","2":"832"},{"1":"Familiendrama","2":"549"},{"1":"Gewalt gegen Frauen","2":"387"},{"1":"Frauenmord","2":"106"},{"1":"Familientragödie","2":"89"},{"1":"Ehestreit","2":"65"},{"1":"Beziehungstat","2":"20"},{"1":"Mord an Frau","2":"4"},{"1":"Feminizid","2":"1"},{"1":"Tötung von Frau","2":"1"},{"1":"Partnergewalt","2":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Keyword time trends (central definition)</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>keyword_timeline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb31-3"><a href="#cb31-3"></a></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb31-5"><a href="#cb31-5"></a>  yearly_kw <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span><span class="fu">is.na</span>(head)) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="fu">mutate</span>(<span class="at">has_keyword =</span> <span class="fu">str_detect</span>(head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>    <span class="fu">summarise</span>(</span>
<span id="cb31-10"><a href="#cb31-10"></a>      <span class="at">total_articles =</span> <span class="fu">n</span>(),</span>
<span id="cb31-11"><a href="#cb31-11"></a>      <span class="at">keyword_articles =</span> <span class="fu">sum</span>(has_keyword, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-12"><a href="#cb31-12"></a>      <span class="at">percentage =</span> (keyword_articles <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb31-13"><a href="#cb31-13"></a>      <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>    <span class="fu">mutate</span>(<span class="at">keyword =</span> kw)</span>
<span id="cb31-16"><a href="#cb31-16"></a>  </span>
<span id="cb31-17"><a href="#cb31-17"></a>  keyword_timeline <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(keyword_timeline, yearly_kw)</span>
<span id="cb31-18"><a href="#cb31-18"></a>}</span>
<span id="cb31-19"><a href="#cb31-19"></a></span>
<span id="cb31-20"><a href="#cb31-20"></a><span class="co"># Keep relevant keywords and years</span></span>
<span id="cb31-21"><a href="#cb31-21"></a>keyword_timeline <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb31-22"><a href="#cb31-22"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-23"><a href="#cb31-23"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb31-24"><a href="#cb31-24"></a>  <span class="fu">filter</span>(<span class="fu">sum</span>(keyword_articles) <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least 10 articles overall</span></span>
<span id="cb31-25"><a href="#cb31-25"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-26"><a href="#cb31-26"></a></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="co"># Absolute counts over time</span></span>
<span id="cb31-28"><a href="#cb31-28"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_timeline, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword_articles, <span class="at">color =</span> keyword)) <span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-31"><a href="#cb31-31"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-32"><a href="#cb31-32"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Time trends: keyword usage in headlines"</span>,</span>
<span id="cb31-33"><a href="#cb31-33"></a>       <span class="at">subtitle =</span> <span class="st">"Absolute article counts per year"</span>,</span>
<span id="cb31-34"><a href="#cb31-34"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>, <span class="at">color =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb31-35"><a href="#cb31-35"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb31-36"><a href="#cb31-36"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb31-37"><a href="#cb31-37"></a></span>
<span id="cb31-38"><a href="#cb31-38"></a><span class="co"># Heatmap: keywords x years</span></span>
<span id="cb31-39"><a href="#cb31-39"></a>keyword_matrix <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb31-40"><a href="#cb31-40"></a>  <span class="fu">select</span>(year, keyword, keyword_articles) <span class="sc">%&gt;%</span></span>
<span id="cb31-41"><a href="#cb31-41"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> keyword, <span class="at">values_from =</span> keyword_articles, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-42"><a href="#cb31-42"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"keyword"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>)</span>
<span id="cb31-43"><a href="#cb31-43"></a></span>
<span id="cb31-44"><a href="#cb31-44"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_matrix, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword, <span class="at">fill =</span> count)) <span class="sc">+</span></span>
<span id="cb31-45"><a href="#cb31-45"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb31-46"><a href="#cb31-46"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Articles"</span>) <span class="sc">+</span></span>
<span id="cb31-47"><a href="#cb31-47"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-48"><a href="#cb31-48"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword intensity over time"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb31-49"><a href="#cb31-49"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb31-50"><a href="#cb31-50"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb31-51"><a href="#cb31-51"></a></span>
<span id="cb31-52"><a href="#cb31-52"></a><span class="fu">print</span>(p5)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/time-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">print</span>(p6)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/time-trends-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Key trends</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>trend_summary <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-5"><a href="#cb33-5"></a>    <span class="at">total_articles =</span> <span class="fu">sum</span>(keyword_articles),</span>
<span id="cb33-6"><a href="#cb33-6"></a>    <span class="at">peak_year =</span> year[<span class="fu">which.max</span>(keyword_articles)],</span>
<span id="cb33-7"><a href="#cb33-7"></a>    <span class="at">peak_count =</span> <span class="fu">max</span>(keyword_articles),</span>
<span id="cb33-8"><a href="#cb33-8"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_articles))</span>
<span id="cb33-11"><a href="#cb33-11"></a></span>
<span id="cb33-12"><a href="#cb33-12"></a>trend_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["keyword"],"name":[1],"type":["chr"],"align":["left"]},{"label":["total_articles"],"name":[2],"type":["int"],"align":["right"]},{"label":["peak_year"],"name":[3],"type":["chr"],"align":["left"]},{"label":["peak_count"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"häusliche Gewalt","2":"1062","3":"2021","4":"190"},{"1":"Femizid","2":"831","3":"2025","4":"374"},{"1":"Familiendrama","2":"549","3":"2009","4":"49"},{"1":"Gewalt gegen Frauen","2":"387","3":"2025","4":"93"},{"1":"Frauenmord","2":"106","3":"2021","4":"37"},{"1":"Familientragödie","2":"89","3":"2009","4":"19"},{"1":"Ehestreit","2":"65","3":"2021","4":"8"},{"1":"Beziehungstat","2":"20","3":"2016","4":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Normalized frequency over time for grouped target terms</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>USE_SMOOTH <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a>term_groups <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="at">euphemistic =</span> <span class="fu">c</span>(<span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>),</span>
<span id="cb34-6"><a href="#cb34-6"></a>  <span class="at">explicit =</span> <span class="fu">c</span>(<span class="st">"Femizid"</span>, <span class="st">"Feminizid"</span>, <span class="st">"Frauenmord"</span>),</span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="at">violence_perpetrator =</span> <span class="fu">c</span>(<span class="st">"häusliche Gewalt"</span>, <span class="st">"Misshandlung"</span>, <span class="st">"Täter"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Opfer"</span>, <span class="st">"Eifersucht"</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a>)</span>
<span id="cb34-9"><a href="#cb34-9"></a></span>
<span id="cb34-10"><a href="#cb34-10"></a>target_terms_focus <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(term_groups))</span>
<span id="cb34-11"><a href="#cb34-11"></a></span>
<span id="cb34-12"><a href="#cb34-12"></a>media_terms <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-15"><a href="#cb34-15"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(year),</span>
<span id="cb34-16"><a href="#cb34-16"></a>    <span class="at">content_lower =</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(content),</span>
<span id="cb34-17"><a href="#cb34-17"></a>    <span class="at">word_count =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(content_lower, <span class="st">"</span><span class="sc">\\</span><span class="st">S+"</span>)</span>
<span id="cb34-18"><a href="#cb34-18"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb34-20"><a href="#cb34-20"></a></span>
<span id="cb34-21"><a href="#cb34-21"></a>total_words_year <span class="ot">&lt;-</span> media_terms <span class="sc">%&gt;%</span></span>
<span id="cb34-22"><a href="#cb34-22"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb34-23"><a href="#cb34-23"></a>  <span class="fu">summarise</span>(<span class="at">total_words =</span> <span class="fu">sum</span>(word_count), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb34-24"><a href="#cb34-24"></a></span>
<span id="cb34-25"><a href="#cb34-25"></a>make_term_regex <span class="ot">&lt;-</span> <span class="cf">function</span>(term) {</span>
<span id="cb34-26"><a href="#cb34-26"></a>  term <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(term)</span>
<span id="cb34-27"><a href="#cb34-27"></a>  parts <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(term, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb34-28"><a href="#cb34-28"></a>  <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, <span class="fu">paste</span>(parts, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>), <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb34-29"><a href="#cb34-29"></a>}</span>
<span id="cb34-30"><a href="#cb34-30"></a></span>
<span id="cb34-31"><a href="#cb34-31"></a>term_counts <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(target_terms_focus, <span class="cf">function</span>(term) {</span>
<span id="cb34-32"><a href="#cb34-32"></a>  pattern <span class="ot">&lt;-</span> <span class="fu">make_term_regex</span>(term)</span>
<span id="cb34-33"><a href="#cb34-33"></a>  media_terms <span class="sc">%&gt;%</span></span>
<span id="cb34-34"><a href="#cb34-34"></a>    <span class="fu">mutate</span>(<span class="at">count =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(content_lower, pattern)) <span class="sc">%&gt;%</span></span>
<span id="cb34-35"><a href="#cb34-35"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>    <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-37"><a href="#cb34-37"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> term)</span>
<span id="cb34-38"><a href="#cb34-38"></a>}))</span>
<span id="cb34-39"><a href="#cb34-39"></a></span>
<span id="cb34-40"><a href="#cb34-40"></a>group_map <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(term_groups), <span class="cf">function</span>(g) {</span>
<span id="cb34-41"><a href="#cb34-41"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">term =</span> term_groups[[g]], <span class="at">group =</span> g)</span>
<span id="cb34-42"><a href="#cb34-42"></a>}))</span>
<span id="cb34-43"><a href="#cb34-43"></a></span>
<span id="cb34-44"><a href="#cb34-44"></a>group_counts <span class="ot">&lt;-</span> term_counts <span class="sc">%&gt;%</span></span>
<span id="cb34-45"><a href="#cb34-45"></a>  <span class="fu">left_join</span>(group_map, <span class="at">by =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-46"><a href="#cb34-46"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(group)) <span class="sc">%&gt;%</span></span>
<span id="cb34-47"><a href="#cb34-47"></a>  <span class="fu">group_by</span>(year, group) <span class="sc">%&gt;%</span></span>
<span id="cb34-48"><a href="#cb34-48"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-49"><a href="#cb34-49"></a>  <span class="fu">left_join</span>(total_words_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-50"><a href="#cb34-50"></a>  <span class="fu">mutate</span>(<span class="at">freq_per_million =</span> (count <span class="sc">/</span> total_words) <span class="sc">*</span> <span class="fl">1e6</span>)</span>
<span id="cb34-51"><a href="#cb34-51"></a></span>
<span id="cb34-52"><a href="#cb34-52"></a>p_terms_time <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(group_counts, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> freq_per_million, <span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb34-53"><a href="#cb34-53"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-54"><a href="#cb34-54"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-55"><a href="#cb34-55"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-56"><a href="#cb34-56"></a>    <span class="at">title =</span> <span class="st">"Framing groups over time (per million words)"</span>,</span>
<span id="cb34-57"><a href="#cb34-57"></a>    <span class="at">subtitle =</span> <span class="st">"Euphemistic vs explicit vs violence/perpetrator framing"</span>,</span>
<span id="cb34-58"><a href="#cb34-58"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency per million words"</span>, <span class="at">color =</span> <span class="st">"Group"</span></span>
<span id="cb34-59"><a href="#cb34-59"></a>  ) <span class="sc">+</span></span>
<span id="cb34-60"><a href="#cb34-60"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb34-61"><a href="#cb34-61"></a></span>
<span id="cb34-62"><a href="#cb34-62"></a><span class="cf">if</span> (USE_SMOOTH) {</span>
<span id="cb34-63"><a href="#cb34-63"></a>  p_terms_time <span class="ot">&lt;-</span> p_terms_time <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span>
<span id="cb34-64"><a href="#cb34-64"></a>}</span>
<span id="cb34-65"><a href="#cb34-65"></a></span>
<span id="cb34-66"><a href="#cb34-66"></a><span class="fu">print</span>(p_terms_time)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/target-term-trends-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="corpus-and-preprocessing" class="level2" data-number="0.8">
<h2 data-number="0.8" class="anchored" data-anchor-id="corpus-and-preprocessing"><span class="header-section-number">0.8</span> Corpus and preprocessing</h2>
<p>Build a quanteda corpus and a trimmed DFM from the cleaned articles. Use the checkpoint load block to resume without reprocessing.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Checkpoint load (corpus/dfm)</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_corpus"</span>, <span class="st">"feminizid_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: feminizid_corpus</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_dfm"</span>, <span class="st">"feminizid_dfm_trimmed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: feminizid_dfm</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>corpus_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb42-5"><a href="#cb42-5"></a></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="fu">message</span>(<span class="st">"Articles for corpus: "</span>, <span class="fu">nrow</span>(corpus_data))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Articles for corpus: 35776</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>corpus_data<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb44-6"><a href="#cb44-6"></a></span>
<span id="cb44-7"><a href="#cb44-7"></a>corpus_data <span class="ot">&lt;-</span> corpus_data <span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="#cb44-8"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clean_content), clean_content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(clean_content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a>feminizid_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(corpus_data,</span>
<span id="cb44-11"><a href="#cb44-11"></a>                            <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb44-12"><a href="#cb44-12"></a>                            <span class="at">docid_field =</span> <span class="st">"unique_id"</span>)</span>
<span id="cb44-13"><a href="#cb44-13"></a></span>
<span id="cb44-14"><a href="#cb44-14"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"original_id"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>id</span>
<span id="cb44-15"><a href="#cb44-15"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"medium"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>medium_name</span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"date"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>pub_date</span>
<span id="cb44-17"><a href="#cb44-17"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"year"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>year</span>
<span id="cb44-18"><a href="#cb44-18"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"headline"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>head</span>
<span id="cb44-19"><a href="#cb44-19"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"char_count"</span>) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(corpus_data<span class="sc">$</span>char_count)</span>
<span id="cb44-20"><a href="#cb44-20"></a></span>
<span id="cb44-21"><a href="#cb44-21"></a>corpus_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb44-22"><a href="#cb44-22"></a>  <span class="at">documents =</span> <span class="fu">ndoc</span>(feminizid_corpus),</span>
<span id="cb44-23"><a href="#cb44-23"></a>  <span class="at">tokens =</span> <span class="fu">sum</span>(<span class="fu">ntoken</span>(feminizid_corpus)),</span>
<span id="cb44-24"><a href="#cb44-24"></a>  <span class="at">date_start =</span> <span class="fu">min</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-25"><a href="#cb44-25"></a>  <span class="at">date_end =</span> <span class="fu">max</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-26"><a href="#cb44-26"></a>)</span>
<span id="cb44-27"><a href="#cb44-27"></a>corpus_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["documents"],"name":[1],"type":["int"],"align":["right"]},{"label":["tokens"],"name":[2],"type":["int"],"align":["right"]},{"label":["date_start"],"name":[3],"type":["date"],"align":["right"]},{"label":["date_end"],"name":[4],"type":["date"],"align":["right"]}],"data":[{"1":"35776","2":"37221149","3":"2000-01-03","4":"2026-01-25"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">summary</span>(feminizid_corpus, <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Text"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Types"],"name":[2],"type":["int"],"align":["right"]},{"label":["Tokens"],"name":[3],"type":["int"],"align":["right"]},{"label":["Sentences"],"name":[4],"type":["int"],"align":["right"]},{"label":["id"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["pubtime"],"name":[6],"type":["dttm"],"align":["right"]},{"label":["medium_code"],"name":[7],"type":["chr"],"align":["left"]},{"label":["medium_name"],"name":[8],"type":["chr"],"align":["left"]},{"label":["rubric"],"name":[9],"type":["chr"],"align":["left"]},{"label":["regional"],"name":[10],"type":["chr"],"align":["left"]},{"label":["doctype"],"name":[11],"type":["chr"],"align":["left"]},{"label":["doctype_description"],"name":[12],"type":["chr"],"align":["left"]},{"label":["language"],"name":[13],"type":["chr"],"align":["left"]},{"label":["char_count"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["dateline"],"name":[15],"type":["chr"],"align":["left"]},{"label":["head"],"name":[16],"type":["chr"],"align":["left"]},{"label":["subhead"],"name":[17],"type":["chr"],"align":["left"]},{"label":["article_link"],"name":[18],"type":["chr"],"align":["left"]},{"label":["content_id"],"name":[19],"type":["chr"],"align":["left"]},{"label":["content"],"name":[20],"type":["chr"],"align":["left"]},{"label":["pub_date"],"name":[21],"type":["date"],"align":["right"]},{"label":["year"],"name":[22],"type":["chr"],"align":["left"]},{"label":["month"],"name":[23],"type":["chr"],"align":["left"]},{"label":["month_year"],"name":[24],"type":["chr"],"align":["left"]},{"label":["original_id"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["medium"],"name":[26],"type":["chr"],"align":["left"]},{"label":["date"],"name":[27],"type":["date"],"align":["right"]},{"label":["headline"],"name":[28],"type":["chr"],"align":["left"]}],"data":[{"1":"doc_1","2":"65","3":"81","4":"5","5":"6045314","6":"2010-04-19 22:00:00","7":"NZZO","8":"nzz.ch","9":"NA","10":"Panorama","11":"WWE","12":"Online medium","13":"de","14":"519","15":"NA","16":"Zwei Tote bei Schiesserei vor US-Spital","17":"NA","18":"NA","19":"00026c57-62b2-e220-e815-80def2bba2ae","20":"<tx><p>(ddp) Bei einer Schiesserei vor einem Spital im US-Teilstaat Tennessee sind eine Frau getötet und zwei weitere verwundet worden. Der Täter nahm sich anschliessend selbst das Leben, wie die Polizei mitteilte. Bei den Opfern handelte es sich um Angestellte, beziehungsweise ehemalige Mitarbeiter des Parkwest Medical Center in Knoxville. Das Motiv für die Bluttat am Montagnachmittag (Ortszeit) war zunächst nicht bekannt.  Gemäss ersten Erkenntnissen handelte es sich nicht um eine Beziehungstat.<\/p><\/tx>","21":"2010-04-19","22":"2010","23":"04","24":"2010-04","25":"6045314","26":"nzz.ch","27":"2010-04-19","28":"Zwei Tote bei Schiesserei vor US-Spital","_rn_":"1"},{"1":"doc_2","2":"87","3":"123","4":"7","5":"12774039","6":"2003-11-12 23:00:00","7":"TA","8":"Tages-Anzeiger","9":"NA","10":"Inland","11":"PND","12":"National daily newspaper","13":"de","14":"792","15":"NA","16":"Schutz für Opfer häuslicher Gewalt","17":"NA","18":"NA","19":"000843dc-d164-c7a1-e6a2-376ab92330c4","20":"<tx><p>Bern. - Opfer häuslicher Gewalt sollen besser geschützt werden. In Zukunft sollen Richter gewalttätige Personen aus der gemeinsamen oder ehemals gemeinsamen Wohnung ausweisen und ihnen das Betreten der Wohnung für eine bestimmte Zeit verbieten können. Damit hätten die Opfer eine Alternative zur Flucht aus der eigenen Wohnung. Der Richter soll der verletzenden Person auch verbieten können, mit dem Opfer telefonisch, schriftlich, elektronisch oder sonstwie Kontakt aufzunehmen. Der Bundesrat hat am Mittwoch einen entsprechenden Entwurf für einen neuen Artikel im Zivilgesetzbuch bis Ende Februar in die Vernehmlassung geschickt. Dieser sieht auch vor, dass die Kantone Informations- und Beratungsstellen einrichten, um häusliche Gewalt zu vermeiden und Rückfälle zu verhindern. (AP)<\/p><\/tx>","21":"2003-11-12","22":"2003","23":"11","24":"2003-11","25":"12774039","26":"Tages-Anzeiger","27":"2003-11-12","28":"Schutz für Opfer häuslicher Gewalt","_rn_":"2"},{"1":"doc_3","2":"406","3":"776","4":"32","5":"38217916","6":"2019-11-06 23:00:00","7":"AZM","8":"Aargauer Zeitung / MLZ","9":"Leserbriefe","10":"AZ Fernausgabe","11":"PND","12":"National daily newspaper","13":"de","14":"4582","15":"Leserbriefe","16":"Wo bleiben Liebe und Hoffnung?","17":"NA","18":"NA","19":"00089c2a-ee93-2f21-3188-4e2b315e743c","20":"<tx><p>Leserbrief: Die göttliche Ordnung bedeutet fast nichts mehr<\/p><p>Ausgabe vom 5. 11.<\/p><p>Es läuft mir kalt den Rücken runter, wenn ich lese, dass ein ehemaliger Gemeinderat einer Nachbargemeinde die Abweisung der Zwillinge gutheisst, mit dem Verweis auf die «göttliche Ordnung», die in dieser Familie missachtet werde. Man muss nicht bibelfest sein, um zu wissen, dass zum Glauben auch Liebe und Hoffnung gehören.<\/p><p>Marianna Matt, Reinach<\/p><zt>Heuchlerischer geht nicht mehr<\/zt><p>Also noch heuchlerischer geht es fast nicht mehr, wenn Heinz Rohr, Präsident EDU Bezirk Brugg und alt Gemeinderat Lupfig, beim Thema Regenbogenfamilie die «göttliche Ordnung über Ehe und Familie» bemüht und dabei behauptet, es gehe nicht um Diskriminierung gleichgeschlechtlicher Paare und ihrer Kinder. Im Laufe der Jahrtausende hat die «göttliche Ordnung von Ehe und Familie» viele Varianten gekannt, welche in den jeweiligen Gesellschaften akzeptiert waren. Die Bibel nennt z.B. die Vielehe, die Geschwisterehe und die Schwagerehe. Diese Ehe-Formen waren Teil der damaligen gesellschaftlichen Norm. In der Familie waren die Kinder Eigentum des Vaters, der das Recht hatte, z.B. Töchter als Sklavinnen zu verkaufen; auch dies gehörte zur Ordnung, über die wir in der Bibel lesen. Der Autor soll jetzt nicht einwenden, das stehe alles im Alten Testament und habe keinen Bezug zu unserer Zeit. Das würde zwar zutreffen, doch sind es seine Kreise, welche gerne aus den Sündenkatalogen des Alten Testaments zitieren und sie bedenkenlos über die Jahrtausende hinweg in die heutige Zeit transferieren. Auch die mittelalterliche Gesellschaftsordnung, in der Adel und Klerus das gemeine Volk gnadenlos ausbeuteten und unterdrückten, galt damals als gottgegeben. Sie machen sich Sorgen um die Werte, welche Kindern vermittelt werden, die in Regenbogenfamilien aufwachsen. Als alt Gemeinderat sollte der Leserbriefschreiber wissen, wie viel Leid Kinder in zerrütteten «normalen» Familien erdulden müssen, in denen häusliche Gewalt an der Tagesordnung ist. Hat er sich schon gefragt, welches Menschenbild wohl diesen Kindern vermittelt wird? Lieber Herr Rohr, auch zwei Frauen oder zwei Männer können ihren Kindern Zuneigung und Geborgenheit in ihrem Zuhause geben, auch sie sind in der Lage, ihnen biblische Werte beizubringen; Achtung und Respekt vor anderen Menschen und der Natur sind nur zwei davon, die ich erwähnen möchte. So zu tun, als sei nur seine Definition von gottgegebener Ordnung oder biblischen Werten gültig, ist anmassend.<\/p><p>Paul Streiff, Baden<\/p><zt>Die Bedeutung der göttlichen Ordnung<\/zt><p>Fundamentalistische Islamisten sprechen vom «göttlichen Gesetz» und meinen damit die Scharia. Wenn diese «göttliche Ordnung» dazu beiträgt, dass gleichgeschlechtlich liebende Menschen samt ihrer Kinder ausgegrenzt werden mit der fadenscheinigen Begründung, sie entsprächen nicht den biblischen Wertvorstellungen von Ehe und Familie, fällt mir der Verzicht darauf nicht schwer. Vor allem, wenn ich davon ausgehen muss, dass es sich um dieselbe «göttliche Ordnung» handelt, welche bis 1971 das Frauenstimmrecht und ein anständiges Eherecht zu verhindern vermochte. Bei dieser Gelegenheit möchte ich mich bei Karin Rüegg und Eva Schweizer für ihren klugen und mutigen Beitrag bedanken. Ich bin mir absolut sicher, dass nicht ihr die göttlichen Ausrutscher seid.<\/p><p>Andreas Hasenfratz, Seengen<\/p><p>Das Problem mit der Umwelt<\/p><p>Diverse Artikel zur Debatte über den Umweltschutz<\/p><p>Das Problem mit der Umwelt besteht ja eigentlich nicht erst seit gestern. Aber was jetzt damit gemacht wird, ist ein bisschen übertrieben! Schüler gehen statt in die Schule auf die Strasse, demonstrieren für eine bessere Umwelt und haben das Gefühl, etwas zu erreichen. Man nimmt sie zwar wahr, wird auf das Thema aufmerksam, und ein gewisses Umdenken findet statt. Die Politiker diskutieren dieses Thema, aber man redet und redet und sagt nichts! Und wenn sie etwas machen, hat es weder Hand noch Fuss! Auch das ganze Downsizing, das jetzt gross in Mode ist, ist ein Witz. Alle Autohersteller tun so, als hätten sie den Motor neu erfunden. Aber so was gab es schon im Zweiten Weltkrieg, Und nützen tut es gar nichts, ausser dem Hersteller, der es verkauft. Würden die verantwortlichen Politiker auf jene hören, die diese Problematik verstehen, würde es viel weniger nichts bringende Versuche zur Rettung der Umwelt geben. Denn diejenigen, die jetzt auf der Strasse wichtig auffallen, sind die Ersten die mit dem Flugzeug in den Urlaub fliegen. Also so gesehen, könnten wir das ganze Theater sparen.<\/p><p>Martin Bolli, Uerkheim<\/p><\/tx>","21":"2019-11-06","22":"2019","23":"11","24":"2019-11","25":"38217916","26":"Aargauer Zeitung / MLZ","27":"2019-11-06","28":"Wo bleiben Liebe und Hoffnung?","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_corpus_20260128_095044.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_corpus_20260128_095044.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># Load German stopwords</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>german_stopwords <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"german_stopwords_full.txt"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb49-3"><a href="#cb49-3"></a>german_stopwords <span class="ot">&lt;-</span> german_stopwords[german_stopwords <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co"># Media-specific stopwords</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>media_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"uhr"</span>, <span class="st">"jahr"</span>, <span class="st">"jahre"</span>, <span class="st">"jahren"</span>, <span class="st">"prozent"</span>, <span class="st">"franken"</span>, <span class="st">"chf"</span>,</span>
<span id="cb49-7"><a href="#cb49-7"></a>                    <span class="st">"artikel"</span>, <span class="st">"bericht"</span>, <span class="st">"zeitung"</span>, <span class="st">"medium"</span>, <span class="st">"redaktion"</span>, <span class="st">"autor"</span>,</span>
<span id="cb49-8"><a href="#cb49-8"></a>                    <span class="st">"quelle"</span>, <span class="st">"foto"</span>, <span class="st">"bild"</span>, <span class="st">"video"</span>, <span class="st">"online"</span>, <span class="st">"www"</span>, <span class="st">"http"</span>,</span>
<span id="cb49-9"><a href="#cb49-9"></a>                    <span class="st">"montag"</span>, <span class="st">"dienstag"</span>, <span class="st">"mittwoch"</span>, <span class="st">"donnerstag"</span>, <span class="st">"freitag"</span>,</span>
<span id="cb49-10"><a href="#cb49-10"></a>                    <span class="st">"samstag"</span>, <span class="st">"sonntag"</span>, <span class="st">"januar"</span>, <span class="st">"februar"</span>, <span class="st">"märz"</span>, <span class="st">"april"</span>,</span>
<span id="cb49-11"><a href="#cb49-11"></a>                    <span class="st">"mai"</span>, <span class="st">"juni"</span>, <span class="st">"juli"</span>, <span class="st">"august"</span>, <span class="st">"september"</span>, <span class="st">"oktober"</span>,</span>
<span id="cb49-12"><a href="#cb49-12"></a>                    <span class="st">"november"</span>, <span class="st">"dezember"</span>, <span class="st">"schweiz"</span>, <span class="st">"schweizer"</span>, <span class="st">"schweizerin"</span>)</span>
<span id="cb49-13"><a href="#cb49-13"></a></span>
<span id="cb49-14"><a href="#cb49-14"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(german_stopwords, media_stopwords)</span>
<span id="cb49-15"><a href="#cb49-15"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">unique</span>(stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(all_stopwords))</span>
<span id="cb49-16"><a href="#cb49-16"></a>all_stopwords <span class="ot">&lt;-</span> all_stopwords[<span class="fu">nzchar</span>(all_stopwords)]</span>
<span id="cb49-17"><a href="#cb49-17"></a></span>
<span id="cb49-18"><a href="#cb49-18"></a></span>
<span id="cb49-19"><a href="#cb49-19"></a><span class="co"># Tokenisierung und Preprocessing</span></span>
<span id="cb49-20"><a href="#cb49-20"></a>feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(feminizid_corpus,</span>
<span id="cb49-21"><a href="#cb49-21"></a>                          <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-22"><a href="#cb49-22"></a>                          <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-23"><a href="#cb49-23"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb49-24"><a href="#cb49-24"></a>                          <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-25"><a href="#cb49-25"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-26"><a href="#cb49-26"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-27"><a href="#cb49-27"></a></span>
<span id="cb49-28"><a href="#cb49-28"></a><span class="co"># Stemming (optional)</span></span>
<span id="cb49-29"><a href="#cb49-29"></a><span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb49-30"><a href="#cb49-30"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(feminizid_tokens, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb49-31"><a href="#cb49-31"></a>}</span>
<span id="cb49-32"><a href="#cb49-32"></a></span>
<span id="cb49-33"><a href="#cb49-33"></a><span class="co"># Then multi-word expressions (now with base forms)</span></span>
<span id="cb49-34"><a href="#cb49-34"></a><span class="co"># Simplified patterns - base forms are sufficient</span></span>
<span id="cb49-35"><a href="#cb49-35"></a><span class="co"># Uses simplified_patterns defined in text-config</span></span>
<span id="cb49-36"><a href="#cb49-36"></a></span>
<span id="cb49-37"><a href="#cb49-37"></a><span class="co"># Compound multi-word expressions into single tokens</span></span>
<span id="cb49-38"><a href="#cb49-38"></a><span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb49-39"><a href="#cb49-39"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(feminizid_tokens, </span>
<span id="cb49-40"><a href="#cb49-40"></a>                                      <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb49-41"><a href="#cb49-41"></a>                                      <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb49-42"><a href="#cb49-42"></a>}</span>
<span id="cb49-43"><a href="#cb49-43"></a></span>
<span id="cb49-44"><a href="#cb49-44"></a>preprocessing_steps <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb49-45"><a href="#cb49-45"></a>  <span class="at">step =</span> <span class="fu">c</span>(<span class="st">"Stemming"</span>, <span class="st">"Multi-word expressions"</span>, <span class="st">"Benefit"</span>),</span>
<span id="cb49-46"><a href="#cb49-46"></a>  <span class="at">detail =</span> <span class="fu">c</span>(</span>
<span id="cb49-47"><a href="#cb49-47"></a>    <span class="st">"Reduces inflectional variants (e.g., häusliche→häusl, tötung→töt)"</span>,</span>
<span id="cb49-48"><a href="#cb49-48"></a>    <span class="fu">paste</span>(<span class="fu">length</span>(simplified_patterns), <span class="st">"word pairs compounded (e.g., häusl + gewalt → häusl_gewalt)"</span>),</span>
<span id="cb49-49"><a href="#cb49-49"></a>    <span class="st">"One pattern captures multiple variants"</span></span>
<span id="cb49-50"><a href="#cb49-50"></a>  )</span>
<span id="cb49-51"><a href="#cb49-51"></a>)</span>
<span id="cb49-52"><a href="#cb49-52"></a>preprocessing_steps</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["step"],"name":[1],"type":["chr"],"align":["left"]},{"label":["detail"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Stemming","2":"Reduces inflectional variants (e.g., häusliche→häusl, tötung→töt)"},{"1":"Multi-word expressions","2":"16 word pairs compounded (e.g., häusl + gewalt → häusl_gewalt)"},{"1":"Benefit","2":"One pattern captures multiple variants"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Document-Feature-Matrix</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>feminizid_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(feminizid_tokens)</span>
<span id="cb50-3"><a href="#cb50-3"></a></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="co"># Trimming: consistent parameters (both as proportions)</span></span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="co"># Based on quanteda documentation: https://quanteda.io/reference/dfm_trim.html</span></span>
<span id="cb50-6"><a href="#cb50-6"></a>feminizid_dfm_trimmed <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(feminizid_dfm, </span>
<span id="cb50-7"><a href="#cb50-7"></a>                                  <span class="at">min_docfreq =</span> <span class="fl">0.0003</span>,  <span class="co"># Min 0.03% (~11 docs at 35k)</span></span>
<span id="cb50-8"><a href="#cb50-8"></a>                                  <span class="at">max_docfreq =</span> <span class="fl">0.90</span>,    <span class="co"># Max 90% of documents</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>                                  <span class="at">docfreq_type =</span> <span class="st">"prop"</span>)  <span class="co"># Both as proportions</span></span>
<span id="cb50-10"><a href="#cb50-10"></a></span>
<span id="cb50-11"><a href="#cb50-11"></a>preprocessing_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb50-12"><a href="#cb50-12"></a>  <span class="at">documents =</span> <span class="fu">ndoc</span>(feminizid_dfm),</span>
<span id="cb50-13"><a href="#cb50-13"></a>  <span class="at">original_features =</span> <span class="fu">nfeat</span>(feminizid_dfm),</span>
<span id="cb50-14"><a href="#cb50-14"></a>  <span class="at">trimmed_features =</span> <span class="fu">nfeat</span>(feminizid_dfm_trimmed),</span>
<span id="cb50-15"><a href="#cb50-15"></a>  <span class="at">sparsity =</span> <span class="fu">round</span>(<span class="fu">sparsity</span>(feminizid_dfm_trimmed), <span class="dv">3</span>)</span>
<span id="cb50-16"><a href="#cb50-16"></a>)</span>
<span id="cb50-17"><a href="#cb50-17"></a>preprocessing_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["documents"],"name":[1],"type":["int"],"align":["right"]},{"label":["original_features"],"name":[2],"type":["int"],"align":["right"]},{"label":["trimmed_features"],"name":[3],"type":["int"],"align":["right"]},{"label":["sparsity"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"35776","2":"515236","3":"71177","4":"0.997"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Most frequent words</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-3"><a href="#cb51-3"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">25</span>)</span>
<span id="cb51-4"><a href="#cb51-4"></a>  top_features_df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb51-5"><a href="#cb51-5"></a>    <span class="at">term =</span> <span class="fu">names</span>(top_features),</span>
<span id="cb51-6"><a href="#cb51-6"></a>    <span class="at">frequency =</span> <span class="fu">as.numeric</span>(top_features)</span>
<span id="cb51-7"><a href="#cb51-7"></a>  )</span>
<span id="cb51-8"><a href="#cb51-8"></a>  top_features_df</span>
<span id="cb51-9"><a href="#cb51-9"></a>} <span class="cf">else</span> {</span>
<span id="cb51-10"><a href="#cb51-10"></a>  <span class="fu">message</span>(<span class="st">"WARN: No features after trimming - adjust parameters"</span>)</span>
<span id="cb51-11"><a href="#cb51-11"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["frequency"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"frau","2":"83622"},{"1":"kind","2":"51100"},{"1":"hauslich_gewalt","2":"40580"},{"1":"mann","2":"38561"},{"1":"gross","2":"37180"},{"1":"polizei","2":"36128"},{"1":"gewalt","2":"33921"},{"1":"mensch","2":"32198"},{"1":"opf","2":"31412"},{"1":"leb","2":"28886"},{"1":"kanton","2":"27691"},{"1":"lang","2":"27109"},{"1":"tag","2":"26331"},{"1":"tat","2":"25932"},{"1":"famili","2":"24921"},{"1":"alt","2":"24441"},{"1":"land","2":"24233"},{"1":"zeit","2":"24003"},{"1":"person","2":"23443"},{"1":"polit","2":"22465"},{"1":"fall","2":"21931"},{"1":"mutt","2":"21573"},{"1":"haus","2":"20818"},{"1":"film","2":"20134"},{"1":"zurich","2":"19681"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Checkpoint save (DFM and optional corpus)</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">save_checkpoint</span>(feminizid_dfm_trimmed, <span class="st">"feminizid_dfm"</span>)</span>
<span id="cb52-4"><a href="#cb52-4"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_dfm_20260127_101136.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_dfm_20260127_101136.qs2"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="cf">if</span> (SAVE_CORPUS) {</span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span>
<span id="cb55-3"><a href="#cb55-3"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># Use quanteda.textplots if available, otherwise fallback to wordcloud</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="cf">if</span> (<span class="st">"textplot_wordcloud"</span> <span class="sc">%in%</span> <span class="fu">ls</span>(<span class="st">"package:quanteda.textplots"</span>)) {</span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="fu">textplot_wordcloud</span>(feminizid_dfm_trimmed, </span>
<span id="cb56-4"><a href="#cb56-4"></a>                    <span class="at">min_count =</span> <span class="dv">30</span>,</span>
<span id="cb56-5"><a href="#cb56-5"></a>                    <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb56-6"><a href="#cb56-6"></a>                    <span class="at">color =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb56-7"><a href="#cb56-7"></a>} <span class="cf">else</span> {</span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="co"># Alternative mit wordcloud package</span></span>
<span id="cb56-9"><a href="#cb56-9"></a>  freq_data <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">100</span>)</span>
<span id="cb56-10"><a href="#cb56-10"></a>  <span class="fu">wordcloud</span>(<span class="fu">names</span>(freq_data), freq_data, </span>
<span id="cb56-11"><a href="#cb56-11"></a>           <span class="at">min.freq =</span> <span class="dv">30</span>, <span class="at">max.words =</span> <span class="dv">100</span>,</span>
<span id="cb56-12"><a href="#cb56-12"></a>           <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>),</span>
<span id="cb56-13"><a href="#cb56-13"></a>           <span class="at">random.order =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-14"><a href="#cb56-14"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Feature frequency over time (normalized)</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co"># Top 10 features by year</span></span>
<span id="cb57-3"><a href="#cb57-3"></a>top_terms <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">10</span>))</span>
<span id="cb57-4"><a href="#cb57-4"></a>  </span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co"># Frequency of these terms over years</span></span>
<span id="cb57-6"><a href="#cb57-6"></a>yearly_terms <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(feminizid_dfm_trimmed, <span class="at">groups =</span> <span class="fu">docvars</span>(feminizid_dfm_trimmed, <span class="st">"year"</span>))</span>
<span id="cb57-7"><a href="#cb57-7"></a></span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="co"># Articles per year for normalization</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>articles_per_year <span class="ot">&lt;-</span> feminizid_corpus <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="#cb57-10"></a>  <span class="fu">docvars</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="#cb57-11"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span>  <span class="co"># Convert year to numeric</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  <span class="fu">count</span>(year, <span class="at">name =</span> <span class="st">"total_articles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb57-14"><a href="#cb57-14"></a></span>
<span id="cb57-15"><a href="#cb57-15"></a><span class="co"># Correct conversion for quanteda 3.0+ - without doc_id column</span></span>
<span id="cb57-16"><a href="#cb57-16"></a>term_data <span class="ot">&lt;-</span> <span class="fu">convert</span>(yearly_terms[, top_terms], <span class="at">to =</span> <span class="st">"data.frame"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-17"><a href="#cb57-17"></a>  <span class="fu">select</span>(<span class="sc">-</span>doc_id) <span class="sc">%&gt;%</span>  <span class="co"># Remove doc_id column</span></span>
<span id="cb57-18"><a href="#cb57-18"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(yearly_terms)))</span>
<span id="cb57-19"><a href="#cb57-19"></a></span>
<span id="cb57-20"><a href="#cb57-20"></a><span class="co"># Absolute frequencies</span></span>
<span id="cb57-21"><a href="#cb57-21"></a>term_timeline_abs <span class="ot">&lt;-</span> term_data <span class="sc">%&gt;%</span></span>
<span id="cb57-22"><a href="#cb57-22"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"term"</span>, <span class="at">values_to =</span> <span class="st">"frequency"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-23"><a href="#cb57-23"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb57-24"><a href="#cb57-24"></a></span>
<span id="cb57-25"><a href="#cb57-25"></a><span class="co"># Normalized frequencies (per 1000 articles)</span></span>
<span id="cb57-26"><a href="#cb57-26"></a>term_timeline_norm <span class="ot">&lt;-</span> term_timeline_abs <span class="sc">%&gt;%</span></span>
<span id="cb57-27"><a href="#cb57-27"></a>  <span class="fu">left_join</span>(articles_per_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-28"><a href="#cb57-28"></a>  <span class="fu">mutate</span>(<span class="at">frequency_per_1000 =</span> (frequency <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-29"><a href="#cb57-29"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_articles), total_articles <span class="sc">&gt;</span> <span class="dv">10</span>)  <span class="co"># Only years with &gt;10 articles</span></span>
<span id="cb57-30"><a href="#cb57-30"></a></span>
<span id="cb57-31"><a href="#cb57-31"></a><span class="co"># Plot 1: Absolute frequencies</span></span>
<span id="cb57-32"><a href="#cb57-32"></a>p7a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_abs, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb57-33"><a href="#cb57-33"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-34"><a href="#cb57-34"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-35"><a href="#cb57-35"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (absolute)"</span>, </span>
<span id="cb57-36"><a href="#cb57-36"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Absolute frequency"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb57-37"><a href="#cb57-37"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb57-38"><a href="#cb57-38"></a></span>
<span id="cb57-39"><a href="#cb57-39"></a><span class="co"># Plot 2: Normalized frequencies (per 1000 articles)</span></span>
<span id="cb57-40"><a href="#cb57-40"></a>p7b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_norm, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency_per_1000, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb57-41"><a href="#cb57-41"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb57-42"><a href="#cb57-42"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-43"><a href="#cb57-43"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (normalized per 1000 articles)"</span>, </span>
<span id="cb57-44"><a href="#cb57-44"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency per 1000 articles"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb57-45"><a href="#cb57-45"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb57-46"><a href="#cb57-46"></a></span>
<span id="cb57-47"><a href="#cb57-47"></a><span class="co"># Plot 3: Article distribution over time (sanity check)</span></span>
<span id="cb57-48"><a href="#cb57-48"></a>p7c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(articles_per_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_articles)) <span class="sc">+</span></span>
<span id="cb57-49"><a href="#cb57-49"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb57-50"><a href="#cb57-50"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb57-51"><a href="#cb57-51"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb57-52"><a href="#cb57-52"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Article distribution over time"</span>, </span>
<span id="cb57-53"><a href="#cb57-53"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb57-54"><a href="#cb57-54"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)</span>
<span id="cb57-55"><a href="#cb57-55"></a></span>
<span id="cb57-56"><a href="#cb57-56"></a><span class="fu">print</span>(p7a)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">print</span>(p7b) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">print</span>(p7c)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/visualization-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># Normalization summary</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>summary_stats <span class="ot">&lt;-</span> articles_per_year <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb60-4"><a href="#cb60-4"></a>    <span class="at">min_articles =</span> <span class="fu">min</span>(total_articles),</span>
<span id="cb60-5"><a href="#cb60-5"></a>    <span class="at">max_articles =</span> <span class="fu">max</span>(total_articles),</span>
<span id="cb60-6"><a href="#cb60-6"></a>    <span class="at">mean_articles =</span> <span class="fu">round</span>(<span class="fu">mean</span>(total_articles)),</span>
<span id="cb60-7"><a href="#cb60-7"></a>    <span class="at">median_articles =</span> <span class="fu">median</span>(total_articles),</span>
<span id="cb60-8"><a href="#cb60-8"></a>    <span class="at">ratio_max_min =</span> <span class="fu">round</span>(<span class="fu">max</span>(total_articles) <span class="sc">/</span> <span class="fu">min</span>(total_articles), <span class="dv">1</span>)</span>
<span id="cb60-9"><a href="#cb60-9"></a>  )</span>
<span id="cb60-10"><a href="#cb60-10"></a>summary_stats</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["min_articles"],"name":[1],"type":["int"],"align":["right"]},{"label":["max_articles"],"name":[2],"type":["int"],"align":["right"]},{"label":["mean_articles"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["median_articles"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ratio_max_min"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"305","2":"3296","3":"1369","4":"917.5","5":"10.8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="cf">if</span> (summary_stats<span class="sc">$</span>ratio_max_min <span class="sc">&gt;</span> <span class="dv">5</span>) {</span>
<span id="cb61-2"><a href="#cb61-2"></a>  <span class="fu">message</span>(<span class="st">"WARN: Strong distortion detected - normalized view recommended"</span>)</span>
<span id="cb61-3"><a href="#cb61-3"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>WARN: Strong distortion detected - normalized view recommended</code></pre>
</div>
</div>
</section>
<section id="word2vec-frame-shift-diachronic" class="level2" data-number="0.9">
<h2 data-number="0.9" class="anchored" data-anchor-id="word2vec-frame-shift-diachronic"><span class="header-section-number">0.9</span> Word2Vec frame shift (diachronic)</h2>
<p>We train separate embeddings for five-year windows and compare nearest neighbors of key terms. This lets us observe shifts in semantic neighborhoods without implying causality.</p>
<p>Train one Word2Vec model per time window and compare nearest neighbors across periods. Use the checkpoint load block to resume without retraining.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Checkpoint load (Word2Vec)</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>No checkpoint found for: word2vec_vectors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_frame_shifts"</span>, <span class="st">"all_frame_shifts"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_frame_shifts_20260127_102706.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_frame_shifts_20260127_102706.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Time windows (5-year bins)</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>time_windows <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb69-3"><a href="#cb69-3"></a>  <span class="st">"2000-2004"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2004</span>),</span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="st">"2005-2009"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">2009</span>), </span>
<span id="cb69-5"><a href="#cb69-5"></a>  <span class="st">"2010-2014"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2014</span>),</span>
<span id="cb69-6"><a href="#cb69-6"></a>  <span class="st">"2015-2019"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2015</span>, <span class="dv">2019</span>),</span>
<span id="cb69-7"><a href="#cb69-7"></a>  <span class="st">"2020-2025"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2025</span>)</span>
<span id="cb69-8"><a href="#cb69-8"></a>)</span>
<span id="cb69-9"><a href="#cb69-9"></a></span>
<span id="cb69-10"><a href="#cb69-10"></a><span class="co"># Target terms for frame-shift analysis (interpretable terms)</span></span>
<span id="cb69-11"><a href="#cb69-11"></a>target_words <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb69-12"><a href="#cb69-12"></a>  <span class="st">"Frauenmord"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Familiendrama"</span>, <span class="st">"Misshandlung"</span>,</span>
<span id="cb69-13"><a href="#cb69-13"></a>  <span class="st">"Eifersucht"</span>, <span class="st">"Femizid"</span>, <span class="st">"Feminizid"</span>, <span class="st">"Familientragödie"</span>,</span>
<span id="cb69-14"><a href="#cb69-14"></a>  <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>, <span class="st">"häusliche Gewalt"</span>, <span class="st">"Opfer"</span>, <span class="st">"Täter"</span></span>
<span id="cb69-15"><a href="#cb69-15"></a>)</span>
<span id="cb69-16"><a href="#cb69-16"></a></span>
<span id="cb69-17"><a href="#cb69-17"></a>target_map <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-18"><a href="#cb69-18"></a>  <span class="at">original =</span> target_words,</span>
<span id="cb69-19"><a href="#cb69-19"></a>  <span class="at">normalized =</span> <span class="fu">normalize_terms_for_model</span>(target_words),</span>
<span id="cb69-20"><a href="#cb69-20"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb69-21"><a href="#cb69-21"></a>)</span>
<span id="cb69-22"><a href="#cb69-22"></a></span>
<span id="cb69-23"><a href="#cb69-23"></a>w2v_setup_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb69-24"><a href="#cb69-24"></a>  <span class="at">time_windows =</span> <span class="fu">length</span>(time_windows),</span>
<span id="cb69-25"><a href="#cb69-25"></a>  <span class="at">target_words =</span> <span class="fu">length</span>(target_words),</span>
<span id="cb69-26"><a href="#cb69-26"></a>  <span class="at">strategy =</span> <span class="st">"one model per window"</span>,</span>
<span id="cb69-27"><a href="#cb69-27"></a>  <span class="at">full_model =</span> <span class="cf">if</span> (TRAIN_FULL_MODEL) FULL_MODEL_LABEL <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb69-28"><a href="#cb69-28"></a>)</span>
<span id="cb69-29"><a href="#cb69-29"></a>w2v_setup_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["time_windows"],"name":[1],"type":["int"],"align":["right"]},{"label":["target_words"],"name":[2],"type":["int"],"align":["right"]},{"label":["strategy"],"name":[3],"type":["chr"],"align":["left"]},{"label":["full_model"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"5","2":"13","3":"one model per window","4":"all_2000-2025"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Train models for each window + optional full-period model</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>existing_vectors <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"word2vec_vectors"</span>)</span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_WORD2VEC_TRAINING) {</span>
<span id="cb70-4"><a href="#cb70-4"></a>  <span class="fu">message</span>(<span class="st">"Word2Vec training disabled (RUN_WORD2VEC_TRAINING = FALSE)."</span>)</span>
<span id="cb70-5"><a href="#cb70-5"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb70-6"><a href="#cb70-6"></a>    <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb70-7"><a href="#cb70-7"></a>  }</span>
<span id="cb70-8"><a href="#cb70-8"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>FORCE_WORD2VEC_TRAINING <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb70-9"><a href="#cb70-9"></a>  <span class="fu">message</span>(<span class="st">"Word2Vec vectors already exist; skipping training."</span>)</span>
<span id="cb70-10"><a href="#cb70-10"></a>  <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb70-11"><a href="#cb70-11"></a>} <span class="cf">else</span> {</span>
<span id="cb70-12"><a href="#cb70-12"></a>  word2vec_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb70-13"><a href="#cb70-13"></a></span>
<span id="cb70-14"><a href="#cb70-14"></a><span class="co"># Optional progress bar (per window)</span></span>
<span id="cb70-15"><a href="#cb70-15"></a>use_progress <span class="ot">&lt;-</span> <span class="fu">requireNamespace</span>(<span class="st">"progress"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-16"><a href="#cb70-16"></a><span class="cf">if</span> (<span class="sc">!</span>use_progress) {</span>
<span id="cb70-17"><a href="#cb70-17"></a>  <span class="fu">message</span>(<span class="st">"Tip: install.packages('progress') for a progress bar."</span>)</span>
<span id="cb70-18"><a href="#cb70-18"></a>}</span>
<span id="cb70-19"><a href="#cb70-19"></a></span>
<span id="cb70-20"><a href="#cb70-20"></a>build_w2v_text <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus_obj) {</span>
<span id="cb70-21"><a href="#cb70-21"></a>  tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_obj,</span>
<span id="cb70-22"><a href="#cb70-22"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-23"><a href="#cb70-23"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-24"><a href="#cb70-24"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-25"><a href="#cb70-25"></a>                        <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-26"><a href="#cb70-26"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-27"><a href="#cb70-27"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-28"><a href="#cb70-28"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb70-29"><a href="#cb70-29"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_obj, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb70-30"><a href="#cb70-30"></a>  }</span>
<span id="cb70-31"><a href="#cb70-31"></a>  <span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb70-32"><a href="#cb70-32"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(tokens_obj,</span>
<span id="cb70-33"><a href="#cb70-33"></a>                                  <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb70-34"><a href="#cb70-34"></a>                                  <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb70-35"><a href="#cb70-35"></a>  }</span>
<span id="cb70-36"><a href="#cb70-36"></a>  txt <span class="ot">&lt;-</span> <span class="fu">sapply</span>(tokens_obj, paste, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb70-37"><a href="#cb70-37"></a>  txt[<span class="fu">nchar</span>(txt) <span class="sc">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb70-38"><a href="#cb70-38"></a>}</span>
<span id="cb70-39"><a href="#cb70-39"></a></span>
<span id="cb70-40"><a href="#cb70-40"></a>train_w2v <span class="ot">&lt;-</span> <span class="cf">function</span>(label, corpus_obj) {</span>
<span id="cb70-41"><a href="#cb70-41"></a>  n_docs <span class="ot">&lt;-</span> <span class="fu">ndoc</span>(corpus_obj)</span>
<span id="cb70-42"><a href="#cb70-42"></a>  txt <span class="ot">&lt;-</span> <span class="fu">build_w2v_text</span>(corpus_obj)</span>
<span id="cb70-43"><a href="#cb70-43"></a>  <span class="cf">if</span> (n_docs <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">||</span> <span class="fu">length</span>(txt) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb70-44"><a href="#cb70-44"></a>    <span class="fu">message</span>(<span class="st">"WARN: Skip "</span>, label, <span class="st">" - too little data"</span>)</span>
<span id="cb70-45"><a href="#cb70-45"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb70-46"><a href="#cb70-46"></a>  }</span>
<span id="cb70-47"><a href="#cb70-47"></a>  <span class="fu">message</span>(<span class="st">"Training Word2Vec for "</span>, label, <span class="st">" ("</span>, n_docs, <span class="st">" docs, "</span>, <span class="fu">length</span>(txt), <span class="st">" texts)..."</span>)</span>
<span id="cb70-48"><a href="#cb70-48"></a>  w2v_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb70-49"><a href="#cb70-49"></a>    <span class="at">x =</span> txt,</span>
<span id="cb70-50"><a href="#cb70-50"></a>    <span class="at">type =</span> <span class="st">"skip-gram"</span>,</span>
<span id="cb70-51"><a href="#cb70-51"></a>    <span class="at">dim =</span> <span class="dv">100</span>,</span>
<span id="cb70-52"><a href="#cb70-52"></a>    <span class="at">iter =</span> <span class="dv">20</span>,</span>
<span id="cb70-53"><a href="#cb70-53"></a>    <span class="at">min_count =</span> <span class="dv">5</span>,</span>
<span id="cb70-54"><a href="#cb70-54"></a>    <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb70-55"><a href="#cb70-55"></a>    <span class="at">threads =</span> <span class="fu">max</span>(<span class="dv">1</span>, parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb70-56"><a href="#cb70-56"></a>  )</span>
<span id="cb70-57"><a href="#cb70-57"></a>  <span class="fu">do.call</span>(word2vec<span class="sc">::</span>word2vec, w2v_args)</span>
<span id="cb70-58"><a href="#cb70-58"></a>}</span>
<span id="cb70-59"><a href="#cb70-59"></a></span>
<span id="cb70-60"><a href="#cb70-60"></a>pb <span class="ot">&lt;-</span> <span class="cf">if</span> (use_progress) progress<span class="sc">::</span>progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb70-61"><a href="#cb70-61"></a>  <span class="at">format =</span> <span class="st">"Training :current/:total [:bar] :percent :eta"</span>,</span>
<span id="cb70-62"><a href="#cb70-62"></a>  <span class="at">total =</span> <span class="fu">length</span>(time_windows),</span>
<span id="cb70-63"><a href="#cb70-63"></a>  <span class="at">clear =</span> <span class="cn">FALSE</span>,</span>
<span id="cb70-64"><a href="#cb70-64"></a>  <span class="at">width =</span> <span class="dv">60</span></span>
<span id="cb70-65"><a href="#cb70-65"></a>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb70-66"><a href="#cb70-66"></a></span>
<span id="cb70-67"><a href="#cb70-67"></a>  <span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows)) {</span>
<span id="cb70-68"><a href="#cb70-68"></a>    <span class="cf">if</span> (use_progress) pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb70-69"><a href="#cb70-69"></a>    window_years <span class="ot">&lt;-</span> time_windows[[window_name]]</span>
<span id="cb70-70"><a href="#cb70-70"></a>    window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb70-71"><a href="#cb70-71"></a>      feminizid_corpus,</span>
<span id="cb70-72"><a href="#cb70-72"></a>      year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb70-73"><a href="#cb70-73"></a>    )</span>
<span id="cb70-74"><a href="#cb70-74"></a>    model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb70-75"><a href="#cb70-75"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(model)) <span class="cf">next</span></span>
<span id="cb70-76"><a href="#cb70-76"></a>    word2vec_models[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb70-77"><a href="#cb70-77"></a>  }</span>
<span id="cb70-78"><a href="#cb70-78"></a></span>
<span id="cb70-79"><a href="#cb70-79"></a>  <span class="cf">if</span> (TRAIN_FULL_MODEL) {</span>
<span id="cb70-80"><a href="#cb70-80"></a>    full_model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(FULL_MODEL_LABEL, feminizid_corpus)</span>
<span id="cb70-81"><a href="#cb70-81"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(full_model)) {</span>
<span id="cb70-82"><a href="#cb70-82"></a>      word2vec_models[[FULL_MODEL_LABEL]] <span class="ot">&lt;-</span> full_model</span>
<span id="cb70-83"><a href="#cb70-83"></a>    }</span>
<span id="cb70-84"><a href="#cb70-84"></a>  }</span>
<span id="cb70-85"><a href="#cb70-85"></a></span>
<span id="cb70-86"><a href="#cb70-86"></a>  <span class="fu">message</span>(<span class="st">"Training done. Models: "</span>, <span class="fu">length</span>(word2vec_models))</span>
<span id="cb70-87"><a href="#cb70-87"></a></span>
<span id="cb70-88"><a href="#cb70-88"></a>  word2vec_vectors <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_models, as.matrix)</span>
<span id="cb70-89"><a href="#cb70-89"></a>  <span class="fu">save_checkpoint</span>(word2vec_vectors, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb70-90"><a href="#cb70-90"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Word2Vec vectors already exist; skipping training.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_20260127_170544.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_20260127_170544.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb74-3"><a href="#cb74-3"></a>}</span>
<span id="cb74-4"><a href="#cb74-4"></a></span>
<span id="cb74-5"><a href="#cb74-5"></a>window_models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_vectors), <span class="fu">names</span>(time_windows))</span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="cf">if</span> (<span class="fu">length</span>(window_models) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb74-7"><a href="#cb74-7"></a>  </span>
<span id="cb74-8"><a href="#cb74-8"></a>  <span class="co"># Frame-shift analysis: what is near what?</span></span>
<span id="cb74-9"><a href="#cb74-9"></a>  frame_shift_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb74-10"><a href="#cb74-10"></a></span>
<span id="cb74-11"><a href="#cb74-11"></a>  normalize_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors) {</span>
<span id="cb74-12"><a href="#cb74-12"></a>    vectors <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(vectors)</span>
<span id="cb74-13"><a href="#cb74-13"></a>    norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb74-14"><a href="#cb74-14"></a>    norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb74-15"><a href="#cb74-15"></a>    vectors <span class="sc">/</span> norms</span>
<span id="cb74-16"><a href="#cb74-16"></a>  }</span>
<span id="cb74-17"><a href="#cb74-17"></a></span>
<span id="cb74-18"><a href="#cb74-18"></a>  vectors_norm_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_vectors[window_models], normalize_vectors)</span>
<span id="cb74-19"><a href="#cb74-19"></a>  </span>
<span id="cb74-20"><a href="#cb74-20"></a>  nearest_terms <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors_norm, term, <span class="at">top_n =</span> <span class="dv">10</span>) {</span>
<span id="cb74-21"><a href="#cb74-21"></a>    <span class="cf">if</span> (<span class="sc">!</span>term <span class="sc">%in%</span> <span class="fu">rownames</span>(vectors_norm)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb74-22"><a href="#cb74-22"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[term, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb74-23"><a href="#cb74-23"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb74-24"><a href="#cb74-24"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> term]</span>
<span id="cb74-25"><a href="#cb74-25"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb74-26"><a href="#cb74-26"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb74-27"><a href="#cb74-27"></a>      <span class="at">neighbor =</span> <span class="fu">names</span>(top),</span>
<span id="cb74-28"><a href="#cb74-28"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb74-29"><a href="#cb74-29"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb74-30"><a href="#cb74-30"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb74-31"><a href="#cb74-31"></a>    )</span>
<span id="cb74-32"><a href="#cb74-32"></a>  }</span>
<span id="cb74-33"><a href="#cb74-33"></a></span>
<span id="cb74-34"><a href="#cb74-34"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(target_map))) {</span>
<span id="cb74-35"><a href="#cb74-35"></a>    target_word <span class="ot">&lt;-</span> target_map<span class="sc">$</span>original[i]</span>
<span id="cb74-36"><a href="#cb74-36"></a>    target_norm <span class="ot">&lt;-</span> target_map<span class="sc">$</span>normalized[i]</span>
<span id="cb74-37"><a href="#cb74-37"></a>    </span>
<span id="cb74-38"><a href="#cb74-38"></a>    neighbors_over_time <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb74-39"><a href="#cb74-39"></a>    </span>
<span id="cb74-40"><a href="#cb74-40"></a>    <span class="cf">for</span> (window_name <span class="cf">in</span> window_models) {</span>
<span id="cb74-41"><a href="#cb74-41"></a>      vectors_norm <span class="ot">&lt;-</span> vectors_norm_list[[window_name]]</span>
<span id="cb74-42"><a href="#cb74-42"></a>      nn <span class="ot">&lt;-</span> <span class="fu">nearest_terms</span>(vectors_norm, target_norm, <span class="at">top_n =</span> <span class="dv">10</span>)</span>
<span id="cb74-43"><a href="#cb74-43"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nn) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(nn) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb74-44"><a href="#cb74-44"></a>        neighbors_df <span class="ot">&lt;-</span> nn <span class="sc">%&gt;%</span></span>
<span id="cb74-45"><a href="#cb74-45"></a>          <span class="fu">mutate</span>(<span class="at">period =</span> window_name, <span class="at">target =</span> target_word) <span class="sc">%&gt;%</span></span>
<span id="cb74-46"><a href="#cb74-46"></a>          <span class="fu">select</span>(period, target, neighbor, similarity, rank)</span>
<span id="cb74-47"><a href="#cb74-47"></a>        neighbors_over_time[[window_name]] <span class="ot">&lt;-</span> neighbors_df</span>
<span id="cb74-48"><a href="#cb74-48"></a>      }</span>
<span id="cb74-49"><a href="#cb74-49"></a>    }</span>
<span id="cb74-50"><a href="#cb74-50"></a>    </span>
<span id="cb74-51"><a href="#cb74-51"></a>    <span class="cf">if</span> (<span class="fu">length</span>(neighbors_over_time) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb74-52"><a href="#cb74-52"></a>      combined_neighbors <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, neighbors_over_time)</span>
<span id="cb74-53"><a href="#cb74-53"></a>      frame_shift_results[[target_word]] <span class="ot">&lt;-</span> combined_neighbors</span>
<span id="cb74-54"><a href="#cb74-54"></a>    }</span>
<span id="cb74-55"><a href="#cb74-55"></a>  }</span>
<span id="cb74-56"><a href="#cb74-56"></a>  </span>
<span id="cb74-57"><a href="#cb74-57"></a>  <span class="cf">if</span> (<span class="fu">length</span>(frame_shift_results) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb74-58"><a href="#cb74-58"></a>    all_frame_shifts <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, frame_shift_results)</span>
<span id="cb74-59"><a href="#cb74-59"></a>    <span class="fu">save_checkpoint</span>(all_frame_shifts, <span class="st">"word2vec_frame_shifts"</span>)</span>
<span id="cb74-60"><a href="#cb74-60"></a></span>
<span id="cb74-61"><a href="#cb74-61"></a>    frame_shift_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb74-62"><a href="#cb74-62"></a>      <span class="at">analyzed_terms =</span> <span class="fu">length</span>(frame_shift_results),</span>
<span id="cb74-63"><a href="#cb74-63"></a>      <span class="at">total_neighbor_relations =</span> <span class="fu">nrow</span>(all_frame_shifts)</span>
<span id="cb74-64"><a href="#cb74-64"></a>    )</span>
<span id="cb74-65"><a href="#cb74-65"></a>    frame_shift_summary</span>
<span id="cb74-66"><a href="#cb74-66"></a></span>
<span id="cb74-67"><a href="#cb74-67"></a>    top_neighbors_all <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb74-68"><a href="#cb74-68"></a>      <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-69"><a href="#cb74-69"></a>      <span class="fu">arrange</span>(target, period, rank)</span>
<span id="cb74-70"><a href="#cb74-70"></a>    top_neighbors_all</span>
<span id="cb74-71"><a href="#cb74-71"></a>  }</span>
<span id="cb74-72"><a href="#cb74-72"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: word2vec_frame_shifts_20260127_170724.qs2</code></pre>
</div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["period"],"name":[1],"type":["chr"],"align":["left"]},{"label":["target"],"name":[2],"type":["chr"],"align":["left"]},{"label":["neighbor"],"name":[3],"type":["chr"],"align":["left"]},{"label":["similarity"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rank"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"2000-2004","2":"ehefrau","3":"erschoss","4":"0.6454866","5":"1","_rn_":"ehefrau.2000-2004.1"},{"1":"2000-2004","2":"ehefrau","3":"belmont","4":"0.6385905","5":"2","_rn_":"ehefrau.2000-2004.2"},{"1":"2000-2004","2":"ehefrau","3":"familienvat","4":"0.6312576","5":"3","_rn_":"ehefrau.2000-2004.3"},{"1":"2005-2009","2":"ehefrau","3":"handfeuerwaff","4":"0.6886042","5":"1","_rn_":"ehefrau.2005-2009.1"},{"1":"2005-2009","2":"ehefrau","3":"dania","4":"0.6147034","5":"2","_rn_":"ehefrau.2005-2009.2"},{"1":"2005-2009","2":"ehefrau","3":"jahrig","4":"0.6036257","5":"3","_rn_":"ehefrau.2005-2009.3"},{"1":"2010-2014","2":"ehefrau","3":"peilz","4":"0.6534957","5":"1","_rn_":"ehefrau.2010-2014.1"},{"1":"2010-2014","2":"ehefrau","3":"barbetreib","4":"0.5994354","5":"2","_rn_":"ehefrau.2010-2014.2"},{"1":"2010-2014","2":"ehefrau","3":"verdunkelungsgefahr","4":"0.5901824","5":"3","_rn_":"ehefrau.2010-2014.3"},{"1":"2015-2019","2":"ehefrau","3":"dringlichkeit","4":"0.6356876","5":"1","_rn_":"ehefrau.2015-2019.1"},{"1":"2015-2019","2":"ehefrau","3":"knobelmit","4":"0.6119422","5":"2","_rn_":"ehefrau.2015-2019.2"},{"1":"2015-2019","2":"ehefrau","3":"berufsoffizi","4":"0.5895878","5":"3","_rn_":"ehefrau.2015-2019.3"},{"1":"2020-2025","2":"ehefrau","3":"chselenska","4":"0.7459409","5":"1","_rn_":"ehefrau.2020-2025.1"},{"1":"2020-2025","2":"ehefrau","3":"niedergestochen","4":"0.7319065","5":"2","_rn_":"ehefrau.2020-2025.2"},{"1":"2020-2025","2":"ehefrau","3":"warntal","4":"0.7229632","5":"3","_rn_":"ehefrau.2020-2025.3"},{"1":"2000-2004","2":"ehemann","3":"ehefrau","4":"0.6255415","5":"1","_rn_":"ehemann.2000-2004.1"},{"1":"2000-2004","2":"ehemann","3":"mathild","4":"0.5808506","5":"2","_rn_":"ehemann.2000-2004.2"},{"1":"2000-2004","2":"ehemann","3":"beverly","4":"0.5622937","5":"3","_rn_":"ehemann.2000-2004.3"},{"1":"2005-2009","2":"ehemann","3":"ehefrau","4":"0.5784344","5":"1","_rn_":"ehemann.2005-2009.1"},{"1":"2005-2009","2":"ehemann","3":"sonntagvormittag","4":"0.5776820","5":"2","_rn_":"ehemann.2005-2009.2"},{"1":"2005-2009","2":"ehemann","3":"spitalreif","4":"0.5577028","5":"3","_rn_":"ehemann.2005-2009.3"},{"1":"2010-2014","2":"ehemann","3":"entfliehen","4":"0.6295919","5":"1","_rn_":"ehemann.2010-2014.1"},{"1":"2010-2014","2":"ehemann","3":"erschlagen","4":"0.6200802","5":"2","_rn_":"ehemann.2010-2014.2"},{"1":"2010-2014","2":"ehemann","3":"durchlitt","4":"0.6055394","5":"3","_rn_":"ehemann.2010-2014.3"},{"1":"2015-2019","2":"ehemann","3":"tink","4":"0.6371862","5":"1","_rn_":"ehemann.2015-2019.1"},{"1":"2015-2019","2":"ehemann","3":"einmischen","4":"0.6183141","5":"2","_rn_":"ehemann.2015-2019.2"},{"1":"2015-2019","2":"ehemann","3":"verbrennen","4":"0.5797608","5":"3","_rn_":"ehemann.2015-2019.3"},{"1":"2020-2025","2":"ehemann","3":"kusterbei","4":"0.6627314","5":"1","_rn_":"ehemann.2020-2025.1"},{"1":"2020-2025","2":"ehemann","3":"vage","4":"0.6619693","5":"2","_rn_":"ehemann.2020-2025.2"},{"1":"2020-2025","2":"ehemann","3":"ehefrau","4":"0.6537983","5":"3","_rn_":"ehemann.2020-2025.3"},{"1":"2005-2009","2":"expartner","3":"partn","4":"0.7260914","5":"1","_rn_":"expartner.2005-2009.1"},{"1":"2005-2009","2":"expartner","3":"partner","4":"0.7064614","5":"2","_rn_":"expartner.2005-2009.2"},{"1":"2005-2009","2":"expartner","3":"eheahn","4":"0.6655882","5":"3","_rn_":"expartner.2005-2009.3"},{"1":"2015-2019","2":"expartner","3":"partn","4":"0.6561090","5":"1","_rn_":"expartner.2015-2019.1"},{"1":"2015-2019","2":"expartner","3":"200000weit","4":"0.6041154","5":"2","_rn_":"expartner.2015-2019.2"},{"1":"2015-2019","2":"expartner","3":"frankreichdi","4":"0.5899285","5":"3","_rn_":"expartner.2015-2019.3"},{"1":"2020-2025","2":"expartner","3":"rechercheprojekt","4":"0.6079364","5":"1","_rn_":"expartner.2020-2025.1"},{"1":"2020-2025","2":"expartner","3":"ausweisen","4":"0.6020403","5":"2","_rn_":"expartner.2020-2025.2"},{"1":"2020-2025","2":"expartner","3":"jahrin","4":"0.5976854","5":"3","_rn_":"expartner.2020-2025.3"},{"1":"2005-2009","2":"feminizid","3":"monárrez","4":"0.6515129","5":"1","_rn_":"feminizid.2005-2009.1"},{"1":"2005-2009","2":"feminizid","3":"frauenmord","4":"0.5665530","5":"2","_rn_":"feminizid.2005-2009.2"},{"1":"2005-2009","2":"feminizid","3":"juárez","4":"0.5478670","5":"3","_rn_":"feminizid.2005-2009.3"},{"1":"2015-2019","2":"feminizid","3":"internetprasenz","4":"0.6797323","5":"1","_rn_":"feminizid.2015-2019.1"},{"1":"2015-2019","2":"feminizid","3":"zumthema","4":"0.6691033","5":"2","_rn_":"feminizid.2015-2019.2"},{"1":"2015-2019","2":"feminizid","3":"anprangerten","4":"0.6613064","5":"3","_rn_":"feminizid.2015-2019.3"},{"1":"2020-2025","2":"feminizid","3":"femizid","4":"0.7058285","5":"1","_rn_":"feminizid.2020-2025.1"},{"1":"2020-2025","2":"feminizid","3":"frauenmord","4":"0.6559260","5":"2","_rn_":"feminizid.2020-2025.2"},{"1":"2020-2025","2":"feminizid","3":"areggerdroh","4":"0.6300194","5":"3","_rn_":"feminizid.2020-2025.3"},{"1":"2005-2009","2":"femizid","3":"monárrez","4":"0.6171613","5":"1","_rn_":"femizid.2005-2009.1"},{"1":"2005-2009","2":"femizid","3":"frau","4":"0.5694215","5":"2","_rn_":"femizid.2005-2009.2"},{"1":"2005-2009","2":"femizid","3":"politisier","4":"0.5492555","5":"3","_rn_":"femizid.2005-2009.3"},{"1":"2015-2019","2":"femizid","3":"demonstranten","4":"0.6669789","5":"1","_rn_":"femizid.2015-2019.1"},{"1":"2015-2019","2":"femizid","3":"verwedelnd","4":"0.6322381","5":"2","_rn_":"femizid.2015-2019.2"},{"1":"2015-2019","2":"femizid","3":"geschlechts","4":"0.6193269","5":"3","_rn_":"femizid.2015-2019.3"},{"1":"2020-2025","2":"femizid","3":"demrechercheprojekt","4":"0.7104081","5":"1","_rn_":"femizid.2020-2025.1"},{"1":"2020-2025","2":"femizid","3":"feminizid","4":"0.7058285","5":"2","_rn_":"femizid.2020-2025.2"},{"1":"2020-2025","2":"femizid","3":"jahrin","4":"0.6969968","5":"3","_rn_":"femizid.2020-2025.3"},{"1":"2000-2004","2":"frau","3":"mann","4":"0.7210877","5":"1","_rn_":"frau.2000-2004.1"},{"1":"2000-2004","2":"frau","3":"gewalt","4":"0.6877540","5":"2","_rn_":"frau.2000-2004.2"},{"1":"2000-2004","2":"frau","3":"zwangsprostitution","4":"0.6510316","5":"3","_rn_":"frau.2000-2004.3"},{"1":"2005-2009","2":"frau","3":"mann","4":"0.7727366","5":"1","_rn_":"frau.2005-2009.1"},{"1":"2005-2009","2":"frau","3":"menschenrechtsprobl","4":"0.6646720","5":"2","_rn_":"frau.2005-2009.2"},{"1":"2005-2009","2":"frau","3":"expartn","4":"0.6552948","5":"3","_rn_":"frau.2005-2009.3"},{"1":"2010-2014","2":"frau","3":"mann","4":"0.7512561","5":"1","_rn_":"frau.2010-2014.1"},{"1":"2010-2014","2":"frau","3":"gewalt","4":"0.6607702","5":"2","_rn_":"frau.2010-2014.2"},{"1":"2010-2014","2":"frau","3":"aurat","4":"0.6427095","5":"3","_rn_":"frau.2010-2014.3"},{"1":"2015-2019","2":"frau","3":"mann","4":"0.7576879","5":"1","_rn_":"frau.2015-2019.1"},{"1":"2015-2019","2":"frau","3":"gewalt","4":"0.6994220","5":"2","_rn_":"frau.2015-2019.2"},{"1":"2015-2019","2":"frau","3":"gegenuberstellen","4":"0.6896873","5":"3","_rn_":"frau.2015-2019.3"},{"1":"2020-2025","2":"frau","3":"menschenrechtsverletzung","4":"0.6985794","5":"1","_rn_":"frau.2020-2025.1"},{"1":"2020-2025","2":"frau","3":"mann","4":"0.6913341","5":"2","_rn_":"frau.2020-2025.2"},{"1":"2020-2025","2":"frau","3":"selbstverteidigung","4":"0.6883677","5":"3","_rn_":"frau.2020-2025.3"},{"1":"2000-2004","2":"frauenmord","3":"verhaftet","4":"0.5661054","5":"1","_rn_":"frauenmord.2000-2004.1"},{"1":"2000-2004","2":"frauenmord","3":"jamaican","4":"0.5386768","5":"2","_rn_":"frauenmord.2000-2004.2"},{"1":"2000-2004","2":"frauenmord","3":"mord","4":"0.5362444","5":"3","_rn_":"frauenmord.2000-2004.3"},{"1":"2005-2009","2":"frauenmord","3":"feminizid","4":"0.5665530","5":"1","_rn_":"frauenmord.2005-2009.1"},{"1":"2005-2009","2":"frauenmord","3":"guatemala","4":"0.5588067","5":"2","_rn_":"frauenmord.2005-2009.2"},{"1":"2005-2009","2":"frauenmord","3":"monárrez","4":"0.5234592","5":"3","_rn_":"frauenmord.2005-2009.3"},{"1":"2010-2014","2":"frauenmord","3":"drogenkrieg","4":"0.5299459","5":"1","_rn_":"frauenmord.2010-2014.1"},{"1":"2010-2014","2":"frauenmord","3":"angebroch","4":"0.5255030","5":"2","_rn_":"frauenmord.2010-2014.2"},{"1":"2010-2014","2":"frauenmord","3":"grenzstadt","4":"0.5090213","5":"3","_rn_":"frauenmord.2010-2014.3"},{"1":"2015-2019","2":"frauenmord","3":"demonstranten","4":"0.6254582","5":"1","_rn_":"frauenmord.2015-2019.1"},{"1":"2015-2019","2":"frauenmord","3":"geschlechtsselektion","4":"0.5758304","5":"2","_rn_":"frauenmord.2015-2019.2"},{"1":"2015-2019","2":"frauenmord","3":"menos","4":"0.5733145","5":"3","_rn_":"frauenmord.2015-2019.3"},{"1":"2020-2025","2":"frauenmord","3":"feminizid","4":"0.6559260","5":"1","_rn_":"frauenmord.2020-2025.1"},{"1":"2020-2025","2":"frauenmord","3":"behauptetein","4":"0.6316607","5":"2","_rn_":"frauenmord.2020-2025.2"},{"1":"2020-2025","2":"frauenmord","3":"offenbarten","4":"0.6277556","5":"3","_rn_":"frauenmord.2020-2025.3"},{"1":"2000-2004","2":"freund","3":"niederlenz","4":"0.5317360","5":"1","_rn_":"freund.2000-2004.1"},{"1":"2000-2004","2":"freund","3":"oli","4":"0.5295482","5":"2","_rn_":"freund.2000-2004.2"},{"1":"2000-2004","2":"freund","3":"peier","4":"0.5174355","5":"3","_rn_":"freund.2000-2004.3"},{"1":"2005-2009","2":"freund","3":"freundin","4":"0.6279853","5":"1","_rn_":"freund.2005-2009.1"},{"1":"2005-2009","2":"freund","3":"rebekah","4":"0.5578431","5":"2","_rn_":"freund.2005-2009.2"},{"1":"2005-2009","2":"freund","3":"gehangt","4":"0.5489575","5":"3","_rn_":"freund.2005-2009.3"},{"1":"2010-2014","2":"freund","3":"zuruckerobert","4":"0.6192658","5":"1","_rn_":"freund.2010-2014.1"},{"1":"2010-2014","2":"freund","3":"freundin","4":"0.6146232","5":"2","_rn_":"freund.2010-2014.2"},{"1":"2010-2014","2":"freund","3":"gjyl","4":"0.5774451","5":"3","_rn_":"freund.2010-2014.3"},{"1":"2015-2019","2":"freund","3":"olbaron","4":"0.6483286","5":"1","_rn_":"freund.2015-2019.1"},{"1":"2015-2019","2":"freund","3":"alarmieren","4":"0.6400690","5":"2","_rn_":"freund.2015-2019.2"},{"1":"2015-2019","2":"freund","3":"abschlussball","4":"0.6259653","5":"3","_rn_":"freund.2015-2019.3"},{"1":"2020-2025","2":"freund","3":"grussei","4":"0.8957051","5":"1","_rn_":"freund.2020-2025.1"},{"1":"2020-2025","2":"freund","3":"grussea","4":"0.8879427","5":"2","_rn_":"freund.2020-2025.2"},{"1":"2020-2025","2":"freund","3":"niethammerim","4":"0.6788388","5":"3","_rn_":"freund.2020-2025.3"},{"1":"2000-2004","2":"opf","3":"tat","4":"0.7441163","5":"1","_rn_":"opf.2000-2004.1"},{"1":"2000-2004","2":"opf","3":"anzeige","4":"0.7058954","5":"2","_rn_":"opf.2000-2004.2"},{"1":"2000-2004","2":"opf","3":"ungeahndet","4":"0.6662383","5":"3","_rn_":"opf.2000-2004.3"},{"1":"2005-2009","2":"opf","3":"tat","4":"0.7466150","5":"1","_rn_":"opf.2005-2009.1"},{"1":"2005-2009","2":"opf","3":"expartn","4":"0.6353163","5":"2","_rn_":"opf.2005-2009.2"},{"1":"2005-2009","2":"opf","3":"aufwi","4":"0.5890866","5":"3","_rn_":"opf.2005-2009.3"},{"1":"2010-2014","2":"opf","3":"tat","4":"0.7600318","5":"1","_rn_":"opf.2010-2014.1"},{"1":"2010-2014","2":"opf","3":"taterinn","4":"0.6674998","5":"2","_rn_":"opf.2010-2014.2"},{"1":"2010-2014","2":"opf","3":"beziehungspartner","4":"0.6416886","5":"3","_rn_":"opf.2010-2014.3"},{"1":"2015-2019","2":"opf","3":"tat","4":"0.6966273","5":"1","_rn_":"opf.2015-2019.1"},{"1":"2015-2019","2":"opf","3":"mitverantwortlich","4":"0.6502453","5":"2","_rn_":"opf.2015-2019.2"},{"1":"2015-2019","2":"opf","3":"ausgehen","4":"0.6491264","5":"3","_rn_":"opf.2015-2019.3"},{"1":"2020-2025","2":"opf","3":"tat","4":"0.7070986","5":"1","_rn_":"opf.2020-2025.1"},{"1":"2020-2025","2":"opf","3":"mannlichkeitsvorstellungen","4":"0.6626416","5":"2","_rn_":"opf.2020-2025.2"},{"1":"2020-2025","2":"opf","3":"schamenweit","4":"0.6603102","5":"3","_rn_":"opf.2020-2025.3"},{"1":"2000-2004","2":"partner","3":"physisch","4":"0.6199476","5":"1","_rn_":"partner.2000-2004.1"},{"1":"2000-2004","2":"partner","3":"gewalttat","4":"0.5996463","5":"2","_rn_":"partner.2000-2004.2"},{"1":"2000-2004","2":"partner","3":"erwachsenenleb","4":"0.5806503","5":"3","_rn_":"partner.2000-2004.3"},{"1":"2005-2009","2":"partner","3":"expartn","4":"0.7260914","5":"1","_rn_":"partner.2005-2009.1"},{"1":"2005-2009","2":"partner","3":"gewalttat","4":"0.6159741","5":"2","_rn_":"partner.2005-2009.2"},{"1":"2005-2009","2":"partner","3":"partnerinn","4":"0.5990382","5":"3","_rn_":"partner.2005-2009.3"},{"1":"2010-2014","2":"partner","3":"partner","4":"0.5916059","5":"1","_rn_":"partner.2010-2014.1"},{"1":"2010-2014","2":"partner","3":"beziehungspartn","4":"0.5615244","5":"2","_rn_":"partner.2010-2014.2"},{"1":"2010-2014","2":"partner","3":"partnerin","4":"0.5484840","5":"3","_rn_":"partner.2010-2014.3"},{"1":"2015-2019","2":"partner","3":"weberall","4":"0.6865293","5":"1","_rn_":"partner.2015-2019.1"},{"1":"2015-2019","2":"partner","3":"bircher","4":"0.6747556","5":"2","_rn_":"partner.2015-2019.2"},{"1":"2015-2019","2":"partner","3":"expartn","4":"0.6561090","5":"3","_rn_":"partner.2015-2019.3"},{"1":"2020-2025","2":"partner","3":"honored","4":"0.7625876","5":"1","_rn_":"partner.2020-2025.1"},{"1":"2020-2025","2":"partner","3":"selected","4":"0.7565417","5":"2","_rn_":"partner.2020-2025.2"},{"1":"2020-2025","2":"partner","3":"vétroz","4":"0.7062700","5":"3","_rn_":"partner.2020-2025.3"},{"1":"2000-2004","2":"partnerin","3":"partn","4":"0.5661396","5":"1","_rn_":"partnerin.2000-2004.1"},{"1":"2000-2004","2":"partnerin","3":"gleichberechtigt","4":"0.5069320","5":"2","_rn_":"partnerin.2000-2004.2"},{"1":"2000-2004","2":"partnerin","3":"standhalt","4":"0.4917599","5":"3","_rn_":"partnerin.2000-2004.3"},{"1":"2005-2009","2":"partnerin","3":"desinteressenerklar","4":"0.6608714","5":"1","_rn_":"partnerin.2005-2009.1"},{"1":"2005-2009","2":"partnerin","3":"rechtsvertreterin","4":"0.6539846","5":"2","_rn_":"partnerin.2005-2009.2"},{"1":"2005-2009","2":"partnerin","3":"desinteresseerklar","4":"0.6261296","5":"3","_rn_":"partnerin.2005-2009.3"},{"1":"2010-2014","2":"partnerin","3":"marlèn","4":"0.5493061","5":"1","_rn_":"partnerin.2010-2014.1"},{"1":"2010-2014","2":"partnerin","3":"partn","4":"0.5484840","5":"2","_rn_":"partnerin.2010-2014.2"},{"1":"2010-2014","2":"partnerin","3":"drohung","4":"0.4986867","5":"3","_rn_":"partnerin.2010-2014.3"},{"1":"2015-2019","2":"partnerin","3":"plagt","4":"0.5732838","5":"1","_rn_":"partnerin.2015-2019.1"},{"1":"2015-2019","2":"partnerin","3":"erstochen","4":"0.5718296","5":"2","_rn_":"partnerin.2015-2019.2"},{"1":"2015-2019","2":"partnerin","3":"partn","4":"0.5682029","5":"3","_rn_":"partnerin.2015-2019.3"},{"1":"2020-2025","2":"partnerin","3":"augenscheinlich","4":"0.6692318","5":"1","_rn_":"partnerin.2020-2025.1"},{"1":"2020-2025","2":"partnerin","3":"vétroz","4":"0.6488301","5":"2","_rn_":"partnerin.2020-2025.2"},{"1":"2020-2025","2":"partnerin","3":"partn","4":"0.6303742","5":"3","_rn_":"partnerin.2020-2025.3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Visualisierung 1: Heatmap der Frame-Shifts</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co"># Top neighbors across all time windows</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>top_shifts <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4"></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb76-6"><a href="#cb76-6"></a>  <span class="fu">summarise</span>(<span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity), </span>
<span id="cb76-7"><a href="#cb76-7"></a>            <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb76-8"><a href="#cb76-8"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-9"><a href="#cb76-9"></a>  <span class="fu">filter</span>(periods_present <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least in 2 time windows</span></span>
<span id="cb76-10"><a href="#cb76-10"></a>  <span class="fu">arrange</span>(target, <span class="sc">-</span>avg_similarity)</span>
<span id="cb76-11"><a href="#cb76-11"></a></span>
<span id="cb76-12"><a href="#cb76-12"></a><span class="co"># Heatmap for selected target terms</span></span>
<span id="cb76-13"><a href="#cb76-13"></a>selected_targets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hauslich_gewalt"</span>, <span class="st">"feminizid"</span>, <span class="st">"famili_drama"</span>)</span>
<span id="cb76-14"><a href="#cb76-14"></a>available_targets <span class="ot">&lt;-</span> <span class="fu">intersect</span>(selected_targets, <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target))</span>
<span id="cb76-15"><a href="#cb76-15"></a></span>
<span id="cb76-16"><a href="#cb76-16"></a><span class="cf">if</span> (<span class="fu">length</span>(available_targets) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb76-17"><a href="#cb76-17"></a>  heatmap_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb76-18"><a href="#cb76-18"></a>    <span class="fu">filter</span>(target <span class="sc">%in%</span> available_targets, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-19"><a href="#cb76-19"></a>    <span class="fu">select</span>(period, target, neighbor, similarity)</span>
<span id="cb76-20"><a href="#cb76-20"></a>  </span>
<span id="cb76-21"><a href="#cb76-21"></a>  p_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heatmap_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb76-22"><a href="#cb76-22"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb76-23"><a href="#cb76-23"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>target, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb76-24"><a href="#cb76-24"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Ähnlichkeit"</span>) <span class="sc">+</span></span>
<span id="cb76-25"><a href="#cb76-25"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-26"><a href="#cb76-26"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb76-27"><a href="#cb76-27"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb76-28"><a href="#cb76-28"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word2Vec frame shifts over time"</span>,</span>
<span id="cb76-29"><a href="#cb76-29"></a>       <span class="at">subtitle =</span> <span class="st">"Which words are close to the target terms?"</span>,</span>
<span id="cb76-30"><a href="#cb76-30"></a>       <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbor terms"</span>)</span>
<span id="cb76-31"><a href="#cb76-31"></a>  </span>
<span id="cb76-32"><a href="#cb76-32"></a>  <span class="fu">print</span>(p_heatmap)</span>
<span id="cb76-33"><a href="#cb76-33"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># Plot per target (top 5 neighbors per time window)</span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="cf">for</span> (term <span class="cf">in</span> <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target)) {</span>
<span id="cb77-3"><a href="#cb77-3"></a>  term_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4"></a>    <span class="fu">filter</span>(target <span class="sc">==</span> term, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-5"><a href="#cb77-5"></a>    <span class="fu">select</span>(period, neighbor, similarity)</span>
<span id="cb77-6"><a href="#cb77-6"></a></span>
<span id="cb77-7"><a href="#cb77-7"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(term_data) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb77-8"><a href="#cb77-8"></a></span>
<span id="cb77-9"><a href="#cb77-9"></a>  p_term <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb77-14"><a href="#cb77-14"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec frame shifts:"</span>, term),</span>
<span id="cb77-16"><a href="#cb77-16"></a>         <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbors"</span>)</span>
<span id="cb77-17"><a href="#cb77-17"></a></span>
<span id="cb77-18"><a href="#cb77-18"></a>  <span class="fu">print</span>(p_term)</span>
<span id="cb77-19"><a href="#cb77-19"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Notebook_files/figure-html/word2vec-visualization-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Visualization 2: stability vs. change</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>stability_analysis <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb78-5"><a href="#cb78-5"></a>    <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb78-6"><a href="#cb78-6"></a>    <span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb78-7"><a href="#cb78-7"></a>    <span class="at">similarity_sd =</span> <span class="fu">sd</span>(similarity),</span>
<span id="cb78-8"><a href="#cb78-8"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb78-9"><a href="#cb78-9"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="#cb78-10"></a>  <span class="fu">mutate</span>(</span>
<span id="cb78-11"><a href="#cb78-11"></a>      <span class="at">stability =</span> <span class="fu">case_when</span>(</span>
<span id="cb78-12"><a href="#cb78-12"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Stable"</span>,</span>
<span id="cb78-13"><a href="#cb78-13"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">"Moderately stable"</span>, </span>
<span id="cb78-14"><a href="#cb78-14"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Changing"</span></span>
<span id="cb78-15"><a href="#cb78-15"></a>      )</span>
<span id="cb78-16"><a href="#cb78-16"></a>  )</span>
<span id="cb78-17"><a href="#cb78-17"></a></span>
<span id="cb78-18"><a href="#cb78-18"></a>stability_summary <span class="ot">&lt;-</span> stability_analysis <span class="sc">%&gt;%</span></span>
<span id="cb78-19"><a href="#cb78-19"></a>  <span class="fu">count</span>(stability) <span class="sc">%&gt;%</span></span>
<span id="cb78-20"><a href="#cb78-20"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb78-21"><a href="#cb78-21"></a></span>
<span id="cb78-22"><a href="#cb78-22"></a>stability_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stability"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["percentage"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Changing","2":"436","3":"97.5"},{"1":"Moderately stable","2":"5","3":"1.1"},{"1":"Stable","2":"6","3":"1.3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="local-embedding-visualization" class="level2" data-number="0.10">
<h2 data-number="0.10" class="anchored" data-anchor-id="local-embedding-visualization"><span class="header-section-number">0.10</span> Local embedding visualization</h2>
<p>We reduce the 100-dimensional Word2Vec space to 3D with UMAP to inspect local semantic neighborhoods. UMAP builds a nearest-neighbor graph in the original space and optimizes a low-dimensional layout that preserves those local neighborhoods. The plotted axes are not interpretable dimensions; they are coordinates of a layout that preserves local structure.</p>
<p>Interpretation: - Points close in 3D usually appear in similar contexts in the corpus. - Tight clusters suggest a coherent framing or shared discourse context. - Isolated points can indicate rare usage or distinct framing.</p>
<p>Caveats: - Distances are mainly meaningful locally (nearest neighbors). - Global positions and axis directions should not be over-interpreted.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb79-2"><a href="#cb79-2"></a></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb79-4"><a href="#cb79-4"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb79-5"><a href="#cb79-5"></a>}</span>
<span id="cb79-6"><a href="#cb79-6"></a></span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="co"># Prefer full-period model if available, otherwise latest window</span></span>
<span id="cb79-8"><a href="#cb79-8"></a><span class="cf">if</span> (FULL_MODEL_LABEL <span class="sc">%in%</span> <span class="fu">names</span>(word2vec_vectors)) {</span>
<span id="cb79-9"><a href="#cb79-9"></a>  viz_window <span class="ot">&lt;-</span> FULL_MODEL_LABEL</span>
<span id="cb79-10"><a href="#cb79-10"></a>} <span class="cf">else</span> {</span>
<span id="cb79-11"><a href="#cb79-11"></a>  available_windows <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_vectors), <span class="fu">names</span>(time_windows))</span>
<span id="cb79-12"><a href="#cb79-12"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_windows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb79-13"><a href="#cb79-13"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(available_windows, <span class="dv">1</span>)</span>
<span id="cb79-14"><a href="#cb79-14"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-15"><a href="#cb79-15"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">names</span>(word2vec_vectors), <span class="dv">1</span>)</span>
<span id="cb79-16"><a href="#cb79-16"></a>  }</span>
<span id="cb79-17"><a href="#cb79-17"></a>}</span>
<span id="cb79-18"><a href="#cb79-18"></a><span class="fu">message</span>(<span class="st">"Using window: "</span>, viz_window)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Using window: all_2000-2025</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>vectors <span class="ot">&lt;-</span> word2vec_vectors[[viz_window]]</span>
<span id="cb81-2"><a href="#cb81-2"></a></span>
<span id="cb81-3"><a href="#cb81-3"></a>normalize_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors) {</span>
<span id="cb81-4"><a href="#cb81-4"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb81-5"><a href="#cb81-5"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>  vectors <span class="sc">/</span> norms</span>
<span id="cb81-7"><a href="#cb81-7"></a>}</span>
<span id="cb81-8"><a href="#cb81-8"></a></span>
<span id="cb81-9"><a href="#cb81-9"></a>vectors_norm <span class="ot">&lt;-</span> <span class="fu">normalize_vectors</span>(vectors)</span>
<span id="cb81-10"><a href="#cb81-10"></a>target_terms_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb81-11"><a href="#cb81-11"></a>in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(target_terms_model, <span class="fu">rownames</span>(vectors_norm))</span>
<span id="cb81-12"><a href="#cb81-12"></a><span class="cf">if</span> (<span class="fu">length</span>(in_vocab) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb81-13"><a href="#cb81-13"></a>  <span class="fu">message</span>(<span class="st">"No target words found in model vocabulary."</span>)</span>
<span id="cb81-14"><a href="#cb81-14"></a>} <span class="cf">else</span> {</span>
<span id="cb81-15"><a href="#cb81-15"></a>  neighbor_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(in_vocab, <span class="cf">function</span>(term) {</span>
<span id="cb81-16"><a href="#cb81-16"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[term, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb81-17"><a href="#cb81-17"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb81-18"><a href="#cb81-18"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> term]</span>
<span id="cb81-19"><a href="#cb81-19"></a>    nn <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb81-20"><a href="#cb81-20"></a>    <span class="fu">unique</span>(<span class="fu">c</span>(term, nn))</span>
<span id="cb81-21"><a href="#cb81-21"></a>  })</span>
<span id="cb81-22"><a href="#cb81-22"></a>  vocab <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(neighbor_list))</span>
<span id="cb81-23"><a href="#cb81-23"></a></span>
<span id="cb81-24"><a href="#cb81-24"></a>  vectors_sub <span class="ot">&lt;-</span> vectors[vocab, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb81-25"><a href="#cb81-25"></a>  umap_coords <span class="ot">&lt;-</span> umap<span class="sc">::</span><span class="fu">umap</span>(vectors_sub, <span class="at">n_components =</span> <span class="dv">3</span>)<span class="sc">$</span>layout</span>
<span id="cb81-26"><a href="#cb81-26"></a></span>
<span id="cb81-27"><a href="#cb81-27"></a>  embedding_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-28"><a href="#cb81-28"></a>    <span class="at">term =</span> vocab,</span>
<span id="cb81-29"><a href="#cb81-29"></a>    <span class="at">x =</span> umap_coords[, <span class="dv">1</span>],</span>
<span id="cb81-30"><a href="#cb81-30"></a>    <span class="at">y =</span> umap_coords[, <span class="dv">2</span>],</span>
<span id="cb81-31"><a href="#cb81-31"></a>    <span class="at">z =</span> umap_coords[, <span class="dv">3</span>],</span>
<span id="cb81-32"><a href="#cb81-32"></a>    <span class="at">type =</span> <span class="fu">ifelse</span>(vocab <span class="sc">%in%</span> in_vocab, <span class="st">"target"</span>, <span class="st">"neighbor"</span>),</span>
<span id="cb81-33"><a href="#cb81-33"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb81-34"><a href="#cb81-34"></a>  )</span>
<span id="cb81-35"><a href="#cb81-35"></a></span>
<span id="cb81-36"><a href="#cb81-36"></a>  p_umap <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(</span>
<span id="cb81-37"><a href="#cb81-37"></a>    embedding_df,</span>
<span id="cb81-38"><a href="#cb81-38"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z, <span class="at">color =</span> <span class="sc">~</span>type, <span class="at">text =</span> <span class="sc">~</span>term,</span>
<span id="cb81-39"><a href="#cb81-39"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb81-40"><a href="#cb81-40"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.85</span>)</span>
<span id="cb81-41"><a href="#cb81-41"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb81-42"><a href="#cb81-42"></a>    plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb81-43"><a href="#cb81-43"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec embeddings (UMAP 3D):"</span>, viz_window),</span>
<span id="cb81-44"><a href="#cb81-44"></a>      <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb81-45"><a href="#cb81-45"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 1"</span>),</span>
<span id="cb81-46"><a href="#cb81-46"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 2"</span>),</span>
<span id="cb81-47"><a href="#cb81-47"></a>        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 3"</span>)</span>
<span id="cb81-48"><a href="#cb81-48"></a>      )</span>
<span id="cb81-49"><a href="#cb81-49"></a>    )</span>
<span id="cb81-50"><a href="#cb81-50"></a>  p_umap</span>
<span id="cb81-51"><a href="#cb81-51"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-9eceb20dc2a931752ae4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9eceb20dc2a931752ae4">{"x":{"visdat":{"77e3f03da79":["function () ","plotlyVisDat"]},"cur_data":"77e3f03da79","attrs":{"77e3f03da79":{"x":{},"y":{},"z":{},"text":{},"mode":"markers","marker":{"size":7,"opacity":0.84999999999999998},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Word2Vec embeddings (UMAP 3D): all_2000-2025","scene":{"xaxis":{"title":"UMAP dim 1"},"yaxis":{"title":"UMAP dim 2"},"zaxis":{"title":"UMAP dim 3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-0.81721864522438281,-1.4376864549454815,-1.425023460304681,-1.538498882503986,-1.4262857540747707,-1.3643497878203705,-0.97116109441095499,-1.8744336486989077,-1.679611626913128,-2.1726862232014987,-1.6283625953513177,-1.5174043280710467,-2.0843817744489748,-1.5594798271505619,-1.8077207558005233,-2.0883040365391681,-2.3171457323793687,-2.2142636264731967,-1.8974903319985348,-2.0084745330809062,-2.2596936680396871,0.25326354376345517,0.46481164096541328,-0.053721308325465955,0.25230849765253538,-0.035133419192781901,0.70450076582043586,0.20844170197150991,-0.14561884226774424,0.42415083028337897,0.384351459904412,0.65344161536967782,0.47590390609043975,0.7841806143004213,0.066613217082402976,0.094566612117981563,0.62933864968500153,1.5578868779199375,1.2915896829382061,1.5839870274649548,1.447997789626652,1.4818236577699553,1.4367596272467105,1.6891499964081946,1.5036963853478982,1.6110290359652644,1.5851521403944475,-0.5818949185943989,0.099688215955945125,-0.49567225792119363,0.26024934142864442,-0.054879853997927164,0.42544014924588502,-0.34245936987682501,0.50397083810018994,0.64428085798041135,0.28030708659441039,0.87595336574687543,0.11303998098105605,0.53420367559098292,0.58924618082660096,0.51368100736264566,0.87219874345079784,0.21656551025817539,0.087030562983886561,-0.17023529950405258,0.070120453034894226,0.29618137043759862,0.25445670409616827,-0.13974029298210855,0.57037033660170078,0.4405557113127001,1.0131143676612107,1.1134799411953287,1.0681054942449704,1.5749190260957282,1.2061894597609863,-0.15797497700674601,0.63591133177077186,0.78710429251891911,0.26976883526637341,0.14507929833780686,0.69048205565560661,0.43560332108522726,0.76686071020473223,0.42240580975925823,0.35469756633741145],"y":[-1.0735130360905241,-1.5720747269557034,-1.4852710465312411,-1.3538956021019644,-0.7656939195831014,-0.7784244780421723,-0.96642515522660188,-0.78181510686251654,-1.9038571208726336,-1.434440531680766,-1.2308440137522005,-1.851379241078416,-1.3052413158548606,-1.1389517927382338,-1.8450756197649389,-1.3643497917570677,-1.6603973940956704,-1.8921851603225677,-1.7698628129520748,-0.76832295144568574,-1.0217656655764933,0.090987929589569916,0.036036295159048937,0.70660213990398502,0.83542090304431293,0.58290615774976717,0.72575446391781151,0.79013768759829173,0.82323233620861802,0.25656610426027981,0.30288862790427018,0.8212965141352655,0.20873742094833236,0.41187847683397272,0.69014589245293956,-0.48422958229273849,0.39481747935991107,2.0428920243026276,1.8440991211208759,1.7956507066705356,1.8048260404872496,1.7978796432838227,2.2385040685586781,1.7550601020537024,2.250716357192283,2.1809952827506995,1.9510467963247407,-0.44628701644891189,-0.021504085473796675,-0.29820719841702781,0.00051538859545052773,-0.26844255931177452,-0.23661176810536411,-0.0076123522902018514,-1.0146893369453363,-1.1586626414358374,-0.74057876594228667,-0.97775289736166027,-0.91783995166206545,-1.5195655186240011,-0.83906950353029819,-1.4479698464035939,-1.1230948286657627,0.28437995897012414,0.50999914614088171,0.50778829593750752,0.53128520372024246,0.9368724140729412,0.85014015277703825,0.90019048079792063,1.1581296002363737,0.605620193619403,0.97390695289559281,1.5160431253702573,1.4150659255277211,1.2284664770055929,1.210683453257108,0.96345601243521628,-0.18573707102121562,-0.048071029162044976,0.037372716351401269,-0.44852889203045354,0.046918903845859727,-0.10186710768329243,-0.37220110574616649,0.29097327691359531,-0.44325077771975918],"z":[1.5734023856471497,2.0591546553049858,1.9398600991217598,1.6540541856300501,1.9329437943192846,1.298404452104015,2.053793383272251,2.018603972695681,1.8300148168999619,1.9137922249538402,1.4642460870963843,2.2000200495357065,1.6240543834661481,2.2535480033508106,1.7350346428398564,1.691415734404998,2.073670514241881,1.6095175736042326,1.5117686103525931,1.8680579168849076,2.20592475235821,-1.5464511128358696,-1.7902345242780913,-1.6562094154551859,-2.3395672736132154,-2.2168564866279392,-1.5399951364160649,-0.95747072429794089,-2.2714682114593341,-2.1335310595093886,-0.70345838868265065,-1.0851231551569893,-0.71279892953662294,-0.65116676253401651,-0.61932850786247728,1.221258157578436,-0.58228306957797282,-1.959619909708697,-1.8472477168193888,-1.6016636656855541,-1.7704141107089535,-2.2247653532944991,-1.9554583156099441,-1.8965628567234956,-1.8400579162774633,-1.8105249221599904,-2.376594603922161,0.74104755704456005,0.19871434735865678,0.4561453248853955,0.25623573443097447,0.35413986179195311,0.61697722134980082,0.19008394802678286,1.3449639359523415,1.5077758193187007,1.6770656110686202,1.3914458801449461,1.5435760137414996,1.6071511805479972,1.8433551236254051,1.4087450231827312,1.7428444538919579,-2.8368616324350135,-2.9566330266742673,-2.7618084820555717,-2.6685303170040315,-2.9078216843253828,-2.9879740551749157,-2.544073395071293,-2.6655039019985303,-3.2503107086099394,-1.4885911461203571,-1.1804777221205616,-1.9265329578648314,-1.0287522274178684,-1.3697233291084792,-2.4769012486202557,1.7909877822427271,1.740155848153911,1.8773878852697969,2.0060469260868432,1.9724277935278722,2.123108855678467,1.2390270243995503,1.8941646279622766,2.0260967883020351],"text":["anprangerten","jahresbeginnwi","gewalt89","beratunggenau","zumthema","regierungszahl","femiziden","schiappas","demrechercheprojekt","rechercheprojekt","frauenmordezwar","monatenal","riedener23","bernsollt","totung","behauptetein","einereportag","offenbarten","mord","fehlanzeige","menos","kusterbei","vivenn","lebenspartn","schussen","kosovarischstamm","prozessgeg","vétroz","tatverdachtig","keystonemodel","honored","ex","selected","partnern","familienmitglied","94’000","ieht","grussei","grussea","freundin","niethammerim","intimus","mafiamilieu","mwanaweka","rechtsextremismusverharmlos","freundinn","fuhrungsgard","wurdenpro","konkubinatspartn","ausweisen","verwandtschaftsbezieh","200000weit","partnerschaft","lebenspartnerinn","mann","menschenrechtsverletzung","gewalt","karrierechancen","800’00","totgeschwiegenwallstrom","schweizfachstellefrauenberatungonlineberatungfur","vorangeschritt","gewaltopferdi","chselenska","warntal","manntotet","niedergestochen","driburg","umbrachte","atme","eingestochen","betitelte","augenscheinlich","umbringen","obstbergquartier","hilfewas","leidtu","lebenspartnerin","tat","abzugleichen","11’508","mannlichkeitsvorstellungen","habseligkeiten","erlebnisberichte","psychische","verfahrenspartei","schamenweit"],"mode":"markers","marker":{"color":"rgba(102,194,165,1)","size":7,"opacity":0.84999999999999998,"line":{"color":"rgba(102,194,165,1)"}},"type":"scatter3d","name":"neighbor","textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-1.4536371845621021,-1.8715672553965437,-2.1174018339194118,0.28828843566289386,0.38554049473909924,0.40216018101133155,0.99168688346844824,0.1192208675155646,1.7332417717630997,0.53164884288118763,0.5416192459638367],"y":[-1.024425990053162,-1.474006329016937,-1.4380156364828736,0.5328694677359862,0.58984912046246518,0.56409737831366091,1.1307380212815294,0.085535665063901867,2.0520586877594744,-1.1941942641818968,-0.065832051604973074],"z":[2.0466232149131551,2.1340671082491252,1.9769238424882192,-1.9676141934066504,-2.8526726925671859,-0.33661246546508905,-1.1368611134126967,0.14216617387422148,-1.9047694616737156,1.71007668843754,2.045809898269372],"text":["feminizid","femizid","frauenmord","ehemann","ehefrau","partn","partnerin","expartn","freund","frau","opf"],"mode":"markers","marker":{"color":"rgba(141,160,203,1)","size":7,"opacity":0.84999999999999998,"line":{"color":"rgba(141,160,203,1)"}},"type":"scatter3d","name":"target","textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="iterative-query-expansion" class="level2" data-number="0.11">
<h2 data-number="0.11" class="anchored" data-anchor-id="iterative-query-expansion"><span class="header-section-number">0.11</span> Iterative query expansion</h2>
<p>This section uses embedding neighborhoods to propose additional terms that might capture earlier or alternative framings. The candidates are heuristically filtered to reduce noise before being considered for a second-pass query.</p>
<p>We use the word2vec neighborhoods to suggest additional search terms that may reflect earlier or alternative framing. It provides a ranked candidate list for curation which can then be added to a subsequent API query in an iterative proggress.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># Split original keywords into action vs. relation/context (no new terms)</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb82-4"><a href="#cb82-4"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>,</span>
<span id="cb82-5"><a href="#cb82-5"></a>  <span class="st">"Gewalt gegen Frauen"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span>,</span>
<span id="cb82-6"><a href="#cb82-6"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>)</span>
<span id="cb82-8"><a href="#cb82-8"></a></span>
<span id="cb82-9"><a href="#cb82-9"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb82-10"><a href="#cb82-10"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span></span>
<span id="cb82-11"><a href="#cb82-11"></a>)</span>
<span id="cb82-12"><a href="#cb82-12"></a></span>
<span id="cb82-13"><a href="#cb82-13"></a><span class="co"># Seeds in the model vocabulary (normalized form)</span></span>
<span id="cb82-14"><a href="#cb82-14"></a>seed_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb82-15"><a href="#cb82-15"></a></span>
<span id="cb82-16"><a href="#cb82-16"></a>collect_neighbors_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb82-17"><a href="#cb82-17"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(vectors))</span>
<span id="cb82-18"><a href="#cb82-18"></a>  <span class="cf">if</span> (<span class="fu">length</span>(seeds_in_vocab) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb82-19"><a href="#cb82-19"></a></span>
<span id="cb82-20"><a href="#cb82-20"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb82-21"><a href="#cb82-21"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb82-22"><a href="#cb82-22"></a>  vectors_norm <span class="ot">&lt;-</span> vectors <span class="sc">/</span> norms</span>
<span id="cb82-23"><a href="#cb82-23"></a></span>
<span id="cb82-24"><a href="#cb82-24"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb82-25"><a href="#cb82-25"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[seed, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb82-26"><a href="#cb82-26"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb82-27"><a href="#cb82-27"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> seed]</span>
<span id="cb82-28"><a href="#cb82-28"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb82-29"><a href="#cb82-29"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb82-30"><a href="#cb82-30"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb82-31"><a href="#cb82-31"></a>      <span class="at">term =</span> <span class="fu">names</span>(top),</span>
<span id="cb82-32"><a href="#cb82-32"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb82-33"><a href="#cb82-33"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb82-34"><a href="#cb82-34"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb82-35"><a href="#cb82-35"></a>    )</span>
<span id="cb82-36"><a href="#cb82-36"></a>  })</span>
<span id="cb82-37"><a href="#cb82-37"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb82-38"><a href="#cb82-38"></a>}</span>
<span id="cb82-39"><a href="#cb82-39"></a></span>
<span id="cb82-40"><a href="#cb82-40"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb82-41"><a href="#cb82-41"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb82-42"><a href="#cb82-42"></a>}</span>
<span id="cb82-43"><a href="#cb82-43"></a></span>
<span id="cb82-44"><a href="#cb82-44"></a>neighbors_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_vectors), <span class="cf">function</span>(w) {</span>
<span id="cb82-45"><a href="#cb82-45"></a>  vectors <span class="ot">&lt;-</span> word2vec_vectors[[w]]</span>
<span id="cb82-46"><a href="#cb82-46"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors_vectors</span>(vectors, seed_terms, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb82-47"><a href="#cb82-47"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb82-48"><a href="#cb82-48"></a>  df</span>
<span id="cb82-49"><a href="#cb82-49"></a>}))</span>
<span id="cb82-50"><a href="#cb82-50"></a></span>
<span id="cb82-51"><a href="#cb82-51"></a>candidate_summary <span class="ot">&lt;-</span> neighbors_all <span class="sc">%&gt;%</span></span>
<span id="cb82-52"><a href="#cb82-52"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(term <span class="sc">%in%</span> seed_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb82-53"><a href="#cb82-53"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb82-54"><a href="#cb82-54"></a>  <span class="fu">summarise</span>(</span>
<span id="cb82-55"><a href="#cb82-55"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb82-56"><a href="#cb82-56"></a>    <span class="at">max_similarity =</span> <span class="fu">max</span>(similarity),</span>
<span id="cb82-57"><a href="#cb82-57"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb82-58"><a href="#cb82-58"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb82-59"><a href="#cb82-59"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb82-60"><a href="#cb82-60"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb82-61"><a href="#cb82-61"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity))</span>
<span id="cb82-62"><a href="#cb82-62"></a></span>
<span id="cb82-63"><a href="#cb82-63"></a><span class="co"># Heuristic: candidates that are close to multiple seeds and appear across windows</span></span>
<span id="cb82-64"><a href="#cb82-64"></a>suggested_terms <span class="ot">&lt;-</span> candidate_summary <span class="sc">%&gt;%</span></span>
<span id="cb82-65"><a href="#cb82-65"></a>  <span class="fu">filter</span>(mean_similarity <span class="sc">&gt;=</span> <span class="fl">0.35</span>, seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-66"><a href="#cb82-66"></a>  <span class="fu">pull</span>(term)</span>
<span id="cb82-67"><a href="#cb82-67"></a></span>
<span id="cb82-68"><a href="#cb82-68"></a><span class="co"># Basic cleanup: keep alpha tokens, remove very short / rare items</span></span>
<span id="cb82-69"><a href="#cb82-69"></a>term_freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(feminizid_dfm_trimmed, <span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-70"><a href="#cb82-70"></a>  <span class="fu">select</span>(feature, frequency)</span>
<span id="cb82-71"><a href="#cb82-71"></a></span>
<span id="cb82-72"><a href="#cb82-72"></a>suggested_terms_clean <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(suggested_terms)</span>
<span id="cb82-73"><a href="#cb82-73"></a>suggested_terms_clean <span class="ot">&lt;-</span> suggested_terms_clean[</span>
<span id="cb82-74"><a href="#cb82-74"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(suggested_terms_clean, <span class="st">"^[[:alpha:]_]+$"</span>)</span>
<span id="cb82-75"><a href="#cb82-75"></a>]</span>
<span id="cb82-76"><a href="#cb82-76"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">unique</span>(suggested_terms_clean)</span>
<span id="cb82-77"><a href="#cb82-77"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">Filter</span>(<span class="cf">function</span>(x) <span class="fu">nchar</span>(x) <span class="sc">&gt;=</span> <span class="dv">4</span>, suggested_terms_clean)</span>
<span id="cb82-78"><a href="#cb82-78"></a></span>
<span id="cb82-79"><a href="#cb82-79"></a>suggested_terms_clean <span class="ot">&lt;-</span> term_freq <span class="sc">%&gt;%</span></span>
<span id="cb82-80"><a href="#cb82-80"></a>  <span class="fu">filter</span>(feature <span class="sc">%in%</span> suggested_terms_clean, frequency <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-81"><a href="#cb82-81"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frequency)) <span class="sc">%&gt;%</span></span>
<span id="cb82-82"><a href="#cb82-82"></a>  <span class="fu">pull</span>(feature)</span>
<span id="cb82-83"><a href="#cb82-83"></a></span>
<span id="cb82-84"><a href="#cb82-84"></a><span class="co"># Map stems back to likely surface forms (approximation)</span></span>
<span id="cb82-85"><a href="#cb82-85"></a>MAP_DOCS_LIMIT <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb82-86"><a href="#cb82-86"></a>corpus_for_map <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">ndoc</span>(feminizid_corpus) <span class="sc">&gt;</span> MAP_DOCS_LIMIT) {</span>
<span id="cb82-87"><a href="#cb82-87"></a>  <span class="fu">corpus_sample</span>(feminizid_corpus, <span class="at">size =</span> MAP_DOCS_LIMIT)</span>
<span id="cb82-88"><a href="#cb82-88"></a>} <span class="cf">else</span> {</span>
<span id="cb82-89"><a href="#cb82-89"></a>  feminizid_corpus</span>
<span id="cb82-90"><a href="#cb82-90"></a>}</span>
<span id="cb82-91"><a href="#cb82-91"></a></span>
<span id="cb82-92"><a href="#cb82-92"></a>tokens_raw <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_for_map,</span>
<span id="cb82-93"><a href="#cb82-93"></a>                     <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-94"><a href="#cb82-94"></a>                     <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-95"><a href="#cb82-95"></a>                     <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb82-96"><a href="#cb82-96"></a>                     <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-97"><a href="#cb82-97"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-98"><a href="#cb82-98"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-99"><a href="#cb82-99"></a></span>
<span id="cb82-100"><a href="#cb82-100"></a>tokens_stem <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_raw, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb82-101"><a href="#cb82-101"></a></span>
<span id="cb82-102"><a href="#cb82-102"></a>stem_map <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-103"><a href="#cb82-103"></a>  <span class="at">stem =</span> <span class="fu">unlist</span>(tokens_stem),</span>
<span id="cb82-104"><a href="#cb82-104"></a>  <span class="at">form =</span> <span class="fu">unlist</span>(tokens_raw)</span>
<span id="cb82-105"><a href="#cb82-105"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb82-106"><a href="#cb82-106"></a>  <span class="fu">count</span>(stem, form, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-107"><a href="#cb82-107"></a></span>
<span id="cb82-108"><a href="#cb82-108"></a>suggested_terms_surface <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stem =</span> suggested_terms_clean) <span class="sc">%&gt;%</span></span>
<span id="cb82-109"><a href="#cb82-109"></a>  <span class="fu">left_join</span>(</span>
<span id="cb82-110"><a href="#cb82-110"></a>    stem_map <span class="sc">%&gt;%</span></span>
<span id="cb82-111"><a href="#cb82-111"></a>      <span class="fu">group_by</span>(stem) <span class="sc">%&gt;%</span></span>
<span id="cb82-112"><a href="#cb82-112"></a>      <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-113"><a href="#cb82-113"></a>      <span class="fu">summarise</span>(<span class="at">forms =</span> <span class="fu">paste</span>(form, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>),</span>
<span id="cb82-114"><a href="#cb82-114"></a>    <span class="at">by =</span> <span class="st">"stem"</span></span>
<span id="cb82-115"><a href="#cb82-115"></a>  )</span>
<span id="cb82-116"><a href="#cb82-116"></a></span>
<span id="cb82-117"><a href="#cb82-117"></a>available_dicts <span class="ot">&lt;-</span> hunspell<span class="sc">::</span><span class="fu">list_dictionaries</span>()</span>
<span id="cb82-118"><a href="#cb82-118"></a>dict_id <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"de_DE_frami"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb82-119"><a href="#cb82-119"></a>  <span class="st">"de_DE_frami"</span></span>
<span id="cb82-120"><a href="#cb82-120"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"de_DE"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb82-121"><a href="#cb82-121"></a>  <span class="st">"de_DE"</span></span>
<span id="cb82-122"><a href="#cb82-122"></a>} <span class="cf">else</span> {</span>
<span id="cb82-123"><a href="#cb82-123"></a>  <span class="cn">NA_character_</span></span>
<span id="cb82-124"><a href="#cb82-124"></a>}</span>
<span id="cb82-125"><a href="#cb82-125"></a></span>
<span id="cb82-126"><a href="#cb82-126"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb82-127"><a href="#cb82-127"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-128"><a href="#cb82-128"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">word</span>(forms, <span class="dv">1</span>, <span class="at">sep =</span> <span class="st">", "</span>),</span>
<span id="cb82-129"><a href="#cb82-129"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(primary_form, <span class="st">"_"</span>, <span class="st">" "</span>),</span>
<span id="cb82-130"><a href="#cb82-130"></a>    <span class="at">dict_ok =</span> <span class="cf">if</span> (<span class="fu">is.na</span>(dict_id)) <span class="cn">TRUE</span> <span class="cf">else</span> hunspell<span class="sc">::</span><span class="fu">hunspell_check</span>(primary_form, <span class="at">dict =</span> dict_id)</span>
<span id="cb82-131"><a href="#cb82-131"></a>  )</span>
<span id="cb82-132"><a href="#cb82-132"></a></span>
<span id="cb82-133"><a href="#cb82-133"></a><span class="co"># Co-occurrence filter: candidate should appear with relation terms</span></span>
<span id="cb82-134"><a href="#cb82-134"></a>relation_terms_model <span class="ot">&lt;-</span> <span class="fu">normalize_terms_for_model</span>(relation_terms)</span>
<span id="cb82-135"><a href="#cb82-135"></a>dfm_model <span class="ot">&lt;-</span> feminizid_dfm_trimmed</span>
<span id="cb82-136"><a href="#cb82-136"></a>relation_in_docs <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(</span>
<span id="cb82-137"><a href="#cb82-137"></a>  <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> relation_terms_model)</span>
<span id="cb82-138"><a href="#cb82-138"></a>)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb82-139"><a href="#cb82-139"></a></span>
<span id="cb82-140"><a href="#cb82-140"></a>cand_dfm <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> suggested_terms_clean)</span>
<span id="cb82-141"><a href="#cb82-141"></a>cand_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cand_dfm) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb82-142"><a href="#cb82-142"></a>cand_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat)</span>
<span id="cb82-143"><a href="#cb82-143"></a>cooccur_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat[relation_in_docs, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb82-144"><a href="#cb82-144"></a>cooccur_ratio <span class="ot">&lt;-</span> cooccur_docs <span class="sc">/</span> <span class="fu">pmax</span>(cand_docs, <span class="dv">1</span>)</span>
<span id="cb82-145"><a href="#cb82-145"></a></span>
<span id="cb82-146"><a href="#cb82-146"></a>candidate_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-147"><a href="#cb82-147"></a>  <span class="at">stem =</span> <span class="fu">colnames</span>(cand_mat),</span>
<span id="cb82-148"><a href="#cb82-148"></a>  <span class="at">cand_docs =</span> cand_docs,</span>
<span id="cb82-149"><a href="#cb82-149"></a>  <span class="at">cooccur_docs =</span> cooccur_docs,</span>
<span id="cb82-150"><a href="#cb82-150"></a>  <span class="at">cooccur_ratio =</span> cooccur_ratio</span>
<span id="cb82-151"><a href="#cb82-151"></a>)</span>
<span id="cb82-152"><a href="#cb82-152"></a></span>
<span id="cb82-153"><a href="#cb82-153"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb82-154"><a href="#cb82-154"></a>  <span class="fu">left_join</span>(candidate_scores, <span class="at">by =</span> <span class="st">"stem"</span>)</span>
<span id="cb82-155"><a href="#cb82-155"></a></span>
<span id="cb82-156"><a href="#cb82-156"></a><span class="co"># Heuristic cleanup for glued function words / artifacts</span></span>
<span id="cb82-157"><a href="#cb82-157"></a>JUNK_SUFFIXES <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zwar"</span>, <span class="st">"pro"</span>, <span class="st">"und"</span>, <span class="st">"oder"</span>, <span class="st">"aber"</span>, <span class="st">"doch"</span>, <span class="st">"weil"</span>, <span class="st">"dass"</span>, <span class="st">"nicht"</span>)</span>
<span id="cb82-158"><a href="#cb82-158"></a>junk_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">paste</span>(JUNK_SUFFIXES, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")$"</span>)</span>
<span id="cb82-159"><a href="#cb82-159"></a></span>
<span id="cb82-160"><a href="#cb82-160"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb82-161"><a href="#cb82-161"></a>  <span class="fu">mutate</span>(<span class="at">junk_suffix =</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(primary_form, junk_regex))</span>
<span id="cb82-162"><a href="#cb82-162"></a></span>
<span id="cb82-163"><a href="#cb82-163"></a>suggested_terms_final <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb82-164"><a href="#cb82-164"></a>  <span class="fu">filter</span>(</span>
<span id="cb82-165"><a href="#cb82-165"></a>    dict_ok,</span>
<span id="cb82-166"><a href="#cb82-166"></a>    <span class="fu">nchar</span>(primary_form) <span class="sc">&gt;=</span> <span class="dv">4</span>,</span>
<span id="cb82-167"><a href="#cb82-167"></a>    <span class="sc">!</span>junk_suffix,</span>
<span id="cb82-168"><a href="#cb82-168"></a>    cooccur_docs <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb82-169"><a href="#cb82-169"></a>    cooccur_ratio <span class="sc">&gt;=</span> <span class="fl">0.2</span></span>
<span id="cb82-170"><a href="#cb82-170"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb82-171"><a href="#cb82-171"></a>  <span class="fu">distinct</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb82-172"><a href="#cb82-172"></a>  <span class="fu">arrange</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb82-173"><a href="#cb82-173"></a>  <span class="fu">pull</span>(primary_form)</span>
<span id="cb82-174"><a href="#cb82-174"></a></span>
<span id="cb82-175"><a href="#cb82-175"></a>suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb82-176"><a href="#cb82-176"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(primary_form)) <span class="sc">%&gt;%</span></span>
<span id="cb82-177"><a href="#cb82-177"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stem"],"name":[1],"type":["chr"],"align":["left"]},{"label":["forms"],"name":[2],"type":["chr"],"align":["left"]},{"label":["primary_form"],"name":[3],"type":["chr"],"align":["left"]},{"label":["dict_ok"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["cand_docs"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["cooccur_docs"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["cooccur_ratio"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["junk_suffix"],"name":[8],"type":["lgl"],"align":["right"]}],"data":[{"1":"wurdenpro","2":"wurdenpro","3":"wurdenpro","4":"TRUE","5":"18","6":"0","7":"0.00000000","8":"TRUE"},{"1":"umgebracht","2":"umgebracht, umgebrachten","3":"umgebracht","4":"TRUE","5":"1437","6":"431","7":"0.29993041","8":"FALSE"},{"1":"totet","2":"tötete, tötet, töteten","3":"tötete","4":"TRUE","5":"1686","6":"658","7":"0.39027284","8":"FALSE"},{"1":"trennung","2":"trennung, trennungen, trennungs","3":"trennung","4":"TRUE","5":"2106","6":"426","7":"0.20227920","8":"FALSE"},{"1":"sylk","2":"sylke","3":"sylke","4":"TRUE","5":"21","6":"2","7":"0.09523810","8":"FALSE"},{"1":"strafanzeig","2":"strafanzeige, strafanzeigen","3":"strafanzeige","4":"TRUE","5":"616","6":"65","7":"0.10551948","8":"FALSE"},{"1":"spitalpfleg","2":"spitalpflege","3":"spitalpflege","4":"TRUE","5":"43","6":"26","7":"0.60465116","8":"FALSE"},{"1":"sexuell","2":"sexuelle, sexueller, sexuellen","3":"sexuelle","4":"TRUE","5":"5213","6":"398","7":"0.07634759","8":"FALSE"},{"1":"schwagerin","2":"schwägerin","3":"schwägerin","4":"TRUE","5":"112","6":"81","7":"0.72321429","8":"FALSE"},{"1":"schwiegervat","2":"schwiegervater, schwiegervaters, schwiegerväter","3":"schwiegervater","4":"TRUE","5":"138","6":"68","7":"0.49275362","8":"FALSE"},{"1":"rechercheprojekt","2":"rechercheprojekt, rechercheprojekts","3":"rechercheprojekt","4":"TRUE","5":"168","6":"6","7":"0.03571429","8":"FALSE"},{"1":"psychisch","2":"psychische, psychischen, psychisch","3":"psychische","4":"TRUE","5":"3581","6":"568","7":"0.15861491","8":"FALSE"},{"1":"physisch","2":"physische, physisch, physischer","3":"physische","4":"TRUE","5":"1856","6":"218","7":"0.11745690","8":"FALSE"},{"1":"partnerschaft","2":"partnerschaft, partnerschaften, partnerschaftlichen","3":"partnerschaft","4":"TRUE","5":"1821","6":"160","7":"0.08786381","8":"FALSE"},{"1":"partnerinn","2":"partnerinnen","3":"partnerinnen","4":"TRUE","5":"499","6":"54","7":"0.10821643","8":"FALSE"},{"1":"paarbezieh","2":"paarbeziehungen, paarbeziehung","3":"paarbeziehungen","4":"TRUE","5":"391","6":"8","7":"0.02046036","8":"FALSE"},{"1":"niedergestoch","2":"niedergestochen","3":"niedergestochen","4":"TRUE","5":"118","6":"30","7":"0.25423729","8":"FALSE"},{"1":"nationalfondsstudi","2":"nationalfondsstudie","3":"nationalfondsstudie","4":"TRUE","5":"26","6":"1","7":"0.03846154","8":"FALSE"},{"1":"mann","2":"männer, männern, mannes","3":"männer","4":"TRUE","5":"12315","6":"1982","7":"0.16094194","8":"FALSE"},{"1":"mordopf","2":"mordopfer, mordopfern, mordopfers","3":"mordopfer","4":"TRUE","5":"81","6":"18","7":"0.22222222","8":"FALSE"},{"1":"menos","2":"menos","3":"menos","4":"TRUE","5":"196","6":"5","7":"0.02551020","8":"FALSE"},{"1":"lebenspartnerin","2":"lebenspartnerin","3":"lebenspartnerin","4":"TRUE","5":"194","6":"66","7":"0.34020619","8":"FALSE"},{"1":"lebensgefahrt","2":"lebensgefährten, lebensgefährte","3":"lebensgefährten","4":"TRUE","5":"360","6":"75","7":"0.20833333","8":"FALSE"},{"1":"kopfschuss","2":"kopfschuss, kopfschüssen, kopfschüsse","3":"kopfschuss","4":"TRUE","5":"73","6":"47","7":"0.64383562","8":"FALSE"},{"1":"kontrollverlust","2":"kontrollverlust, kontrollverlusts","3":"kontrollverlust","4":"TRUE","5":"154","6":"31","7":"0.20129870","8":"FALSE"},{"1":"kindereh","2":"kinderehen, kinderehe","3":"kinderehen","4":"TRUE","5":"128","6":"6","7":"0.04687500","8":"FALSE"},{"1":"jahrig","2":"jähriger","3":"jähriger","4":"TRUE","5":"13","6":"11","7":"0.84615385","8":"FALSE"},{"1":"juárez","2":"juárez","3":"juárez","4":"TRUE","5":"78","6":"3","7":"0.03846154","8":"FALSE"},{"1":"jahresbeginnwi","2":"jahresbeginnwie","3":"jahresbeginnwie","4":"TRUE","5":"18","6":"18","7":"1.00000000","8":"FALSE"},{"1":"guatemala","2":"guatemala","3":"guatemala","4":"TRUE","5":"84","6":"20","7":"0.23809524","8":"FALSE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>suggested_terms_final</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "civica"          "ehepartner"      "eifersucht"      "ermordet"       
 [5] "femicide"        "freundin"        "guatemala"       "jahresbeginnwie"
 [9] "jähriger"        "kontrollverlust" "kopfschuss"      "lebensgefährten"
[13] "lebenspartnerin" "mordopfer"       "niedergestochen" "schwiegervater" 
[17] "schwägerin"      "spitalpflege"    "trennung"        "tötete"         
[21] "umgebracht"     </code></pre>
</div>
</div>
</section>
<section id="second-pass-api-query-manual-curation" class="level2" data-number="0.12">
<h2 data-number="0.12" class="anchored" data-anchor-id="second-pass-api-query-manual-curation"><span class="header-section-number">0.12</span> Second-pass API query (manual curation)</h2>
<p>The second pass narrows the query by combining action terms with relation/context terms. This reduces false positives while still capturing relevant framing variants. We treat this pass as a curated subset rather than a full census.</p>
<p>We run a stricter AND query to keep results manageable. The original keywords are split into two groups (action vs.&nbsp;relation) and combined with curated extra terms. Wildcards are included for single-word terms.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># Wildcards only for single-word terms from the original list</span></span>
<span id="cb85-2"><a href="#cb85-2"></a>add_wildcards_single <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb85-3"><a href="#cb85-3"></a>  single <span class="ot">&lt;-</span> terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)]</span>
<span id="cb85-4"><a href="#cb85-4"></a>  <span class="fu">paste0</span>(single, <span class="st">"*"</span>)</span>
<span id="cb85-5"><a href="#cb85-5"></a>}</span>
<span id="cb85-6"><a href="#cb85-6"></a></span>
<span id="cb85-7"><a href="#cb85-7"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, <span class="fu">add_wildcards_single</span>(action_terms)))</span>
<span id="cb85-8"><a href="#cb85-8"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, <span class="fu">add_wildcards_single</span>(relation_terms)))</span>
<span id="cb85-9"><a href="#cb85-9"></a></span>
<span id="cb85-10"><a href="#cb85-10"></a><span class="co"># Manual split from suggested_terms_final</span></span>
<span id="cb85-11"><a href="#cb85-11"></a>SECOND_PASS_EXCLUDE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gewalt"</span>)</span>
<span id="cb85-12"><a href="#cb85-12"></a></span>
<span id="cb85-13"><a href="#cb85-13"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb85-14"><a href="#cb85-14"></a>  <span class="st">"ermordet"</span>, <span class="st">"erschossen"</span>, <span class="st">"erstochen"</span>, <span class="st">"getötet"</span>,</span>
<span id="cb85-15"><a href="#cb85-15"></a>  <span class="st">"tötung"</span>, <span class="st">"tötungsversuch"</span>, <span class="st">"frauentötungen"</span>,</span>
<span id="cb85-16"><a href="#cb85-16"></a>  <span class="st">"stranguliert"</span>, <span class="st">"kopfschuss"</span>, <span class="st">"küchenmesser"</span>,</span>
<span id="cb85-17"><a href="#cb85-17"></a>  <span class="st">"mordopfer"</span>, <span class="st">"umgebracht"</span>, <span class="st">"tötete"</span>, <span class="st">"totschlag"</span>,</span>
<span id="cb85-18"><a href="#cb85-18"></a>  <span class="st">"misshandlung"</span>, <span class="st">"misshandelt"</span>, <span class="st">"stalking"</span>,</span>
<span id="cb85-19"><a href="#cb85-19"></a>  <span class="st">"eifersucht"</span>, <span class="st">"eifersüchtig"</span>, <span class="st">"eifersüchtige"</span>, <span class="st">"eifersüchtigen"</span>,</span>
<span id="cb85-20"><a href="#cb85-20"></a>  <span class="st">"mord"</span></span>
<span id="cb85-21"><a href="#cb85-21"></a></span>
<span id="cb85-22"><a href="#cb85-22"></a>)</span>
<span id="cb85-23"><a href="#cb85-23"></a></span>
<span id="cb85-24"><a href="#cb85-24"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb85-25"><a href="#cb85-25"></a>  <span class="st">"ehepartner"</span>, <span class="st">"exmann"</span>, <span class="st">"intimpartner"</span>, <span class="st">"lebensgefährt"</span>,</span>
<span id="cb85-26"><a href="#cb85-26"></a>  <span class="st">"lebensgemeinschaft"</span>, <span class="st">"Partner"</span>, <span class="st">"schwägerin"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Frau"</span>,</span>
<span id="cb85-27"><a href="#cb85-27"></a>  <span class="st">"ehefrau"</span>, <span class="st">"freundin"</span>, <span class="st">"beziehung"</span>, <span class="st">"geschieden"</span>, <span class="st">"mutter"</span>, <span class="st">"vater"</span>,</span>
<span id="cb85-28"><a href="#cb85-28"></a>  <span class="st">"sohn"</span>, <span class="st">"tochter"</span>, <span class="st">"schwiegersohn"</span>, <span class="st">"ex-partner"</span>, <span class="st">"ex-mann"</span>, <span class="st">"ex-frau"</span></span>
<span id="cb85-29"><a href="#cb85-29"></a></span>
<span id="cb85-30"><a href="#cb85-30"></a>)</span>
<span id="cb85-31"><a href="#cb85-31"></a></span>
<span id="cb85-32"><a href="#cb85-32"></a><span class="co"># Dropped terms (noisy/too generic): aufwies, desinteresseerklärung,</span></span>
<span id="cb85-33"><a href="#cb85-33"></a><span class="co"># desinteressenerklärung, erleben, erwachsenenleben, fünfte, häusliche,</span></span>
<span id="cb85-34"><a href="#cb85-34"></a><span class="co"># körper, männer, menos, mutmassliche, physische, rechercheplattformen,</span></span>
<span id="cb85-35"><a href="#cb85-35"></a><span class="co"># rechercheprojekt, sexuelle, straftatbestand, tatverdächtigen, türkin</span></span>
<span id="cb85-36"><a href="#cb85-36"></a></span>
<span id="cb85-37"><a href="#cb85-37"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(action_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb85-38"><a href="#cb85-38"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(relation_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb85-39"><a href="#cb85-39"></a></span>
<span id="cb85-40"><a href="#cb85-40"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, action_terms_extra))</span>
<span id="cb85-41"><a href="#cb85-41"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, relation_terms_extra))</span>
<span id="cb85-42"><a href="#cb85-42"></a></span>
<span id="cb85-43"><a href="#cb85-43"></a>normalize_wildcards <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb85-44"><a href="#cb85-44"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb85-45"><a href="#cb85-45"></a>  terms <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">*+$"</span>, <span class="st">""</span>, terms)</span>
<span id="cb85-46"><a href="#cb85-46"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb85-47"><a href="#cb85-47"></a>  <span class="fu">c</span>(terms, <span class="fu">paste0</span>(terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)], <span class="st">"*"</span>))</span>
<span id="cb85-48"><a href="#cb85-48"></a>}</span>
<span id="cb85-49"><a href="#cb85-49"></a></span>
<span id="cb85-50"><a href="#cb85-50"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(action_terms_second)</span>
<span id="cb85-51"><a href="#cb85-51"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(relation_terms_second)</span>
<span id="cb85-52"><a href="#cb85-52"></a></span>
<span id="cb85-53"><a href="#cb85-53"></a><span class="fu">message</span>(<span class="st">"Second-pass action terms: "</span>, <span class="fu">paste</span>(action_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass action terms: Feminizid, Femizid, Frauenmord, Tötung von Frau, Mord an Frau, Gewalt gegen Frauen, Partnergewalt, Beziehungsgewalt, häusliche Gewalt, Partnerschaftsgewalt, ermordet, erschossen, erstochen, getötet, tötung, tötungsversuch, frauentötungen, stranguliert, kopfschuss, küchenmesser, mordopfer, umgebracht, tötete, totschlag, misshandlung, misshandelt, stalking, eifersucht, eifersüchtig, eifersüchtige, eifersüchtigen, mord, Feminizid*, Femizid*, Frauenmord*, Partnergewalt*, Beziehungsgewalt*, Partnerschaftsgewalt*, ermordet*, erschossen*, erstochen*, getötet*, tötung*, tötungsversuch*, frauentötungen*, stranguliert*, kopfschuss*, küchenmesser*, mordopfer*, umgebracht*, tötete*, totschlag*, misshandlung*, misshandelt*, stalking*, eifersucht*, eifersüchtig*, eifersüchtige*, eifersüchtigen*, mord*</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">message</span>(<span class="st">"Second-pass relation terms: "</span>, <span class="fu">paste</span>(relation_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass relation terms: Familiendrama, Familientragödie, Beziehungstat, Ehestreit, ehepartner, exmann, intimpartner, lebensgefährt, lebensgemeinschaft, Partner, schwägerin, Peiniger, Frau, ehefrau, freundin, beziehung, geschieden, mutter, vater, sohn, tochter, schwiegersohn, ex-partner, ex-mann, ex-frau, Familiendrama*, Familientragödie*, Beziehungstat*, Ehestreit*, ehepartner*, exmann*, intimpartner*, lebensgefährt*, lebensgemeinschaft*, Partner*, schwägerin*, Peiniger*, Frau*, ehefrau*, freundin*, beziehung*, geschieden*, mutter*, vater*, sohn*, tochter*, schwiegersohn*, ex-partner*, ex-mann*, ex-frau*</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>existing_secondpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_SECOND_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_secondpass))) {</span>
<span id="cb89-3"><a href="#cb89-3"></a>  <span class="fu">message</span>(<span class="st">"Second-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_secondpass))</span>
<span id="cb89-4"><a href="#cb89-4"></a>} <span class="cf">else</span> {</span>
<span id="cb89-5"><a href="#cb89-5"></a>  second_pass_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb89-6"><a href="#cb89-6"></a>    <span class="at">client =</span> client,</span>
<span id="cb89-7"><a href="#cb89-7"></a>    <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb89-8"><a href="#cb89-8"></a>      <span class="at">content_groups =</span> <span class="fu">list</span>(</span>
<span id="cb89-9"><a href="#cb89-9"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> action_terms_second),</span>
<span id="cb89-10"><a href="#cb89-10"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> relation_terms_second)</span>
<span id="cb89-11"><a href="#cb89-11"></a>      ),</span>
<span id="cb89-12"><a href="#cb89-12"></a>      <span class="at">date_from =</span> <span class="st">"1990-01-01"</span>,</span>
<span id="cb89-13"><a href="#cb89-13"></a>      <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb89-14"><a href="#cb89-14"></a>      <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb89-15"><a href="#cb89-15"></a>      <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb89-16"><a href="#cb89-16"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb89-17"><a href="#cb89-17"></a>                  <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>,</span>
<span id="cb89-18"><a href="#cb89-18"></a>                  <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>,</span>
<span id="cb89-19"><a href="#cb89-19"></a>                  <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb89-20"><a href="#cb89-20"></a>    ),</span>
<span id="cb89-21"><a href="#cb89-21"></a>    <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_SecondPass"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb89-22"><a href="#cb89-22"></a>    <span class="at">comment =</span> <span class="st">"Second-pass query with curated action+relation terms (1990+)"</span>,</span>
<span id="cb89-23"><a href="#cb89-23"></a>    <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb89-24"><a href="#cb89-24"></a>    <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb89-25"><a href="#cb89-25"></a>  )</span>
<span id="cb89-26"><a href="#cb89-26"></a></span>
<span id="cb89-27"><a href="#cb89-27"></a>  <span class="co"># Save second-pass result for reuse</span></span>
<span id="cb89-28"><a href="#cb89-28"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(second_pass_result<span class="sc">$</span>data)) {</span>
<span id="cb89-29"><a href="#cb89-29"></a>    <span class="fu">save_checkpoint</span>(second_pass_result<span class="sc">$</span>data, <span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb89-30"><a href="#cb89-30"></a>  }</span>
<span id="cb89-31"><a href="#cb89-31"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass query skipped. Existing checkpoint: feminizid_raw_data_secondpass_20260127_094656.qs2</code></pre>
</div>
</div>
</section>
<section id="second-pass-data-preparation" class="level2" data-number="0.13">
<h2 data-number="0.13" class="anchored" data-anchor-id="second-pass-data-preparation"><span class="header-section-number">0.13</span> Second-pass data preparation</h2>
<p>We clean the second-pass data and build a focused corpus for downstream semantic analysis. The same cleaning logic is applied to keep results comparable with the first pass.</p>
<p>Clean the second-pass data and build a corpus for downstream analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>, <span class="st">"media_data_second"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: feminizid_raw_data_secondpass_20260127_094656.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_raw_data_secondpass_20260127_094656.qs2"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>media_data_second<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(media_data_second<span class="sc">$</span>pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb94-2"><a href="#cb94-2"></a>media_data_second<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data_second<span class="sc">$</span>pubtime)</span>
<span id="cb94-3"><a href="#cb94-3"></a>media_data_second<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(media_data_second<span class="sc">$</span>pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb94-4"><a href="#cb94-4"></a></span>
<span id="cb94-5"><a href="#cb94-5"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="#cb94-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="#cb94-8"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1990</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-9"><a href="#cb94-9"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-10"><a href="#cb94-10"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb94-11"><a href="#cb94-11"></a></span>
<span id="cb94-12"><a href="#cb94-12"></a>media_data_second<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> media_data_second<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb94-13"><a href="#cb94-13"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-14"><a href="#cb94-14"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-15"><a href="#cb94-15"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-16"><a href="#cb94-16"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb94-17"><a href="#cb94-17"></a></span>
<span id="cb94-18"><a href="#cb94-18"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb94-19"><a href="#cb94-19"></a>  media_data_second,</span>
<span id="cb94-20"><a href="#cb94-20"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb94-21"><a href="#cb94-21"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb94-22"><a href="#cb94-22"></a>)</span>
<span id="cb94-23"><a href="#cb94-23"></a></span>
<span id="cb94-24"><a href="#cb94-24"></a><span class="fu">save_checkpoint</span>(secondpass_corpus, <span class="st">"feminizid_secondpass_corpus"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: feminizid_secondpass_corpus_20260127_110217.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/feminizid_secondpass_corpus_20260127_110217.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Filter out broad international rubrics for a more focused second-pass set</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="co"># (keeps the raw checkpoint intact; only affects downstream analysis)</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="fu">mutate</span>(<span class="at">rubric_clean =</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(<span class="fu">str_squish</span>(rubric))) <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="#cb97-5"></a>  <span class="fu">filter</span>(<span class="sc">!</span>rubric_clean <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ausland"</span>, <span class="st">"international"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb97-6"><a href="#cb97-6"></a>  <span class="fu">select</span>(<span class="sc">-</span>rubric_clean)</span>
<span id="cb97-7"><a href="#cb97-7"></a></span>
<span id="cb97-8"><a href="#cb97-8"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb97-9"><a href="#cb97-9"></a>  media_data_second,</span>
<span id="cb97-10"><a href="#cb97-10"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb97-11"><a href="#cb97-11"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb97-12"><a href="#cb97-12"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="co"># Basic distribution: article counts per year (1990-present)</span></span>
<span id="cb98-2"><a href="#cb98-2"></a>articles_second_by_year <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb98-4"><a href="#cb98-4"></a>    <span class="at">pubtime =</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb98-5"><a href="#cb98-5"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb98-6"><a href="#cb98-6"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="#cb98-7"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">1990</span>, year <span class="sc">&lt;=</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="#cb98-8"></a>  <span class="fu">count</span>(year)</span>
<span id="cb98-9"><a href="#cb98-9"></a></span>
<span id="cb98-10"><a href="#cb98-10"></a>articles_second_by_year</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"1991","2":"14"},{"1":"1992","2":"11"},{"1":"1993","2":"142"},{"1":"1994","2":"961"},{"1":"1995","2":"1319"},{"1":"1996","2":"1815"},{"1":"1997","2":"1913"},{"1":"1998","2":"2313"},{"1":"1999","2":"3035"},{"1":"2000","2":"3535"},{"1":"2001","2":"3753"},{"1":"2002","2":"4575"},{"1":"2003","2":"4359"},{"1":"2004","2":"4914"},{"1":"2005","2":"4522"},{"1":"2006","2":"4780"},{"1":"2007","2":"4517"},{"1":"2008","2":"4442"},{"1":"2009","2":"5700"},{"1":"2010","2":"5319"},{"1":"2011","2":"5689"},{"1":"2012","2":"5382"},{"1":"2013","2":"6284"},{"1":"2014","2":"6460"},{"1":"2015","2":"6793"},{"1":"2016","2":"7930"},{"1":"2017","2":"8507"},{"1":"2018","2":"9582"},{"1":"2019","2":"10143"},{"1":"2020","2":"12733"},{"1":"2021","2":"14636"},{"1":"2022","2":"17895"},{"1":"2023","2":"14794"},{"1":"2024","2":"14479"},{"1":"2025","2":"13039"},{"1":"2026","2":"787"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="top-sources" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Top sources</h1>
<p>top_media_second &lt;- media_data_second %&gt;% count(medium_name, sort = TRUE) %&gt;% head(15) top_media_second</p>
<pre><code>
# Top rubric categories
top_rubrics_second &lt;- media_data_second %&gt;%
  mutate(rubric = na_if(str_squish(rubric), "")) %&gt;%
  count(rubric, sort = TRUE) %&gt;%
  head(15)
top_rubrics_second</code></pre>
</section>
<section id="normalized-contrast-early-vs.-late-periods-per-million-words" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Normalized contrast: early vs.&nbsp;late periods (per million words)</h1>
<p>tokens_raw &lt;- tokens( secondpass_corpus, remove_punct = TRUE, remove_symbols = TRUE, remove_numbers = TRUE, remove_url = TRUE )</p>
<p>dfm_raw &lt;- dfm(tokens_raw, tolower = TRUE) dfm_raw &lt;- dfm_remove(dfm_raw, all_stopwords, valuetype = “fixed”) dfm_raw &lt;- dfm_remove( dfm_raw, pattern = c( “^uhr”, “^(montag|dienstag|mittwoch|donnerstag|freitag|samstag|sonntag)<span class="math inline">\(",
    ".*\\d+.*",
    "^[a-zäöüß]{1,2}\)</span>” ), valuetype = “regex”, case_insensitive = TRUE ) dfm_raw &lt;- dfm_trim(dfm_raw, min_termfreq = 10)</p>
<p>doc_ids &lt;- docnames(dfm_raw) year_lookup &lt;- media_data_second<span class="math inline">\(year[match(doc_ids, media_data_second\)</span>unique_id)] period_vec &lt;- ifelse(is.na(year_lookup), “Unknown”, ifelse(year_lookup &lt; 2005, “1990-2004”, “2005-2026”)) docvars(dfm_raw, “period”) &lt;- period_vec</p>
<p>dfm_period &lt;- dfm_group(dfm_raw, groups = docvars(dfm_raw, “period”)) dfm_prop &lt;- dfm_weight(dfm_period, scheme = “prop”)</p>
<p>term_prop &lt;- convert(dfm_prop, to = “data.frame”) %&gt;% select(-doc_id) %&gt;% mutate(period = rownames(dfm_prop))</p>
<p>term_long &lt;- term_prop %&gt;% pivot_longer(-period, names_to = “term”, values_to = “prop”)</p>
<p>term_wide &lt;- term_long %&gt;% pivot_wider(names_from = period, values_from = prop, values_fill = 0) %&gt;% mutate( early_per_million = <code>1990-2004</code> * 1e6, late_per_million = <code>2005-2026</code> * 1e6, log2_ratio = log2((late_per_million + 1) / (early_per_million + 1)) )</p>
<p>top_contrast &lt;- bind_rows( head(arrange(term_wide, desc(log2_ratio)), 15), head(arrange(term_wide, log2_ratio), 15) ) %&gt;% mutate(direction = ifelse(log2_ratio &gt; 0, “Later period”, “Earlier period”))</p>
<p>top_contrast %&gt;% select(term, log2_ratio, direction)</p>
<pre><code>

::: {.cell}

```{.r .cell-code}
# Checkpoint save (Second-pass analysis outputs)
save_checkpoint(top_contrast, "secondpass_key_terms")</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: secondpass_key_terms_20260127_113451.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/secondpass_key_terms_20260127_113451.qs2"</code></pre>
</div>
<p>:::</p>
<section id="second-pass-semantic-expansion-iteration-2" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="second-pass-semantic-expansion-iteration-2"><span class="header-section-number">2.1</span> Second-pass semantic expansion (iteration 2)</h2>
<p>We repeat the embedding approach on the second-pass corpus to identify framing shifts inside this narrower, more specific dataset. This provides a robustness check against the broader first-pass collection.</p>
<p>We run a second, focused embedding pass on the filtered second-pass corpus. The goal is to surface terms that describe feminicide framing across 5-year windows.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Build 5-year windows based on available second-pass years</span></span>
<span id="cb103-2"><a href="#cb103-2"></a>min_year_sp <span class="ot">&lt;-</span> <span class="fu">min</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-3"><a href="#cb103-3"></a>max_year_sp <span class="ot">&lt;-</span> <span class="fu">max</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-4"><a href="#cb103-4"></a>window_starts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">floor</span>(min_year_sp <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>, max_year_sp, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb103-5"><a href="#cb103-5"></a>time_windows_secondpass <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb103-6"><a href="#cb103-6"></a>  <span class="fu">lapply</span>(window_starts, <span class="cf">function</span>(y) <span class="fu">c</span>(y, <span class="fu">min</span>(y <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))),</span>
<span id="cb103-7"><a href="#cb103-7"></a>  <span class="fu">paste0</span>(window_starts, <span class="st">"-"</span>, <span class="fu">pmin</span>(window_starts <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))</span>
<span id="cb103-8"><a href="#cb103-8"></a>)</span>
<span id="cb103-9"><a href="#cb103-9"></a></span>
<span id="cb103-10"><a href="#cb103-10"></a>seed_terms_secondpass <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># Train one model per window for the second-pass corpus.</span></span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="co"># Always export plain vectors (no external pointers) for reuse.</span></span>
<span id="cb104-3"><a href="#cb104-3"></a>existing_vectors <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_W2V_TRAINING) {</span>
<span id="cb104-5"><a href="#cb104-5"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec training disabled (RUN_SECOND_PASS_W2V_TRAINING = FALSE)."</span>)</span>
<span id="cb104-6"><a href="#cb104-6"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb104-7"><a href="#cb104-7"></a>    <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb104-8"><a href="#cb104-8"></a>  }</span>
<span id="cb104-9"><a href="#cb104-9"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>FORCE_SECOND_PASS_W2V_TRAINING <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb104-10"><a href="#cb104-10"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec vectors already exist; skipping training."</span>)</span>
<span id="cb104-11"><a href="#cb104-11"></a>  <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb104-12"><a href="#cb104-12"></a>} <span class="cf">else</span> {</span>
<span id="cb104-13"><a href="#cb104-13"></a>  word2vec_models_secondpass <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb104-14"><a href="#cb104-14"></a></span>
<span id="cb104-15"><a href="#cb104-15"></a>  <span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows_secondpass)) {</span>
<span id="cb104-16"><a href="#cb104-16"></a>    window_years <span class="ot">&lt;-</span> time_windows_secondpass[[window_name]]</span>
<span id="cb104-17"><a href="#cb104-17"></a>    window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb104-18"><a href="#cb104-18"></a>      secondpass_corpus,</span>
<span id="cb104-19"><a href="#cb104-19"></a>      year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb104-20"><a href="#cb104-20"></a>    )</span>
<span id="cb104-21"><a href="#cb104-21"></a>    model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb104-22"><a href="#cb104-22"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(model)) {</span>
<span id="cb104-23"><a href="#cb104-23"></a>      word2vec_models_secondpass[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb104-24"><a href="#cb104-24"></a>    }</span>
<span id="cb104-25"><a href="#cb104-25"></a>  }</span>
<span id="cb104-26"><a href="#cb104-26"></a></span>
<span id="cb104-27"><a href="#cb104-27"></a>  word2vec_vectors_secondpass <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_models_secondpass, as.matrix)</span>
<span id="cb104-28"><a href="#cb104-28"></a>  <span class="fu">save_checkpoint</span>(word2vec_vectors_secondpass, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb104-29"><a href="#cb104-29"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Second-pass Word2Vec vectors already exist; skipping training.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># Checkpoint load (Second-pass Word2Vec vectors)</span></span>
<span id="cb108-2"><a href="#cb108-2"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="co"># Collect nearest neighbors for seed terms across windows</span></span>
<span id="cb111-2"><a href="#cb111-2"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded checkpoint: word2vec_vectors_secondpass_20260127_152631.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_vectors_secondpass_20260127_152631.qs2"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>collect_neighbors_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb114-2"><a href="#cb114-2"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(vectors))</span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="cf">if</span> (<span class="fu">length</span>(seeds_in_vocab) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb114-4"><a href="#cb114-4"></a></span>
<span id="cb114-5"><a href="#cb114-5"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb114-6"><a href="#cb114-6"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb114-7"><a href="#cb114-7"></a>  vectors_norm <span class="ot">&lt;-</span> vectors <span class="sc">/</span> norms</span>
<span id="cb114-8"><a href="#cb114-8"></a></span>
<span id="cb114-9"><a href="#cb114-9"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb114-10"><a href="#cb114-10"></a>    seed_vec <span class="ot">&lt;-</span> vectors_norm[seed, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb114-11"><a href="#cb114-11"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(seed_vec))</span>
<span id="cb114-12"><a href="#cb114-12"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb114-13"><a href="#cb114-13"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> seed]</span>
<span id="cb114-14"><a href="#cb114-14"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb114-15"><a href="#cb114-15"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb114-16"><a href="#cb114-16"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb114-17"><a href="#cb114-17"></a>      <span class="at">term =</span> <span class="fu">names</span>(top),</span>
<span id="cb114-18"><a href="#cb114-18"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb114-19"><a href="#cb114-19"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb114-20"><a href="#cb114-20"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb114-21"><a href="#cb114-21"></a>    )</span>
<span id="cb114-22"><a href="#cb114-22"></a>  })</span>
<span id="cb114-23"><a href="#cb114-23"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb114-24"><a href="#cb114-24"></a>}</span>
<span id="cb114-25"><a href="#cb114-25"></a></span>
<span id="cb114-26"><a href="#cb114-26"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb114-27"><a href="#cb114-27"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb114-28"><a href="#cb114-28"></a>}</span>
<span id="cb114-29"><a href="#cb114-29"></a></span>
<span id="cb114-30"><a href="#cb114-30"></a>neighbors_secondpass <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_vectors_secondpass), <span class="cf">function</span>(w) {</span>
<span id="cb114-31"><a href="#cb114-31"></a>  vectors <span class="ot">&lt;-</span> word2vec_vectors_secondpass[[w]]</span>
<span id="cb114-32"><a href="#cb114-32"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors_vectors</span>(vectors, seed_terms_secondpass, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb114-33"><a href="#cb114-33"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb114-34"><a href="#cb114-34"></a>  df</span>
<span id="cb114-35"><a href="#cb114-35"></a>}))</span>
<span id="cb114-36"><a href="#cb114-36"></a></span>
<span id="cb114-37"><a href="#cb114-37"></a><span class="fu">save_checkpoint</span>(neighbors_secondpass, <span class="st">"word2vec_neighbors_secondpass"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Saved checkpoint: word2vec_neighbors_secondpass_20260127_171158.qs2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/word2vec_neighbors_secondpass_20260127_171158.qs2"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>candidate_terms_secondpass <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb117-4"><a href="#cb117-4"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb117-5"><a href="#cb117-5"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb117-6"><a href="#cb117-6"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb117-7"><a href="#cb117-7"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb117-8"><a href="#cb117-8"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb117-9"><a href="#cb117-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity)) <span class="sc">%&gt;%</span></span>
<span id="cb117-10"><a href="#cb117-10"></a>  <span class="fu">filter</span>(seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-11"><a href="#cb117-11"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb117-12"><a href="#cb117-12"></a></span>
<span id="cb117-13"><a href="#cb117-13"></a>candidate_terms_secondpass</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_similarity"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["seed_hits"],"name":[3],"type":["int"],"align":["right"]},{"label":["window_hits"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"ehefrau","2":"0.7270274","3":"2","4":"7"},{"1":"ehemann","2":"0.7233748","3":"3","4":"7"},{"1":"gattin","2":"0.6790379","3":"2","4":"6"},{"1":"tocht","2":"0.6644148","3":"2","4":"4"},{"1":"gatt","2":"0.6636772","3":"3","4":"5"},{"1":"freundin","2":"0.6520655","3":"5","4":"7"},{"1":"rechercheprojekt","2":"0.6406193","3":"2","4":"2"},{"1":"geschied","2":"0.6394915","3":"3","4":"5"},{"1":"ehepaar","2":"0.6320771","3":"2","4":"5"},{"1":"totungsdelikt","2":"0.6287441","3":"3","4":"3"},{"1":"schwagerin","2":"0.6286987","3":"2","4":"2"},{"1":"partnerin","2":"0.6278488","3":"4","4":"7"},{"1":"schwiegertocht","2":"0.6269674","3":"2","4":"2"},{"1":"geliebt","2":"0.6214185","3":"4","4":"5"},{"1":"freundinn","2":"0.6206314","3":"2","4":"7"},{"1":"partn","2":"0.6203972","3":"2","4":"7"},{"1":"lebenspartnerin","2":"0.6193070","3":"3","4":"6"},{"1":"frauenmord","2":"0.6160603","3":"2","4":"4"},{"1":"scheidung","2":"0.6139958","3":"2","4":"5"},{"1":"schwiegervat","2":"0.6134064","3":"2","4":"2"},{"1":"liebhab","2":"0.6127684","3":"3","4":"5"},{"1":"gewaltverbrech","2":"0.6117881","3":"2","4":"2"},{"1":"weiblich","2":"0.6117671","3":"2","4":"5"},{"1":"bekannte","2":"0.6093075","3":"2","4":"2"},{"1":"schwiegermutt","2":"0.6058557","3":"2","4":"3"},{"1":"partnerschaft","2":"0.6018198","3":"3","4":"7"},{"1":"straftatbestand","2":"0.6016796","3":"2","4":"2"},{"1":"sohn","2":"0.6013578","3":"3","4":"3"},{"1":"expartn","2":"0.6009090","3":"2","4":"4"},{"1":"feminizid","2":"0.6008742","3":"3","4":"3"},{"1":"verheiratet","2":"0.5994937","3":"2","4":"7"},{"1":"schwag","2":"0.5979706","3":"2","4":"2"},{"1":"lebenspartn","2":"0.5969972","3":"5","4":"5"},{"1":"verlobt","2":"0.5960518","3":"2","4":"2"},{"1":"femizid","2":"0.5945183","3":"4","4":"5"},{"1":"nebenbuhl","2":"0.5918896","3":"3","4":"2"},{"1":"femiziden","2":"0.5872106","3":"2","4":"2"},{"1":"trennungsphas","2":"0.5871151","3":"2","4":"2"},{"1":"ex","2":"0.5860109","3":"6","4":"6"},{"1":"partner","2":"0.5841795","3":"2","4":"4"},{"1":"partnerinn","2":"0.5815668","3":"4","4":"5"},{"1":"gewalt","2":"0.5803474","3":"4","4":"5"},{"1":"exfrau","2":"0.5787322","3":"2","4":"3"},{"1":"lebensgefahrtin","2":"0.5781691","3":"2","4":"3"},{"1":"geschlechtsspezif","2":"0.5778614","3":"2","4":"3"},{"1":"geschlechts","2":"0.5766927","3":"2","4":"2"},{"1":"gewaltbetroff","2":"0.5758527","3":"2","4":"2"},{"1":"bezieh","2":"0.5742653","3":"3","4":"7"},{"1":"menos","2":"0.5742351","3":"3","4":"3"},{"1":"lebensgefahrt","2":"0.5736089","3":"5","4":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># We align spaces across windows before projecting to 3D. Without alignment,</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="co"># apparent movement may be an artifact of arbitrary embedding rotations.</span></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="co"># Interactive 3D view across time windows (aligned spaces)</span></span>
<span id="cb118-4"><a href="#cb118-4"></a><span class="co"># Important: align vectors across windows before comparing positions.</span></span>
<span id="cb118-5"><a href="#cb118-5"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb118-6"><a href="#cb118-6"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb118-7"><a href="#cb118-7"></a>}</span>
<span id="cb118-8"><a href="#cb118-8"></a></span>
<span id="cb118-9"><a href="#cb118-9"></a><span class="co"># Controls for density and focus</span></span>
<span id="cb118-10"><a href="#cb118-10"></a>TOP_NEIGHBORS_PER_TARGET <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb118-11"><a href="#cb118-11"></a>MAX_MOVERS <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb118-12"><a href="#cb118-12"></a>MAX_POINTS_PER_WINDOW <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb118-13"><a href="#cb118-13"></a>MAX_TARGETS <span class="ot">&lt;-</span> <span class="fu">length</span>(target_words)  <span class="co"># reduce for clarity if needed</span></span>
<span id="cb118-14"><a href="#cb118-14"></a></span>
<span id="cb118-15"><a href="#cb118-15"></a><span class="co"># Select neighbors per target and window</span></span>
<span id="cb118-16"><a href="#cb118-16"></a>targets_focus <span class="ot">&lt;-</span> <span class="fu">head</span>(target_words, MAX_TARGETS)</span>
<span id="cb118-17"><a href="#cb118-17"></a>targets_focus_norm <span class="ot">&lt;-</span> <span class="fu">normalize_terms_for_model</span>(targets_focus)</span>
<span id="cb118-18"><a href="#cb118-18"></a>target_label_map <span class="ot">&lt;-</span> target_map <span class="sc">%&gt;%</span></span>
<span id="cb118-19"><a href="#cb118-19"></a>  <span class="fu">select</span>(original, normalized) <span class="sc">%&gt;%</span></span>
<span id="cb118-20"><a href="#cb118-20"></a>  <span class="fu">distinct</span>()</span>
<span id="cb118-21"><a href="#cb118-21"></a>neighbors_top <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb118-22"><a href="#cb118-22"></a>  <span class="fu">filter</span>(seed <span class="sc">%in%</span> targets_focus_norm) <span class="sc">%&gt;%</span></span>
<span id="cb118-23"><a href="#cb118-23"></a>  <span class="fu">group_by</span>(window, seed) <span class="sc">%&gt;%</span></span>
<span id="cb118-24"><a href="#cb118-24"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> TOP_NEIGHBORS_PER_TARGET, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-25"><a href="#cb118-25"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb118-26"><a href="#cb118-26"></a></span>
<span id="cb118-27"><a href="#cb118-27"></a><span class="co"># Dominant target per term/window (for coloring)</span></span>
<span id="cb118-28"><a href="#cb118-28"></a>dominant_seed <span class="ot">&lt;-</span> neighbors_top <span class="sc">%&gt;%</span></span>
<span id="cb118-29"><a href="#cb118-29"></a>  <span class="fu">group_by</span>(window, term) <span class="sc">%&gt;%</span></span>
<span id="cb118-30"><a href="#cb118-30"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-31"><a href="#cb118-31"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-32"><a href="#cb118-32"></a>  <span class="fu">select</span>(window, term, seed)</span>
<span id="cb118-33"><a href="#cb118-33"></a></span>
<span id="cb118-34"><a href="#cb118-34"></a><span class="co"># Build a compact term set: targets + top neighbors</span></span>
<span id="cb118-35"><a href="#cb118-35"></a>terms_all <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(targets_focus_norm, neighbors_top<span class="sc">$</span>term))</span>
<span id="cb118-36"><a href="#cb118-36"></a>terms_all <span class="ot">&lt;-</span> terms_all[<span class="sc">!</span><span class="fu">is.na</span>(terms_all)]</span>
<span id="cb118-37"><a href="#cb118-37"></a></span>
<span id="cb118-38"><a href="#cb118-38"></a>vectors_list <span class="ot">&lt;-</span> word2vec_vectors_secondpass</span>
<span id="cb118-39"><a href="#cb118-39"></a>windows <span class="ot">&lt;-</span> <span class="fu">names</span>(vectors_list)</span>
<span id="cb118-40"><a href="#cb118-40"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb118-41"><a href="#cb118-41"></a>  <span class="fu">stop</span>(<span class="st">"Need at least two time windows for an interactive timeline."</span>)</span>
<span id="cb118-42"><a href="#cb118-42"></a>}</span>
<span id="cb118-43"><a href="#cb118-43"></a></span>
<span id="cb118-44"><a href="#cb118-44"></a><span class="co"># Reference window for alignment</span></span>
<span id="cb118-45"><a href="#cb118-45"></a>ref_window <span class="ot">&lt;-</span> windows[<span class="dv">1</span>]</span>
<span id="cb118-46"><a href="#cb118-46"></a>ref_vectors <span class="ot">&lt;-</span> vectors_list[[ref_window]]</span>
<span id="cb118-47"><a href="#cb118-47"></a></span>
<span id="cb118-48"><a href="#cb118-48"></a><span class="co"># Common terms used for alignment (must exist in all windows)</span></span>
<span id="cb118-49"><a href="#cb118-49"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(vectors_list, rownames))</span>
<span id="cb118-50"><a href="#cb118-50"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(common_terms, <span class="fu">rownames</span>(ref_vectors))</span>
<span id="cb118-51"><a href="#cb118-51"></a><span class="cf">if</span> (<span class="fu">length</span>(common_terms) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb118-52"><a href="#cb118-52"></a>  <span class="fu">message</span>(<span class="st">"WARN: Few common terms for alignment ("</span>, <span class="fu">length</span>(common_terms), <span class="st">")."</span>)</span>
<span id="cb118-53"><a href="#cb118-53"></a>}</span>
<span id="cb118-54"><a href="#cb118-54"></a></span>
<span id="cb118-55"><a href="#cb118-55"></a>align_to_reference <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, ref_vec, anchor_terms) {</span>
<span id="cb118-56"><a href="#cb118-56"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchor_terms, <span class="fu">rownames</span>(vec))</span>
<span id="cb118-57"><a href="#cb118-57"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchors, <span class="fu">rownames</span>(ref_vec))</span>
<span id="cb118-58"><a href="#cb118-58"></a>  <span class="cf">if</span> (<span class="fu">length</span>(anchors) <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="fu">return</span>(vec)</span>
<span id="cb118-59"><a href="#cb118-59"></a>  A <span class="ot">&lt;-</span> ref_vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb118-60"><a href="#cb118-60"></a>  B <span class="ot">&lt;-</span> vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb118-61"><a href="#cb118-61"></a>  M <span class="ot">&lt;-</span> <span class="fu">t</span>(B) <span class="sc">%*%</span> A</span>
<span id="cb118-62"><a href="#cb118-62"></a>  sv <span class="ot">&lt;-</span> <span class="fu">svd</span>(M)</span>
<span id="cb118-63"><a href="#cb118-63"></a>  R <span class="ot">&lt;-</span> sv<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">t</span>(sv<span class="sc">$</span>v)</span>
<span id="cb118-64"><a href="#cb118-64"></a>  vec <span class="sc">%*%</span> R</span>
<span id="cb118-65"><a href="#cb118-65"></a>}</span>
<span id="cb118-66"><a href="#cb118-66"></a></span>
<span id="cb118-67"><a href="#cb118-67"></a><span class="co"># Align all windows to reference</span></span>
<span id="cb118-68"><a href="#cb118-68"></a>aligned_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vectors_list, <span class="cf">function</span>(v) {</span>
<span id="cb118-69"><a href="#cb118-69"></a>  <span class="fu">align_to_reference</span>(v, ref_vectors, common_terms)</span>
<span id="cb118-70"><a href="#cb118-70"></a>})</span>
<span id="cb118-71"><a href="#cb118-71"></a></span>
<span id="cb118-72"><a href="#cb118-72"></a><span class="co"># PCA basis from reference window on shared terms (for comparable axes)</span></span>
<span id="cb118-73"><a href="#cb118-73"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms_all, <span class="fu">rownames</span>(aligned_list[[ref_window]]))</span>
<span id="cb118-74"><a href="#cb118-74"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(ref_anchor_terms, common_terms)</span>
<span id="cb118-75"><a href="#cb118-75"></a><span class="cf">if</span> (<span class="fu">length</span>(ref_anchor_terms) <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb118-76"><a href="#cb118-76"></a>  <span class="fu">stop</span>(<span class="st">"Not enough shared terms for stable PCA alignment."</span>)</span>
<span id="cb118-77"><a href="#cb118-77"></a>}</span>
<span id="cb118-78"><a href="#cb118-78"></a>ref_mat <span class="ot">&lt;-</span> aligned_list[[ref_window]][ref_anchor_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb118-79"><a href="#cb118-79"></a>pca_ref <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(ref_mat, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb118-80"><a href="#cb118-80"></a></span>
<span id="cb118-81"><a href="#cb118-81"></a>project_window <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, terms, pca_obj) {</span>
<span id="cb118-82"><a href="#cb118-82"></a>  terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms, <span class="fu">rownames</span>(vectors))</span>
<span id="cb118-83"><a href="#cb118-83"></a>  mat <span class="ot">&lt;-</span> vectors[terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb118-84"><a href="#cb118-84"></a>  coords <span class="ot">&lt;-</span> <span class="fu">scale</span>(mat, <span class="at">center =</span> pca_obj<span class="sc">$</span>center, <span class="at">scale =</span> <span class="cn">FALSE</span>) <span class="sc">%*%</span> pca_obj<span class="sc">$</span>rotation[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb118-85"><a href="#cb118-85"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb118-86"><a href="#cb118-86"></a>    <span class="at">term =</span> terms,</span>
<span id="cb118-87"><a href="#cb118-87"></a>    <span class="at">x =</span> coords[, <span class="dv">1</span>],</span>
<span id="cb118-88"><a href="#cb118-88"></a>    <span class="at">y =</span> coords[, <span class="dv">2</span>],</span>
<span id="cb118-89"><a href="#cb118-89"></a>    <span class="at">z =</span> coords[, <span class="dv">3</span>],</span>
<span id="cb118-90"><a href="#cb118-90"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb118-91"><a href="#cb118-91"></a>  )</span>
<span id="cb118-92"><a href="#cb118-92"></a>}</span>
<span id="cb118-93"><a href="#cb118-93"></a></span>
<span id="cb118-94"><a href="#cb118-94"></a>plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(windows, <span class="cf">function</span>(w) {</span>
<span id="cb118-95"><a href="#cb118-95"></a>  vectors <span class="ot">&lt;-</span> aligned_list[[w]]</span>
<span id="cb118-96"><a href="#cb118-96"></a>  df <span class="ot">&lt;-</span> <span class="fu">project_window</span>(vectors, terms_all, pca_ref)</span>
<span id="cb118-97"><a href="#cb118-97"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb118-98"><a href="#cb118-98"></a>  df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>term <span class="sc">%in%</span> seed_terms_secondpass, <span class="st">"target"</span>, <span class="st">"neighbor"</span>)</span>
<span id="cb118-99"><a href="#cb118-99"></a>  df</span>
<span id="cb118-100"><a href="#cb118-100"></a>}))</span>
<span id="cb118-101"><a href="#cb118-101"></a></span>
<span id="cb118-102"><a href="#cb118-102"></a><span class="co"># Track movers: terms with largest displacement across windows</span></span>
<span id="cb118-103"><a href="#cb118-103"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb118-104"><a href="#cb118-104"></a>  mover_candidates <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb118-105"><a href="#cb118-105"></a>    <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb118-106"><a href="#cb118-106"></a>    <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="fu">length</span>(windows)) <span class="sc">%&gt;%</span></span>
<span id="cb118-107"><a href="#cb118-107"></a>    <span class="fu">summarise</span>(</span>
<span id="cb118-108"><a href="#cb118-108"></a>      <span class="at">dx =</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x),</span>
<span id="cb118-109"><a href="#cb118-109"></a>      <span class="at">dy =</span> <span class="fu">max</span>(y) <span class="sc">-</span> <span class="fu">min</span>(y),</span>
<span id="cb118-110"><a href="#cb118-110"></a>      <span class="at">dz =</span> <span class="fu">max</span>(z) <span class="sc">-</span> <span class="fu">min</span>(z),</span>
<span id="cb118-111"><a href="#cb118-111"></a>      <span class="at">displacement =</span> <span class="fu">sqrt</span>(dx<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dy<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dz<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb118-112"><a href="#cb118-112"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb118-113"><a href="#cb118-113"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb118-114"><a href="#cb118-114"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(displacement)) <span class="sc">%&gt;%</span></span>
<span id="cb118-115"><a href="#cb118-115"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_MOVERS) <span class="sc">%&gt;%</span></span>
<span id="cb118-116"><a href="#cb118-116"></a>    <span class="fu">pull</span>(term)</span>
<span id="cb118-117"><a href="#cb118-117"></a>} <span class="cf">else</span> {</span>
<span id="cb118-118"><a href="#cb118-118"></a>  mover_candidates <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb118-119"><a href="#cb118-119"></a>}</span>
<span id="cb118-120"><a href="#cb118-120"></a></span>
<span id="cb118-121"><a href="#cb118-121"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb118-122"><a href="#cb118-122"></a>  <span class="fu">left_join</span>(dominant_seed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"window"</span>, <span class="st">"term"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-123"><a href="#cb118-123"></a>  <span class="fu">left_join</span>(target_label_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"term"</span> <span class="ot">=</span> <span class="st">"normalized"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-124"><a href="#cb118-124"></a>  <span class="fu">mutate</span>(</span>
<span id="cb118-125"><a href="#cb118-125"></a>    <span class="at">is_mover =</span> term <span class="sc">%in%</span> mover_candidates,</span>
<span id="cb118-126"><a href="#cb118-126"></a>    <span class="at">label =</span> <span class="fu">ifelse</span>(type <span class="sc">==</span> <span class="st">"target"</span>, original, term)</span>
<span id="cb118-127"><a href="#cb118-127"></a>  )</span>
<span id="cb118-128"><a href="#cb118-128"></a></span>
<span id="cb118-129"><a href="#cb118-129"></a><span class="co"># Keep: all targets + top neighbors + movers</span></span>
<span id="cb118-130"><a href="#cb118-130"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb118-131"><a href="#cb118-131"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(seed) <span class="sc">|</span> is_mover)</span>
<span id="cb118-132"><a href="#cb118-132"></a></span>
<span id="cb118-133"><a href="#cb118-133"></a><span class="co"># Cap total points per window</span></span>
<span id="cb118-134"><a href="#cb118-134"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb118-135"><a href="#cb118-135"></a>  <span class="fu">group_by</span>(window) <span class="sc">%&gt;%</span></span>
<span id="cb118-136"><a href="#cb118-136"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_POINTS_PER_WINDOW) <span class="sc">%&gt;%</span></span>
<span id="cb118-137"><a href="#cb118-137"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb118-138"><a href="#cb118-138"></a></span>
<span id="cb118-139"><a href="#cb118-139"></a><span class="co"># Split targets vs neighbors for clearer rendering and stable traces</span></span>
<span id="cb118-140"><a href="#cb118-140"></a>targets_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span>)</span>
<span id="cb118-141"><a href="#cb118-141"></a>neighbors_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"neighbor"</span>)</span>
<span id="cb118-142"><a href="#cb118-142"></a></span>
<span id="cb118-143"><a href="#cb118-143"></a>p_w2v_3d <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-144"><a href="#cb118-144"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb118-145"><a href="#cb118-145"></a>    <span class="at">data =</span> neighbors_plot,</span>
<span id="cb118-146"><a href="#cb118-146"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb118-147"><a href="#cb118-147"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb118-148"><a href="#cb118-148"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb118-149"><a href="#cb118-149"></a>    <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb118-150"><a href="#cb118-150"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray70"</span>),</span>
<span id="cb118-151"><a href="#cb118-151"></a>    <span class="at">text =</span> <span class="sc">~</span>label,</span>
<span id="cb118-152"><a href="#cb118-152"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb118-153"><a href="#cb118-153"></a>    <span class="at">name =</span> <span class="st">"Neighbors"</span></span>
<span id="cb118-154"><a href="#cb118-154"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb118-155"><a href="#cb118-155"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb118-156"><a href="#cb118-156"></a>    <span class="at">data =</span> targets_plot,</span>
<span id="cb118-157"><a href="#cb118-157"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb118-158"><a href="#cb118-158"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb118-159"><a href="#cb118-159"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb118-160"><a href="#cb118-160"></a>    <span class="at">mode =</span> <span class="st">"markers+text"</span>,</span>
<span id="cb118-161"><a href="#cb118-161"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.95</span>, <span class="at">color =</span> <span class="st">"crimson"</span>),</span>
<span id="cb118-162"><a href="#cb118-162"></a>    <span class="at">text =</span> <span class="sc">~</span>label,</span>
<span id="cb118-163"><a href="#cb118-163"></a>    <span class="at">textposition =</span> <span class="st">"top center"</span>,</span>
<span id="cb118-164"><a href="#cb118-164"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb118-165"><a href="#cb118-165"></a>    <span class="at">name =</span> <span class="st">"Targets"</span></span>
<span id="cb118-166"><a href="#cb118-166"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb118-167"><a href="#cb118-167"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb118-168"><a href="#cb118-168"></a>    <span class="at">title =</span> <span class="st">"Word2Vec 3D timeline (aligned windows)"</span>,</span>
<span id="cb118-169"><a href="#cb118-169"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb118-170"><a href="#cb118-170"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC1"</span>),</span>
<span id="cb118-171"><a href="#cb118-171"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC2"</span>),</span>
<span id="cb118-172"><a href="#cb118-172"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC3"</span>)</span>
<span id="cb118-173"><a href="#cb118-173"></a>    ),</span>
<span id="cb118-174"><a href="#cb118-174"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">"h"</span>)</span>
<span id="cb118-175"><a href="#cb118-175"></a>  )</span>
<span id="cb118-176"><a href="#cb118-176"></a></span>
<span id="cb118-177"><a href="#cb118-177"></a>p_w2v_3d</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-3da01c0acf122fbe70f5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3da01c0acf122fbe70f5">{"x":{"visdat":{"accc3abc843c":["function () ","plotlyVisDat"],"accc2e8d9d44":["function () ","data"],"accc534ff33c":["function () ","data"]},"cur_data":"accc534ff33c","attrs":{"accc2e8d9d44":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"frame":{},"type":"scatter3d","mode":"markers","marker":{"size":3,"opacity":0.5,"color":"gray70"},"text":{},"hoverinfo":"text","name":"Neighbors","inherit":true},"accc534ff33c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"z":{},"frame":{},"type":"scatter3d","mode":"markers+text","marker":{"size":7,"opacity":0.94999999999999996,"color":"crimson"},"text":{},"textposition":"top center","hoverinfo":"text","name":"Targets","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Word2Vec 3D timeline (aligned windows)","scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"legend":{"orientation":"h"},"hovermode":"closest","showlegend":true,"xaxis":{"range":[-4.9152287058214617,5.2737524997035896]},"yaxis":{"range":[-5.0303427785496124,5.7993221568827629]},"sliders":[{"currentvalue":{"prefix":"window: ","xanchor":"right","font":{"size":16,"color":"rgba(204,204,204,1)"}},"steps":[{"method":"animate","args":[["1990-1994"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"1990-1994","value":"1990-1994"},{"method":"animate","args":[["1995-1999"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"1995-1999","value":"1995-1999"},{"method":"animate","args":[["2000-2004"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2000-2004","value":"2000-2004"},{"method":"animate","args":[["2005-2009"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2005-2009","value":"2005-2009"},{"method":"animate","args":[["2010-2014"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2010-2014","value":"2010-2014"},{"method":"animate","args":[["2015-2019"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2015-2019","value":"2015-2019"},{"method":"animate","args":[["2020-2024"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2020-2024","value":"2020-2024"},{"method":"animate","args":[["2025-2026"],{"transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true},"mode":"immediate"}],"label":"2025-2026","value":"2025-2026"}],"visible":true,"pad":{"t":40}}],"updatemenus":[{"type":"buttons","direction":"right","showactive":false,"y":0,"x":0,"yanchor":"top","xanchor":"right","pad":{"t":60,"r":5},"buttons":[{"label":"Play","method":"animate","args":[null,{"fromcurrent":true,"mode":"immediate","transition":{"duration":500,"easing":"linear"},"frame":{"duration":500,"redraw":true}}]}]}]},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2.5155116131969839,1.5838457548742333,-3.1105143558138111,-4.4520931964794137,1.3624884718747925,-1.655029468079356,-2.3449363592954411,-2.8604034883813516,-2.7140416099098945,-1.8226917602221835,-1.309983540466408,-3.1063383976120829,-2.5137638915487788,-1.5897643801912897,-1.5893607361063982,2.5180956304767066,-2.1597040944350572,-0.48059071601067821,-0.0087608442913168615,-1.2618208314319297,3.515349813894086,-3.799861624109993,3.6571277794759895,3.5655039140712237,2.3325823829300769,0.3753321663162591,-1.2795475354908337,-2.6418879578263335,-3.7323356057034314,0.51140328127500634,-0.94113582619290725,-0.15349152103467587,3.0975395151630316,4.8106169903615417],"y":[-0.74741364665600263,-1.5906216995849816,-1.3766778819682493,0.74868199458484175,5.3070646598176552,0.25512462679794656,-0.56417605030108819,1.5008409617024105,-0.028173579762132809,2.7089690983294763,1.4560988007056956,-0.98855775812311053,1.3326442182945724,-3.1056663049733908,-4.5202864322364293,-0.78573556745046025,-3.8502952557092689,-1.7469970360772447,-4.5380852814845047,-1.7834666824444176,-1.0651449964739919,-0.93833783590848907,3.1475962478443451,0.88529356116717506,-2.019853240214319,-1.6977046187033149,-0.77140826184260447,-0.37258840400999038,-2.1202577198223778,4.4223045018987603,4.7342713324907759,1.7192115867192452,2.6782511333839278,-1.0448115835298908],"z":[-0.8378923368495288,-4.795504440007738,-1.1423653702915677,-0.036884733362581579,0.1353044537252022,-1.3587297458051715,-1.6649466684994441,-0.81540472408939391,1.5747008508400688,-0.1320398406222015,-1.798366293756869,-0.30183326846783387,-0.77868551682614451,-2.3155883764728449,1.1604805946174206,0.87294978618889651,-1.7008970520387348,1.6280365112008204,3.6004346600520063,2.1004991371788773,1.3788587007577444,-0.35370718636698173,0.14395082361288983,2.1384842750668898,-2.7432627089303656,3.9452588112845408,1.1627032214269746,2.0569348648567614,0.45915183062338061,0.82398591777425578,0.38425289198684615,3.4734790751591076,4.6871779709748305,-3.3301928956322238],"frame":"1990-1994","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","darios","hauert","doppelmord","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","blickwinkel","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.3138556953373777,0.30314154213770095,3.4805102955139704],"y":[3.0050253003820542,-3.919717890889824,-0.81845027113676116],"z":[-1.4034991170835334,-0.073632046730187709,-3.2759745116690828],"frame":"1990-1994","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Opfer",null],"textposition":["top center","top center","top center"],"hoverinfo":["text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"frames":[{"name":"1990-1994","data":[{"x":[2.5155116131969839,1.5838457548742333,-3.1105143558138111,-4.4520931964794137,1.3624884718747925,-1.655029468079356,-2.3449363592954411,-2.8604034883813516,-2.7140416099098945,-1.8226917602221835,-1.309983540466408,-3.1063383976120829,-2.5137638915487788,-1.5897643801912897,-1.5893607361063982,2.5180956304767066,-2.1597040944350572,-0.48059071601067821,-0.0087608442913168615,-1.2618208314319297,3.515349813894086,-3.799861624109993,3.6571277794759895,3.5655039140712237,2.3325823829300769,0.3753321663162591,-1.2795475354908337,-2.6418879578263335,-3.7323356057034314,0.51140328127500634,-0.94113582619290725,-0.15349152103467587,3.0975395151630316,4.8106169903615417],"y":[-0.74741364665600263,-1.5906216995849816,-1.3766778819682493,0.74868199458484175,5.3070646598176552,0.25512462679794656,-0.56417605030108819,1.5008409617024105,-0.028173579762132809,2.7089690983294763,1.4560988007056956,-0.98855775812311053,1.3326442182945724,-3.1056663049733908,-4.5202864322364293,-0.78573556745046025,-3.8502952557092689,-1.7469970360772447,-4.5380852814845047,-1.7834666824444176,-1.0651449964739919,-0.93833783590848907,3.1475962478443451,0.88529356116717506,-2.019853240214319,-1.6977046187033149,-0.77140826184260447,-0.37258840400999038,-2.1202577198223778,4.4223045018987603,4.7342713324907759,1.7192115867192452,2.6782511333839278,-1.0448115835298908],"z":[-0.8378923368495288,-4.795504440007738,-1.1423653702915677,-0.036884733362581579,0.1353044537252022,-1.3587297458051715,-1.6649466684994441,-0.81540472408939391,1.5747008508400688,-0.1320398406222015,-1.798366293756869,-0.30183326846783387,-0.77868551682614451,-2.3155883764728449,1.1604805946174206,0.87294978618889651,-1.7008970520387348,1.6280365112008204,3.6004346600520063,2.1004991371788773,1.3788587007577444,-0.35370718636698173,0.14395082361288983,2.1384842750668898,-2.7432627089303656,3.9452588112845408,1.1627032214269746,2.0569348648567614,0.45915183062338061,0.82398591777425578,0.38425289198684615,3.4734790751591076,4.6871779709748305,-3.3301928956322238],"frame":"1990-1994","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","lebenslang","zurechnungsfah","dreifach","darios","hauert","doppelmord","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","blickwinkel","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.3138556953373777,0.30314154213770095,3.4805102955139704],"y":[3.0050253003820542,-3.919717890889824,-0.81845027113676116],"z":[-1.4034991170835334,-0.073632046730187709,-3.2759745116690828],"frame":"1990-1994","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Opfer",null],"textposition":["top center","top center","top center"],"hoverinfo":["text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"1995-1999","data":[{"x":[0.10936969814345078,-0.64870166584989075,-2.3993771217788606,-0.44502575127063088,1.4966037574332463,-1.3569803154745752,0.29135822423751045,-1.8818998479556948,-0.035582959276341933,-2.1967857844991832,-0.42574052960431513,2.3849016471406208,-1.830162651855034,0.32689381811294721,2.2791849052261433,0.3059580799415566,-2.9834192408635087,-3.1769027416989251,-0.028140644909140311,-3.9891975163811582,0.42172157257884602,1.3327463403857476,0.19027520909084611,1.9870093655876662,-0.40640069436440024,0.77883653177203638,0.79280060062908619,-1.3193567092036103,1.3737404242843898,0.88640446876528245,-0.66609963046966381,-0.53428200567177542,-0.62266249766044668,1.6066533655806789,0.18827862687495239,-1.7164754017875306,-2.9635945032139688,-0.97401645175272289,-0.8540655439065058,0.34926334995986491,2.6306336175647944,2.2820553269101476],"y":[0.65934439918266252,-1.8390188584269362,-1.5352947433760977,1.4235164844294017,4.1247814054918726,-1.2230832567860577,0.050617348011981769,-1.4639601162264944,1.0068733768629579,-1.8629272283090013,-2.0286699345003436,-0.52027981337262841,-1.8119496742940302,-0.97562268498063165,-1.6113559767561412,-0.64109987029508797,0.85863620018134257,1.820134128052264,2.4591167330307959,0.15906431352774411,2.5377122156695373,3.8001497550346524,1.216106167636581,1.3343073110672703,0.6274862564950513,3.6661081858507405,-2.8081953845860013,-1.366877526762283,-1.6961506183899457,-2.2956741348352421,-1.3614796453845575,-3.3852525364501598,-0.83161382940762152,-1.7918829940918495,-0.13097684811561644,-1.0731396737501666,-1.0020742369467415,1.2781824452595243,1.8825625245756279,1.1055815866091254,1.1943480137477083,-1.5337618460306939],"z":[-0.11787924283738606,-0.95768904359726892,-0.70547358903477808,0.89693021919170768,-0.38310712326239021,-1.0401753493175931,0.40698497582052601,0.96194024624420571,0.7275918260462485,-0.96674728869159055,0.26568541648606236,0.59079332588597744,-1.7808773148242074,-1.0799517981029052,0.7108968999544315,0.21096339500212843,-0.8315982741212613,-0.29825833309134292,-1.8201818538799095,-0.65809219114896944,-0.3283498093736143,-1.4481398056599413,0.66772589041747843,0.063470990320114898,-0.7953101763656989,0.31605699347247396,-0.6487326374140715,-0.11178757586979489,-1.5516237842199248,1.1502594210038506,-0.079066166303357222,0.71397529639433288,-2.0622850541572775,-0.97878915477182149,0.33121006905561751,-1.9863809853275909,0.075854447376023121,-0.40749856832346038,-1.5954168754049249,-0.30334728380646253,1.8639190546347535,-0.75846230429669315],"frame":"1995-1999","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","sexualmord","mord","serienmord","hafturlaub","serienkill","morderpupp","kriminalgeschicht","unheim","gifthex","katt","angehor","tatern","richtete","handelt","morillonstrass","kirchendirektion","gertraud","opfer","verbrechens","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-1.8048670311542552,0.055132813804587406,2.7061458433897903],"y":[1.9281016205609107,-3.27366985596553,-1.9266803262652792],"z":[-1.8464748325010707,-1.4666415690026804,-2.5136367367145072],"frame":"1995-1999","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Opfer",null],"textposition":["top center","top center","top center"],"hoverinfo":["text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2000-2004","data":[{"x":[0.79729082547799146,0.25319764626499774,-2.8726076249229835,0.4217153323221694,1.3517418081385939,-1.3336179894915743,0.13402956274368527,-2.2911314945269479,-1.7726381249395831,-3.1186055672815676,-0.58047985014306225,0.34710939290855297,-2.5510323321221313,1.3656102314036755,3.1972746587826095,-0.34798619062414154,-3.0100491417040134,-1.6490531796870818,-3.0187957470464735,0.035140503075693448,2.296977601053003,0.15467608118685952,0.55888147025364787,1.4672020094464917,-2.682274182749576,-2.4788603928283326,-1.8003594362817619,-1.7547573048884204,-2.764677293302781,-2.0839445312184082,-1.0209775121402993,0.51640880434809111,0.68954438414299624,-0.73763845426757324,0.21846609391909227,-1.4434592877429111,1.8120826455329788,0.50213973906426868,-1.0724800700924855,-0.4129370123897334,2.8001394440244431,0.29444701518075223],"y":[-0.12448603738317228,-1.8245988586992468,-1.8036974576523106,1.1172035133734741,2.387401752889923,-1.5693539156764034,-0.22842737985767667,-1.5092942677173351,1.2808458455238914,-2.0135637321099158,-1.5600349887388543,-0.87690771414017887,-1.5371156743657215,-1.151762484799477,-1.7305195117534493,0.41470489554832074,1.3812905409488003,2.7252282895222133,0.046635087605522027,3.435047919202352,1.5494261751113496,-2.5024976228423359,-1.3753560633732476,-1.0851718870868561,-0.29472535214081058,1.6948039890729925,0.899166669147345,1.0600291448505181,-1.2409019014859983,0.19107854095491492,0.85227792633820088,-3.3563582896858577,-0.39332233475446993,-2.1920962689512411,-1.908924105173669,-1.1527716574729365,-2.5348330187147257,-1.7678688016821869,1.6063385028592811,1.936230977414239,1.4023912312683637,-2.078835493665522],"z":[-1.7854045256533457,-2.3119917535059247,-0.77350722099724312,0.90513434380776758,2.9126582582919225,-1.4781021427420351,-0.74764152024780073,0.82075802134051257,0.28176791321996186,-0.11420777918606237,1.2234579279412239,0.79605056857756018,0.015841089378771125,-0.59964128706356634,1.9946180262560038,1.6208544792932589,-0.28579658511795991,-0.8670122234871559,-1.0650889265444143,-0.80176573054566069,0.85543228147839712,-0.70543846726731751,0.24370655586527862,0.53318880881276687,-1.2149290963869317,-0.5443710674485116,1.0901723016421307,-0.80799722353220138,0.013378350566075529,0.9721523898869292,0.06266458174176627,-0.89195135254714042,-1.0547092163708063,0.22650233892125288,-1.3735040780811267,-1.1528799548095843,-1.2505632625997236,0.52909830580285555,-1.360681939105876,0.35946783494789658,2.1690583942636663,-0.67466069655068772],"frame":"2000-2004","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","mord","serienmord","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","mordfall","mitternachts","serientat","totungsdelikt","morders","fahnd","ubergriffe","tot","identisch","korperdurchschuss","drogendirn","weggedruckt","hinterblieb","mordseri","kriminalfall","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-2.2343244912481319,-0.55457680402469967,2.3344028903792031],"y":[1.4328834716980776,-2.5286317103535629,-2.497134692780445],"z":[-0.86228391407547678,-1.6415963269202518,-2.0074643935342533],"frame":"2000-2004","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Opfer",null],"textposition":["top center","top center","top center"],"hoverinfo":["text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2005-2009","data":[{"x":[0.096401172960826911,0.21102148726419398,-2.6014939239214079,0.88233207328759666,1.2443369564408169,-0.5823105541091067,1.2531551704862576,-1.9867601626557858,-0.0084255609260426769,-2.8878921059507348,0.34072859039906706,2.2215007239403342,-1.5400402707621423,0.47219916215070223,1.6709225671106596,-0.85421746723931247,-3.422568524743431,-0.68955282839374088,-1.814091161654799,-0.06411026341426207,2.8258181213577416,-0.43920150835227562,0.81709762793711305,1.2065523678732661,-1.8986688386295734,-0.83173342268306616,-3.0650498950433698,-0.62264243725284973,0.8568309259608734,-1.8983394292277618,1.8826168960975453,0.35243689718275989,2.9798510716069795,0.34297046607624782,1.0637876664997894,0.45260715726967998,1.7440787886142333,1.1534479590352398,1.8683321447373582,1.5298414387963426,1.35817162073374,1.9727382012278361,1.4250772973556669,1.7023252089745602,2.8576234881231222,0.40823721003703595,-0.1257450505810008,-1.5030260372576405,1.5077837520135031,-0.84454682898037947,-1.1894161066381448,-0.32241706210491711,1.6986591277079064,0.89681971452970421,-2.7044805364670448,-1.2208104351720672,0.45326983421428918,1.8991532003352933,2.7112939131067484,0.38319797528407479],"y":[-0.27400176465883741,-1.711710426979258,-1.499877304385308,-0.12620781810673792,2.5100708853466731,-0.52229102628661284,-1.113983660013719,-0.98662481874651298,0.16522035352674719,-2.2558170290178707,-2.389766974342407,-0.83660020454872908,-1.6070713810289277,-1.109267474618558,-0.22495214216971732,0.13945014795279723,1.4232578651344703,3.0690805285214506,-0.35777895742129473,3.7079946485029058,1.2705038269739439,-1.7199288937827699,-1.4278441323973787,-1.78765357930657,0.0018824685227896104,0.72618523771081378,-1.4522344791522201,1.979028361192207,-1.2206394777312526,-2.3288939416373955,1.1431511520691355,0.80552083098205218,0.060395368867588665,0.77418005334763307,-0.33450680123374871,-2.0864559287905839,-0.93044260458855244,0.10246480647327567,-1.0492595293304408,-1.9846199677907463,-3.2478965893382119,-2.6713975638400718,-2.4839034210102651,-2.9147947920605923,-2.0882983989529951,1.172880070639013,0.1419434275351078,1.9443709800996305,1.0033770483089004,2.4406496726703026,2.075491036331222,-2.7886694229064606,-0.98387652273399584,-0.73307936591897171,-2.583732778801342,-0.65803829418001436,-2.6447302578946337,-2.2252325795639627,1.3552318624181523,-2.5771603056836745],"z":[-2.7234703602938741,-0.75020202994586838,-1.3592606985668292,-0.38020218573580145,2.439776333631841,-0.58023571132248208,-0.6019905355282027,0.65643370288173675,-0.27861484688488775,-1.174370847575628,0.16377764516124357,2.5030046546412223,-1.2407151738134032,-0.64573223526574897,1.1845040158367062,0.41782236272606277,-0.49212236876826143,-1.3472297824450932,-0.85009428404842857,-1.3003761257066411,1.1737960417012392,-1.4879684378152926,0.67059795777853271,-1.1020897622516734,-1.5707394653046785,-0.39039774023842588,0.13897956328997685,-1.7209587712037078,-1.6414589128259693,0.77941043549634959,-1.176334273566731,0.40297329903343843,-0.37654722207330898,-0.96911857280024061,0.18089373574304959,-0.71839346421593697,-1.2591653317250202,0.40077699097199393,0.33363515765486951,1.4213824884530801,0.23520343149173439,0.76532281500260768,-0.10887974962827748,-0.073459177221588456,3.0572327691469097,-1.4321902737659655,-0.72832355807223426,0.3809491915061734,-0.88890585926603372,-1.8439513381075741,0.90510369249027844,-1.1524721677908321,-0.46181767422779851,-2.6333715373678079,-0.2500673064045601,1.3130839707780859,-1.3716687997294661,-1.5628178865901392,2.5518305505748065,-1.3357080470129017],"frame":"2005-2009","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","mord","serienmord","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","serientat","totungsdelikt","fahnd","monárrez","tatbestand","juárez","frauenhass","vorher","araceli","landesdurchschnitt","madchennam","lebenspartnerschaft","todesfalle","sextourismus","aufschlussel","jahresdurchschnitt","heyz","familienmodell","gendefekt","unterschied","nordmexikan","mitternachtsmord","serienvergewalt","ciudad","mordseri","kriminalfall","handlungen","fielen","verwandte","dritttat","doppeltotungsdelikt","gewaltopf","widerfahren","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-1.3992784338988857,2.3243800864299939,0.1301680725815397,-0.32326337760841523,2.7678144383785459],"y":[1.4774380678257204,-1.6686935461034458,-1.8780379315328704,-2.5999128061567904,-2.5378344749604214],"z":[-1.2327496991483804,0.64662605122293837,-1.580641897734075,-1.9987452267682966,-2.6958527829081018],"frame":"2005-2009","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Femizid","Feminizid","Opfer",null],"textposition":["top center","top center","top center","top center","top center"],"hoverinfo":["text","text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2010-2014","data":[{"x":[-0.82683276246400628,-0.56668660275719673,-3.0381955507202387,-1.9283707732390363,2.0502861837383581,-1.3041351840085791,0.082224374754313739,-1.5265193719687136,-0.49556787534389313,-3.0044539306028057,-0.77281636796110065,1.1037140444346072,-2.741834374490038,1.4256531605739753,1.461293381298012,-0.13333554231576722,-3.2772484183234134,-1.8640517565603407,0.44401018156270267,2.2241350276500222,0.69469346366892926,0.32824082605332061,0.58917979180486724,-2.340536859778501,-3.1766672686009985,-0.84198478884430861,1.270071021029191,0.912573234671339,1.077665368876213,-1.2132427225606015,-0.89975035760439404,2.1046775461002571,0.75596652870403602,-2.3999870142605921,0.85800464795738773,-1.1468983188087156,2.1348784660870681,-1.3494154535969762,1.8466161318803251,0.98129271589901557,-0.16920526562855062,2.3128697806951735,0.71063335591502164,1.93525439126226,0.38948994610759924,-1.0903198116330342,0.087056608611927697,-0.87938907029672786,-0.098322087239958722,-0.0024207039464630713,-0.90178405403194728,2.7075595723797901,0.64894578361577548],"y":[-0.5887336118587827,-0.93140601820970137,-1.719584914328566,0.68037048436778447,2.404052100064487,-1.9160769751931916,0.53433191984990902,0.21514544075902914,0.22717900969239208,-1.136562072396669,-1.5616793080071616,-0.21188861094449343,-0.62363324904331052,-1.8152439888412928,-0.88622177904138222,0.020228308225605392,0.99790704810023623,-0.42717540815487737,3.4594630595959202,1.5908090138826216,-2.1484855066425945,-0.75334017491447669,-1.0647510296448617,-0.38784851116441471,-1.5498816163834965,1.8694841297371319,1.4566606258542096,1.7312120735238561,1.6162898615226682,1.8618670932388268,2.0142749370613862,0.44158939152591214,1.4270623971842735,0.52010805049940745,0.82915551698856749,0.76112725962932426,0.35272029756669543,-1.0636782033148138,3.7094863135943124,1.2291547342513227,3.5622125361526584,2.1726496592184787,0.76927087987619069,2.6411552401669605,-1.6280453646280659,-2.5628366105459053,-0.77945002356739101,-1.5500080370533635,-2.8636165110094356,-2.6714933827484715,-1.2486081029457476,1.7792721466559391,-2.1934453000780283],"z":[-1.4815080037690873,-0.86726198671609289,-0.50965358421415585,-0.77021529767691421,2.310439094614825,-0.48653324801278991,0.036185802596620367,0.32189624875973172,0.38417848895700629,0.51890258578455439,0.33848161274313437,1.7311467310143864,-0.3679171155132156,0.90522306942918762,1.8908248176210205,0.72086879236913104,0.41991419707866129,-0.77720510441004254,-1.0991846137566834,0.21910834013906869,-0.88796025398465617,0.56267642278545971,0.33502354912492477,-0.10624196355041438,1.2262700199664753,-0.97249577152483335,-1.4117213689486918,-2.3297914526226737,-1.8041544586433658,-0.0049137703027691141,1.0371297999408235,-0.96548298522662446,-0.049682783988243231,-0.084474847142727641,-0.53628909277130177,-0.77405103218528515,-0.45770351060406489,1.038501510591832,0.71140942837566801,-1.6594400349348462,0.48302204459372144,1.5383079882730859,-1.7876580596095815,0.9309967843867023,-1.4850572625022269,0.18866175008761643,-0.48134243994201042,-1.5228131790678823,-0.30064646002886986,-1.6030035401536784,-0.93729454764118736,3.8575933092237418,-0.80506997653087686],"frame":"2010-2014","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","mord","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","juárez","nordmexikan","ciudad","mordseri","kriminalfall","nordmexiko","drogenkrieg","verbrech","gewaltkriminalitat","horrormeld","michoacana","kapitalstraf","marchenstoff","indianerinn","adventkill","feuillad","bandenkriminalitat","revert","stichverletzungen","hinrichtungen","geldgewinn","eingestochen","hws","anzuzeigen","armverletz","tout","hauslich"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-0.59563565191484835,-0.2762151602277827,-0.43551895381037231,2.0254829353625539],"y":[2.9538214316386302,-0.40497473088233665,-2.9295458883257779,-2.1779543361137015],"z":[-1.0457781468834908,-0.24172137206769848,-1.3963871356093838,-3.2235483086419157],"frame":"2010-2014","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Femizid","Opfer",null],"textposition":["top center","top center","top center","top center"],"hoverinfo":["text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2015-2019","data":[{"x":[0.78511556111915459,0.030596453007584772,-2.1622714489064196,-1.1070436773840044,0.56971432783925524,-1.8320360499997965,3.2509272677113739,-0.66896396555546056,0.87951021285964692,-2.9935276434681262,-0.36432946209334299,2.6343277498509781,-1.9200506218375533,1.1431071461579581,0.60231861651385332,-0.80358250122657715,-2.8477191485959947,0.54859677377416005,2.7619687292285131,0.19724362354273361,0.59254141978388186,1.4429711643086982,-2.7553774336411871,-2.8697701497445771,-1.4603792969921432,-0.94582694414563884,0.25259868384400835,-0.56288415833026118,1.6287776601675652,2.898029924539947,1.2324521644041813,1.2262269219176327,0.74985260089514949,-0.58515394612331373,2.317080014277427,1.8886155045122388,2.5580801844889489,0.32229217234309404,0.65897150878891997,1.6071099285919166,2.1522981697430899,1.2148940158331134,1.2231500795128594,1.8904842658684282,1.8929236503674089,0.59855632708823903,1.1739098161567565,1.9829081824300947,-0.78136483925352673,0.23319655777450288,0.44743505132765332,-0.42508178809977709,-0.55841590315983325,2.016613420439807,0.15892955042169005,0.77738509430785896,-0.34851925422446717,-0.74599895889905166],"y":[-0.31275706338837866,-1.619718123729551,-1.6064531083377172,-0.15172545264928147,0.40643579480398756,-1.0665071380042022,-0.79474606008199344,-0.6579301542296625,0.48285220732134571,-2.0005615851350771,-2.047351481635316,-0.525479551449194,-0.9828730565916951,-0.63559289306519418,-1.1921679745916034,-0.39714926508722681,0.75112804121671572,2.412484800724839,1.6025690246943212,-1.7965429331333156,-1.1528799027439989,-0.79637263126547297,0.6981365458197949,-0.94774200275224452,2.0408918609324131,2.7379197192417766,1.8512121683635367,0.8034092041104024,0.61867323865570534,0.51840283514993735,-0.47344194557983971,2.3677967549208208,-0.92261326172616542,0.0064412108389978627,0.7437403540019436,1.6388623681565584,0.84543408457873837,-0.66429528590437581,-0.85475745987072971,0.72479353565945537,-0.2145013952768417,-1.4825518742754624,-1.3054977677237647,-0.58462402042891415,0.94417450533869074,-1.5938700157664252,2.5592925038732353,-1.7313249857884352,1.3710181293470862,-0.93146766773581258,-2.8864849653156597,-1.0681711958710609,-0.99343342894121822,-2.7272813231240756,-2.7026987152233928,-2.136662173853785,-1.1806282997259936,-2.2849097780713872],"z":[-1.8163376230432031,-2.1227390532427659,-0.98969609798576286,0.044284988745687537,0.76632427442881013,-0.50569007279663569,0.097358305940013753,-0.46206568551144428,0.16144657706586182,-1.1423442623742937,0.68057283631799503,2.0266238939915064,-1.3671908843498275,0.33298449125992108,1.0724055920155846,1.7470199675523967,0.11678210678047407,-0.61584046634187628,2.1086151657558556,-1.3130322928360207,-0.28542531824447209,-0.4711463209611666,-2.0760541223063251,-0.24598094993931013,-0.4968153884905479,-1.2327202910114952,0.37275769785953317,1.4983492486165992,1.6654016094116779,1.6007442238184406,-0.15318141095481685,0.86622704218796498,0.59266327708007116,0.43607026130781201,0.66538950663321472,3.3060063163810121,-0.29632720071084662,0.74435854730224249,1.4141999868456501,-0.90426023092979557,-1.0746175217732075,0.8192575560130152,0.1911160766245342,-0.25234569189281336,-0.26588294404178631,-1.6827665431640644,0.28315262890849624,-1.7573871708643651,-1.4869178498715014,-1.1913185438978797,-0.46657932790089646,-0.18659384234657347,-0.47608757660186934,-1.670863079183081,-0.56629823065738116,-1.6279466666152138,-0.16010249406943128,-1.0519005087132871],"frame":"2015-2019","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","zumthema","internetprasenz","schiappas","anprangerten","bouqueval","verwedelnd","frauentot","frankreich","tout","menos","regierungszahl","lohnabbau","niunamenos","argentinierinn","femizidin","machtunterschied","geschlechtsselektion","tesis","hauslich","pisarenko","gewalt","zypernhat","verbrechenshandelt","zufallsopferbei","griffschale","hinam","eilten","fondserricht","wehrzwei","brustnach","minderjahrig"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[-0.07121036176501512,-0.24872559860268786,0.38609843840136426,-0.69060699487499855,2.8857856807910753],"y":[0.66354617253058723,-1.1810323943862941,1.1327620864624088,-2.4747476119862806,-1.2590282275735656],"z":[-0.63999638574365569,-0.12826789491306942,1.1730002712249106,-2.2685268649357822,-2.2988991556107692],"frame":"2015-2019","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Femizid","Feminizid","Opfer",null],"textposition":["top center","top center","top center","top center","top center"],"hoverinfo":["text","text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2020-2024","data":[{"x":[0.59087422699363856,0.79035527588083188,-2.2433414588959293,0.40118901482775621,1.3919076589639792,-1.612694920541361,0.90232066626548124,-1.4292110004357799,0.58020310768553118,-1.7118945385637894,-1.1113795551247108,1.4480049772036661,-1.9584241087208114,1.5560955495950992,0.67497104456212242,-1.584701194853356,-2.4520110372496573,1.3831482641741903,2.2969829650645459,0.17278553285188511,0.5589969644661934,1.8168417517628095,-0.42515674968322298,-2.740190063968905,-0.90811163047048926,-0.82122744873064735,-1.4875079287963506,0.57416250987433481,2.4362099944619082,1.8796905715042609,1.4704842611762843,1.8293127496082529,1.3621001969586732,1.6148109405384719,0.97678541426092624,1.639430574468276,0.079030474097175035,2.021025928470721,2.2074494904703119,2.2047702216497886,2.5692178769082199,0.98647507359332576,1.7185199393409056,1.5929578395413106,0.88284187897056443,0.57274418102728786,0.48079431188254673,1.3457902553482077,1.1612102835810196,1.2276233036795787,2.615690175247519,2.6306744432900775,1.4254811520538699,0.96255395217264961,1.6500648502889841,0.57541244740947195,1.732491487376316,-0.37150527156758684,0.95405910431928087,1.2442783556938535,0.34017621090214117],"y":[-0.84117834630320087,-1.6652783780885116,-1.0921066582619861,1.1046148475434376,2.4130923613659743,-1.226644460422152,0.10090351607191603,-1.0500260192911302,0.72801142995712143,-1.1639349280720761,-1.8169380213751269,-0.85281222668501355,-1.1781786850239586,-1.0955074332909609,-2.0266442601309453,0.26722960744345409,-1.2076695198391967,2.7864634885374673,1.8321201058965182,-1.1938871738919759,-1.1869333340813455,-1.2411934714224668,-0.58131319179049401,-1.032195764961539,1.3067863746466315,1.6340164250267708,1.9018915429282859,-1.4595958847815715,2.2085821951342037,-0.26331292386846289,-1.7980793593362083,-1.5047554343731899,-0.70783146525366936,0.30246252046265037,-0.57470134791818406,-2.283077171670473,-0.31374053033518817,-0.32880113882691742,-0.2752636384254033,-0.99336955686047468,-0.60669575597966052,-1.2191138451160168,-0.56174847796043959,-0.79539198876730466,-1.4616343952960313,-0.59007653706561136,-1.8131392265626454,-0.032896362661471015,1.7135657535747821,0.4097650575307748,0.88263961041684402,1.014213075873857,-1.8897006979042157,-2.0851475837534998,-1.2799111611859624,-2.1384598012521083,-2.3330514548825412,-1.4893358897474396,-1.7728914725152309,-1.6406151343652497,-2.0806068142477958],"z":[-1.9225882903135032,-1.3899906088824201,-1.1483562803679868,-1.4701255871562073,0.18762338858897998,0.6011565447542353,-0.38488264899640839,-0.29909923993041232,-0.38128716335110791,-0.43344256959639577,0.95675738674749566,0.20772475056179709,-0.088248491265769918,0.91267955002988621,0.60332809804251442,1.5820618990546416,-0.89120073487446694,-0.49290880201843673,1.1032848010674203,0.049027207891529978,1.3485164622571799,-0.25817600779800737,-0.76385417022532098,0.076687343678910905,1.462741427246258,-1.0109978838482363,0.79981802424718251,-0.32322138784999666,1.5961912965478948,-0.65319348554562173,0.26223872540136728,-0.39728580473797387,0.69084938686349795,-0.58425687589248021,-0.21569427683055348,0.53889100457697348,1.1381354216846677,1.3052105352188192,1.061014825689625,1.1340887040055485,0.2920365037230771,-0.48484346902054509,0.55243463647228674,0.92246790683425828,0.15226676765741989,-0.32303615563281207,-0.7092567966837996,0.50463782716974004,-0.54897888440578801,-0.25172960456506788,0.70172641445185668,0.1118944909649946,-0.72218792302374935,-1.2856705250345601,-0.87282781117980168,0.17858159646680585,-1.3777932476659005,0.24682602369422857,-0.75384491075179516,-1.1935920352539207,-0.84169198783302035],"frame":"2020-2024","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","frauentot","tout","menos","hauslich","gewalt","videolaut","femizidzuerst","kingein","geschlechtsspezif","angezeigtd","frauenwahljahr","toutes","stopfemizid","rechercheprojekt","femizide","statistiken","gruhnwald","frauenmordezwar","osterreichwi","auslandergewalt","gureldeniz","bordierd","buchivon","behauptetein","totprugeln","menschenhandelbai","misshandlung","darbringen","11’508","guggisbergbabys","berechtigtdi","gewalttatrombach","massnahmenregimes","grundschulmassak"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[0.74513799375034317,0.63281300745842084,0.80376177227582823,0.6823502866783745,2.672031826216172],"y":[0.48936657094145891,-1.3467035529490881,0.078940241590859037,-2.3017720056268609,-1.8638324216052844],"z":[-0.91155868676288121,-0.083481327288303597,1.0958171532203631,-1.2157021314328424,-1.6785598791800007],"frame":"2020-2024","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Femizid","Feminizid","Opfer",null],"textposition":["top center","top center","top center","top center","top center"],"hoverinfo":["text","text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]},{"name":"2025-2026","data":[{"x":[0.70198929204792826,1.3546818938452629,-1.8119694952435415,-0.79949316058224251,1.1317860910846793,-0.96079444482947107,2.1192828202525189,0.22554133723879569,-0.55430231311568778,-1.2160071256979903,-0.05230986876642485,2.2748616354686502,-1.240655704138897,1.4347631631603597,1.6457477298587295,0.44861723933716641,-0.90102933387694217,-0.060711003569791179,2.468182364011402,-0.62416840101078586,0.45298653008395334,0.77675116728849991,-0.55861192413085914,-0.99621923641955568,-0.40181392514389491,-0.15259497824140275,-0.1168949804211917,3.5711062761148753,2.8015353946754713,0.28043124853118429,1.1753774358081319,0.51707623601052788,1.3341005441762466,1.3711408728104912,1.0808451957993297,0.66709442208375636,-0.75573709014226342,1.9061076478626136,1.1393900027821902,2.3127026630544658,0.62964348073793153,-0.86203966774797736,0.71927849695599266,1.4220997944735982,2.8093465991667883,1.2927668590548902,0.95346880901450481,1.7952018099012201,1.3882841335234544,0.69110685406411032,0.47842293270861735,0.5403424849022036,1.4504876749247184,1.3775809343472236,1.1227031091381476,0.73751856765437784,0.67620383709254583,1.1654311768541894],"y":[-0.092913150871024142,-2.2455276322020259,-0.64018090794037941,1.1736965118404392,2.0033082016957202,-0.33604771351257795,-0.065265740686453966,-1.0438604244644847,0.0075887028439092031,-1.6913741043966315,-2.0001051856679517,-0.095299345566932189,-1.7278109817460381,-0.79922320871872177,-1.3993570758496283,0.70648892671344055,-0.82663425188996587,2.2936945928882788,3.137225611184836,-1.1908222998525706,-1.0851047163600829,-0.84039764127018513,-0.88780320000475021,-1.8746714322115854,0.85391055250839798,3.4080172790086833,2.2452358193761466,1.4141838472194115,-0.38339438437611006,-2.6109651354026893,-2.640295634074814,-1.8479695119594701,-1.9091381538086651,-1.122433392237997,-1.8506120049252475,-1.0006756163583539,-2.2179054970124175,0.014481597549214714,-0.94301450105781692,-2.1566043881081427,-1.4418581340509999,-1.9088520450024118,-1.6881694080498713,-2.3002332008845094,-0.75495274067941809,-0.974920876695758,-0.80362311378723883,1.239813295857914,-1.576254647159953,-0.74478481090000936,-2.3494744915831554,-0.62306471638632543,-2.0470845311788897,-0.15263078371366659,-0.84933132691061386,-1.3714180876506026,-0.52477141172320896,-1.6769567965275927],"z":[-1.4494248321642678,-1.8379301466293416,-1.0927507467748057,-0.35958826846930514,1.2306742479058186,-0.9383866231334258,1.2071603548352172,0.18435910572518757,-1.295131917089273,-0.13697888800351252,0.28356122193836009,0.21945070383113255,-1.1273386063159576,0.15201129751403547,2.3817862948767186,0.55975273625702637,-0.56318181842658521,0.16073979833732552,2.3844492779263469,-1.7460957660278611,0.30933996508636696,0.85812438434139904,-0.021902444421858121,-0.65318930988522972,1.2168240105737573,0.27292893341715802,0.51293836744182608,1.6204650725668672,0.038066425240541615,-1.1245302771396222,-1.3303065474637317,0.053428251513770515,-0.059374729615728664,0.49472279236074035,0.90435322983598743,0.33136863476230011,1.1444622756693665,0.73114079307905389,1.1662197867347093,1.3544532942678751,0.36947158828681392,1.5738524204425179,1.4080124318091043,-0.34168586507768317,1.9211653022995208,0.051865215700346565,-1.2620244233477238,-0.80970762431272092,-0.058418251098205011,0.5350067362647013,-1.1628409162528135,0.41609889595781363,-0.39670576099443511,-0.88782691935564473,1.2215521028519787,0.049071652033631105,0.19843642214568821,-0.51761735986674096],"frame":"2025-2026","type":"scatter3d","mode":"markers","marker":{"color":"gray70","size":3,"opacity":0.5,"line":{"color":"rgba(31,119,180,1)"}},"text":["peinig","misshandl","tat","zweifach","kriminalfilm","taterin","kaiseraug","zurechnungsfah","dreifach","straftat","genugtu","menschenveracht","sexualdelikt","bekanntenkreis","neuer","reu","hafturlaub","serienkill","unheim","angehor","handelt","opfer","gewaltverbrech","totungsdelikt","fahnd","mordseri","kriminalfall","tout","menos","hauslich","gewalt","geschlechtsspezif","rechercheprojekt","2020in","einreichen","jansjustizminist","vielausgab","julibundesrat","riedener23","oktoberw","demrechercheprojekt","septembergefragt","strafartikeln","richte","mitreden","strafrechtsexpertinn","gleichstellungsministerin","familienkonstellation","femiziddi","gesetztam","annaherungsalarmheut","junizum","waffendelikt","globus2017","hommage","verfahrensakten","holocausts","totungsdeliktsglu"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"name":"Neighbors","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"visible":true},{"x":[2.1820105487529213,0.719063702258952,0.14906975766630742,-0.60704151484045887,3.3429432393503253],"y":[-0.6592102938482205,-2.102543637968,-1.5917852822221963,-1.3846991019844404,-1.9849367500390958],"z":[-0.73742249941170779,0.55912971751331775,0.23760463036053164,-1.6875714000726425,-2.1852113350860889],"frame":"2025-2026","type":"scatter3d","mode":"markers+text","marker":{"color":"crimson","size":7,"opacity":0.94999999999999996,"line":{"color":"rgba(255,127,14,1)"}},"text":["Frauenmord","Femizid","Feminizid","Opfer",null],"textposition":["top center","top center","top center","top center","top center"],"hoverinfo":["text","text","text","text","text"],"name":"Targets","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"visible":true}],"traces":[0,1]}],"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="interpretation-and-limitations" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="interpretation-and-limitations"><span class="header-section-number">2.2</span> Interpretation and limitations</h2>
<p>The descriptive trends and embedding neighborhoods suggest a gradual shift from euphemistic/relational framings toward more explicit naming of gendered violence. This is consistent with a broader public discourse that increasingly recognizes feminicide as a distinct social problem. At the same time, these are correlational indicators: term usage is sensitive to genre, outlet, and event-driven spikes, and embeddings reflect co-occurrence patterns rather than causal mechanisms. We therefore treat the results as evidence of discursive change, not proof of underlying causes.</p>
<!-- -->


</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-carobbio_giscetti_interpellation_2020" class="csl-entry" role="listitem">
Carobbio Giscetti, Marina. 2020. <span>“Interpellation: <span>Frauenmorde</span> in Der <span>Schweiz</span> Müssen Gestoppt Werden.”</span> <a href="https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505">https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505</a>.
</div>
<div id="ref-ggf_femizid_2023" class="csl-entry" role="listitem">
GgF. 2023. <span>“Femizid Oder <span>Feminizid</span>? – <span>Gemeinsam</span> Gegen <span>Feminizide</span>.”</span> <em>Gemeinsam Gegen Feminizide</em>. <a href="https://contre-les-feminicides.ch/femizid-oder-feminizid/">https://contre-les-feminicides.ch/femizid-oder-feminizid/</a>.
</div>
<div id="ref-journalistde_kein_2023" class="csl-entry" role="listitem">
journalist.de. 2023. <span>“Kein <span>Familiendrama</span>: <span>Berichterstattung</span> Über <span>Femizide</span> Und Der <span>Umgang</span> Mit Überlebenden Und <span>Angehörigen</span>.”</span> Leitfaden. <em>Journalist.de</em>. Bonn: Journalismus3000. <a href="https://www.journalist.de/werkstatt/werkstatt-detail/kein-familiendrama-berichterstattung-ueber-femizide-und-der-umgang-mit-ueberlebenden-und-angehoerigen/">https://www.journalist.de/werkstatt/werkstatt-detail/kein-familiendrama-berichterstattung-ueber-femizide-und-der-umgang-mit-ueberlebenden-und-angehoerigen/</a>.
</div>
<div id="ref-meltzer_gewalt_2023" class="csl-entry" role="listitem">
Meltzer, Christine E. 2023. <span>“Gewalt Gegen <span>Frauen</span> in Den <span>Nachrichten</span>.”</span> Bundeszentrale für politische Bildung pbp. <a href="https://www.bpb.de/shop/zeitschriften/apuz/femizid-2023/519673/gewalt-gegen-frauen-in-den-nachrichten/">https://www.bpb.de/shop/zeitschriften/apuz/femizid-2023/519673/gewalt-gegen-frauen-in-den-nachrichten/</a>.
</div>
<div id="ref-presserat_berichterstattung_2025" class="csl-entry" role="listitem">
Presserat. 2025. <span>“Berichterstattung Zu <span>Femizid</span>.”</span> <em>Schweizer Presserat</em>. <a href="https://presserat.ch/news_40_2025/">https://presserat.ch/news_40_2025/</a>.
</div>
<div id="ref-saccomano_femicide_2015" class="csl-entry" role="listitem">
Saccomano, Celeste. 2015. <span>“Femicide and <span>Violence</span> <span>Against</span> <span>Women</span>.”</span> Institut Barcelona d’Estudis Internacionals (IBEI). <a href="https://www.jstor.org/stable/resrep14204.5">https://www.jstor.org/stable/resrep14204.5</a>.
</div>
<div id="ref-ustpat_studie_2024" class="csl-entry" role="listitem">
ustp.at. 2024. <span>“Studie Zur <span>Berichterstattung</span> Über <span>Femizide</span>.”</span> <em>USTP - University of Applied Sciences St. Pölten</em>. St. Pölten. <a href="https://www.ustp.at/de/stories/news/studie-zur-berichterstattung-ueber-femizide">https://www.ustp.at/de/stories/news/studie-zur-berichterstattung-ueber-femizide</a>.
</div>
<div id="ref-wetzstein_femicide_2024" class="csl-entry" role="listitem">
Wetzstein, Irmgard, Yvonne Prinzellner, and Elisabeth Kröpfl. 2024. <span>“Femicide Coverage in <span>German</span>-Language News. <span>A</span> Content Analysis of <span>Austrian</span>, <span>German</span>, and <span>Swiss</span> Newspaper Articles from 2018 to 2020.”</span> <em>Feminist Media Studies</em>, October, 1–25. <a href="https://doi.org/10.1080/14680777.2024.2417996">https://doi.org/10.1080/14680777.2024.2417996</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Swiss Federal Council, August 12, 2020, https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505 <span class="citation" data-cites="carobbio_giscetti_interpellation_2020">(via <a href="#ref-carobbio_giscetti_interpellation_2020" role="doc-biblioref">Carobbio Giscetti 2020</a>)</span> <!-- evtl. heikel in Fussnote zu zitieren? --><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>German: „[er] die Verwendung des Terminus ‘Femizid’ in der Diplomatie und im Umgang mit den Medien zu fördern [beabsichtigt]” <!-- evtl. italic? --><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>German: “[d]as BFS hingegen in der polizeilichen Kriminalstatistik (PKS) bei Gewaltstraftaten das Geschlecht der geschädigten Personen sowie die Beziehung zwischen geschädigten und beschuldigten Personen [ausweist], so dass Tötungsdelikte an Frauen in der Statistik sichtbar werden” <!-- evtl. italic? --><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>CC-BY-NC-SA</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb119" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb119-1"><a href="#cb119-1"></a><span class="co">---</span></span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="an">title:</span><span class="co"> "From “Family Tragedy” to “Feminicide”?"</span></span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="an">subtitle:</span><span class="co"> "Exploring Discursive Change in Swiss Media Reporting on the Killing of Women since 1990"</span></span>
<span id="cb119-4"><a href="#cb119-4"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb119-5"><a href="#cb119-5"></a><span class="co">  The language used in media reporting on the killing of women reflects and shapes broader social understandings of gender-based violence. This paper presents an exploratory analysis of discursive change in German-language Swiss media reporting on feminicides since 1990. Drawing on the Swissdox media archive, we apply diachronic word2vec models to examine how key terms and their semantic neighbourhoods have evolved over time. Rather than offering definitive causal explanations, the study aims to detect patterns of continuity and change in terminology, framing, and contextual associations. The findings indicate a gradual shift from individualising and relational framings toward more politicised and gender-specific vocabularies, while certain narrative conventions remain remarkably stable. By combining computational text analysis with a critical perspective on discourse, the paper highlights both the potential and the limits of word embedding methods for studying long-term transformations in media representations of feminicide.</span></span>
<span id="cb119-6"><a href="#cb119-6"></a><span class="an">date:</span><span class="co"> 2026-01-26</span></span>
<span id="cb119-7"><a href="#cb119-7"></a><span class="an">author:</span></span>
<span id="cb119-8"><a href="#cb119-8"></a><span class="co">  - name: Lukas Batschelet</span></span>
<span id="cb119-9"><a href="#cb119-9"></a><span class="co">    email: lukas.batschelet@students.unibe.ch</span></span>
<span id="cb119-10"><a href="#cb119-10"></a><span class="co">  - name: Linus Kiener</span></span>
<span id="cb119-11"><a href="#cb119-11"></a><span class="co">    email: linus.kiener@students.unibe.ch</span></span>
<span id="cb119-12"><a href="#cb119-12"></a><span class="an">license:</span><span class="co"> "CC-BY-NC-SA"</span></span>
<span id="cb119-13"><a href="#cb119-13"></a><span class="an">format:</span></span>
<span id="cb119-14"><a href="#cb119-14"></a><span class="co">  html:</span></span>
<span id="cb119-15"><a href="#cb119-15"></a><span class="co">    toc: true</span></span>
<span id="cb119-16"><a href="#cb119-16"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb119-17"><a href="#cb119-17"></a><span class="co">    number-sections: true</span></span>
<span id="cb119-18"><a href="#cb119-18"></a><span class="co">    code-download: true</span></span>
<span id="cb119-19"><a href="#cb119-19"></a><span class="co">    code-fold: true</span></span>
<span id="cb119-20"><a href="#cb119-20"></a><span class="co">    code-tools: true</span></span>
<span id="cb119-21"><a href="#cb119-21"></a><span class="co">    code-copy: true</span></span>
<span id="cb119-22"><a href="#cb119-22"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb119-23"><a href="#cb119-23"></a><span class="co">    code-line-numbers-width: 40</span></span>
<span id="cb119-24"><a href="#cb119-24"></a><span class="co">    df-print: paged</span></span>
<span id="cb119-25"><a href="#cb119-25"></a><span class="an">execute:</span></span>
<span id="cb119-26"><a href="#cb119-26"></a><span class="co">  cache: true</span></span>
<span id="cb119-27"><a href="#cb119-27"></a><span class="an">bibliography:</span><span class="co"> library.bib</span></span>
<span id="cb119-28"><a href="#cb119-28"></a><span class="an">title-block-banner:</span><span class="co"> true</span></span>
<span id="cb119-29"><a href="#cb119-29"></a><span class="co">---</span></span>
<span id="cb119-30"><a href="#cb119-30"></a></span>
<span id="cb119-31"><a href="#cb119-31"></a><span class="fu">## Introduction</span></span>
<span id="cb119-32"><a href="#cb119-32"></a></span>
<span id="cb119-33"><a href="#cb119-33"></a>Media coverage of the topic of femicide has always been controversial. The term “femicide” itself is the subject of complex debate in the media and politics. For example, in its statement of August 12, 2020, on interpellation 20.3505<span class="ot">[^1]</span>, the Federal Council said: “There are currently no plans to use the term ‘femicide’,” in response to the question of whether “<span class="sc">\[</span>it<span class="sc">\]</span> intends to promote the use of the term ‘femicide’ in diplomacy and in relations with the media”.<span class="ot">[^2]</span> However, it also points out that “<span class="sc">\[</span>t<span class="sc">\]</span>he FSO, on the other hand, <span class="sc">\[</span>reports<span class="sc">\]</span> the gender of the victims and the relationship between the victims and the accused in the police crime statistics (PKS) for violent crimes, so that homicides against women are visible in the statistics”.<span class="ot">[^3]</span> Information such as this can then be used by projects like <span class="co">[</span><span class="ot">stopfemizid.ch</span><span class="co">](https://stopfemizid.ch)</span> to crowdsource reports of such incidents. However, the debate surrounding the use of different terms has now progressed further, with the term “feminicide” gradually becoming established. (As we can also show in our subsequent analysis.) The term was coined by Mexican feminist activist Marcela Lagarde, who wanted to use the neologism “feminicidio” expanding the concept of “femicidio” to include, among other things, the dimension of institutional violence and responsibility <span class="co">[</span><span class="ot">cf. @saccomano_femicide_2015, pp. 5; as seen in @ggf_femizid_2023</span><span class="co">]</span>. However, @saccomano_femicide_2015 <span class="co">&lt;!-- [p. 33] --&gt;</span> notes that the popularization of the term has also led to confusion and that it is often mistakenly used for any killing of a woman.</span>
<span id="cb119-34"><a href="#cb119-34"></a></span>
<span id="cb119-35"><a href="#cb119-35"></a><span class="ot">[^1]: </span>Swiss Federal Council, August 12, 2020, https://www.parlament.ch/de/ratsbetrieb/suche-curia-vista/geschaeft?AffairId=20203505 <span class="co">[</span><span class="ot">via @carobbio_giscetti_interpellation_2020</span><span class="co">]</span> <span class="co">&lt;!-- evtl. heikel in Fussnote zu zitieren? --&gt;</span></span>
<span id="cb119-36"><a href="#cb119-36"></a></span>
<span id="cb119-37"><a href="#cb119-37"></a><span class="ot">[^2]: </span>German: „<span class="sc">\[</span>er<span class="sc">\]</span> die Verwendung des Terminus ‘Femizid’ in der Diplomatie und im Umgang mit den Medien zu fördern <span class="sc">\[</span>beabsichtigt<span class="sc">\]</span>” <span class="co">&lt;!-- evtl. italic? --&gt;</span></span>
<span id="cb119-38"><a href="#cb119-38"></a></span>
<span id="cb119-39"><a href="#cb119-39"></a><span class="ot">[^3]: </span>German: “<span class="sc">\[</span>d<span class="sc">\]</span>as BFS hingegen in der polizeilichen Kriminalstatistik (PKS) bei Gewaltstraftaten das Geschlecht der geschädigten Personen sowie die Beziehung zwischen geschädigten und beschuldigten Personen <span class="sc">\[</span>ausweist<span class="sc">\]</span>, so dass Tötungsdelikte an Frauen in der Statistik sichtbar werden” <span class="co">&lt;!-- evtl. italic? --&gt;</span></span>
<span id="cb119-40"><a href="#cb119-40"></a></span>
<span id="cb119-41"><a href="#cb119-41"></a>In its press release on case No. 20/2025, the Swiss Press Council also stated that “<span class="sc">\[</span>...<span class="sc">\]</span> it is in the public interest to report on femicides and draw attention to the issue” <span class="co">[</span><span class="ot">@presserat_berichterstattung_2025</span><span class="co">]</span>. Similar trends can also be observed in academic literature. An overview by @meltzer_gewalt_2023 summarizes extensive findings on media coverage in Germany and mentions “that the term ‘femicide’ did not play a major role in the media until 2019.” According to the report, it was only used in about 1% <span class="co">&lt;!-- escape für % sollte nicht nötig sein --&gt;</span> of the articles examined. We will attempt to replicate this finding, among others, for Switzerland using data from Swissdox via the LiRI (Linguistic Research Infrastructure) API. Moreover, @wetzstein_femicide_2024 finds that, for posts from the entire DACH region during the observation period between 2018 and 2020, euphemistic terms such as “relationship drama” or “blood deed” vary significantly depending on the type of relationship between the victim and the perpetrator. These and other terms such as “family tragedies” or “jealousy dramas” “trivialize violence against women and turn femicides into fateful isolated cases” <span class="co">[</span><span class="ot">@journalistde_kein_2023</span><span class="co">]</span>. Apart from that, the use of terms such as “femicide” (which focus on the gender of the victim) is more common when the perpetrator's migrant background is mentioned in parallel <span class="co">[</span><span class="ot">@wetzstein_femicide_2024; via @ustpat_studie_2024</span><span class="co">]</span>.</span>
<span id="cb119-42"><a href="#cb119-42"></a></span>
<span id="cb119-43"><a href="#cb119-43"></a>Based on this initial literature review, we have concluded that there is a substantial need for the availability and analysis of data related to the topic of femi(ni)cide, particularly in the recent past within the Swiss media landscape. Our work aims to construct a framework for obtaining relevant data and then demonstrates possible approaches and methods of analysis.</span>
<span id="cb119-44"><a href="#cb119-44"></a></span>
<span id="cb119-45"><a href="#cb119-45"></a>This paper asks whether Swiss media language has shifted from euphemistic or relational framings (e.g., “family tragedy”) toward more explicit, feminist terms (e.g., “femicide”). We combine a two-stage retrieval from Swissdox with descriptive frequency analysis and diachronic word embeddings. The aim is not causal explanation but a systematic description of framing change over time.</span>
<span id="cb119-46"><a href="#cb119-46"></a></span>
<span id="cb119-47"><a href="#cb119-47"></a><span class="co">&lt;!-- *** --&gt;</span></span>
<span id="cb119-48"><a href="#cb119-48"></a></span>
<span id="cb119-49"><a href="#cb119-49"></a><span class="co">&lt;!-- redundant durch fussnoten separator --&gt;</span></span>
<span id="cb119-50"><a href="#cb119-50"></a></span>
<span id="cb119-51"><a href="#cb119-51"></a><span class="co">&lt;!-- Achtung: Quarto sollte gehen, aber R Markdown ist "lightweight markup" und unterstützt fussnoten nicht --&gt;</span></span>
<span id="cb119-52"><a href="#cb119-52"></a></span>
<span id="cb119-53"><a href="#cb119-53"></a><span class="fu">## Setup</span></span>
<span id="cb119-54"><a href="#cb119-54"></a></span>
<span id="cb119-55"><a href="#cb119-55"></a>This section initializes the environment, dependencies, and shared configuration used across all analyses. Heavy steps (API calls, embeddings) are guarded to avoid accidental re-runs.</span>
<span id="cb119-56"><a href="#cb119-56"></a></span>
<span id="cb119-57"><a href="#cb119-57"></a>::: {.callout-warning}</span>
<span id="cb119-58"><a href="#cb119-58"></a>**Large files and long compute times ahead!**</span>
<span id="cb119-59"><a href="#cb119-59"></a></span>
<span id="cb119-60"><a href="#cb119-60"></a>This pipeline relies on multithreaded processing wherever possible.</span>
<span id="cb119-61"><a href="#cb119-61"></a></span>
<span id="cb119-62"><a href="#cb119-62"></a>Please make sure that **`quanteda` is running in parallel mode**.\</span>
<span id="cb119-63"><a href="#cb119-63"></a>If parallelisation is disabled, several steps (especially tokenisation and feature extraction) may take *extremely* long.</span>
<span id="cb119-64"><a href="#cb119-64"></a></span>
<span id="cb119-65"><a href="#cb119-65"></a>::: {.callout-tip collapse=true}</span>
<span id="cb119-66"><a href="#cb119-66"></a><span class="fu">## How to check whether `quanteda` runs in parallel</span></span>
<span id="cb119-67"><a href="#cb119-67"></a></span>
<span id="cb119-68"><a href="#cb119-68"></a>In R, run (quanteda is already loaded in the setup chunk):</span>
<span id="cb119-69"><a href="#cb119-69"></a></span>
<span id="cb119-70"><a href="#cb119-70"></a><span class="in">``` r</span></span>
<span id="cb119-71"><a href="#cb119-71"></a><span class="fu">quanteda_options</span>()</span>
<span id="cb119-72"><a href="#cb119-72"></a><span class="in">```</span></span>
<span id="cb119-73"><a href="#cb119-73"></a></span>
<span id="cb119-74"><a href="#cb119-74"></a>If you see:</span>
<span id="cb119-75"><a href="#cb119-75"></a></span>
<span id="cb119-76"><a href="#cb119-76"></a><span class="in">```</span></span>
<span id="cb119-77"><a href="#cb119-77"></a><span class="in">Parallel computing: disabled</span></span>
<span id="cb119-78"><a href="#cb119-78"></a><span class="in">```</span></span>
<span id="cb119-79"><a href="#cb119-79"></a></span>
<span id="cb119-80"><a href="#cb119-80"></a>then multithreading is **not** active and performance will be severely reduced.</span>
<span id="cb119-81"><a href="#cb119-81"></a></span>
<span id="cb119-82"><a href="#cb119-82"></a>You can also inspect:</span>
<span id="cb119-83"><a href="#cb119-83"></a></span>
<span id="cb119-84"><a href="#cb119-84"></a><span class="in">``` r</span></span>
<span id="cb119-85"><a href="#cb119-85"></a><span class="fu">quanteda_options</span>()</span>
<span id="cb119-86"><a href="#cb119-86"></a><span class="in">```</span></span>
<span id="cb119-87"><a href="#cb119-87"></a></span>
<span id="cb119-88"><a href="#cb119-88"></a>For setup instructions and troubleshooting, see: <span class="ot">&lt;https://quanteda.io/articles/pkgdown/parallelisation.html&gt;</span></span>
<span id="cb119-89"><a href="#cb119-89"></a>:::</span>
<span id="cb119-90"><a href="#cb119-90"></a></span>
<span id="cb119-91"><a href="#cb119-91"></a>Swissdox API calls are also inherently slow and may take hours for large queries.</span>
<span id="cb119-92"><a href="#cb119-92"></a>:::</span>
<span id="cb119-93"><a href="#cb119-93"></a></span>
<span id="cb119-94"><a href="#cb119-94"></a><span class="in">```{r setup, cache=FALSE}</span></span>
<span id="cb119-95"><a href="#cb119-95"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-96"><a href="#cb119-96"></a>  <span class="st">"httr"</span>, <span class="st">"jsonlite"</span>, <span class="st">"yaml"</span>, <span class="st">"dotenv"</span>, <span class="st">"R6"</span>,</span>
<span id="cb119-97"><a href="#cb119-97"></a>  <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"stringr"</span>, <span class="st">"tidytext"</span>, <span class="st">"readr"</span>, <span class="st">"tidyr"</span>,</span>
<span id="cb119-98"><a href="#cb119-98"></a>  <span class="st">"quanteda"</span>, <span class="st">"quanteda.textplots"</span>, <span class="st">"quanteda.textstats"</span>,</span>
<span id="cb119-99"><a href="#cb119-99"></a>  <span class="st">"tm"</span>, <span class="st">"topicmodels"</span>, <span class="st">"wordcloud"</span>, <span class="st">"RColorBrewer"</span>,</span>
<span id="cb119-100"><a href="#cb119-100"></a>  <span class="st">"umap"</span>, <span class="st">"plotly"</span>, <span class="st">"hunspell"</span>, <span class="st">"word2vec"</span>, <span class="st">"progress"</span>,</span>
<span id="cb119-101"><a href="#cb119-101"></a>  <span class="st">"qs2"</span>, <span class="st">"tibble"</span>, <span class="st">"scales"</span></span>
<span id="cb119-102"><a href="#cb119-102"></a>)</span>
<span id="cb119-103"><a href="#cb119-103"></a></span>
<span id="cb119-104"><a href="#cb119-104"></a>missing_packages <span class="ot">&lt;-</span> required_packages[</span>
<span id="cb119-105"><a href="#cb119-105"></a>  <span class="sc">!</span><span class="fu">vapply</span>(required_packages, requireNamespace, <span class="fu">logical</span>(<span class="dv">1</span>), <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-106"><a href="#cb119-106"></a>]</span>
<span id="cb119-107"><a href="#cb119-107"></a><span class="cf">if</span> (<span class="fu">length</span>(missing_packages) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-108"><a href="#cb119-108"></a>  <span class="fu">install.packages</span>(missing_packages)</span>
<span id="cb119-109"><a href="#cb119-109"></a>}</span>
<span id="cb119-110"><a href="#cb119-110"></a></span>
<span id="cb119-111"><a href="#cb119-111"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(required_packages, <span class="cf">function</span>(pkg) {</span>
<span id="cb119-112"><a href="#cb119-112"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb119-113"><a href="#cb119-113"></a>}))</span>
<span id="cb119-114"><a href="#cb119-114"></a></span>
<span id="cb119-115"><a href="#cb119-115"></a><span class="co"># API Wrapper laden</span></span>
<span id="cb119-116"><a href="#cb119-116"></a><span class="fu">source</span>(<span class="st">"swissdox_api.R"</span>)</span>
<span id="cb119-117"><a href="#cb119-117"></a></span>
<span id="cb119-118"><a href="#cb119-118"></a><span class="in">```</span></span>
<span id="cb119-119"><a href="#cb119-119"></a></span>
<span id="cb119-120"><a href="#cb119-120"></a><span class="fu">## Document Setup</span></span>
<span id="cb119-121"><a href="#cb119-121"></a></span>
<span id="cb119-122"><a href="#cb119-122"></a></span>
<span id="cb119-123"><a href="#cb119-123"></a>Centralized API access, checkpoint utilities, and text configuration.</span>
<span id="cb119-124"><a href="#cb119-124"></a></span>
<span id="cb119-125"><a href="#cb119-125"></a><span class="in">```{r document-setup}</span></span>
<span id="cb119-126"><a href="#cb119-126"></a><span class="co"># Load environment variables from local.env</span></span>
<span id="cb119-127"><a href="#cb119-127"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"local.env"</span>)) {</span>
<span id="cb119-128"><a href="#cb119-128"></a>  <span class="fu">load_dot_env</span>(<span class="st">"local.env"</span>)</span>
<span id="cb119-129"><a href="#cb119-129"></a>  <span class="fu">message</span>(<span class="st">"\u2713 Environment variables loaded from local.env"</span>)</span>
<span id="cb119-130"><a href="#cb119-130"></a>} <span class="cf">else</span> {</span>
<span id="cb119-131"><a href="#cb119-131"></a>  <span class="fu">message</span>(<span class="st">"WARN: local.env not found - using system environment"</span>)</span>
<span id="cb119-132"><a href="#cb119-132"></a>}</span>
<span id="cb119-133"><a href="#cb119-133"></a></span>
<span id="cb119-134"><a href="#cb119-134"></a><span class="co"># Initialize API client with credentials</span></span>
<span id="cb119-135"><a href="#cb119-135"></a>client <span class="ot">&lt;-</span> SwissdoxAPI<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb119-136"><a href="#cb119-136"></a>  <span class="at">api_key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_KEY"</span>),</span>
<span id="cb119-137"><a href="#cb119-137"></a>  <span class="at">api_secret =</span> <span class="fu">Sys.getenv</span>(<span class="st">"SWISSDOX_API_SECRET"</span>)</span>
<span id="cb119-138"><a href="#cb119-138"></a>)</span>
<span id="cb119-139"><a href="#cb119-139"></a></span>
<span id="cb119-140"><a href="#cb119-140"></a><span class="co"># Guard flags to prevent accidental duplicate API calls</span></span>
<span id="cb119-141"><a href="#cb119-141"></a><span class="co"># Query guards:</span></span>
<span id="cb119-142"><a href="#cb119-142"></a><span class="co"># - RUN_* enables the API call at all</span></span>
<span id="cb119-143"><a href="#cb119-143"></a><span class="co"># - FORCE_* re-runs even if a checkpoint already exists</span></span>
<span id="cb119-144"><a href="#cb119-144"></a>RUN_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-145"><a href="#cb119-145"></a>FORCE_FIRST_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-146"><a href="#cb119-146"></a>RUN_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-147"><a href="#cb119-147"></a>FORCE_SECOND_PASS_QUERY <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-148"><a href="#cb119-148"></a><span class="co"># Word2Vec guards (first-pass)</span></span>
<span id="cb119-149"><a href="#cb119-149"></a>RUN_WORD2VEC_TRAINING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb119-150"><a href="#cb119-150"></a>FORCE_WORD2VEC_TRAINING <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-151"><a href="#cb119-151"></a><span class="co"># Second-pass Word2Vec guards</span></span>
<span id="cb119-152"><a href="#cb119-152"></a>RUN_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb119-153"><a href="#cb119-153"></a>FORCE_SECOND_PASS_W2V_TRAINING <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-154"><a href="#cb119-154"></a><span class="co"># Checkpoint helpers (load/save latest timestamped files)</span></span>
<span id="cb119-155"><a href="#cb119-155"></a>find_latest <span class="ot">&lt;-</span> <span class="cf">function</span>(pattern, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb119-156"><a href="#cb119-156"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> pattern, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-157"><a href="#cb119-157"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb119-158"><a href="#cb119-158"></a>  <span class="co"># Prefer timestamp in filename (YYYYMMDD_HHMMSS). Fall back to mtime.</span></span>
<span id="cb119-159"><a href="#cb119-159"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb119-160"><a href="#cb119-160"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb119-161"><a href="#cb119-161"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb119-162"><a href="#cb119-162"></a>  }</span>
<span id="cb119-163"><a href="#cb119-163"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb119-164"><a href="#cb119-164"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb119-165"><a href="#cb119-165"></a>}</span>
<span id="cb119-166"><a href="#cb119-166"></a></span>
<span id="cb119-167"><a href="#cb119-167"></a>latest_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, <span class="at">dir =</span> <span class="st">"data"</span>) {</span>
<span id="cb119-168"><a href="#cb119-168"></a>  patterns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-169"><a href="#cb119-169"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.rds$"</span>),</span>
<span id="cb119-170"><a href="#cb119-170"></a>    <span class="fu">paste0</span>(<span class="st">"^"</span>, prefix, <span class="st">"_</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6}</span><span class="sc">\\</span><span class="st">.qs2$"</span>)</span>
<span id="cb119-171"><a href="#cb119-171"></a>  )</span>
<span id="cb119-172"><a href="#cb119-172"></a>  files <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(patterns, <span class="cf">function</span>(p) <span class="fu">list.files</span>(dir, <span class="at">pattern =</span> p, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb119-173"><a href="#cb119-173"></a>  <span class="cf">if</span> (<span class="fu">length</span>(files) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb119-174"><a href="#cb119-174"></a>  <span class="co"># Reuse find_latest logic on the combined list</span></span>
<span id="cb119-175"><a href="#cb119-175"></a>  stamps <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="fu">basename</span>(files), <span class="st">"(</span><span class="sc">\\</span><span class="st">d{8}_</span><span class="sc">\\</span><span class="st">d{6})"</span>)[, <span class="dv">2</span>]</span>
<span id="cb119-176"><a href="#cb119-176"></a>  <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">is.na</span>(stamps))) {</span>
<span id="cb119-177"><a href="#cb119-177"></a>    <span class="fu">return</span>(files[<span class="fu">order</span>(<span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>])</span>
<span id="cb119-178"><a href="#cb119-178"></a>  }</span>
<span id="cb119-179"><a href="#cb119-179"></a>  ts <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.POSIXct</span>(stamps, <span class="at">format =</span> <span class="st">"%Y%m%d_%H%M%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>))</span>
<span id="cb119-180"><a href="#cb119-180"></a>  files[<span class="fu">order</span>(ts, <span class="fu">file.mtime</span>(files), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)][<span class="dv">1</span>]</span>
<span id="cb119-181"><a href="#cb119-181"></a>}</span>
<span id="cb119-182"><a href="#cb119-182"></a></span>
<span id="cb119-183"><a href="#cb119-183"></a>save_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, prefix, <span class="at">dir =</span> <span class="st">"data"</span>, <span class="at">format =</span> <span class="st">"qs2"</span>, <span class="at">compress =</span> <span class="st">"xz"</span>) {</span>
<span id="cb119-184"><a href="#cb119-184"></a>  timestamp <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)</span>
<span id="cb119-185"><a href="#cb119-185"></a>  <span class="cf">if</span> (format <span class="sc">==</span> <span class="st">"qs2"</span>) {</span>
<span id="cb119-186"><a href="#cb119-186"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb119-187"><a href="#cb119-187"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot save .qs2 checkpoint"</span>)</span>
<span id="cb119-188"><a href="#cb119-188"></a>    }</span>
<span id="cb119-189"><a href="#cb119-189"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".qs2"</span>))</span>
<span id="cb119-190"><a href="#cb119-190"></a>    qs2<span class="sc">::</span><span class="fu">qs_save</span>(obj, file)</span>
<span id="cb119-191"><a href="#cb119-191"></a>  } <span class="cf">else</span> {</span>
<span id="cb119-192"><a href="#cb119-192"></a>    file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(prefix, <span class="st">"_"</span>, timestamp, <span class="st">".rds"</span>))</span>
<span id="cb119-193"><a href="#cb119-193"></a>    <span class="fu">saveRDS</span>(obj, file, <span class="at">compress =</span> compress)</span>
<span id="cb119-194"><a href="#cb119-194"></a>  }</span>
<span id="cb119-195"><a href="#cb119-195"></a>  <span class="fu">message</span>(<span class="st">"Saved checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb119-196"><a href="#cb119-196"></a>  file</span>
<span id="cb119-197"><a href="#cb119-197"></a>}</span>
<span id="cb119-198"><a href="#cb119-198"></a></span>
<span id="cb119-199"><a href="#cb119-199"></a>load_checkpoint <span class="ot">&lt;-</span> <span class="cf">function</span>(prefix, var_name) {</span>
<span id="cb119-200"><a href="#cb119-200"></a>  file <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(prefix)</span>
<span id="cb119-201"><a href="#cb119-201"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(file)) {</span>
<span id="cb119-202"><a href="#cb119-202"></a>    <span class="fu">message</span>(<span class="st">"No checkpoint found for: "</span>, prefix)</span>
<span id="cb119-203"><a href="#cb119-203"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb119-204"><a href="#cb119-204"></a>  }</span>
<span id="cb119-205"><a href="#cb119-205"></a>  <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.qs2$"</span>, file)) {</span>
<span id="cb119-206"><a href="#cb119-206"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"qs2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb119-207"><a href="#cb119-207"></a>      <span class="fu">stop</span>(<span class="st">"qs2 package not installed, cannot read: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb119-208"><a href="#cb119-208"></a>    }</span>
<span id="cb119-209"><a href="#cb119-209"></a>    <span class="fu">assign</span>(var_name, qs2<span class="sc">::</span><span class="fu">qs_read</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb119-210"><a href="#cb119-210"></a>  } <span class="cf">else</span> {</span>
<span id="cb119-211"><a href="#cb119-211"></a>    <span class="fu">assign</span>(var_name, <span class="fu">readRDS</span>(file), <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb119-212"><a href="#cb119-212"></a>  }</span>
<span id="cb119-213"><a href="#cb119-213"></a>  <span class="fu">message</span>(<span class="st">"Loaded checkpoint: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb119-214"><a href="#cb119-214"></a>  file</span>
<span id="cb119-215"><a href="#cb119-215"></a>}</span>
<span id="cb119-216"><a href="#cb119-216"></a><span class="co"># Text analysis defaults</span></span>
<span id="cb119-217"><a href="#cb119-217"></a>SAVE_CORPUS <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb119-218"><a href="#cb119-218"></a>USE_STEMMING <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb119-219"><a href="#cb119-219"></a>TRAIN_FULL_MODEL <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb119-220"><a href="#cb119-220"></a>FULL_MODEL_LABEL <span class="ot">&lt;-</span> <span class="st">"all_2000-2025"</span></span>
<span id="cb119-221"><a href="#cb119-221"></a></span>
<span id="cb119-222"><a href="#cb119-222"></a><span class="co"># Multi-word patterns after stemming (used in preprocessing + word2vec)</span></span>
<span id="cb119-223"><a href="#cb119-223"></a>simplified_patterns <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb119-224"><a href="#cb119-224"></a>  <span class="fu">c</span>(<span class="st">"hauslich"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-225"><a href="#cb119-225"></a>  <span class="fu">c</span>(<span class="st">"partnerschaft"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-226"><a href="#cb119-226"></a>  <span class="fu">c</span>(<span class="st">"partner"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-227"><a href="#cb119-227"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-228"><a href="#cb119-228"></a>  <span class="fu">c</span>(<span class="st">"sexuell"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-229"><a href="#cb119-229"></a>  <span class="fu">c</span>(<span class="st">"körperl"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-230"><a href="#cb119-230"></a>  <span class="fu">c</span>(<span class="st">"psychisch"</span>, <span class="st">"gewalt"</span>),</span>
<span id="cb119-231"><a href="#cb119-231"></a>  <span class="fu">c</span>(<span class="st">"töt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb119-232"><a href="#cb119-232"></a>  <span class="fu">c</span>(<span class="st">"mord"</span>, <span class="st">"frau"</span>),</span>
<span id="cb119-233"><a href="#cb119-233"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"frau"</span>),</span>
<span id="cb119-234"><a href="#cb119-234"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"drama"</span>),</span>
<span id="cb119-235"><a href="#cb119-235"></a>  <span class="fu">c</span>(<span class="st">"famili"</span>, <span class="st">"tragödi"</span>),</span>
<span id="cb119-236"><a href="#cb119-236"></a>  <span class="fu">c</span>(<span class="st">"bezieh"</span>, <span class="st">"tat"</span>),</span>
<span id="cb119-237"><a href="#cb119-237"></a>  <span class="fu">c</span>(<span class="st">"eh"</span>, <span class="st">"streit"</span>),</span>
<span id="cb119-238"><a href="#cb119-238"></a>  <span class="fu">c</span>(<span class="st">"opf"</span>, <span class="st">"schutz"</span>),</span>
<span id="cb119-239"><a href="#cb119-239"></a>  <span class="fu">c</span>(<span class="st">"gewalt"</span>, <span class="st">"schutz"</span>)</span>
<span id="cb119-240"><a href="#cb119-240"></a>)</span>
<span id="cb119-241"><a href="#cb119-241"></a></span>
<span id="cb119-242"><a href="#cb119-242"></a><span class="co"># Normalize terms to match Word2Vec vocabulary (lowercase, optional stemming)</span></span>
<span id="cb119-243"><a href="#cb119-243"></a>normalize_terms_for_model <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb119-244"><a href="#cb119-244"></a>  norm <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(terms)</span>
<span id="cb119-245"><a href="#cb119-245"></a>  toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens</span>(norm, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-246"><a href="#cb119-246"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb119-247"><a href="#cb119-247"></a>    toks <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">tokens_wordstem</span>(toks, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb119-248"><a href="#cb119-248"></a>  }</span>
<span id="cb119-249"><a href="#cb119-249"></a>  <span class="fu">vapply</span>(toks, <span class="cf">function</span>(x) <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">"_"</span>), <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb119-250"><a href="#cb119-250"></a>}</span>
<span id="cb119-251"><a href="#cb119-251"></a></span>
<span id="cb119-252"><a href="#cb119-252"></a><span class="in">```</span></span>
<span id="cb119-253"><a href="#cb119-253"></a></span>
<span id="cb119-254"><a href="#cb119-254"></a><span class="fu">## Keyword Definitions</span></span>
<span id="cb119-255"><a href="#cb119-255"></a></span>
<span id="cb119-256"><a href="#cb119-256"></a>These terms are the basis for the queries. We define them centrally to keep usage consistent across analysis and API calls.</span>
<span id="cb119-257"><a href="#cb119-257"></a></span>
<span id="cb119-258"><a href="#cb119-258"></a><span class="in">```{r keyword-definitions}</span></span>
<span id="cb119-259"><a href="#cb119-259"></a></span>
<span id="cb119-260"><a href="#cb119-260"></a>feminizid_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-261"><a href="#cb119-261"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb119-262"><a href="#cb119-262"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>,</span>
<span id="cb119-263"><a href="#cb119-263"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span>, <span class="st">"Gewalt gegen Frauen"</span>,</span>
<span id="cb119-264"><a href="#cb119-264"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span></span>
<span id="cb119-265"><a href="#cb119-265"></a>)</span>
<span id="cb119-266"><a href="#cb119-266"></a></span>
<span id="cb119-267"><a href="#cb119-267"></a><span class="in">```</span></span>
<span id="cb119-268"><a href="#cb119-268"></a></span>
<span id="cb119-269"><a href="#cb119-269"></a><span class="fu">## Data collection</span></span>
<span id="cb119-270"><a href="#cb119-270"></a></span>
<span id="cb119-271"><a href="#cb119-271"></a>We retrieve relevant Swissdox articles with an initial broad keyword query. The API call is guarded by flags and checkpoints, so re-runs can reuse cached results without repeating the full download.</span>
<span id="cb119-272"><a href="#cb119-272"></a></span>
<span id="cb119-273"><a href="#cb119-273"></a>Build and run the Swissdox query. Use the checkpoint load block to resume without re-running the API call.</span>
<span id="cb119-274"><a href="#cb119-274"></a></span>
<span id="cb119-275"><a href="#cb119-275"></a>We start with a broad exploratory query using the original keyword list (OR).</span>
<span id="cb119-276"><a href="#cb119-276"></a></span>
<span id="cb119-277"><a href="#cb119-277"></a><span class="in">```{r checkpoint-load-raw}</span></span>
<span id="cb119-278"><a href="#cb119-278"></a><span class="co"># Checkpoint load (raw data)</span></span>
<span id="cb119-279"><a href="#cb119-279"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span>
<span id="cb119-280"><a href="#cb119-280"></a><span class="in">```</span></span>
<span id="cb119-281"><a href="#cb119-281"></a></span>
<span id="cb119-282"><a href="#cb119-282"></a><span class="in">```{r feminizid-data-collection, cache=FALSE}</span></span>
<span id="cb119-283"><a href="#cb119-283"></a><span class="co"># Skip if a checkpoint exists unless explicitly forced</span></span>
<span id="cb119-284"><a href="#cb119-284"></a>existing_firstpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb119-285"><a href="#cb119-285"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_FIRST_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_FIRST_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_firstpass))) {</span>
<span id="cb119-286"><a href="#cb119-286"></a>  <span class="fu">message</span>(<span class="st">"First-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_firstpass))</span>
<span id="cb119-287"><a href="#cb119-287"></a>} <span class="cf">else</span> {</span>
<span id="cb119-288"><a href="#cb119-288"></a><span class="co"># Full data collection with API wrapper</span></span>
<span id="cb119-289"><a href="#cb119-289"></a>collection_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb119-290"><a href="#cb119-290"></a>  <span class="at">client =</span> client,</span>
<span id="cb119-291"><a href="#cb119-291"></a>  <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb119-292"><a href="#cb119-292"></a>    <span class="at">content_terms =</span> feminizid_keywords,</span>
<span id="cb119-293"><a href="#cb119-293"></a>    <span class="at">date_from =</span> <span class="st">"2000-01-01"</span>,</span>
<span id="cb119-294"><a href="#cb119-294"></a>    <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb119-295"><a href="#cb119-295"></a>    <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb119-296"><a href="#cb119-296"></a>    <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb119-297"><a href="#cb119-297"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb119-298"><a href="#cb119-298"></a>               <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>, </span>
<span id="cb119-299"><a href="#cb119-299"></a>               <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>, </span>
<span id="cb119-300"><a href="#cb119-300"></a>               <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb119-301"><a href="#cb119-301"></a>  ),</span>
<span id="cb119-302"><a href="#cb119-302"></a>  <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_Collection"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb119-303"><a href="#cb119-303"></a>  <span class="at">comment =</span> <span class="st">"Comprehensive feminicide media analysis dataset"</span>,</span>
<span id="cb119-304"><a href="#cb119-304"></a>  <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-305"><a href="#cb119-305"></a>  <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb119-306"><a href="#cb119-306"></a>)</span>
<span id="cb119-307"><a href="#cb119-307"></a></span>
<span id="cb119-308"><a href="#cb119-308"></a><span class="co"># Store results and save checkpoint</span></span>
<span id="cb119-309"><a href="#cb119-309"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(collection_result<span class="sc">$</span>data)) {</span>
<span id="cb119-310"><a href="#cb119-310"></a>  media_data <span class="ot">&lt;-</span> collection_result<span class="sc">$</span>data</span>
<span id="cb119-311"><a href="#cb119-311"></a>  <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb119-312"><a href="#cb119-312"></a>  <span class="fu">message</span>(<span class="st">"\u2713 "</span>, collection_result<span class="sc">$</span>message)</span>
<span id="cb119-313"><a href="#cb119-313"></a>} <span class="cf">else</span> {</span>
<span id="cb119-314"><a href="#cb119-314"></a>  <span class="fu">message</span>(<span class="st">"Error while loading data"</span>)</span>
<span id="cb119-315"><a href="#cb119-315"></a>}</span>
<span id="cb119-316"><a href="#cb119-316"></a>}</span>
<span id="cb119-317"><a href="#cb119-317"></a><span class="in">```</span></span>
<span id="cb119-318"><a href="#cb119-318"></a></span>
<span id="cb119-319"><a href="#cb119-319"></a><span class="fu">## Data preparation</span></span>
<span id="cb119-320"><a href="#cb119-320"></a></span>
<span id="cb119-321"><a href="#cb119-321"></a>We load raw documents, clean fields, and create time variables for later aggregation. All transformations are documented here to keep the analysis pipeline transparent.</span>
<span id="cb119-322"><a href="#cb119-322"></a></span>
<span id="cb119-323"><a href="#cb119-323"></a>Load raw data (from checkpoint or TSV), clean fields, and prepare time variables used in analysis.</span>
<span id="cb119-324"><a href="#cb119-324"></a></span>
<span id="cb119-325"><a href="#cb119-325"></a><span class="in">```{r data-preparation}</span></span>
<span id="cb119-326"><a href="#cb119-326"></a><span class="co"># Load data (checkpoint first, TSV fallback)</span></span>
<span id="cb119-327"><a href="#cb119-327"></a>raw_file <span class="ot">&lt;-</span> <span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data"</span>, <span class="st">"media_data"</span>)</span>
<span id="cb119-328"><a href="#cb119-328"></a><span class="cf">if</span> (<span class="fu">is.null</span>(raw_file)) {</span>
<span id="cb119-329"><a href="#cb119-329"></a>  tsv_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.tsv(</span><span class="sc">\\</span><span class="st">.xz)?$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-330"><a href="#cb119-330"></a>  <span class="cf">if</span> (<span class="fu">length</span>(tsv_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb119-331"><a href="#cb119-331"></a>    <span class="fu">message</span>(<span class="st">"WARN: No data files found - run the API call"</span>)</span>
<span id="cb119-332"><a href="#cb119-332"></a>  } <span class="cf">else</span> {</span>
<span id="cb119-333"><a href="#cb119-333"></a>    <span class="fu">message</span>(<span class="st">"No .rds file found, loading .tsv files..."</span>)</span>
<span id="cb119-334"><a href="#cb119-334"></a>    media_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">lapply</span>(tsv_files, <span class="cf">function</span>(file) {</span>
<span id="cb119-335"><a href="#cb119-335"></a>      <span class="fu">message</span>(<span class="st">"Loading: "</span>, <span class="fu">basename</span>(file))</span>
<span id="cb119-336"><a href="#cb119-336"></a>      <span class="fu">read_tsv</span>(file, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb119-337"><a href="#cb119-337"></a>    })) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-338"><a href="#cb119-338"></a>    <span class="fu">message</span>(<span class="st">"\u2713 Combined "</span>, <span class="fu">length</span>(tsv_files), <span class="st">" files: "</span>, <span class="fu">nrow</span>(media_data), <span class="st">" articles"</span>)</span>
<span id="cb119-339"><a href="#cb119-339"></a>    <span class="fu">save_checkpoint</span>(media_data, <span class="st">"feminizid_raw_data"</span>)</span>
<span id="cb119-340"><a href="#cb119-340"></a>  }</span>
<span id="cb119-341"><a href="#cb119-341"></a>}</span>
<span id="cb119-342"><a href="#cb119-342"></a><span class="in">```</span></span>
<span id="cb119-343"><a href="#cb119-343"></a></span>
<span id="cb119-344"><a href="#cb119-344"></a><span class="in">```{r data-cleaning}</span></span>
<span id="cb119-345"><a href="#cb119-345"></a></span>
<span id="cb119-346"><a href="#cb119-346"></a><span class="co"># Prepare data (if not already done)</span></span>
<span id="cb119-347"><a href="#cb119-347"></a><span class="co"># Convert dates and create time variables</span></span>
<span id="cb119-348"><a href="#cb119-348"></a>media_data<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb119-349"><a href="#cb119-349"></a>media_data<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data<span class="sc">$</span>pubtime)</span>
<span id="cb119-350"><a href="#cb119-350"></a>media_data<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y"</span>)</span>
<span id="cb119-351"><a href="#cb119-351"></a>media_data<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%m"</span>)</span>
<span id="cb119-352"><a href="#cb119-352"></a>media_data<span class="sc">$</span>month_year <span class="ot">&lt;-</span> <span class="fu">format</span>(media_data<span class="sc">$</span>pub_date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb119-353"><a href="#cb119-353"></a></span>
<span id="cb119-354"><a href="#cb119-354"></a><span class="co"># Keep German-only articles (drop French)</span></span>
<span id="cb119-355"><a href="#cb119-355"></a>media_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-356"><a href="#cb119-356"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-357"><a href="#cb119-357"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb119-358"><a href="#cb119-358"></a></span>
<span id="cb119-359"><a href="#cb119-359"></a><span class="fu">message</span>(<span class="st">"German articles after filtering: "</span>, <span class="fu">nrow</span>(media_data))</span>
<span id="cb119-360"><a href="#cb119-360"></a><span class="fu">message</span>(<span class="st">"Date range: "</span>, <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">" to "</span>, <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb119-361"><a href="#cb119-361"></a><span class="fu">message</span>(<span class="st">"Media outlets: "</span>, <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)))</span>
<span id="cb119-362"><a href="#cb119-362"></a></span>
<span id="cb119-363"><a href="#cb119-363"></a><span class="in">```</span></span>
<span id="cb119-364"><a href="#cb119-364"></a></span>
<span id="cb119-365"><a href="#cb119-365"></a><span class="fu">## Descriptive results</span></span>
<span id="cb119-366"><a href="#cb119-366"></a></span>
<span id="cb119-367"><a href="#cb119-367"></a>We first summarize coverage over time and identify the most frequent terms and sources. These descriptive statistics provide a baseline for interpreting later embedding results.</span>
<span id="cb119-368"><a href="#cb119-368"></a></span>
<span id="cb119-369"><a href="#cb119-369"></a><span class="in">```{r overview-analysis}</span></span>
<span id="cb119-370"><a href="#cb119-370"></a></span>
<span id="cb119-371"><a href="#cb119-371"></a><span class="co"># 1. Articles per year</span></span>
<span id="cb119-372"><a href="#cb119-372"></a>yearly_counts <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-373"><a href="#cb119-373"></a>  <span class="fu">count</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb119-374"><a href="#cb119-374"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb119-375"><a href="#cb119-375"></a></span>
<span id="cb119-376"><a href="#cb119-376"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(yearly_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb119-377"><a href="#cb119-377"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb119-378"><a href="#cb119-378"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-379"><a href="#cb119-379"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feminicide coverage over time"</span>, </span>
<span id="cb119-380"><a href="#cb119-380"></a>       <span class="at">subtitle =</span> <span class="st">"German media 2000-2025"</span>,</span>
<span id="cb119-381"><a href="#cb119-381"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb119-382"><a href="#cb119-382"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb119-383"><a href="#cb119-383"></a></span>
<span id="cb119-384"><a href="#cb119-384"></a><span class="co"># 2. Top outlets</span></span>
<span id="cb119-385"><a href="#cb119-385"></a>top_media <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-386"><a href="#cb119-386"></a>  <span class="fu">count</span>(medium_name, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-387"><a href="#cb119-387"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb119-388"><a href="#cb119-388"></a></span>
<span id="cb119-389"><a href="#cb119-389"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_media, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(medium_name, n), <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb119-390"><a href="#cb119-390"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb119-391"><a href="#cb119-391"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb119-392"><a href="#cb119-392"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-393"><a href="#cb119-393"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 15 outlets"</span>, <span class="at">x =</span> <span class="st">"Outlet"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb119-394"><a href="#cb119-394"></a></span>
<span id="cb119-395"><a href="#cb119-395"></a><span class="co"># 3. Monthly trend (last 5 years)</span></span>
<span id="cb119-396"><a href="#cb119-396"></a>recent_trend <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-397"><a href="#cb119-397"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-398"><a href="#cb119-398"></a>  <span class="fu">count</span>(month_year) <span class="sc">%&gt;%</span></span>
<span id="cb119-399"><a href="#cb119-399"></a>  <span class="fu">arrange</span>(month_year)</span>
<span id="cb119-400"><a href="#cb119-400"></a></span>
<span id="cb119-401"><a href="#cb119-401"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recent_trend, <span class="fu">aes</span>(<span class="at">x =</span> month_year, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb119-402"><a href="#cb119-402"></a>  <span class="fu">geom_line</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-403"><a href="#cb119-403"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb119-404"><a href="#cb119-404"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-405"><a href="#cb119-405"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly trend 2020-2026"</span>, <span class="at">x =</span> <span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb119-406"><a href="#cb119-406"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb119-407"><a href="#cb119-407"></a></span>
<span id="cb119-408"><a href="#cb119-408"></a><span class="fu">print</span>(p1)</span>
<span id="cb119-409"><a href="#cb119-409"></a><span class="fu">print</span>(p2) </span>
<span id="cb119-410"><a href="#cb119-410"></a><span class="fu">print</span>(p3)</span>
<span id="cb119-411"><a href="#cb119-411"></a></span>
<span id="cb119-412"><a href="#cb119-412"></a><span class="co"># Summary</span></span>
<span id="cb119-413"><a href="#cb119-413"></a>data_overview <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-414"><a href="#cb119-414"></a>  <span class="at">german_articles =</span> <span class="fu">nrow</span>(media_data),</span>
<span id="cb119-415"><a href="#cb119-415"></a>  <span class="at">date_start =</span> <span class="fu">min</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb119-416"><a href="#cb119-416"></a>  <span class="at">date_end =</span> <span class="fu">max</span>(media_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb119-417"><a href="#cb119-417"></a>  <span class="at">media_outlets =</span> <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>medium_name)),</span>
<span id="cb119-418"><a href="#cb119-418"></a>  <span class="at">avg_per_year =</span> <span class="fu">round</span>(<span class="fu">nrow</span>(media_data) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">unique</span>(media_data<span class="sc">$</span>year)))</span>
<span id="cb119-419"><a href="#cb119-419"></a>)</span>
<span id="cb119-420"><a href="#cb119-420"></a>data_overview</span>
<span id="cb119-421"><a href="#cb119-421"></a><span class="in">```</span></span>
<span id="cb119-422"><a href="#cb119-422"></a></span>
<span id="cb119-423"><a href="#cb119-423"></a><span class="in">```{r keyword-analysis}</span></span>
<span id="cb119-424"><a href="#cb119-424"></a></span>
<span id="cb119-425"><a href="#cb119-425"></a><span class="co"># Keyword frequency in headlines (central definition)</span></span>
<span id="cb119-426"><a href="#cb119-426"></a>keyword_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">keyword =</span> <span class="fu">character</span>(), <span class="at">count =</span> <span class="fu">numeric</span>())</span>
<span id="cb119-427"><a href="#cb119-427"></a></span>
<span id="cb119-428"><a href="#cb119-428"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb119-429"><a href="#cb119-429"></a>  count <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(media_data<span class="sc">$</span>head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-430"><a href="#cb119-430"></a>  keyword_counts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(keyword_counts, <span class="fu">data.frame</span>(<span class="at">keyword =</span> kw, <span class="at">count =</span> count))</span>
<span id="cb119-431"><a href="#cb119-431"></a>}</span>
<span id="cb119-432"><a href="#cb119-432"></a></span>
<span id="cb119-433"><a href="#cb119-433"></a>keyword_counts <span class="ot">&lt;-</span> keyword_counts <span class="sc">%&gt;%</span></span>
<span id="cb119-434"><a href="#cb119-434"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-435"><a href="#cb119-435"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="cb119-436"><a href="#cb119-436"></a></span>
<span id="cb119-437"><a href="#cb119-437"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(keyword, count), <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb119-438"><a href="#cb119-438"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"darkred"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb119-439"><a href="#cb119-439"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb119-440"><a href="#cb119-440"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-441"><a href="#cb119-441"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword frequency in headlines"</span>, </span>
<span id="cb119-442"><a href="#cb119-442"></a>       <span class="at">x =</span> <span class="st">"Keyword"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>)</span>
<span id="cb119-443"><a href="#cb119-443"></a></span>
<span id="cb119-444"><a href="#cb119-444"></a><span class="fu">print</span>(p4)</span>
<span id="cb119-445"><a href="#cb119-445"></a></span>
<span id="cb119-446"><a href="#cb119-446"></a><span class="co"># Print top keywords</span></span>
<span id="cb119-447"><a href="#cb119-447"></a>keyword_counts</span>
<span id="cb119-448"><a href="#cb119-448"></a><span class="in">```</span></span>
<span id="cb119-449"><a href="#cb119-449"></a></span>
<span id="cb119-450"><a href="#cb119-450"></a><span class="in">```{r time-trends}</span></span>
<span id="cb119-451"><a href="#cb119-451"></a></span>
<span id="cb119-452"><a href="#cb119-452"></a><span class="co"># Keyword time trends (central definition)</span></span>
<span id="cb119-453"><a href="#cb119-453"></a>keyword_timeline <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb119-454"><a href="#cb119-454"></a></span>
<span id="cb119-455"><a href="#cb119-455"></a><span class="cf">for</span> (kw <span class="cf">in</span> feminizid_keywords) {</span>
<span id="cb119-456"><a href="#cb119-456"></a>  yearly_kw <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-457"><a href="#cb119-457"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), <span class="sc">!</span><span class="fu">is.na</span>(head)) <span class="sc">%&gt;%</span></span>
<span id="cb119-458"><a href="#cb119-458"></a>    <span class="fu">mutate</span>(<span class="at">has_keyword =</span> <span class="fu">str_detect</span>(head, <span class="fu">regex</span>(kw, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb119-459"><a href="#cb119-459"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb119-460"><a href="#cb119-460"></a>    <span class="fu">summarise</span>(</span>
<span id="cb119-461"><a href="#cb119-461"></a>      <span class="at">total_articles =</span> <span class="fu">n</span>(),</span>
<span id="cb119-462"><a href="#cb119-462"></a>      <span class="at">keyword_articles =</span> <span class="fu">sum</span>(has_keyword, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb119-463"><a href="#cb119-463"></a>      <span class="at">percentage =</span> (keyword_articles <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb119-464"><a href="#cb119-464"></a>      <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb119-465"><a href="#cb119-465"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb119-466"><a href="#cb119-466"></a>    <span class="fu">mutate</span>(<span class="at">keyword =</span> kw)</span>
<span id="cb119-467"><a href="#cb119-467"></a>  </span>
<span id="cb119-468"><a href="#cb119-468"></a>  keyword_timeline <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(keyword_timeline, yearly_kw)</span>
<span id="cb119-469"><a href="#cb119-469"></a>}</span>
<span id="cb119-470"><a href="#cb119-470"></a></span>
<span id="cb119-471"><a href="#cb119-471"></a><span class="co"># Keep relevant keywords and years</span></span>
<span id="cb119-472"><a href="#cb119-472"></a>keyword_timeline <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb119-473"><a href="#cb119-473"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-474"><a href="#cb119-474"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb119-475"><a href="#cb119-475"></a>  <span class="fu">filter</span>(<span class="fu">sum</span>(keyword_articles) <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least 10 articles overall</span></span>
<span id="cb119-476"><a href="#cb119-476"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb119-477"><a href="#cb119-477"></a></span>
<span id="cb119-478"><a href="#cb119-478"></a><span class="co"># Absolute counts over time</span></span>
<span id="cb119-479"><a href="#cb119-479"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_timeline, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword_articles, <span class="at">color =</span> keyword)) <span class="sc">+</span></span>
<span id="cb119-480"><a href="#cb119-480"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb119-481"><a href="#cb119-481"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb119-482"><a href="#cb119-482"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-483"><a href="#cb119-483"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Time trends: keyword usage in headlines"</span>,</span>
<span id="cb119-484"><a href="#cb119-484"></a>       <span class="at">subtitle =</span> <span class="st">"Absolute article counts per year"</span>,</span>
<span id="cb119-485"><a href="#cb119-485"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>, <span class="at">color =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb119-486"><a href="#cb119-486"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb119-487"><a href="#cb119-487"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span>
<span id="cb119-488"><a href="#cb119-488"></a></span>
<span id="cb119-489"><a href="#cb119-489"></a><span class="co"># Heatmap: keywords x years</span></span>
<span id="cb119-490"><a href="#cb119-490"></a>keyword_matrix <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb119-491"><a href="#cb119-491"></a>  <span class="fu">select</span>(year, keyword, keyword_articles) <span class="sc">%&gt;%</span></span>
<span id="cb119-492"><a href="#cb119-492"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> keyword, <span class="at">values_from =</span> keyword_articles, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-493"><a href="#cb119-493"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"keyword"</span>, <span class="at">values_to =</span> <span class="st">"count"</span>)</span>
<span id="cb119-494"><a href="#cb119-494"></a></span>
<span id="cb119-495"><a href="#cb119-495"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(keyword_matrix, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(year), <span class="at">y =</span> keyword, <span class="at">fill =</span> count)) <span class="sc">+</span></span>
<span id="cb119-496"><a href="#cb119-496"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb119-497"><a href="#cb119-497"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Articles"</span>) <span class="sc">+</span></span>
<span id="cb119-498"><a href="#cb119-498"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-499"><a href="#cb119-499"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Keyword intensity over time"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Keyword"</span>) <span class="sc">+</span></span>
<span id="cb119-500"><a href="#cb119-500"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb119-501"><a href="#cb119-501"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb119-502"><a href="#cb119-502"></a></span>
<span id="cb119-503"><a href="#cb119-503"></a><span class="fu">print</span>(p5)</span>
<span id="cb119-504"><a href="#cb119-504"></a><span class="fu">print</span>(p6)</span>
<span id="cb119-505"><a href="#cb119-505"></a></span>
<span id="cb119-506"><a href="#cb119-506"></a><span class="co"># Key trends</span></span>
<span id="cb119-507"><a href="#cb119-507"></a>trend_summary <span class="ot">&lt;-</span> keyword_timeline <span class="sc">%&gt;%</span></span>
<span id="cb119-508"><a href="#cb119-508"></a>  <span class="fu">group_by</span>(keyword) <span class="sc">%&gt;%</span></span>
<span id="cb119-509"><a href="#cb119-509"></a>  <span class="fu">summarise</span>(</span>
<span id="cb119-510"><a href="#cb119-510"></a>    <span class="at">total_articles =</span> <span class="fu">sum</span>(keyword_articles),</span>
<span id="cb119-511"><a href="#cb119-511"></a>    <span class="at">peak_year =</span> year[<span class="fu">which.max</span>(keyword_articles)],</span>
<span id="cb119-512"><a href="#cb119-512"></a>    <span class="at">peak_count =</span> <span class="fu">max</span>(keyword_articles),</span>
<span id="cb119-513"><a href="#cb119-513"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb119-514"><a href="#cb119-514"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-515"><a href="#cb119-515"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_articles))</span>
<span id="cb119-516"><a href="#cb119-516"></a></span>
<span id="cb119-517"><a href="#cb119-517"></a>trend_summary</span>
<span id="cb119-518"><a href="#cb119-518"></a><span class="in">```</span></span>
<span id="cb119-519"><a href="#cb119-519"></a></span>
<span id="cb119-520"><a href="#cb119-520"></a><span class="in">```{r target-term-trends}</span></span>
<span id="cb119-521"><a href="#cb119-521"></a><span class="co"># Normalized frequency over time for grouped target terms</span></span>
<span id="cb119-522"><a href="#cb119-522"></a>USE_SMOOTH <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb119-523"><a href="#cb119-523"></a></span>
<span id="cb119-524"><a href="#cb119-524"></a>term_groups <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb119-525"><a href="#cb119-525"></a>  <span class="at">euphemistic =</span> <span class="fu">c</span>(<span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>),</span>
<span id="cb119-526"><a href="#cb119-526"></a>  <span class="at">explicit =</span> <span class="fu">c</span>(<span class="st">"Femizid"</span>, <span class="st">"Feminizid"</span>, <span class="st">"Frauenmord"</span>),</span>
<span id="cb119-527"><a href="#cb119-527"></a>  <span class="at">violence_perpetrator =</span> <span class="fu">c</span>(<span class="st">"häusliche Gewalt"</span>, <span class="st">"Misshandlung"</span>, <span class="st">"Täter"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Opfer"</span>, <span class="st">"Eifersucht"</span>)</span>
<span id="cb119-528"><a href="#cb119-528"></a>)</span>
<span id="cb119-529"><a href="#cb119-529"></a></span>
<span id="cb119-530"><a href="#cb119-530"></a>target_terms_focus <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(term_groups))</span>
<span id="cb119-531"><a href="#cb119-531"></a></span>
<span id="cb119-532"><a href="#cb119-532"></a>media_terms <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-533"><a href="#cb119-533"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-534"><a href="#cb119-534"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-535"><a href="#cb119-535"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(year),</span>
<span id="cb119-536"><a href="#cb119-536"></a>    <span class="at">content_lower =</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(content),</span>
<span id="cb119-537"><a href="#cb119-537"></a>    <span class="at">word_count =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(content_lower, <span class="st">"</span><span class="sc">\\</span><span class="st">S+"</span>)</span>
<span id="cb119-538"><a href="#cb119-538"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-539"><a href="#cb119-539"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb119-540"><a href="#cb119-540"></a></span>
<span id="cb119-541"><a href="#cb119-541"></a>total_words_year <span class="ot">&lt;-</span> media_terms <span class="sc">%&gt;%</span></span>
<span id="cb119-542"><a href="#cb119-542"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb119-543"><a href="#cb119-543"></a>  <span class="fu">summarise</span>(<span class="at">total_words =</span> <span class="fu">sum</span>(word_count), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb119-544"><a href="#cb119-544"></a></span>
<span id="cb119-545"><a href="#cb119-545"></a>make_term_regex <span class="ot">&lt;-</span> <span class="cf">function</span>(term) {</span>
<span id="cb119-546"><a href="#cb119-546"></a>  term <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(term)</span>
<span id="cb119-547"><a href="#cb119-547"></a>  parts <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(term, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb119-548"><a href="#cb119-548"></a>  <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>, <span class="fu">paste</span>(parts, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>), <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb119-549"><a href="#cb119-549"></a>}</span>
<span id="cb119-550"><a href="#cb119-550"></a></span>
<span id="cb119-551"><a href="#cb119-551"></a>term_counts <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(target_terms_focus, <span class="cf">function</span>(term) {</span>
<span id="cb119-552"><a href="#cb119-552"></a>  pattern <span class="ot">&lt;-</span> <span class="fu">make_term_regex</span>(term)</span>
<span id="cb119-553"><a href="#cb119-553"></a>  media_terms <span class="sc">%&gt;%</span></span>
<span id="cb119-554"><a href="#cb119-554"></a>    <span class="fu">mutate</span>(<span class="at">count =</span> stringr<span class="sc">::</span><span class="fu">str_count</span>(content_lower, pattern)) <span class="sc">%&gt;%</span></span>
<span id="cb119-555"><a href="#cb119-555"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb119-556"><a href="#cb119-556"></a>    <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-557"><a href="#cb119-557"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> term)</span>
<span id="cb119-558"><a href="#cb119-558"></a>}))</span>
<span id="cb119-559"><a href="#cb119-559"></a></span>
<span id="cb119-560"><a href="#cb119-560"></a>group_map <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(term_groups), <span class="cf">function</span>(g) {</span>
<span id="cb119-561"><a href="#cb119-561"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">term =</span> term_groups[[g]], <span class="at">group =</span> g)</span>
<span id="cb119-562"><a href="#cb119-562"></a>}))</span>
<span id="cb119-563"><a href="#cb119-563"></a></span>
<span id="cb119-564"><a href="#cb119-564"></a>group_counts <span class="ot">&lt;-</span> term_counts <span class="sc">%&gt;%</span></span>
<span id="cb119-565"><a href="#cb119-565"></a>  <span class="fu">left_join</span>(group_map, <span class="at">by =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-566"><a href="#cb119-566"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(group)) <span class="sc">%&gt;%</span></span>
<span id="cb119-567"><a href="#cb119-567"></a>  <span class="fu">group_by</span>(year, group) <span class="sc">%&gt;%</span></span>
<span id="cb119-568"><a href="#cb119-568"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-569"><a href="#cb119-569"></a>  <span class="fu">left_join</span>(total_words_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-570"><a href="#cb119-570"></a>  <span class="fu">mutate</span>(<span class="at">freq_per_million =</span> (count <span class="sc">/</span> total_words) <span class="sc">*</span> <span class="fl">1e6</span>)</span>
<span id="cb119-571"><a href="#cb119-571"></a></span>
<span id="cb119-572"><a href="#cb119-572"></a>p_terms_time <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(group_counts, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> freq_per_million, <span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb119-573"><a href="#cb119-573"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb119-574"><a href="#cb119-574"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-575"><a href="#cb119-575"></a>  <span class="fu">labs</span>(</span>
<span id="cb119-576"><a href="#cb119-576"></a>    <span class="at">title =</span> <span class="st">"Framing groups over time (per million words)"</span>,</span>
<span id="cb119-577"><a href="#cb119-577"></a>    <span class="at">subtitle =</span> <span class="st">"Euphemistic vs explicit vs violence/perpetrator framing"</span>,</span>
<span id="cb119-578"><a href="#cb119-578"></a>    <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency per million words"</span>, <span class="at">color =</span> <span class="st">"Group"</span></span>
<span id="cb119-579"><a href="#cb119-579"></a>  ) <span class="sc">+</span></span>
<span id="cb119-580"><a href="#cb119-580"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb119-581"><a href="#cb119-581"></a></span>
<span id="cb119-582"><a href="#cb119-582"></a><span class="cf">if</span> (USE_SMOOTH) {</span>
<span id="cb119-583"><a href="#cb119-583"></a>  p_terms_time <span class="ot">&lt;-</span> p_terms_time <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>)</span>
<span id="cb119-584"><a href="#cb119-584"></a>}</span>
<span id="cb119-585"><a href="#cb119-585"></a></span>
<span id="cb119-586"><a href="#cb119-586"></a><span class="fu">print</span>(p_terms_time)</span>
<span id="cb119-587"><a href="#cb119-587"></a><span class="in">```</span></span>
<span id="cb119-588"><a href="#cb119-588"></a></span>
<span id="cb119-589"><a href="#cb119-589"></a><span class="fu">## Corpus and preprocessing</span></span>
<span id="cb119-590"><a href="#cb119-590"></a></span>
<span id="cb119-591"><a href="#cb119-591"></a>Build a quanteda corpus and a trimmed DFM from the cleaned articles. Use the checkpoint load block to resume without reprocessing.</span>
<span id="cb119-592"><a href="#cb119-592"></a></span>
<span id="cb119-593"><a href="#cb119-593"></a><span class="in">```{r checkpoint-load-corpus}</span></span>
<span id="cb119-594"><a href="#cb119-594"></a><span class="co"># Checkpoint load (corpus/dfm)</span></span>
<span id="cb119-595"><a href="#cb119-595"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_corpus"</span>, <span class="st">"feminizid_corpus"</span>)</span>
<span id="cb119-596"><a href="#cb119-596"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_dfm"</span>, <span class="st">"feminizid_dfm_trimmed"</span>)</span>
<span id="cb119-597"><a href="#cb119-597"></a><span class="in">```</span></span>
<span id="cb119-598"><a href="#cb119-598"></a></span>
<span id="cb119-599"><a href="#cb119-599"></a><span class="in">```{r corpus-setup}</span></span>
<span id="cb119-600"><a href="#cb119-600"></a></span>
<span id="cb119-601"><a href="#cb119-601"></a>corpus_data <span class="ot">&lt;-</span> media_data <span class="sc">%&gt;%</span></span>
<span id="cb119-602"><a href="#cb119-602"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-603"><a href="#cb119-603"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-604"><a href="#cb119-604"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb119-605"><a href="#cb119-605"></a></span>
<span id="cb119-606"><a href="#cb119-606"></a><span class="fu">message</span>(<span class="st">"Articles for corpus: "</span>, <span class="fu">nrow</span>(corpus_data))</span>
<span id="cb119-607"><a href="#cb119-607"></a></span>
<span id="cb119-608"><a href="#cb119-608"></a>corpus_data<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb119-609"><a href="#cb119-609"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-610"><a href="#cb119-610"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-611"><a href="#cb119-611"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-612"><a href="#cb119-612"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb119-613"><a href="#cb119-613"></a></span>
<span id="cb119-614"><a href="#cb119-614"></a>corpus_data <span class="ot">&lt;-</span> corpus_data <span class="sc">%&gt;%</span></span>
<span id="cb119-615"><a href="#cb119-615"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clean_content), clean_content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(clean_content) <span class="sc">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb119-616"><a href="#cb119-616"></a></span>
<span id="cb119-617"><a href="#cb119-617"></a>feminizid_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(corpus_data,</span>
<span id="cb119-618"><a href="#cb119-618"></a>                            <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb119-619"><a href="#cb119-619"></a>                            <span class="at">docid_field =</span> <span class="st">"unique_id"</span>)</span>
<span id="cb119-620"><a href="#cb119-620"></a></span>
<span id="cb119-621"><a href="#cb119-621"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"original_id"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>id</span>
<span id="cb119-622"><a href="#cb119-622"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"medium"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>medium_name</span>
<span id="cb119-623"><a href="#cb119-623"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"date"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>pub_date</span>
<span id="cb119-624"><a href="#cb119-624"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"year"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>year</span>
<span id="cb119-625"><a href="#cb119-625"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"headline"</span>) <span class="ot">&lt;-</span> corpus_data<span class="sc">$</span>head</span>
<span id="cb119-626"><a href="#cb119-626"></a><span class="fu">docvars</span>(feminizid_corpus, <span class="st">"char_count"</span>) <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(corpus_data<span class="sc">$</span>char_count)</span>
<span id="cb119-627"><a href="#cb119-627"></a></span>
<span id="cb119-628"><a href="#cb119-628"></a>corpus_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-629"><a href="#cb119-629"></a>  <span class="at">documents =</span> <span class="fu">ndoc</span>(feminizid_corpus),</span>
<span id="cb119-630"><a href="#cb119-630"></a>  <span class="at">tokens =</span> <span class="fu">sum</span>(<span class="fu">ntoken</span>(feminizid_corpus)),</span>
<span id="cb119-631"><a href="#cb119-631"></a>  <span class="at">date_start =</span> <span class="fu">min</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb119-632"><a href="#cb119-632"></a>  <span class="at">date_end =</span> <span class="fu">max</span>(corpus_data<span class="sc">$</span>pub_date, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-633"><a href="#cb119-633"></a>)</span>
<span id="cb119-634"><a href="#cb119-634"></a>corpus_summary</span>
<span id="cb119-635"><a href="#cb119-635"></a></span>
<span id="cb119-636"><a href="#cb119-636"></a><span class="fu">summary</span>(feminizid_corpus, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb119-637"><a href="#cb119-637"></a></span>
<span id="cb119-638"><a href="#cb119-638"></a><span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span>
<span id="cb119-639"><a href="#cb119-639"></a><span class="in">```</span></span>
<span id="cb119-640"><a href="#cb119-640"></a></span>
<span id="cb119-641"><a href="#cb119-641"></a><span class="in">```{r text-preprocessing}</span></span>
<span id="cb119-642"><a href="#cb119-642"></a></span>
<span id="cb119-643"><a href="#cb119-643"></a><span class="co"># Load German stopwords</span></span>
<span id="cb119-644"><a href="#cb119-644"></a>german_stopwords <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"german_stopwords_full.txt"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb119-645"><a href="#cb119-645"></a>german_stopwords <span class="ot">&lt;-</span> german_stopwords[german_stopwords <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb119-646"><a href="#cb119-646"></a></span>
<span id="cb119-647"><a href="#cb119-647"></a><span class="co"># Media-specific stopwords</span></span>
<span id="cb119-648"><a href="#cb119-648"></a>media_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"uhr"</span>, <span class="st">"jahr"</span>, <span class="st">"jahre"</span>, <span class="st">"jahren"</span>, <span class="st">"prozent"</span>, <span class="st">"franken"</span>, <span class="st">"chf"</span>,</span>
<span id="cb119-649"><a href="#cb119-649"></a>                    <span class="st">"artikel"</span>, <span class="st">"bericht"</span>, <span class="st">"zeitung"</span>, <span class="st">"medium"</span>, <span class="st">"redaktion"</span>, <span class="st">"autor"</span>,</span>
<span id="cb119-650"><a href="#cb119-650"></a>                    <span class="st">"quelle"</span>, <span class="st">"foto"</span>, <span class="st">"bild"</span>, <span class="st">"video"</span>, <span class="st">"online"</span>, <span class="st">"www"</span>, <span class="st">"http"</span>,</span>
<span id="cb119-651"><a href="#cb119-651"></a>                    <span class="st">"montag"</span>, <span class="st">"dienstag"</span>, <span class="st">"mittwoch"</span>, <span class="st">"donnerstag"</span>, <span class="st">"freitag"</span>,</span>
<span id="cb119-652"><a href="#cb119-652"></a>                    <span class="st">"samstag"</span>, <span class="st">"sonntag"</span>, <span class="st">"januar"</span>, <span class="st">"februar"</span>, <span class="st">"märz"</span>, <span class="st">"april"</span>,</span>
<span id="cb119-653"><a href="#cb119-653"></a>                    <span class="st">"mai"</span>, <span class="st">"juni"</span>, <span class="st">"juli"</span>, <span class="st">"august"</span>, <span class="st">"september"</span>, <span class="st">"oktober"</span>,</span>
<span id="cb119-654"><a href="#cb119-654"></a>                    <span class="st">"november"</span>, <span class="st">"dezember"</span>, <span class="st">"schweiz"</span>, <span class="st">"schweizer"</span>, <span class="st">"schweizerin"</span>)</span>
<span id="cb119-655"><a href="#cb119-655"></a></span>
<span id="cb119-656"><a href="#cb119-656"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(german_stopwords, media_stopwords)</span>
<span id="cb119-657"><a href="#cb119-657"></a>all_stopwords <span class="ot">&lt;-</span> <span class="fu">unique</span>(stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(all_stopwords))</span>
<span id="cb119-658"><a href="#cb119-658"></a>all_stopwords <span class="ot">&lt;-</span> all_stopwords[<span class="fu">nzchar</span>(all_stopwords)]</span>
<span id="cb119-659"><a href="#cb119-659"></a></span>
<span id="cb119-660"><a href="#cb119-660"></a></span>
<span id="cb119-661"><a href="#cb119-661"></a><span class="co"># Tokenisierung und Preprocessing</span></span>
<span id="cb119-662"><a href="#cb119-662"></a>feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(feminizid_corpus,</span>
<span id="cb119-663"><a href="#cb119-663"></a>                          <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-664"><a href="#cb119-664"></a>                          <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-665"><a href="#cb119-665"></a>                          <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-666"><a href="#cb119-666"></a>                          <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-667"><a href="#cb119-667"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-668"><a href="#cb119-668"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-669"><a href="#cb119-669"></a></span>
<span id="cb119-670"><a href="#cb119-670"></a><span class="co"># Stemming (optional)</span></span>
<span id="cb119-671"><a href="#cb119-671"></a><span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb119-672"><a href="#cb119-672"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(feminizid_tokens, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb119-673"><a href="#cb119-673"></a>}</span>
<span id="cb119-674"><a href="#cb119-674"></a></span>
<span id="cb119-675"><a href="#cb119-675"></a><span class="co"># Then multi-word expressions (now with base forms)</span></span>
<span id="cb119-676"><a href="#cb119-676"></a><span class="co"># Simplified patterns - base forms are sufficient</span></span>
<span id="cb119-677"><a href="#cb119-677"></a><span class="co"># Uses simplified_patterns defined in text-config</span></span>
<span id="cb119-678"><a href="#cb119-678"></a></span>
<span id="cb119-679"><a href="#cb119-679"></a><span class="co"># Compound multi-word expressions into single tokens</span></span>
<span id="cb119-680"><a href="#cb119-680"></a><span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb119-681"><a href="#cb119-681"></a>  feminizid_tokens <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(feminizid_tokens, </span>
<span id="cb119-682"><a href="#cb119-682"></a>                                      <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb119-683"><a href="#cb119-683"></a>                                      <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb119-684"><a href="#cb119-684"></a>}</span>
<span id="cb119-685"><a href="#cb119-685"></a></span>
<span id="cb119-686"><a href="#cb119-686"></a>preprocessing_steps <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-687"><a href="#cb119-687"></a>  <span class="at">step =</span> <span class="fu">c</span>(<span class="st">"Stemming"</span>, <span class="st">"Multi-word expressions"</span>, <span class="st">"Benefit"</span>),</span>
<span id="cb119-688"><a href="#cb119-688"></a>  <span class="at">detail =</span> <span class="fu">c</span>(</span>
<span id="cb119-689"><a href="#cb119-689"></a>    <span class="st">"Reduces inflectional variants (e.g., häusliche→häusl, tötung→töt)"</span>,</span>
<span id="cb119-690"><a href="#cb119-690"></a>    <span class="fu">paste</span>(<span class="fu">length</span>(simplified_patterns), <span class="st">"word pairs compounded (e.g., häusl + gewalt → häusl_gewalt)"</span>),</span>
<span id="cb119-691"><a href="#cb119-691"></a>    <span class="st">"One pattern captures multiple variants"</span></span>
<span id="cb119-692"><a href="#cb119-692"></a>  )</span>
<span id="cb119-693"><a href="#cb119-693"></a>)</span>
<span id="cb119-694"><a href="#cb119-694"></a>preprocessing_steps</span>
<span id="cb119-695"><a href="#cb119-695"></a></span>
<span id="cb119-696"><a href="#cb119-696"></a><span class="co"># Document-Feature-Matrix</span></span>
<span id="cb119-697"><a href="#cb119-697"></a>feminizid_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(feminizid_tokens)</span>
<span id="cb119-698"><a href="#cb119-698"></a></span>
<span id="cb119-699"><a href="#cb119-699"></a><span class="co"># Trimming: consistent parameters (both as proportions)</span></span>
<span id="cb119-700"><a href="#cb119-700"></a><span class="co"># Based on quanteda documentation: https://quanteda.io/reference/dfm_trim.html</span></span>
<span id="cb119-701"><a href="#cb119-701"></a>feminizid_dfm_trimmed <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(feminizid_dfm, </span>
<span id="cb119-702"><a href="#cb119-702"></a>                                  <span class="at">min_docfreq =</span> <span class="fl">0.0003</span>,  <span class="co"># Min 0.03% (~11 docs at 35k)</span></span>
<span id="cb119-703"><a href="#cb119-703"></a>                                  <span class="at">max_docfreq =</span> <span class="fl">0.90</span>,    <span class="co"># Max 90% of documents</span></span>
<span id="cb119-704"><a href="#cb119-704"></a>                                  <span class="at">docfreq_type =</span> <span class="st">"prop"</span>)  <span class="co"># Both as proportions</span></span>
<span id="cb119-705"><a href="#cb119-705"></a></span>
<span id="cb119-706"><a href="#cb119-706"></a>preprocessing_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-707"><a href="#cb119-707"></a>  <span class="at">documents =</span> <span class="fu">ndoc</span>(feminizid_dfm),</span>
<span id="cb119-708"><a href="#cb119-708"></a>  <span class="at">original_features =</span> <span class="fu">nfeat</span>(feminizid_dfm),</span>
<span id="cb119-709"><a href="#cb119-709"></a>  <span class="at">trimmed_features =</span> <span class="fu">nfeat</span>(feminizid_dfm_trimmed),</span>
<span id="cb119-710"><a href="#cb119-710"></a>  <span class="at">sparsity =</span> <span class="fu">round</span>(<span class="fu">sparsity</span>(feminizid_dfm_trimmed), <span class="dv">3</span>)</span>
<span id="cb119-711"><a href="#cb119-711"></a>)</span>
<span id="cb119-712"><a href="#cb119-712"></a>preprocessing_summary</span>
<span id="cb119-713"><a href="#cb119-713"></a></span>
<span id="cb119-714"><a href="#cb119-714"></a><span class="co"># Most frequent words</span></span>
<span id="cb119-715"><a href="#cb119-715"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-716"><a href="#cb119-716"></a>  top_features <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">25</span>)</span>
<span id="cb119-717"><a href="#cb119-717"></a>  top_features_df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-718"><a href="#cb119-718"></a>    <span class="at">term =</span> <span class="fu">names</span>(top_features),</span>
<span id="cb119-719"><a href="#cb119-719"></a>    <span class="at">frequency =</span> <span class="fu">as.numeric</span>(top_features)</span>
<span id="cb119-720"><a href="#cb119-720"></a>  )</span>
<span id="cb119-721"><a href="#cb119-721"></a>  top_features_df</span>
<span id="cb119-722"><a href="#cb119-722"></a>} <span class="cf">else</span> {</span>
<span id="cb119-723"><a href="#cb119-723"></a>  <span class="fu">message</span>(<span class="st">"WARN: No features after trimming - adjust parameters"</span>)</span>
<span id="cb119-724"><a href="#cb119-724"></a>}</span>
<span id="cb119-725"><a href="#cb119-725"></a><span class="in">```</span></span>
<span id="cb119-726"><a href="#cb119-726"></a></span>
<span id="cb119-727"><a href="#cb119-727"></a><span class="in">```{r checkpoint-save-dfm}</span></span>
<span id="cb119-728"><a href="#cb119-728"></a><span class="co"># Checkpoint save (DFM and optional corpus)</span></span>
<span id="cb119-729"><a href="#cb119-729"></a><span class="cf">if</span> (<span class="fu">nfeat</span>(feminizid_dfm_trimmed) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-730"><a href="#cb119-730"></a>  <span class="fu">save_checkpoint</span>(feminizid_dfm_trimmed, <span class="st">"feminizid_dfm"</span>)</span>
<span id="cb119-731"><a href="#cb119-731"></a>}</span>
<span id="cb119-732"><a href="#cb119-732"></a><span class="cf">if</span> (SAVE_CORPUS) {</span>
<span id="cb119-733"><a href="#cb119-733"></a>  <span class="fu">save_checkpoint</span>(feminizid_corpus, <span class="st">"feminizid_corpus"</span>)</span>
<span id="cb119-734"><a href="#cb119-734"></a>}</span>
<span id="cb119-735"><a href="#cb119-735"></a><span class="in">```</span></span>
<span id="cb119-736"><a href="#cb119-736"></a></span>
<span id="cb119-737"><a href="#cb119-737"></a><span class="in">```{r visualization}</span></span>
<span id="cb119-738"><a href="#cb119-738"></a><span class="co"># Use quanteda.textplots if available, otherwise fallback to wordcloud</span></span>
<span id="cb119-739"><a href="#cb119-739"></a><span class="cf">if</span> (<span class="st">"textplot_wordcloud"</span> <span class="sc">%in%</span> <span class="fu">ls</span>(<span class="st">"package:quanteda.textplots"</span>)) {</span>
<span id="cb119-740"><a href="#cb119-740"></a>  <span class="fu">textplot_wordcloud</span>(feminizid_dfm_trimmed, </span>
<span id="cb119-741"><a href="#cb119-741"></a>                    <span class="at">min_count =</span> <span class="dv">30</span>,</span>
<span id="cb119-742"><a href="#cb119-742"></a>                    <span class="at">max_words =</span> <span class="dv">100</span>,</span>
<span id="cb119-743"><a href="#cb119-743"></a>                    <span class="at">color =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb119-744"><a href="#cb119-744"></a>} <span class="cf">else</span> {</span>
<span id="cb119-745"><a href="#cb119-745"></a>  <span class="co"># Alternative mit wordcloud package</span></span>
<span id="cb119-746"><a href="#cb119-746"></a>  freq_data <span class="ot">&lt;-</span> <span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">100</span>)</span>
<span id="cb119-747"><a href="#cb119-747"></a>  <span class="fu">wordcloud</span>(<span class="fu">names</span>(freq_data), freq_data, </span>
<span id="cb119-748"><a href="#cb119-748"></a>           <span class="at">min.freq =</span> <span class="dv">30</span>, <span class="at">max.words =</span> <span class="dv">100</span>,</span>
<span id="cb119-749"><a href="#cb119-749"></a>           <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>),</span>
<span id="cb119-750"><a href="#cb119-750"></a>           <span class="at">random.order =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-751"><a href="#cb119-751"></a>}</span>
<span id="cb119-752"><a href="#cb119-752"></a></span>
<span id="cb119-753"><a href="#cb119-753"></a><span class="co"># Feature frequency over time (normalized)</span></span>
<span id="cb119-754"><a href="#cb119-754"></a><span class="co"># Top 10 features by year</span></span>
<span id="cb119-755"><a href="#cb119-755"></a>top_terms <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(feminizid_dfm_trimmed, <span class="dv">10</span>))</span>
<span id="cb119-756"><a href="#cb119-756"></a>  </span>
<span id="cb119-757"><a href="#cb119-757"></a><span class="co"># Frequency of these terms over years</span></span>
<span id="cb119-758"><a href="#cb119-758"></a>yearly_terms <span class="ot">&lt;-</span> <span class="fu">dfm_group</span>(feminizid_dfm_trimmed, <span class="at">groups =</span> <span class="fu">docvars</span>(feminizid_dfm_trimmed, <span class="st">"year"</span>))</span>
<span id="cb119-759"><a href="#cb119-759"></a></span>
<span id="cb119-760"><a href="#cb119-760"></a><span class="co"># Articles per year for normalization</span></span>
<span id="cb119-761"><a href="#cb119-761"></a>articles_per_year <span class="ot">&lt;-</span> feminizid_corpus <span class="sc">%&gt;%</span></span>
<span id="cb119-762"><a href="#cb119-762"></a>  <span class="fu">docvars</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-763"><a href="#cb119-763"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span>  <span class="co"># Convert year to numeric</span></span>
<span id="cb119-764"><a href="#cb119-764"></a>  <span class="fu">count</span>(year, <span class="at">name =</span> <span class="st">"total_articles"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-765"><a href="#cb119-765"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb119-766"><a href="#cb119-766"></a></span>
<span id="cb119-767"><a href="#cb119-767"></a><span class="co"># Correct conversion for quanteda 3.0+ - without doc_id column</span></span>
<span id="cb119-768"><a href="#cb119-768"></a>term_data <span class="ot">&lt;-</span> <span class="fu">convert</span>(yearly_terms[, top_terms], <span class="at">to =</span> <span class="st">"data.frame"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-769"><a href="#cb119-769"></a>  <span class="fu">select</span>(<span class="sc">-</span>doc_id) <span class="sc">%&gt;%</span>  <span class="co"># Remove doc_id column</span></span>
<span id="cb119-770"><a href="#cb119-770"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(yearly_terms)))</span>
<span id="cb119-771"><a href="#cb119-771"></a></span>
<span id="cb119-772"><a href="#cb119-772"></a><span class="co"># Absolute frequencies</span></span>
<span id="cb119-773"><a href="#cb119-773"></a>term_timeline_abs <span class="ot">&lt;-</span> term_data <span class="sc">%&gt;%</span></span>
<span id="cb119-774"><a href="#cb119-774"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">"term"</span>, <span class="at">values_to =</span> <span class="st">"frequency"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-775"><a href="#cb119-775"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>, year <span class="sc">&lt;=</span> <span class="dv">2025</span>)</span>
<span id="cb119-776"><a href="#cb119-776"></a></span>
<span id="cb119-777"><a href="#cb119-777"></a><span class="co"># Normalized frequencies (per 1000 articles)</span></span>
<span id="cb119-778"><a href="#cb119-778"></a>term_timeline_norm <span class="ot">&lt;-</span> term_timeline_abs <span class="sc">%&gt;%</span></span>
<span id="cb119-779"><a href="#cb119-779"></a>  <span class="fu">left_join</span>(articles_per_year, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-780"><a href="#cb119-780"></a>  <span class="fu">mutate</span>(<span class="at">frequency_per_1000 =</span> (frequency <span class="sc">/</span> total_articles) <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-781"><a href="#cb119-781"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_articles), total_articles <span class="sc">&gt;</span> <span class="dv">10</span>)  <span class="co"># Only years with &gt;10 articles</span></span>
<span id="cb119-782"><a href="#cb119-782"></a></span>
<span id="cb119-783"><a href="#cb119-783"></a><span class="co"># Plot 1: Absolute frequencies</span></span>
<span id="cb119-784"><a href="#cb119-784"></a>p7a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_abs, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb119-785"><a href="#cb119-785"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb119-786"><a href="#cb119-786"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-787"><a href="#cb119-787"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (absolute)"</span>, </span>
<span id="cb119-788"><a href="#cb119-788"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Absolute frequency"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb119-789"><a href="#cb119-789"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb119-790"><a href="#cb119-790"></a></span>
<span id="cb119-791"><a href="#cb119-791"></a><span class="co"># Plot 2: Normalized frequencies (per 1000 articles)</span></span>
<span id="cb119-792"><a href="#cb119-792"></a>p7b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_timeline_norm, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> frequency_per_1000, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb119-793"><a href="#cb119-793"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb119-794"><a href="#cb119-794"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-795"><a href="#cb119-795"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most frequent terms over time (normalized per 1000 articles)"</span>, </span>
<span id="cb119-796"><a href="#cb119-796"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Frequency per 1000 articles"</span>, <span class="at">color =</span> <span class="st">"Term"</span>) <span class="sc">+</span></span>
<span id="cb119-797"><a href="#cb119-797"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb119-798"><a href="#cb119-798"></a></span>
<span id="cb119-799"><a href="#cb119-799"></a><span class="co"># Plot 3: Article distribution over time (sanity check)</span></span>
<span id="cb119-800"><a href="#cb119-800"></a>p7c <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(articles_per_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_articles)) <span class="sc">+</span></span>
<span id="cb119-801"><a href="#cb119-801"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb119-802"><a href="#cb119-802"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb119-803"><a href="#cb119-803"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-804"><a href="#cb119-804"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Article distribution over time"</span>, </span>
<span id="cb119-805"><a href="#cb119-805"></a>        <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Article count"</span>) <span class="sc">+</span></span>
<span id="cb119-806"><a href="#cb119-806"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)</span>
<span id="cb119-807"><a href="#cb119-807"></a></span>
<span id="cb119-808"><a href="#cb119-808"></a><span class="fu">print</span>(p7a)</span>
<span id="cb119-809"><a href="#cb119-809"></a><span class="fu">print</span>(p7b) </span>
<span id="cb119-810"><a href="#cb119-810"></a><span class="fu">print</span>(p7c)</span>
<span id="cb119-811"><a href="#cb119-811"></a></span>
<span id="cb119-812"><a href="#cb119-812"></a><span class="co"># Normalization summary</span></span>
<span id="cb119-813"><a href="#cb119-813"></a>summary_stats <span class="ot">&lt;-</span> articles_per_year <span class="sc">%&gt;%</span></span>
<span id="cb119-814"><a href="#cb119-814"></a>  <span class="fu">summarise</span>(</span>
<span id="cb119-815"><a href="#cb119-815"></a>    <span class="at">min_articles =</span> <span class="fu">min</span>(total_articles),</span>
<span id="cb119-816"><a href="#cb119-816"></a>    <span class="at">max_articles =</span> <span class="fu">max</span>(total_articles),</span>
<span id="cb119-817"><a href="#cb119-817"></a>    <span class="at">mean_articles =</span> <span class="fu">round</span>(<span class="fu">mean</span>(total_articles)),</span>
<span id="cb119-818"><a href="#cb119-818"></a>    <span class="at">median_articles =</span> <span class="fu">median</span>(total_articles),</span>
<span id="cb119-819"><a href="#cb119-819"></a>    <span class="at">ratio_max_min =</span> <span class="fu">round</span>(<span class="fu">max</span>(total_articles) <span class="sc">/</span> <span class="fu">min</span>(total_articles), <span class="dv">1</span>)</span>
<span id="cb119-820"><a href="#cb119-820"></a>  )</span>
<span id="cb119-821"><a href="#cb119-821"></a>summary_stats</span>
<span id="cb119-822"><a href="#cb119-822"></a></span>
<span id="cb119-823"><a href="#cb119-823"></a><span class="cf">if</span> (summary_stats<span class="sc">$</span>ratio_max_min <span class="sc">&gt;</span> <span class="dv">5</span>) {</span>
<span id="cb119-824"><a href="#cb119-824"></a>  <span class="fu">message</span>(<span class="st">"WARN: Strong distortion detected - normalized view recommended"</span>)</span>
<span id="cb119-825"><a href="#cb119-825"></a>}</span>
<span id="cb119-826"><a href="#cb119-826"></a></span>
<span id="cb119-827"><a href="#cb119-827"></a><span class="in">```</span></span>
<span id="cb119-828"><a href="#cb119-828"></a></span>
<span id="cb119-829"><a href="#cb119-829"></a><span class="fu">## Word2Vec frame shift (diachronic)</span></span>
<span id="cb119-830"><a href="#cb119-830"></a></span>
<span id="cb119-831"><a href="#cb119-831"></a>We train separate embeddings for five-year windows and compare nearest neighbors of key terms. This lets us observe shifts in semantic neighborhoods without implying causality.</span>
<span id="cb119-832"><a href="#cb119-832"></a></span>
<span id="cb119-833"><a href="#cb119-833"></a>Train one Word2Vec model per time window and compare nearest neighbors across periods. Use the checkpoint load block to resume without retraining.</span>
<span id="cb119-834"><a href="#cb119-834"></a></span>
<span id="cb119-835"><a href="#cb119-835"></a><span class="in">```{r checkpoint-load-word2vec}</span></span>
<span id="cb119-836"><a href="#cb119-836"></a><span class="co"># Checkpoint load (Word2Vec)</span></span>
<span id="cb119-837"><a href="#cb119-837"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb119-838"><a href="#cb119-838"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_frame_shifts"</span>, <span class="st">"all_frame_shifts"</span>)</span>
<span id="cb119-839"><a href="#cb119-839"></a><span class="in">```</span></span>
<span id="cb119-840"><a href="#cb119-840"></a></span>
<span id="cb119-841"><a href="#cb119-841"></a><span class="in">```{r word2vec-setup}</span></span>
<span id="cb119-842"><a href="#cb119-842"></a><span class="co"># Time windows (5-year bins)</span></span>
<span id="cb119-843"><a href="#cb119-843"></a>time_windows <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb119-844"><a href="#cb119-844"></a>  <span class="st">"2000-2004"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2004</span>),</span>
<span id="cb119-845"><a href="#cb119-845"></a>  <span class="st">"2005-2009"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2005</span>, <span class="dv">2009</span>), </span>
<span id="cb119-846"><a href="#cb119-846"></a>  <span class="st">"2010-2014"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2014</span>),</span>
<span id="cb119-847"><a href="#cb119-847"></a>  <span class="st">"2015-2019"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2015</span>, <span class="dv">2019</span>),</span>
<span id="cb119-848"><a href="#cb119-848"></a>  <span class="st">"2020-2025"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2025</span>)</span>
<span id="cb119-849"><a href="#cb119-849"></a>)</span>
<span id="cb119-850"><a href="#cb119-850"></a></span>
<span id="cb119-851"><a href="#cb119-851"></a><span class="co"># Target terms for frame-shift analysis (interpretable terms)</span></span>
<span id="cb119-852"><a href="#cb119-852"></a>target_words <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-853"><a href="#cb119-853"></a>  <span class="st">"Frauenmord"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Familiendrama"</span>, <span class="st">"Misshandlung"</span>,</span>
<span id="cb119-854"><a href="#cb119-854"></a>  <span class="st">"Eifersucht"</span>, <span class="st">"Femizid"</span>, <span class="st">"Feminizid"</span>, <span class="st">"Familientragödie"</span>,</span>
<span id="cb119-855"><a href="#cb119-855"></a>  <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span>, <span class="st">"häusliche Gewalt"</span>, <span class="st">"Opfer"</span>, <span class="st">"Täter"</span></span>
<span id="cb119-856"><a href="#cb119-856"></a>)</span>
<span id="cb119-857"><a href="#cb119-857"></a></span>
<span id="cb119-858"><a href="#cb119-858"></a>target_map <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb119-859"><a href="#cb119-859"></a>  <span class="at">original =</span> target_words,</span>
<span id="cb119-860"><a href="#cb119-860"></a>  <span class="at">normalized =</span> <span class="fu">normalize_terms_for_model</span>(target_words),</span>
<span id="cb119-861"><a href="#cb119-861"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-862"><a href="#cb119-862"></a>)</span>
<span id="cb119-863"><a href="#cb119-863"></a></span>
<span id="cb119-864"><a href="#cb119-864"></a>w2v_setup_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-865"><a href="#cb119-865"></a>  <span class="at">time_windows =</span> <span class="fu">length</span>(time_windows),</span>
<span id="cb119-866"><a href="#cb119-866"></a>  <span class="at">target_words =</span> <span class="fu">length</span>(target_words),</span>
<span id="cb119-867"><a href="#cb119-867"></a>  <span class="at">strategy =</span> <span class="st">"one model per window"</span>,</span>
<span id="cb119-868"><a href="#cb119-868"></a>  <span class="at">full_model =</span> <span class="cf">if</span> (TRAIN_FULL_MODEL) FULL_MODEL_LABEL <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb119-869"><a href="#cb119-869"></a>)</span>
<span id="cb119-870"><a href="#cb119-870"></a>w2v_setup_summary</span>
<span id="cb119-871"><a href="#cb119-871"></a><span class="in">```</span></span>
<span id="cb119-872"><a href="#cb119-872"></a></span>
<span id="cb119-873"><a href="#cb119-873"></a><span class="in">```{r word2vec-training}</span></span>
<span id="cb119-874"><a href="#cb119-874"></a></span>
<span id="cb119-875"><a href="#cb119-875"></a><span class="co"># Train models for each window + optional full-period model</span></span>
<span id="cb119-876"><a href="#cb119-876"></a>existing_vectors <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"word2vec_vectors"</span>)</span>
<span id="cb119-877"><a href="#cb119-877"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_WORD2VEC_TRAINING) {</span>
<span id="cb119-878"><a href="#cb119-878"></a>  <span class="fu">message</span>(<span class="st">"Word2Vec training disabled (RUN_WORD2VEC_TRAINING = FALSE)."</span>)</span>
<span id="cb119-879"><a href="#cb119-879"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb119-880"><a href="#cb119-880"></a>    <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb119-881"><a href="#cb119-881"></a>  }</span>
<span id="cb119-882"><a href="#cb119-882"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>FORCE_WORD2VEC_TRAINING <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb119-883"><a href="#cb119-883"></a>  <span class="fu">message</span>(<span class="st">"Word2Vec vectors already exist; skipping training."</span>)</span>
<span id="cb119-884"><a href="#cb119-884"></a>  <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors"</span>, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb119-885"><a href="#cb119-885"></a>} <span class="cf">else</span> {</span>
<span id="cb119-886"><a href="#cb119-886"></a>  word2vec_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-887"><a href="#cb119-887"></a></span>
<span id="cb119-888"><a href="#cb119-888"></a><span class="co"># Optional progress bar (per window)</span></span>
<span id="cb119-889"><a href="#cb119-889"></a>use_progress <span class="ot">&lt;-</span> <span class="fu">requireNamespace</span>(<span class="st">"progress"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-890"><a href="#cb119-890"></a><span class="cf">if</span> (<span class="sc">!</span>use_progress) {</span>
<span id="cb119-891"><a href="#cb119-891"></a>  <span class="fu">message</span>(<span class="st">"Tip: install.packages('progress') for a progress bar."</span>)</span>
<span id="cb119-892"><a href="#cb119-892"></a>}</span>
<span id="cb119-893"><a href="#cb119-893"></a></span>
<span id="cb119-894"><a href="#cb119-894"></a>build_w2v_text <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus_obj) {</span>
<span id="cb119-895"><a href="#cb119-895"></a>  tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_obj,</span>
<span id="cb119-896"><a href="#cb119-896"></a>                        <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-897"><a href="#cb119-897"></a>                        <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-898"><a href="#cb119-898"></a>                        <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-899"><a href="#cb119-899"></a>                        <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-900"><a href="#cb119-900"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-901"><a href="#cb119-901"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-902"><a href="#cb119-902"></a>  <span class="cf">if</span> (USE_STEMMING) {</span>
<span id="cb119-903"><a href="#cb119-903"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_obj, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb119-904"><a href="#cb119-904"></a>  }</span>
<span id="cb119-905"><a href="#cb119-905"></a>  <span class="cf">for</span> (pattern <span class="cf">in</span> simplified_patterns) {</span>
<span id="cb119-906"><a href="#cb119-906"></a>    tokens_obj <span class="ot">&lt;-</span> <span class="fu">tokens_compound</span>(tokens_obj,</span>
<span id="cb119-907"><a href="#cb119-907"></a>                                  <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">paste</span>(pattern, <span class="at">collapse =</span> <span class="st">" "</span>)),</span>
<span id="cb119-908"><a href="#cb119-908"></a>                                  <span class="at">concatenator =</span> <span class="st">"_"</span>)</span>
<span id="cb119-909"><a href="#cb119-909"></a>  }</span>
<span id="cb119-910"><a href="#cb119-910"></a>  txt <span class="ot">&lt;-</span> <span class="fu">sapply</span>(tokens_obj, paste, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb119-911"><a href="#cb119-911"></a>  txt[<span class="fu">nchar</span>(txt) <span class="sc">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb119-912"><a href="#cb119-912"></a>}</span>
<span id="cb119-913"><a href="#cb119-913"></a></span>
<span id="cb119-914"><a href="#cb119-914"></a>train_w2v <span class="ot">&lt;-</span> <span class="cf">function</span>(label, corpus_obj) {</span>
<span id="cb119-915"><a href="#cb119-915"></a>  n_docs <span class="ot">&lt;-</span> <span class="fu">ndoc</span>(corpus_obj)</span>
<span id="cb119-916"><a href="#cb119-916"></a>  txt <span class="ot">&lt;-</span> <span class="fu">build_w2v_text</span>(corpus_obj)</span>
<span id="cb119-917"><a href="#cb119-917"></a>  <span class="cf">if</span> (n_docs <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">||</span> <span class="fu">length</span>(txt) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb119-918"><a href="#cb119-918"></a>    <span class="fu">message</span>(<span class="st">"WARN: Skip "</span>, label, <span class="st">" - too little data"</span>)</span>
<span id="cb119-919"><a href="#cb119-919"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb119-920"><a href="#cb119-920"></a>  }</span>
<span id="cb119-921"><a href="#cb119-921"></a>  <span class="fu">message</span>(<span class="st">"Training Word2Vec for "</span>, label, <span class="st">" ("</span>, n_docs, <span class="st">" docs, "</span>, <span class="fu">length</span>(txt), <span class="st">" texts)..."</span>)</span>
<span id="cb119-922"><a href="#cb119-922"></a>  w2v_args <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb119-923"><a href="#cb119-923"></a>    <span class="at">x =</span> txt,</span>
<span id="cb119-924"><a href="#cb119-924"></a>    <span class="at">type =</span> <span class="st">"skip-gram"</span>,</span>
<span id="cb119-925"><a href="#cb119-925"></a>    <span class="at">dim =</span> <span class="dv">100</span>,</span>
<span id="cb119-926"><a href="#cb119-926"></a>    <span class="at">iter =</span> <span class="dv">20</span>,</span>
<span id="cb119-927"><a href="#cb119-927"></a>    <span class="at">min_count =</span> <span class="dv">5</span>,</span>
<span id="cb119-928"><a href="#cb119-928"></a>    <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb119-929"><a href="#cb119-929"></a>    <span class="at">threads =</span> <span class="fu">max</span>(<span class="dv">1</span>, parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb119-930"><a href="#cb119-930"></a>  )</span>
<span id="cb119-931"><a href="#cb119-931"></a>  <span class="fu">do.call</span>(word2vec<span class="sc">::</span>word2vec, w2v_args)</span>
<span id="cb119-932"><a href="#cb119-932"></a>}</span>
<span id="cb119-933"><a href="#cb119-933"></a></span>
<span id="cb119-934"><a href="#cb119-934"></a>pb <span class="ot">&lt;-</span> <span class="cf">if</span> (use_progress) progress<span class="sc">::</span>progress_bar<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb119-935"><a href="#cb119-935"></a>  <span class="at">format =</span> <span class="st">"Training :current/:total [:bar] :percent :eta"</span>,</span>
<span id="cb119-936"><a href="#cb119-936"></a>  <span class="at">total =</span> <span class="fu">length</span>(time_windows),</span>
<span id="cb119-937"><a href="#cb119-937"></a>  <span class="at">clear =</span> <span class="cn">FALSE</span>,</span>
<span id="cb119-938"><a href="#cb119-938"></a>  <span class="at">width =</span> <span class="dv">60</span></span>
<span id="cb119-939"><a href="#cb119-939"></a>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb119-940"><a href="#cb119-940"></a></span>
<span id="cb119-941"><a href="#cb119-941"></a>  <span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows)) {</span>
<span id="cb119-942"><a href="#cb119-942"></a>    <span class="cf">if</span> (use_progress) pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb119-943"><a href="#cb119-943"></a>    window_years <span class="ot">&lt;-</span> time_windows[[window_name]]</span>
<span id="cb119-944"><a href="#cb119-944"></a>    window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb119-945"><a href="#cb119-945"></a>      feminizid_corpus,</span>
<span id="cb119-946"><a href="#cb119-946"></a>      year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb119-947"><a href="#cb119-947"></a>    )</span>
<span id="cb119-948"><a href="#cb119-948"></a>    model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb119-949"><a href="#cb119-949"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(model)) <span class="cf">next</span></span>
<span id="cb119-950"><a href="#cb119-950"></a>    word2vec_models[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb119-951"><a href="#cb119-951"></a>  }</span>
<span id="cb119-952"><a href="#cb119-952"></a></span>
<span id="cb119-953"><a href="#cb119-953"></a>  <span class="cf">if</span> (TRAIN_FULL_MODEL) {</span>
<span id="cb119-954"><a href="#cb119-954"></a>    full_model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(FULL_MODEL_LABEL, feminizid_corpus)</span>
<span id="cb119-955"><a href="#cb119-955"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(full_model)) {</span>
<span id="cb119-956"><a href="#cb119-956"></a>      word2vec_models[[FULL_MODEL_LABEL]] <span class="ot">&lt;-</span> full_model</span>
<span id="cb119-957"><a href="#cb119-957"></a>    }</span>
<span id="cb119-958"><a href="#cb119-958"></a>  }</span>
<span id="cb119-959"><a href="#cb119-959"></a></span>
<span id="cb119-960"><a href="#cb119-960"></a>  <span class="fu">message</span>(<span class="st">"Training done. Models: "</span>, <span class="fu">length</span>(word2vec_models))</span>
<span id="cb119-961"><a href="#cb119-961"></a></span>
<span id="cb119-962"><a href="#cb119-962"></a>  word2vec_vectors <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_models, as.matrix)</span>
<span id="cb119-963"><a href="#cb119-963"></a>  <span class="fu">save_checkpoint</span>(word2vec_vectors, <span class="st">"word2vec_vectors"</span>)</span>
<span id="cb119-964"><a href="#cb119-964"></a>}</span>
<span id="cb119-965"><a href="#cb119-965"></a><span class="in">```</span></span>
<span id="cb119-966"><a href="#cb119-966"></a></span>
<span id="cb119-967"><a href="#cb119-967"></a><span class="in">```{r word2vec-frame-shift}</span></span>
<span id="cb119-968"><a href="#cb119-968"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb119-969"><a href="#cb119-969"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb119-970"><a href="#cb119-970"></a>}</span>
<span id="cb119-971"><a href="#cb119-971"></a></span>
<span id="cb119-972"><a href="#cb119-972"></a>window_models <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_vectors), <span class="fu">names</span>(time_windows))</span>
<span id="cb119-973"><a href="#cb119-973"></a><span class="cf">if</span> (<span class="fu">length</span>(window_models) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb119-974"><a href="#cb119-974"></a>  </span>
<span id="cb119-975"><a href="#cb119-975"></a>  <span class="co"># Frame-shift analysis: what is near what?</span></span>
<span id="cb119-976"><a href="#cb119-976"></a>  frame_shift_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-977"><a href="#cb119-977"></a></span>
<span id="cb119-978"><a href="#cb119-978"></a>  normalize_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors) {</span>
<span id="cb119-979"><a href="#cb119-979"></a>    vectors <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(vectors)</span>
<span id="cb119-980"><a href="#cb119-980"></a>    norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb119-981"><a href="#cb119-981"></a>    norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb119-982"><a href="#cb119-982"></a>    vectors <span class="sc">/</span> norms</span>
<span id="cb119-983"><a href="#cb119-983"></a>  }</span>
<span id="cb119-984"><a href="#cb119-984"></a></span>
<span id="cb119-985"><a href="#cb119-985"></a>  vectors_norm_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_vectors[window_models], normalize_vectors)</span>
<span id="cb119-986"><a href="#cb119-986"></a>  </span>
<span id="cb119-987"><a href="#cb119-987"></a>  nearest_terms <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors_norm, term, <span class="at">top_n =</span> <span class="dv">10</span>) {</span>
<span id="cb119-988"><a href="#cb119-988"></a>    <span class="cf">if</span> (<span class="sc">!</span>term <span class="sc">%in%</span> <span class="fu">rownames</span>(vectors_norm)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb119-989"><a href="#cb119-989"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[term, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb119-990"><a href="#cb119-990"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb119-991"><a href="#cb119-991"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> term]</span>
<span id="cb119-992"><a href="#cb119-992"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb119-993"><a href="#cb119-993"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb119-994"><a href="#cb119-994"></a>      <span class="at">neighbor =</span> <span class="fu">names</span>(top),</span>
<span id="cb119-995"><a href="#cb119-995"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb119-996"><a href="#cb119-996"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb119-997"><a href="#cb119-997"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-998"><a href="#cb119-998"></a>    )</span>
<span id="cb119-999"><a href="#cb119-999"></a>  }</span>
<span id="cb119-1000"><a href="#cb119-1000"></a></span>
<span id="cb119-1001"><a href="#cb119-1001"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(target_map))) {</span>
<span id="cb119-1002"><a href="#cb119-1002"></a>    target_word <span class="ot">&lt;-</span> target_map<span class="sc">$</span>original[i]</span>
<span id="cb119-1003"><a href="#cb119-1003"></a>    target_norm <span class="ot">&lt;-</span> target_map<span class="sc">$</span>normalized[i]</span>
<span id="cb119-1004"><a href="#cb119-1004"></a>    </span>
<span id="cb119-1005"><a href="#cb119-1005"></a>    neighbors_over_time <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-1006"><a href="#cb119-1006"></a>    </span>
<span id="cb119-1007"><a href="#cb119-1007"></a>    <span class="cf">for</span> (window_name <span class="cf">in</span> window_models) {</span>
<span id="cb119-1008"><a href="#cb119-1008"></a>      vectors_norm <span class="ot">&lt;-</span> vectors_norm_list[[window_name]]</span>
<span id="cb119-1009"><a href="#cb119-1009"></a>      nn <span class="ot">&lt;-</span> <span class="fu">nearest_terms</span>(vectors_norm, target_norm, <span class="at">top_n =</span> <span class="dv">10</span>)</span>
<span id="cb119-1010"><a href="#cb119-1010"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nn) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(nn) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-1011"><a href="#cb119-1011"></a>        neighbors_df <span class="ot">&lt;-</span> nn <span class="sc">%&gt;%</span></span>
<span id="cb119-1012"><a href="#cb119-1012"></a>          <span class="fu">mutate</span>(<span class="at">period =</span> window_name, <span class="at">target =</span> target_word) <span class="sc">%&gt;%</span></span>
<span id="cb119-1013"><a href="#cb119-1013"></a>          <span class="fu">select</span>(period, target, neighbor, similarity, rank)</span>
<span id="cb119-1014"><a href="#cb119-1014"></a>        neighbors_over_time[[window_name]] <span class="ot">&lt;-</span> neighbors_df</span>
<span id="cb119-1015"><a href="#cb119-1015"></a>      }</span>
<span id="cb119-1016"><a href="#cb119-1016"></a>    }</span>
<span id="cb119-1017"><a href="#cb119-1017"></a>    </span>
<span id="cb119-1018"><a href="#cb119-1018"></a>    <span class="cf">if</span> (<span class="fu">length</span>(neighbors_over_time) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-1019"><a href="#cb119-1019"></a>      combined_neighbors <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, neighbors_over_time)</span>
<span id="cb119-1020"><a href="#cb119-1020"></a>      frame_shift_results[[target_word]] <span class="ot">&lt;-</span> combined_neighbors</span>
<span id="cb119-1021"><a href="#cb119-1021"></a>    }</span>
<span id="cb119-1022"><a href="#cb119-1022"></a>  }</span>
<span id="cb119-1023"><a href="#cb119-1023"></a>  </span>
<span id="cb119-1024"><a href="#cb119-1024"></a>  <span class="cf">if</span> (<span class="fu">length</span>(frame_shift_results) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-1025"><a href="#cb119-1025"></a>    all_frame_shifts <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, frame_shift_results)</span>
<span id="cb119-1026"><a href="#cb119-1026"></a>    <span class="fu">save_checkpoint</span>(all_frame_shifts, <span class="st">"word2vec_frame_shifts"</span>)</span>
<span id="cb119-1027"><a href="#cb119-1027"></a></span>
<span id="cb119-1028"><a href="#cb119-1028"></a>    frame_shift_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb119-1029"><a href="#cb119-1029"></a>      <span class="at">analyzed_terms =</span> <span class="fu">length</span>(frame_shift_results),</span>
<span id="cb119-1030"><a href="#cb119-1030"></a>      <span class="at">total_neighbor_relations =</span> <span class="fu">nrow</span>(all_frame_shifts)</span>
<span id="cb119-1031"><a href="#cb119-1031"></a>    )</span>
<span id="cb119-1032"><a href="#cb119-1032"></a>    frame_shift_summary</span>
<span id="cb119-1033"><a href="#cb119-1033"></a></span>
<span id="cb119-1034"><a href="#cb119-1034"></a>    top_neighbors_all <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb119-1035"><a href="#cb119-1035"></a>      <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1036"><a href="#cb119-1036"></a>      <span class="fu">arrange</span>(target, period, rank)</span>
<span id="cb119-1037"><a href="#cb119-1037"></a>    top_neighbors_all</span>
<span id="cb119-1038"><a href="#cb119-1038"></a>  }</span>
<span id="cb119-1039"><a href="#cb119-1039"></a>}</span>
<span id="cb119-1040"><a href="#cb119-1040"></a><span class="in">```</span></span>
<span id="cb119-1041"><a href="#cb119-1041"></a></span>
<span id="cb119-1042"><a href="#cb119-1042"></a><span class="in">```{r word2vec-visualization}</span></span>
<span id="cb119-1043"><a href="#cb119-1043"></a></span>
<span id="cb119-1044"><a href="#cb119-1044"></a><span class="co"># Visualisierung 1: Heatmap der Frame-Shifts</span></span>
<span id="cb119-1045"><a href="#cb119-1045"></a><span class="co"># Top neighbors across all time windows</span></span>
<span id="cb119-1046"><a href="#cb119-1046"></a>top_shifts <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb119-1047"><a href="#cb119-1047"></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1048"><a href="#cb119-1048"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb119-1049"><a href="#cb119-1049"></a>  <span class="fu">summarise</span>(<span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity), </span>
<span id="cb119-1050"><a href="#cb119-1050"></a>            <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb119-1051"><a href="#cb119-1051"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1052"><a href="#cb119-1052"></a>  <span class="fu">filter</span>(periods_present <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="co"># At least in 2 time windows</span></span>
<span id="cb119-1053"><a href="#cb119-1053"></a>  <span class="fu">arrange</span>(target, <span class="sc">-</span>avg_similarity)</span>
<span id="cb119-1054"><a href="#cb119-1054"></a></span>
<span id="cb119-1055"><a href="#cb119-1055"></a><span class="co"># Heatmap for selected target terms</span></span>
<span id="cb119-1056"><a href="#cb119-1056"></a>selected_targets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"hauslich_gewalt"</span>, <span class="st">"feminizid"</span>, <span class="st">"famili_drama"</span>)</span>
<span id="cb119-1057"><a href="#cb119-1057"></a>available_targets <span class="ot">&lt;-</span> <span class="fu">intersect</span>(selected_targets, <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target))</span>
<span id="cb119-1058"><a href="#cb119-1058"></a></span>
<span id="cb119-1059"><a href="#cb119-1059"></a><span class="cf">if</span> (<span class="fu">length</span>(available_targets) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-1060"><a href="#cb119-1060"></a>  heatmap_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb119-1061"><a href="#cb119-1061"></a>    <span class="fu">filter</span>(target <span class="sc">%in%</span> available_targets, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1062"><a href="#cb119-1062"></a>    <span class="fu">select</span>(period, target, neighbor, similarity)</span>
<span id="cb119-1063"><a href="#cb119-1063"></a>  </span>
<span id="cb119-1064"><a href="#cb119-1064"></a>  p_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heatmap_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb119-1065"><a href="#cb119-1065"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb119-1066"><a href="#cb119-1066"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>target, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb119-1067"><a href="#cb119-1067"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Ähnlichkeit"</span>) <span class="sc">+</span></span>
<span id="cb119-1068"><a href="#cb119-1068"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-1069"><a href="#cb119-1069"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb119-1070"><a href="#cb119-1070"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb119-1071"><a href="#cb119-1071"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Word2Vec frame shifts over time"</span>,</span>
<span id="cb119-1072"><a href="#cb119-1072"></a>       <span class="at">subtitle =</span> <span class="st">"Which words are close to the target terms?"</span>,</span>
<span id="cb119-1073"><a href="#cb119-1073"></a>       <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbor terms"</span>)</span>
<span id="cb119-1074"><a href="#cb119-1074"></a>  </span>
<span id="cb119-1075"><a href="#cb119-1075"></a>  <span class="fu">print</span>(p_heatmap)</span>
<span id="cb119-1076"><a href="#cb119-1076"></a>}</span>
<span id="cb119-1077"><a href="#cb119-1077"></a></span>
<span id="cb119-1078"><a href="#cb119-1078"></a><span class="co"># Plot per target (top 5 neighbors per time window)</span></span>
<span id="cb119-1079"><a href="#cb119-1079"></a><span class="cf">for</span> (term <span class="cf">in</span> <span class="fu">unique</span>(all_frame_shifts<span class="sc">$</span>target)) {</span>
<span id="cb119-1080"><a href="#cb119-1080"></a>  term_data <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb119-1081"><a href="#cb119-1081"></a>    <span class="fu">filter</span>(target <span class="sc">==</span> term, rank <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1082"><a href="#cb119-1082"></a>    <span class="fu">select</span>(period, neighbor, similarity)</span>
<span id="cb119-1083"><a href="#cb119-1083"></a></span>
<span id="cb119-1084"><a href="#cb119-1084"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(term_data) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb119-1085"><a href="#cb119-1085"></a></span>
<span id="cb119-1086"><a href="#cb119-1086"></a>  p_term <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(term_data, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> neighbor, <span class="at">fill =</span> similarity)) <span class="sc">+</span></span>
<span id="cb119-1087"><a href="#cb119-1087"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb119-1088"><a href="#cb119-1088"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkred"</span>, <span class="at">name =</span> <span class="st">"Similarity"</span>) <span class="sc">+</span></span>
<span id="cb119-1089"><a href="#cb119-1089"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-1090"><a href="#cb119-1090"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb119-1091"><a href="#cb119-1091"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb119-1092"><a href="#cb119-1092"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec frame shifts:"</span>, term),</span>
<span id="cb119-1093"><a href="#cb119-1093"></a>         <span class="at">x =</span> <span class="st">"Time window"</span>, <span class="at">y =</span> <span class="st">"Neighbors"</span>)</span>
<span id="cb119-1094"><a href="#cb119-1094"></a></span>
<span id="cb119-1095"><a href="#cb119-1095"></a>  <span class="fu">print</span>(p_term)</span>
<span id="cb119-1096"><a href="#cb119-1096"></a>}</span>
<span id="cb119-1097"><a href="#cb119-1097"></a></span>
<span id="cb119-1098"><a href="#cb119-1098"></a><span class="co"># Visualization 2: stability vs. change</span></span>
<span id="cb119-1099"><a href="#cb119-1099"></a>stability_analysis <span class="ot">&lt;-</span> all_frame_shifts <span class="sc">%&gt;%</span></span>
<span id="cb119-1100"><a href="#cb119-1100"></a>  <span class="fu">group_by</span>(target, neighbor) <span class="sc">%&gt;%</span></span>
<span id="cb119-1101"><a href="#cb119-1101"></a>  <span class="fu">summarise</span>(</span>
<span id="cb119-1102"><a href="#cb119-1102"></a>    <span class="at">periods_present =</span> <span class="fu">n</span>(),</span>
<span id="cb119-1103"><a href="#cb119-1103"></a>    <span class="at">avg_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb119-1104"><a href="#cb119-1104"></a>    <span class="at">similarity_sd =</span> <span class="fu">sd</span>(similarity),</span>
<span id="cb119-1105"><a href="#cb119-1105"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb119-1106"><a href="#cb119-1106"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1107"><a href="#cb119-1107"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-1108"><a href="#cb119-1108"></a>      <span class="at">stability =</span> <span class="fu">case_when</span>(</span>
<span id="cb119-1109"><a href="#cb119-1109"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Stable"</span>,</span>
<span id="cb119-1110"><a href="#cb119-1110"></a>        periods_present <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> similarity_sd <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">"Moderately stable"</span>, </span>
<span id="cb119-1111"><a href="#cb119-1111"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Changing"</span></span>
<span id="cb119-1112"><a href="#cb119-1112"></a>      )</span>
<span id="cb119-1113"><a href="#cb119-1113"></a>  )</span>
<span id="cb119-1114"><a href="#cb119-1114"></a></span>
<span id="cb119-1115"><a href="#cb119-1115"></a>stability_summary <span class="ot">&lt;-</span> stability_analysis <span class="sc">%&gt;%</span></span>
<span id="cb119-1116"><a href="#cb119-1116"></a>  <span class="fu">count</span>(stability) <span class="sc">%&gt;%</span></span>
<span id="cb119-1117"><a href="#cb119-1117"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb119-1118"><a href="#cb119-1118"></a></span>
<span id="cb119-1119"><a href="#cb119-1119"></a>stability_summary</span>
<span id="cb119-1120"><a href="#cb119-1120"></a><span class="in">```</span></span>
<span id="cb119-1121"><a href="#cb119-1121"></a></span>
<span id="cb119-1122"><a href="#cb119-1122"></a><span class="fu">## Local embedding visualization</span></span>
<span id="cb119-1123"><a href="#cb119-1123"></a></span>
<span id="cb119-1124"><a href="#cb119-1124"></a>We reduce the 100-dimensional Word2Vec space to 3D with UMAP to inspect local semantic neighborhoods. UMAP builds a nearest-neighbor graph in the original space and optimizes a low-dimensional layout that preserves those local neighborhoods. The plotted axes are not interpretable dimensions; they are coordinates of a layout that preserves local structure.</span>
<span id="cb119-1125"><a href="#cb119-1125"></a></span>
<span id="cb119-1126"><a href="#cb119-1126"></a>Interpretation: - Points close in 3D usually appear in similar contexts in the corpus. - Tight clusters suggest a coherent framing or shared discourse context. - Isolated points can indicate rare usage or distinct framing.</span>
<span id="cb119-1127"><a href="#cb119-1127"></a></span>
<span id="cb119-1128"><a href="#cb119-1128"></a>Caveats: - Distances are mainly meaningful locally (nearest neighbors). - Global positions and axis directions should not be over-interpreted.</span>
<span id="cb119-1129"><a href="#cb119-1129"></a></span>
<span id="cb119-1130"><a href="#cb119-1130"></a><span class="in">```{r word2vec-local-embedding}</span></span>
<span id="cb119-1131"><a href="#cb119-1131"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb119-1132"><a href="#cb119-1132"></a></span>
<span id="cb119-1133"><a href="#cb119-1133"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb119-1134"><a href="#cb119-1134"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb119-1135"><a href="#cb119-1135"></a>}</span>
<span id="cb119-1136"><a href="#cb119-1136"></a></span>
<span id="cb119-1137"><a href="#cb119-1137"></a><span class="co"># Prefer full-period model if available, otherwise latest window</span></span>
<span id="cb119-1138"><a href="#cb119-1138"></a><span class="cf">if</span> (FULL_MODEL_LABEL <span class="sc">%in%</span> <span class="fu">names</span>(word2vec_vectors)) {</span>
<span id="cb119-1139"><a href="#cb119-1139"></a>  viz_window <span class="ot">&lt;-</span> FULL_MODEL_LABEL</span>
<span id="cb119-1140"><a href="#cb119-1140"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1141"><a href="#cb119-1141"></a>  available_windows <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(word2vec_vectors), <span class="fu">names</span>(time_windows))</span>
<span id="cb119-1142"><a href="#cb119-1142"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_windows) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb119-1143"><a href="#cb119-1143"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(available_windows, <span class="dv">1</span>)</span>
<span id="cb119-1144"><a href="#cb119-1144"></a>  } <span class="cf">else</span> {</span>
<span id="cb119-1145"><a href="#cb119-1145"></a>    viz_window <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">names</span>(word2vec_vectors), <span class="dv">1</span>)</span>
<span id="cb119-1146"><a href="#cb119-1146"></a>  }</span>
<span id="cb119-1147"><a href="#cb119-1147"></a>}</span>
<span id="cb119-1148"><a href="#cb119-1148"></a><span class="fu">message</span>(<span class="st">"Using window: "</span>, viz_window)</span>
<span id="cb119-1149"><a href="#cb119-1149"></a>vectors <span class="ot">&lt;-</span> word2vec_vectors[[viz_window]]</span>
<span id="cb119-1150"><a href="#cb119-1150"></a></span>
<span id="cb119-1151"><a href="#cb119-1151"></a>normalize_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors) {</span>
<span id="cb119-1152"><a href="#cb119-1152"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb119-1153"><a href="#cb119-1153"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb119-1154"><a href="#cb119-1154"></a>  vectors <span class="sc">/</span> norms</span>
<span id="cb119-1155"><a href="#cb119-1155"></a>}</span>
<span id="cb119-1156"><a href="#cb119-1156"></a></span>
<span id="cb119-1157"><a href="#cb119-1157"></a>vectors_norm <span class="ot">&lt;-</span> <span class="fu">normalize_vectors</span>(vectors)</span>
<span id="cb119-1158"><a href="#cb119-1158"></a>target_terms_model <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb119-1159"><a href="#cb119-1159"></a>in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(target_terms_model, <span class="fu">rownames</span>(vectors_norm))</span>
<span id="cb119-1160"><a href="#cb119-1160"></a><span class="cf">if</span> (<span class="fu">length</span>(in_vocab) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb119-1161"><a href="#cb119-1161"></a>  <span class="fu">message</span>(<span class="st">"No target words found in model vocabulary."</span>)</span>
<span id="cb119-1162"><a href="#cb119-1162"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1163"><a href="#cb119-1163"></a>  neighbor_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(in_vocab, <span class="cf">function</span>(term) {</span>
<span id="cb119-1164"><a href="#cb119-1164"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[term, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb119-1165"><a href="#cb119-1165"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb119-1166"><a href="#cb119-1166"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> term]</span>
<span id="cb119-1167"><a href="#cb119-1167"></a>    nn <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb119-1168"><a href="#cb119-1168"></a>    <span class="fu">unique</span>(<span class="fu">c</span>(term, nn))</span>
<span id="cb119-1169"><a href="#cb119-1169"></a>  })</span>
<span id="cb119-1170"><a href="#cb119-1170"></a>  vocab <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(neighbor_list))</span>
<span id="cb119-1171"><a href="#cb119-1171"></a></span>
<span id="cb119-1172"><a href="#cb119-1172"></a>  vectors_sub <span class="ot">&lt;-</span> vectors[vocab, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1173"><a href="#cb119-1173"></a>  umap_coords <span class="ot">&lt;-</span> umap<span class="sc">::</span><span class="fu">umap</span>(vectors_sub, <span class="at">n_components =</span> <span class="dv">3</span>)<span class="sc">$</span>layout</span>
<span id="cb119-1174"><a href="#cb119-1174"></a></span>
<span id="cb119-1175"><a href="#cb119-1175"></a>  embedding_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb119-1176"><a href="#cb119-1176"></a>    <span class="at">term =</span> vocab,</span>
<span id="cb119-1177"><a href="#cb119-1177"></a>    <span class="at">x =</span> umap_coords[, <span class="dv">1</span>],</span>
<span id="cb119-1178"><a href="#cb119-1178"></a>    <span class="at">y =</span> umap_coords[, <span class="dv">2</span>],</span>
<span id="cb119-1179"><a href="#cb119-1179"></a>    <span class="at">z =</span> umap_coords[, <span class="dv">3</span>],</span>
<span id="cb119-1180"><a href="#cb119-1180"></a>    <span class="at">type =</span> <span class="fu">ifelse</span>(vocab <span class="sc">%in%</span> in_vocab, <span class="st">"target"</span>, <span class="st">"neighbor"</span>),</span>
<span id="cb119-1181"><a href="#cb119-1181"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-1182"><a href="#cb119-1182"></a>  )</span>
<span id="cb119-1183"><a href="#cb119-1183"></a></span>
<span id="cb119-1184"><a href="#cb119-1184"></a>  p_umap <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(</span>
<span id="cb119-1185"><a href="#cb119-1185"></a>    embedding_df,</span>
<span id="cb119-1186"><a href="#cb119-1186"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z, <span class="at">color =</span> <span class="sc">~</span>type, <span class="at">text =</span> <span class="sc">~</span>term,</span>
<span id="cb119-1187"><a href="#cb119-1187"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb119-1188"><a href="#cb119-1188"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.85</span>)</span>
<span id="cb119-1189"><a href="#cb119-1189"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1190"><a href="#cb119-1190"></a>    plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb119-1191"><a href="#cb119-1191"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Word2Vec embeddings (UMAP 3D):"</span>, viz_window),</span>
<span id="cb119-1192"><a href="#cb119-1192"></a>      <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb119-1193"><a href="#cb119-1193"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 1"</span>),</span>
<span id="cb119-1194"><a href="#cb119-1194"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 2"</span>),</span>
<span id="cb119-1195"><a href="#cb119-1195"></a>        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"UMAP dim 3"</span>)</span>
<span id="cb119-1196"><a href="#cb119-1196"></a>      )</span>
<span id="cb119-1197"><a href="#cb119-1197"></a>    )</span>
<span id="cb119-1198"><a href="#cb119-1198"></a>  p_umap</span>
<span id="cb119-1199"><a href="#cb119-1199"></a>}</span>
<span id="cb119-1200"><a href="#cb119-1200"></a><span class="in">```</span></span>
<span id="cb119-1201"><a href="#cb119-1201"></a></span>
<span id="cb119-1202"><a href="#cb119-1202"></a><span class="fu">## Iterative query expansion</span></span>
<span id="cb119-1203"><a href="#cb119-1203"></a></span>
<span id="cb119-1204"><a href="#cb119-1204"></a>This section uses embedding neighborhoods to propose additional terms that might capture earlier or alternative framings. The candidates are heuristically filtered to reduce noise before being considered for a second-pass query.</span>
<span id="cb119-1205"><a href="#cb119-1205"></a></span>
<span id="cb119-1206"><a href="#cb119-1206"></a>We use the word2vec neighborhoods to suggest additional search terms that may reflect earlier or alternative framing. It provides a ranked candidate list for curation which can then be added to a subsequent API query in an iterative proggress.</span>
<span id="cb119-1207"><a href="#cb119-1207"></a></span>
<span id="cb119-1208"><a href="#cb119-1208"></a><span class="in">```{r query-expansion}</span></span>
<span id="cb119-1209"><a href="#cb119-1209"></a><span class="co"># Split original keywords into action vs. relation/context (no new terms)</span></span>
<span id="cb119-1210"><a href="#cb119-1210"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-1211"><a href="#cb119-1211"></a>  <span class="st">"Feminizid"</span>, <span class="st">"Femizid"</span>, <span class="st">"Frauenmord"</span>,</span>
<span id="cb119-1212"><a href="#cb119-1212"></a>  <span class="st">"Tötung von Frau"</span>, <span class="st">"Mord an Frau"</span>,</span>
<span id="cb119-1213"><a href="#cb119-1213"></a>  <span class="st">"Gewalt gegen Frauen"</span>, <span class="st">"Partnergewalt"</span>, <span class="st">"Beziehungsgewalt"</span>,</span>
<span id="cb119-1214"><a href="#cb119-1214"></a>  <span class="st">"häusliche Gewalt"</span>, <span class="st">"Partnerschaftsgewalt"</span></span>
<span id="cb119-1215"><a href="#cb119-1215"></a>)</span>
<span id="cb119-1216"><a href="#cb119-1216"></a></span>
<span id="cb119-1217"><a href="#cb119-1217"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-1218"><a href="#cb119-1218"></a>  <span class="st">"Familiendrama"</span>, <span class="st">"Familientragödie"</span>, <span class="st">"Beziehungstat"</span>, <span class="st">"Ehestreit"</span></span>
<span id="cb119-1219"><a href="#cb119-1219"></a>)</span>
<span id="cb119-1220"><a href="#cb119-1220"></a></span>
<span id="cb119-1221"><a href="#cb119-1221"></a><span class="co"># Seeds in the model vocabulary (normalized form)</span></span>
<span id="cb119-1222"><a href="#cb119-1222"></a>seed_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb119-1223"><a href="#cb119-1223"></a></span>
<span id="cb119-1224"><a href="#cb119-1224"></a>collect_neighbors_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb119-1225"><a href="#cb119-1225"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(vectors))</span>
<span id="cb119-1226"><a href="#cb119-1226"></a>  <span class="cf">if</span> (<span class="fu">length</span>(seeds_in_vocab) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb119-1227"><a href="#cb119-1227"></a></span>
<span id="cb119-1228"><a href="#cb119-1228"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb119-1229"><a href="#cb119-1229"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb119-1230"><a href="#cb119-1230"></a>  vectors_norm <span class="ot">&lt;-</span> vectors <span class="sc">/</span> norms</span>
<span id="cb119-1231"><a href="#cb119-1231"></a></span>
<span id="cb119-1232"><a href="#cb119-1232"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb119-1233"><a href="#cb119-1233"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(vectors_norm[seed, , <span class="at">drop =</span> <span class="cn">FALSE</span>]))</span>
<span id="cb119-1234"><a href="#cb119-1234"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb119-1235"><a href="#cb119-1235"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> seed]</span>
<span id="cb119-1236"><a href="#cb119-1236"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb119-1237"><a href="#cb119-1237"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb119-1238"><a href="#cb119-1238"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb119-1239"><a href="#cb119-1239"></a>      <span class="at">term =</span> <span class="fu">names</span>(top),</span>
<span id="cb119-1240"><a href="#cb119-1240"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb119-1241"><a href="#cb119-1241"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb119-1242"><a href="#cb119-1242"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-1243"><a href="#cb119-1243"></a>    )</span>
<span id="cb119-1244"><a href="#cb119-1244"></a>  })</span>
<span id="cb119-1245"><a href="#cb119-1245"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb119-1246"><a href="#cb119-1246"></a>}</span>
<span id="cb119-1247"><a href="#cb119-1247"></a></span>
<span id="cb119-1248"><a href="#cb119-1248"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors)) {</span>
<span id="cb119-1249"><a href="#cb119-1249"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb119-1250"><a href="#cb119-1250"></a>}</span>
<span id="cb119-1251"><a href="#cb119-1251"></a></span>
<span id="cb119-1252"><a href="#cb119-1252"></a>neighbors_all <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_vectors), <span class="cf">function</span>(w) {</span>
<span id="cb119-1253"><a href="#cb119-1253"></a>  vectors <span class="ot">&lt;-</span> word2vec_vectors[[w]]</span>
<span id="cb119-1254"><a href="#cb119-1254"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors_vectors</span>(vectors, seed_terms, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb119-1255"><a href="#cb119-1255"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb119-1256"><a href="#cb119-1256"></a>  df</span>
<span id="cb119-1257"><a href="#cb119-1257"></a>}))</span>
<span id="cb119-1258"><a href="#cb119-1258"></a></span>
<span id="cb119-1259"><a href="#cb119-1259"></a>candidate_summary <span class="ot">&lt;-</span> neighbors_all <span class="sc">%&gt;%</span></span>
<span id="cb119-1260"><a href="#cb119-1260"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(term <span class="sc">%in%</span> seed_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1261"><a href="#cb119-1261"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb119-1262"><a href="#cb119-1262"></a>  <span class="fu">summarise</span>(</span>
<span id="cb119-1263"><a href="#cb119-1263"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb119-1264"><a href="#cb119-1264"></a>    <span class="at">max_similarity =</span> <span class="fu">max</span>(similarity),</span>
<span id="cb119-1265"><a href="#cb119-1265"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb119-1266"><a href="#cb119-1266"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb119-1267"><a href="#cb119-1267"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb119-1268"><a href="#cb119-1268"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1269"><a href="#cb119-1269"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity))</span>
<span id="cb119-1270"><a href="#cb119-1270"></a></span>
<span id="cb119-1271"><a href="#cb119-1271"></a><span class="co"># Heuristic: candidates that are close to multiple seeds and appear across windows</span></span>
<span id="cb119-1272"><a href="#cb119-1272"></a>suggested_terms <span class="ot">&lt;-</span> candidate_summary <span class="sc">%&gt;%</span></span>
<span id="cb119-1273"><a href="#cb119-1273"></a>  <span class="fu">filter</span>(mean_similarity <span class="sc">&gt;=</span> <span class="fl">0.35</span>, seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1274"><a href="#cb119-1274"></a>  <span class="fu">pull</span>(term)</span>
<span id="cb119-1275"><a href="#cb119-1275"></a></span>
<span id="cb119-1276"><a href="#cb119-1276"></a><span class="co"># Basic cleanup: keep alpha tokens, remove very short / rare items</span></span>
<span id="cb119-1277"><a href="#cb119-1277"></a>term_freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(feminizid_dfm_trimmed, <span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1278"><a href="#cb119-1278"></a>  <span class="fu">select</span>(feature, frequency)</span>
<span id="cb119-1279"><a href="#cb119-1279"></a></span>
<span id="cb119-1280"><a href="#cb119-1280"></a>suggested_terms_clean <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(suggested_terms)</span>
<span id="cb119-1281"><a href="#cb119-1281"></a>suggested_terms_clean <span class="ot">&lt;-</span> suggested_terms_clean[</span>
<span id="cb119-1282"><a href="#cb119-1282"></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(suggested_terms_clean, <span class="st">"^[[:alpha:]_]+$"</span>)</span>
<span id="cb119-1283"><a href="#cb119-1283"></a>]</span>
<span id="cb119-1284"><a href="#cb119-1284"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">unique</span>(suggested_terms_clean)</span>
<span id="cb119-1285"><a href="#cb119-1285"></a>suggested_terms_clean <span class="ot">&lt;-</span> <span class="fu">Filter</span>(<span class="cf">function</span>(x) <span class="fu">nchar</span>(x) <span class="sc">&gt;=</span> <span class="dv">4</span>, suggested_terms_clean)</span>
<span id="cb119-1286"><a href="#cb119-1286"></a></span>
<span id="cb119-1287"><a href="#cb119-1287"></a>suggested_terms_clean <span class="ot">&lt;-</span> term_freq <span class="sc">%&gt;%</span></span>
<span id="cb119-1288"><a href="#cb119-1288"></a>  <span class="fu">filter</span>(feature <span class="sc">%in%</span> suggested_terms_clean, frequency <span class="sc">&gt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1289"><a href="#cb119-1289"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frequency)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1290"><a href="#cb119-1290"></a>  <span class="fu">pull</span>(feature)</span>
<span id="cb119-1291"><a href="#cb119-1291"></a></span>
<span id="cb119-1292"><a href="#cb119-1292"></a><span class="co"># Map stems back to likely surface forms (approximation)</span></span>
<span id="cb119-1293"><a href="#cb119-1293"></a>MAP_DOCS_LIMIT <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb119-1294"><a href="#cb119-1294"></a>corpus_for_map <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">ndoc</span>(feminizid_corpus) <span class="sc">&gt;</span> MAP_DOCS_LIMIT) {</span>
<span id="cb119-1295"><a href="#cb119-1295"></a>  <span class="fu">corpus_sample</span>(feminizid_corpus, <span class="at">size =</span> MAP_DOCS_LIMIT)</span>
<span id="cb119-1296"><a href="#cb119-1296"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1297"><a href="#cb119-1297"></a>  feminizid_corpus</span>
<span id="cb119-1298"><a href="#cb119-1298"></a>}</span>
<span id="cb119-1299"><a href="#cb119-1299"></a></span>
<span id="cb119-1300"><a href="#cb119-1300"></a>tokens_raw <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corpus_for_map,</span>
<span id="cb119-1301"><a href="#cb119-1301"></a>                     <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-1302"><a href="#cb119-1302"></a>                     <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-1303"><a href="#cb119-1303"></a>                     <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-1304"><a href="#cb119-1304"></a>                     <span class="at">remove_url =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1305"><a href="#cb119-1305"></a>  <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-1306"><a href="#cb119-1306"></a>  <span class="fu">tokens_remove</span>(all_stopwords, <span class="at">min_nchar =</span> <span class="dv">3</span>, <span class="at">valuetype =</span> <span class="st">"fixed"</span>, <span class="at">padding =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-1307"><a href="#cb119-1307"></a></span>
<span id="cb119-1308"><a href="#cb119-1308"></a>tokens_stem <span class="ot">&lt;-</span> <span class="fu">tokens_wordstem</span>(tokens_raw, <span class="at">language =</span> <span class="st">"de"</span>)</span>
<span id="cb119-1309"><a href="#cb119-1309"></a></span>
<span id="cb119-1310"><a href="#cb119-1310"></a>stem_map <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb119-1311"><a href="#cb119-1311"></a>  <span class="at">stem =</span> <span class="fu">unlist</span>(tokens_stem),</span>
<span id="cb119-1312"><a href="#cb119-1312"></a>  <span class="at">form =</span> <span class="fu">unlist</span>(tokens_raw)</span>
<span id="cb119-1313"><a href="#cb119-1313"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1314"><a href="#cb119-1314"></a>  <span class="fu">count</span>(stem, form, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-1315"><a href="#cb119-1315"></a></span>
<span id="cb119-1316"><a href="#cb119-1316"></a>suggested_terms_surface <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stem =</span> suggested_terms_clean) <span class="sc">%&gt;%</span></span>
<span id="cb119-1317"><a href="#cb119-1317"></a>  <span class="fu">left_join</span>(</span>
<span id="cb119-1318"><a href="#cb119-1318"></a>    stem_map <span class="sc">%&gt;%</span></span>
<span id="cb119-1319"><a href="#cb119-1319"></a>      <span class="fu">group_by</span>(stem) <span class="sc">%&gt;%</span></span>
<span id="cb119-1320"><a href="#cb119-1320"></a>      <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1321"><a href="#cb119-1321"></a>      <span class="fu">summarise</span>(<span class="at">forms =</span> <span class="fu">paste</span>(form, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>),</span>
<span id="cb119-1322"><a href="#cb119-1322"></a>    <span class="at">by =</span> <span class="st">"stem"</span></span>
<span id="cb119-1323"><a href="#cb119-1323"></a>  )</span>
<span id="cb119-1324"><a href="#cb119-1324"></a></span>
<span id="cb119-1325"><a href="#cb119-1325"></a>available_dicts <span class="ot">&lt;-</span> hunspell<span class="sc">::</span><span class="fu">list_dictionaries</span>()</span>
<span id="cb119-1326"><a href="#cb119-1326"></a>dict_id <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"de_DE_frami"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb119-1327"><a href="#cb119-1327"></a>  <span class="st">"de_DE_frami"</span></span>
<span id="cb119-1328"><a href="#cb119-1328"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"de_DE"</span> <span class="sc">%in%</span> available_dicts) {</span>
<span id="cb119-1329"><a href="#cb119-1329"></a>  <span class="st">"de_DE"</span></span>
<span id="cb119-1330"><a href="#cb119-1330"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1331"><a href="#cb119-1331"></a>  <span class="cn">NA_character_</span></span>
<span id="cb119-1332"><a href="#cb119-1332"></a>}</span>
<span id="cb119-1333"><a href="#cb119-1333"></a></span>
<span id="cb119-1334"><a href="#cb119-1334"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb119-1335"><a href="#cb119-1335"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-1336"><a href="#cb119-1336"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">word</span>(forms, <span class="dv">1</span>, <span class="at">sep =</span> <span class="st">", "</span>),</span>
<span id="cb119-1337"><a href="#cb119-1337"></a>    <span class="at">primary_form =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(primary_form, <span class="st">"_"</span>, <span class="st">" "</span>),</span>
<span id="cb119-1338"><a href="#cb119-1338"></a>    <span class="at">dict_ok =</span> <span class="cf">if</span> (<span class="fu">is.na</span>(dict_id)) <span class="cn">TRUE</span> <span class="cf">else</span> hunspell<span class="sc">::</span><span class="fu">hunspell_check</span>(primary_form, <span class="at">dict =</span> dict_id)</span>
<span id="cb119-1339"><a href="#cb119-1339"></a>  )</span>
<span id="cb119-1340"><a href="#cb119-1340"></a></span>
<span id="cb119-1341"><a href="#cb119-1341"></a><span class="co"># Co-occurrence filter: candidate should appear with relation terms</span></span>
<span id="cb119-1342"><a href="#cb119-1342"></a>relation_terms_model <span class="ot">&lt;-</span> <span class="fu">normalize_terms_for_model</span>(relation_terms)</span>
<span id="cb119-1343"><a href="#cb119-1343"></a>dfm_model <span class="ot">&lt;-</span> feminizid_dfm_trimmed</span>
<span id="cb119-1344"><a href="#cb119-1344"></a>relation_in_docs <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(</span>
<span id="cb119-1345"><a href="#cb119-1345"></a>  <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> relation_terms_model)</span>
<span id="cb119-1346"><a href="#cb119-1346"></a>)) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb119-1347"><a href="#cb119-1347"></a></span>
<span id="cb119-1348"><a href="#cb119-1348"></a>cand_dfm <span class="ot">&lt;-</span> <span class="fu">dfm_select</span>(dfm_model, <span class="at">pattern =</span> suggested_terms_clean)</span>
<span id="cb119-1349"><a href="#cb119-1349"></a>cand_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cand_dfm) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb119-1350"><a href="#cb119-1350"></a>cand_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat)</span>
<span id="cb119-1351"><a href="#cb119-1351"></a>cooccur_docs <span class="ot">&lt;-</span> <span class="fu">colSums</span>(cand_mat[relation_in_docs, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb119-1352"><a href="#cb119-1352"></a>cooccur_ratio <span class="ot">&lt;-</span> cooccur_docs <span class="sc">/</span> <span class="fu">pmax</span>(cand_docs, <span class="dv">1</span>)</span>
<span id="cb119-1353"><a href="#cb119-1353"></a></span>
<span id="cb119-1354"><a href="#cb119-1354"></a>candidate_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb119-1355"><a href="#cb119-1355"></a>  <span class="at">stem =</span> <span class="fu">colnames</span>(cand_mat),</span>
<span id="cb119-1356"><a href="#cb119-1356"></a>  <span class="at">cand_docs =</span> cand_docs,</span>
<span id="cb119-1357"><a href="#cb119-1357"></a>  <span class="at">cooccur_docs =</span> cooccur_docs,</span>
<span id="cb119-1358"><a href="#cb119-1358"></a>  <span class="at">cooccur_ratio =</span> cooccur_ratio</span>
<span id="cb119-1359"><a href="#cb119-1359"></a>)</span>
<span id="cb119-1360"><a href="#cb119-1360"></a></span>
<span id="cb119-1361"><a href="#cb119-1361"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb119-1362"><a href="#cb119-1362"></a>  <span class="fu">left_join</span>(candidate_scores, <span class="at">by =</span> <span class="st">"stem"</span>)</span>
<span id="cb119-1363"><a href="#cb119-1363"></a></span>
<span id="cb119-1364"><a href="#cb119-1364"></a><span class="co"># Heuristic cleanup for glued function words / artifacts</span></span>
<span id="cb119-1365"><a href="#cb119-1365"></a>JUNK_SUFFIXES <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"zwar"</span>, <span class="st">"pro"</span>, <span class="st">"und"</span>, <span class="st">"oder"</span>, <span class="st">"aber"</span>, <span class="st">"doch"</span>, <span class="st">"weil"</span>, <span class="st">"dass"</span>, <span class="st">"nicht"</span>)</span>
<span id="cb119-1366"><a href="#cb119-1366"></a>junk_regex <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">paste</span>(JUNK_SUFFIXES, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")$"</span>)</span>
<span id="cb119-1367"><a href="#cb119-1367"></a></span>
<span id="cb119-1368"><a href="#cb119-1368"></a>suggested_terms_surface <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb119-1369"><a href="#cb119-1369"></a>  <span class="fu">mutate</span>(<span class="at">junk_suffix =</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(primary_form, junk_regex))</span>
<span id="cb119-1370"><a href="#cb119-1370"></a></span>
<span id="cb119-1371"><a href="#cb119-1371"></a>suggested_terms_final <span class="ot">&lt;-</span> suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb119-1372"><a href="#cb119-1372"></a>  <span class="fu">filter</span>(</span>
<span id="cb119-1373"><a href="#cb119-1373"></a>    dict_ok,</span>
<span id="cb119-1374"><a href="#cb119-1374"></a>    <span class="fu">nchar</span>(primary_form) <span class="sc">&gt;=</span> <span class="dv">4</span>,</span>
<span id="cb119-1375"><a href="#cb119-1375"></a>    <span class="sc">!</span>junk_suffix,</span>
<span id="cb119-1376"><a href="#cb119-1376"></a>    cooccur_docs <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb119-1377"><a href="#cb119-1377"></a>    cooccur_ratio <span class="sc">&gt;=</span> <span class="fl">0.2</span></span>
<span id="cb119-1378"><a href="#cb119-1378"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1379"><a href="#cb119-1379"></a>  <span class="fu">distinct</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb119-1380"><a href="#cb119-1380"></a>  <span class="fu">arrange</span>(primary_form) <span class="sc">%&gt;%</span></span>
<span id="cb119-1381"><a href="#cb119-1381"></a>  <span class="fu">pull</span>(primary_form)</span>
<span id="cb119-1382"><a href="#cb119-1382"></a></span>
<span id="cb119-1383"><a href="#cb119-1383"></a>suggested_terms_surface <span class="sc">%&gt;%</span></span>
<span id="cb119-1384"><a href="#cb119-1384"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(primary_form)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1385"><a href="#cb119-1385"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb119-1386"><a href="#cb119-1386"></a></span>
<span id="cb119-1387"><a href="#cb119-1387"></a>suggested_terms_final</span>
<span id="cb119-1388"><a href="#cb119-1388"></a><span class="in">```</span></span>
<span id="cb119-1389"><a href="#cb119-1389"></a></span>
<span id="cb119-1390"><a href="#cb119-1390"></a><span class="fu">## Second-pass API query (manual curation)</span></span>
<span id="cb119-1391"><a href="#cb119-1391"></a></span>
<span id="cb119-1392"><a href="#cb119-1392"></a>The second pass narrows the query by combining action terms with relation/context terms. This reduces false positives while still capturing relevant framing variants. We treat this pass as a curated subset rather than a full census.</span>
<span id="cb119-1393"><a href="#cb119-1393"></a></span>
<span id="cb119-1394"><a href="#cb119-1394"></a>We run a stricter AND query to keep results manageable. The original keywords are split into two groups (action vs. relation) and combined with curated extra terms. Wildcards are included for single-word terms.</span>
<span id="cb119-1395"><a href="#cb119-1395"></a></span>
<span id="cb119-1396"><a href="#cb119-1396"></a><span class="in">```{r second-pass-query, cache.lazy=FALSE}</span></span>
<span id="cb119-1397"><a href="#cb119-1397"></a><span class="co"># Wildcards only for single-word terms from the original list</span></span>
<span id="cb119-1398"><a href="#cb119-1398"></a>add_wildcards_single <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb119-1399"><a href="#cb119-1399"></a>  single <span class="ot">&lt;-</span> terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)]</span>
<span id="cb119-1400"><a href="#cb119-1400"></a>  <span class="fu">paste0</span>(single, <span class="st">"*"</span>)</span>
<span id="cb119-1401"><a href="#cb119-1401"></a>}</span>
<span id="cb119-1402"><a href="#cb119-1402"></a></span>
<span id="cb119-1403"><a href="#cb119-1403"></a>action_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, <span class="fu">add_wildcards_single</span>(action_terms)))</span>
<span id="cb119-1404"><a href="#cb119-1404"></a>relation_terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, <span class="fu">add_wildcards_single</span>(relation_terms)))</span>
<span id="cb119-1405"><a href="#cb119-1405"></a></span>
<span id="cb119-1406"><a href="#cb119-1406"></a><span class="co"># Manual split from suggested_terms_final</span></span>
<span id="cb119-1407"><a href="#cb119-1407"></a>SECOND_PASS_EXCLUDE <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gewalt"</span>)</span>
<span id="cb119-1408"><a href="#cb119-1408"></a></span>
<span id="cb119-1409"><a href="#cb119-1409"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-1410"><a href="#cb119-1410"></a>  <span class="st">"ermordet"</span>, <span class="st">"erschossen"</span>, <span class="st">"erstochen"</span>, <span class="st">"getötet"</span>,</span>
<span id="cb119-1411"><a href="#cb119-1411"></a>  <span class="st">"tötung"</span>, <span class="st">"tötungsversuch"</span>, <span class="st">"frauentötungen"</span>,</span>
<span id="cb119-1412"><a href="#cb119-1412"></a>  <span class="st">"stranguliert"</span>, <span class="st">"kopfschuss"</span>, <span class="st">"küchenmesser"</span>,</span>
<span id="cb119-1413"><a href="#cb119-1413"></a>  <span class="st">"mordopfer"</span>, <span class="st">"umgebracht"</span>, <span class="st">"tötete"</span>, <span class="st">"totschlag"</span>,</span>
<span id="cb119-1414"><a href="#cb119-1414"></a>  <span class="st">"misshandlung"</span>, <span class="st">"misshandelt"</span>, <span class="st">"stalking"</span>,</span>
<span id="cb119-1415"><a href="#cb119-1415"></a>  <span class="st">"eifersucht"</span>, <span class="st">"eifersüchtig"</span>, <span class="st">"eifersüchtige"</span>, <span class="st">"eifersüchtigen"</span>,</span>
<span id="cb119-1416"><a href="#cb119-1416"></a>  <span class="st">"mord"</span></span>
<span id="cb119-1417"><a href="#cb119-1417"></a></span>
<span id="cb119-1418"><a href="#cb119-1418"></a>)</span>
<span id="cb119-1419"><a href="#cb119-1419"></a></span>
<span id="cb119-1420"><a href="#cb119-1420"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-1421"><a href="#cb119-1421"></a>  <span class="st">"ehepartner"</span>, <span class="st">"exmann"</span>, <span class="st">"intimpartner"</span>, <span class="st">"lebensgefährt"</span>,</span>
<span id="cb119-1422"><a href="#cb119-1422"></a>  <span class="st">"lebensgemeinschaft"</span>, <span class="st">"Partner"</span>, <span class="st">"schwägerin"</span>, <span class="st">"Peiniger"</span>, <span class="st">"Frau"</span>,</span>
<span id="cb119-1423"><a href="#cb119-1423"></a>  <span class="st">"ehefrau"</span>, <span class="st">"freundin"</span>, <span class="st">"beziehung"</span>, <span class="st">"geschieden"</span>, <span class="st">"mutter"</span>, <span class="st">"vater"</span>,</span>
<span id="cb119-1424"><a href="#cb119-1424"></a>  <span class="st">"sohn"</span>, <span class="st">"tochter"</span>, <span class="st">"schwiegersohn"</span>, <span class="st">"ex-partner"</span>, <span class="st">"ex-mann"</span>, <span class="st">"ex-frau"</span></span>
<span id="cb119-1425"><a href="#cb119-1425"></a></span>
<span id="cb119-1426"><a href="#cb119-1426"></a>)</span>
<span id="cb119-1427"><a href="#cb119-1427"></a></span>
<span id="cb119-1428"><a href="#cb119-1428"></a><span class="co"># Dropped terms (noisy/too generic): aufwies, desinteresseerklärung,</span></span>
<span id="cb119-1429"><a href="#cb119-1429"></a><span class="co"># desinteressenerklärung, erleben, erwachsenenleben, fünfte, häusliche,</span></span>
<span id="cb119-1430"><a href="#cb119-1430"></a><span class="co"># körper, männer, menos, mutmassliche, physische, rechercheplattformen,</span></span>
<span id="cb119-1431"><a href="#cb119-1431"></a><span class="co"># rechercheprojekt, sexuelle, straftatbestand, tatverdächtigen, türkin</span></span>
<span id="cb119-1432"><a href="#cb119-1432"></a></span>
<span id="cb119-1433"><a href="#cb119-1433"></a>action_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(action_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb119-1434"><a href="#cb119-1434"></a>relation_terms_extra <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(relation_terms_extra, SECOND_PASS_EXCLUDE)</span>
<span id="cb119-1435"><a href="#cb119-1435"></a></span>
<span id="cb119-1436"><a href="#cb119-1436"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(action_terms, action_terms_extra))</span>
<span id="cb119-1437"><a href="#cb119-1437"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(relation_terms, relation_terms_extra))</span>
<span id="cb119-1438"><a href="#cb119-1438"></a></span>
<span id="cb119-1439"><a href="#cb119-1439"></a>normalize_wildcards <span class="ot">&lt;-</span> <span class="cf">function</span>(terms) {</span>
<span id="cb119-1440"><a href="#cb119-1440"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb119-1441"><a href="#cb119-1441"></a>  terms <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">*+$"</span>, <span class="st">""</span>, terms)</span>
<span id="cb119-1442"><a href="#cb119-1442"></a>  terms <span class="ot">&lt;-</span> <span class="fu">unique</span>(terms)</span>
<span id="cb119-1443"><a href="#cb119-1443"></a>  <span class="fu">c</span>(terms, <span class="fu">paste0</span>(terms[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, terms)], <span class="st">"*"</span>))</span>
<span id="cb119-1444"><a href="#cb119-1444"></a>}</span>
<span id="cb119-1445"><a href="#cb119-1445"></a></span>
<span id="cb119-1446"><a href="#cb119-1446"></a>action_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(action_terms_second)</span>
<span id="cb119-1447"><a href="#cb119-1447"></a>relation_terms_second <span class="ot">&lt;-</span> <span class="fu">normalize_wildcards</span>(relation_terms_second)</span>
<span id="cb119-1448"><a href="#cb119-1448"></a></span>
<span id="cb119-1449"><a href="#cb119-1449"></a><span class="fu">message</span>(<span class="st">"Second-pass action terms: "</span>, <span class="fu">paste</span>(action_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb119-1450"><a href="#cb119-1450"></a><span class="fu">message</span>(<span class="st">"Second-pass relation terms: "</span>, <span class="fu">paste</span>(relation_terms_second, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb119-1451"><a href="#cb119-1451"></a></span>
<span id="cb119-1452"><a href="#cb119-1452"></a>existing_secondpass <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb119-1453"><a href="#cb119-1453"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_QUERY <span class="sc">||</span> (<span class="sc">!</span>FORCE_SECOND_PASS_QUERY <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_secondpass))) {</span>
<span id="cb119-1454"><a href="#cb119-1454"></a>  <span class="fu">message</span>(<span class="st">"Second-pass query skipped. Existing checkpoint: "</span>, <span class="fu">basename</span>(existing_secondpass))</span>
<span id="cb119-1455"><a href="#cb119-1455"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1456"><a href="#cb119-1456"></a>  second_pass_result <span class="ot">&lt;-</span> <span class="fu">execute_swissdox_workflow</span>(</span>
<span id="cb119-1457"><a href="#cb119-1457"></a>    <span class="at">client =</span> client,</span>
<span id="cb119-1458"><a href="#cb119-1458"></a>    <span class="at">query =</span> <span class="fu">create_swissdox_query</span>(</span>
<span id="cb119-1459"><a href="#cb119-1459"></a>      <span class="at">content_groups =</span> <span class="fu">list</span>(</span>
<span id="cb119-1460"><a href="#cb119-1460"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> action_terms_second),</span>
<span id="cb119-1461"><a href="#cb119-1461"></a>        <span class="fu">list</span>(<span class="at">operator =</span> <span class="st">"OR"</span>, <span class="at">terms =</span> relation_terms_second)</span>
<span id="cb119-1462"><a href="#cb119-1462"></a>      ),</span>
<span id="cb119-1463"><a href="#cb119-1463"></a>      <span class="at">date_from =</span> <span class="st">"1990-01-01"</span>,</span>
<span id="cb119-1464"><a href="#cb119-1464"></a>      <span class="at">date_to =</span> <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb119-1465"><a href="#cb119-1465"></a>      <span class="at">languages =</span> <span class="st">"de"</span>,</span>
<span id="cb119-1466"><a href="#cb119-1466"></a>      <span class="at">max_results =</span> <span class="dv">1000000</span>L,</span>
<span id="cb119-1467"><a href="#cb119-1467"></a>      <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"pubtime"</span>, <span class="st">"medium_code"</span>, <span class="st">"medium_name"</span>, <span class="st">"rubric"</span>,</span>
<span id="cb119-1468"><a href="#cb119-1468"></a>                  <span class="st">"regional"</span>, <span class="st">"doctype"</span>, <span class="st">"doctype_description"</span>, <span class="st">"language"</span>,</span>
<span id="cb119-1469"><a href="#cb119-1469"></a>                  <span class="st">"char_count"</span>, <span class="st">"dateline"</span>, <span class="st">"head"</span>, <span class="st">"subhead"</span>,</span>
<span id="cb119-1470"><a href="#cb119-1470"></a>                  <span class="st">"article_link"</span>, <span class="st">"content_id"</span>, <span class="st">"content"</span>)</span>
<span id="cb119-1471"><a href="#cb119-1471"></a>    ),</span>
<span id="cb119-1472"><a href="#cb119-1472"></a>    <span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"Feminizid_SecondPass"</span>, <span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">"%Y%m%d_%H%M%S"</span>)),</span>
<span id="cb119-1473"><a href="#cb119-1473"></a>    <span class="at">comment =</span> <span class="st">"Second-pass query with curated action+relation terms (1990+)"</span>,</span>
<span id="cb119-1474"><a href="#cb119-1474"></a>    <span class="at">return_data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb119-1475"><a href="#cb119-1475"></a>    <span class="at">output_dir =</span> <span class="st">"data"</span></span>
<span id="cb119-1476"><a href="#cb119-1476"></a>  )</span>
<span id="cb119-1477"><a href="#cb119-1477"></a></span>
<span id="cb119-1478"><a href="#cb119-1478"></a>  <span class="co"># Save second-pass result for reuse</span></span>
<span id="cb119-1479"><a href="#cb119-1479"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(second_pass_result<span class="sc">$</span>data)) {</span>
<span id="cb119-1480"><a href="#cb119-1480"></a>    <span class="fu">save_checkpoint</span>(second_pass_result<span class="sc">$</span>data, <span class="st">"feminizid_raw_data_secondpass"</span>)</span>
<span id="cb119-1481"><a href="#cb119-1481"></a>  }</span>
<span id="cb119-1482"><a href="#cb119-1482"></a>}</span>
<span id="cb119-1483"><a href="#cb119-1483"></a><span class="in">```</span></span>
<span id="cb119-1484"><a href="#cb119-1484"></a></span>
<span id="cb119-1485"><a href="#cb119-1485"></a><span class="fu">## Second-pass data preparation</span></span>
<span id="cb119-1486"><a href="#cb119-1486"></a></span>
<span id="cb119-1487"><a href="#cb119-1487"></a>We clean the second-pass data and build a focused corpus for downstream semantic analysis. The same cleaning logic is applied to keep results comparable with the first pass.</span>
<span id="cb119-1488"><a href="#cb119-1488"></a></span>
<span id="cb119-1489"><a href="#cb119-1489"></a>Clean the second-pass data and build a corpus for downstream analysis.</span>
<span id="cb119-1490"><a href="#cb119-1490"></a></span>
<span id="cb119-1491"><a href="#cb119-1491"></a><span class="in">```{r second-pass-prep, cache.lazy=FALSE}</span></span>
<span id="cb119-1492"><a href="#cb119-1492"></a><span class="fu">load_checkpoint</span>(<span class="st">"feminizid_raw_data_secondpass"</span>, <span class="st">"media_data_second"</span>)</span>
<span id="cb119-1493"><a href="#cb119-1493"></a></span>
<span id="cb119-1494"><a href="#cb119-1494"></a>media_data_second<span class="sc">$</span>pubtime <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(media_data_second<span class="sc">$</span>pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb119-1495"><a href="#cb119-1495"></a>media_data_second<span class="sc">$</span>pub_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(media_data_second<span class="sc">$</span>pubtime)</span>
<span id="cb119-1496"><a href="#cb119-1496"></a>media_data_second<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(media_data_second<span class="sc">$</span>pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb119-1497"><a href="#cb119-1497"></a></span>
<span id="cb119-1498"><a href="#cb119-1498"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb119-1499"><a href="#cb119-1499"></a>  <span class="fu">filter</span>(language <span class="sc">==</span> <span class="st">"de"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1500"><a href="#cb119-1500"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(content), content <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">nchar</span>(content) <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1501"><a href="#cb119-1501"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1990</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1502"><a href="#cb119-1502"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1503"><a href="#cb119-1503"></a>  <span class="fu">mutate</span>(<span class="at">unique_id =</span> <span class="fu">paste0</span>(<span class="st">"doc_"</span>, <span class="fu">row_number</span>()))</span>
<span id="cb119-1504"><a href="#cb119-1504"></a></span>
<span id="cb119-1505"><a href="#cb119-1505"></a>media_data_second<span class="sc">$</span>clean_content <span class="ot">&lt;-</span> media_data_second<span class="sc">$</span>content <span class="sc">%&gt;%</span></span>
<span id="cb119-1506"><a href="#cb119-1506"></a>  <span class="fu">str_remove_all</span>(<span class="st">"&lt;[^&gt;]+&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1507"><a href="#cb119-1507"></a>  <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">n|</span><span class="sc">\\</span><span class="st">t|</span><span class="sc">\\</span><span class="st">r"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1508"><a href="#cb119-1508"></a>  <span class="fu">str_remove_all</span>(<span class="st">"https?://</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1509"><a href="#cb119-1509"></a>  <span class="fu">str_squish</span>()</span>
<span id="cb119-1510"><a href="#cb119-1510"></a></span>
<span id="cb119-1511"><a href="#cb119-1511"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb119-1512"><a href="#cb119-1512"></a>  media_data_second,</span>
<span id="cb119-1513"><a href="#cb119-1513"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb119-1514"><a href="#cb119-1514"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb119-1515"><a href="#cb119-1515"></a>)</span>
<span id="cb119-1516"><a href="#cb119-1516"></a></span>
<span id="cb119-1517"><a href="#cb119-1517"></a><span class="fu">save_checkpoint</span>(secondpass_corpus, <span class="st">"feminizid_secondpass_corpus"</span>)</span>
<span id="cb119-1518"><a href="#cb119-1518"></a><span class="in">```</span></span>
<span id="cb119-1519"><a href="#cb119-1519"></a></span>
<span id="cb119-1520"><a href="#cb119-1520"></a><span class="in">```{r second-pass-filter-rubrics, cache.lazy=FALSE}</span></span>
<span id="cb119-1521"><a href="#cb119-1521"></a><span class="co"># Filter out broad international rubrics for a more focused second-pass set</span></span>
<span id="cb119-1522"><a href="#cb119-1522"></a><span class="co"># (keeps the raw checkpoint intact; only affects downstream analysis)</span></span>
<span id="cb119-1523"><a href="#cb119-1523"></a>media_data_second <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb119-1524"><a href="#cb119-1524"></a>  <span class="fu">mutate</span>(<span class="at">rubric_clean =</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(<span class="fu">str_squish</span>(rubric))) <span class="sc">%&gt;%</span></span>
<span id="cb119-1525"><a href="#cb119-1525"></a>  <span class="fu">filter</span>(<span class="sc">!</span>rubric_clean <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"ausland"</span>, <span class="st">"international"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1526"><a href="#cb119-1526"></a>  <span class="fu">select</span>(<span class="sc">-</span>rubric_clean)</span>
<span id="cb119-1527"><a href="#cb119-1527"></a></span>
<span id="cb119-1528"><a href="#cb119-1528"></a>secondpass_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb119-1529"><a href="#cb119-1529"></a>  media_data_second,</span>
<span id="cb119-1530"><a href="#cb119-1530"></a>  <span class="at">text_field =</span> <span class="st">"clean_content"</span>,</span>
<span id="cb119-1531"><a href="#cb119-1531"></a>  <span class="at">docid_field =</span> <span class="st">"unique_id"</span></span>
<span id="cb119-1532"><a href="#cb119-1532"></a>)</span>
<span id="cb119-1533"><a href="#cb119-1533"></a><span class="in">```</span></span>
<span id="cb119-1534"><a href="#cb119-1534"></a></span>
<span id="cb119-1535"><a href="#cb119-1535"></a><span class="in">```{r second-pass-analysis, cache.lazy=FALSE}</span></span>
<span id="cb119-1536"><a href="#cb119-1536"></a><span class="co"># Basic distribution: article counts per year (1990-present)</span></span>
<span id="cb119-1537"><a href="#cb119-1537"></a>articles_second_by_year <span class="ot">&lt;-</span> media_data_second <span class="sc">%&gt;%</span></span>
<span id="cb119-1538"><a href="#cb119-1538"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-1539"><a href="#cb119-1539"></a>    <span class="at">pubtime =</span> <span class="fu">as.POSIXct</span>(<span class="fu">as.character</span>(pubtime), <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb119-1540"><a href="#cb119-1540"></a>    <span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(pubtime, <span class="st">"%Y"</span>))</span>
<span id="cb119-1541"><a href="#cb119-1541"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1542"><a href="#cb119-1542"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year), year <span class="sc">&gt;=</span> <span class="dv">1990</span>, year <span class="sc">&lt;=</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb119-1543"><a href="#cb119-1543"></a>  <span class="fu">count</span>(year)</span>
<span id="cb119-1544"><a href="#cb119-1544"></a></span>
<span id="cb119-1545"><a href="#cb119-1545"></a>articles_second_by_year</span>
<span id="cb119-1546"><a href="#cb119-1546"></a><span class="in">```</span></span>
<span id="cb119-1547"><a href="#cb119-1547"></a></span>
<span id="cb119-1548"><a href="#cb119-1548"></a><span class="fu"># Top sources</span></span>
<span id="cb119-1549"><a href="#cb119-1549"></a>top_media_second &lt;- media_data_second %&gt;%</span>
<span id="cb119-1550"><a href="#cb119-1550"></a>  count(medium_name, sort = TRUE) %&gt;%</span>
<span id="cb119-1551"><a href="#cb119-1551"></a>  head(15)</span>
<span id="cb119-1552"><a href="#cb119-1552"></a>top_media_second</span>
<span id="cb119-1553"><a href="#cb119-1553"></a><span class="in">```</span></span>
<span id="cb119-1554"><a href="#cb119-1554"></a></span>
<span id="cb119-1555"><a href="#cb119-1555"></a><span class="in"># Top rubric categories</span></span>
<span id="cb119-1556"><a href="#cb119-1556"></a><span class="in">top_rubrics_second &lt;- media_data_second %&gt;%</span></span>
<span id="cb119-1557"><a href="#cb119-1557"></a><span class="in">  mutate(rubric = na_if(str_squish(rubric), "")) %&gt;%</span></span>
<span id="cb119-1558"><a href="#cb119-1558"></a><span class="in">  count(rubric, sort = TRUE) %&gt;%</span></span>
<span id="cb119-1559"><a href="#cb119-1559"></a><span class="in">  head(15)</span></span>
<span id="cb119-1560"><a href="#cb119-1560"></a><span class="in">top_rubrics_second</span></span>
<span id="cb119-1561"><a href="#cb119-1561"></a><span class="in">```</span></span>
<span id="cb119-1562"><a href="#cb119-1562"></a></span>
<span id="cb119-1563"><a href="#cb119-1563"></a><span class="fu"># Normalized contrast: early vs. late periods (per million words)</span></span>
<span id="cb119-1564"><a href="#cb119-1564"></a>tokens_raw &lt;- tokens(</span>
<span id="cb119-1565"><a href="#cb119-1565"></a>  secondpass_corpus,</span>
<span id="cb119-1566"><a href="#cb119-1566"></a>  remove_punct = TRUE,</span>
<span id="cb119-1567"><a href="#cb119-1567"></a>  remove_symbols = TRUE,</span>
<span id="cb119-1568"><a href="#cb119-1568"></a>  remove_numbers = TRUE,</span>
<span id="cb119-1569"><a href="#cb119-1569"></a>  remove_url = TRUE</span>
<span id="cb119-1570"><a href="#cb119-1570"></a>)</span>
<span id="cb119-1571"><a href="#cb119-1571"></a></span>
<span id="cb119-1572"><a href="#cb119-1572"></a>dfm_raw &lt;- dfm(tokens_raw, tolower = TRUE)</span>
<span id="cb119-1573"><a href="#cb119-1573"></a>dfm_raw &lt;- dfm_remove(dfm_raw, all_stopwords, valuetype = "fixed")</span>
<span id="cb119-1574"><a href="#cb119-1574"></a>dfm_raw &lt;- dfm_remove(</span>
<span id="cb119-1575"><a href="#cb119-1575"></a>  dfm_raw,</span>
<span id="cb119-1576"><a href="#cb119-1576"></a>  pattern = c(</span>
<span id="cb119-1577"><a href="#cb119-1577"></a>    "^uhr",</span>
<span id="cb119-1578"><a href="#cb119-1578"></a>    "^(montag|dienstag|mittwoch|donnerstag|freitag|samstag|sonntag)$",</span>
<span id="cb119-1579"><a href="#cb119-1579"></a>    ".*\\d+.*",</span>
<span id="cb119-1580"><a href="#cb119-1580"></a>    "^<span class="co">[</span><span class="ot">a-zäöüß</span><span class="co">]</span>{1,2}$"</span>
<span id="cb119-1581"><a href="#cb119-1581"></a>  ),</span>
<span id="cb119-1582"><a href="#cb119-1582"></a>  valuetype = "regex",</span>
<span id="cb119-1583"><a href="#cb119-1583"></a>  case_insensitive = TRUE</span>
<span id="cb119-1584"><a href="#cb119-1584"></a>)</span>
<span id="cb119-1585"><a href="#cb119-1585"></a>dfm_raw &lt;- dfm_trim(dfm_raw, min_termfreq = 10)</span>
<span id="cb119-1586"><a href="#cb119-1586"></a></span>
<span id="cb119-1587"><a href="#cb119-1587"></a>doc_ids &lt;- docnames(dfm_raw)</span>
<span id="cb119-1588"><a href="#cb119-1588"></a>year_lookup &lt;- media_data_second$year<span class="co">[</span><span class="ot">match(doc_ids, media_data_second$unique_id)</span><span class="co">]</span></span>
<span id="cb119-1589"><a href="#cb119-1589"></a>period_vec &lt;- ifelse(is.na(year_lookup), "Unknown",</span>
<span id="cb119-1590"><a href="#cb119-1590"></a>                     ifelse(year_lookup &lt; 2005, "1990-2004", "2005-2026"))</span>
<span id="cb119-1591"><a href="#cb119-1591"></a>docvars(dfm_raw, "period") &lt;- period_vec</span>
<span id="cb119-1592"><a href="#cb119-1592"></a></span>
<span id="cb119-1593"><a href="#cb119-1593"></a>dfm_period &lt;- dfm_group(dfm_raw, groups = docvars(dfm_raw, "period"))</span>
<span id="cb119-1594"><a href="#cb119-1594"></a>dfm_prop &lt;- dfm_weight(dfm_period, scheme = "prop")</span>
<span id="cb119-1595"><a href="#cb119-1595"></a></span>
<span id="cb119-1596"><a href="#cb119-1596"></a>term_prop &lt;- convert(dfm_prop, to = "data.frame") %&gt;%</span>
<span id="cb119-1597"><a href="#cb119-1597"></a>  select(-doc_id) %&gt;%</span>
<span id="cb119-1598"><a href="#cb119-1598"></a>  mutate(period = rownames(dfm_prop))</span>
<span id="cb119-1599"><a href="#cb119-1599"></a></span>
<span id="cb119-1600"><a href="#cb119-1600"></a>term_long &lt;- term_prop %&gt;%</span>
<span id="cb119-1601"><a href="#cb119-1601"></a>  pivot_longer(-period, names_to = "term", values_to = "prop")</span>
<span id="cb119-1602"><a href="#cb119-1602"></a></span>
<span id="cb119-1603"><a href="#cb119-1603"></a>term_wide &lt;- term_long %&gt;%</span>
<span id="cb119-1604"><a href="#cb119-1604"></a>  pivot_wider(names_from = period, values_from = prop, values_fill = 0) %&gt;%</span>
<span id="cb119-1605"><a href="#cb119-1605"></a>  mutate(</span>
<span id="cb119-1606"><a href="#cb119-1606"></a>    early_per_million = <span class="in">`1990-2004`</span> * 1e6,</span>
<span id="cb119-1607"><a href="#cb119-1607"></a>    late_per_million = <span class="in">`2005-2026`</span> * 1e6,</span>
<span id="cb119-1608"><a href="#cb119-1608"></a>    log2_ratio = log2((late_per_million + 1) / (early_per_million + 1))</span>
<span id="cb119-1609"><a href="#cb119-1609"></a>  )</span>
<span id="cb119-1610"><a href="#cb119-1610"></a></span>
<span id="cb119-1611"><a href="#cb119-1611"></a>top_contrast &lt;- bind_rows(</span>
<span id="cb119-1612"><a href="#cb119-1612"></a>  head(arrange(term_wide, desc(log2_ratio)), 15),</span>
<span id="cb119-1613"><a href="#cb119-1613"></a>  head(arrange(term_wide, log2_ratio), 15)</span>
<span id="cb119-1614"><a href="#cb119-1614"></a>) %&gt;%</span>
<span id="cb119-1615"><a href="#cb119-1615"></a>  mutate(direction = ifelse(log2_ratio &gt; 0, "Later period", "Earlier period"))</span>
<span id="cb119-1616"><a href="#cb119-1616"></a></span>
<span id="cb119-1617"><a href="#cb119-1617"></a>top_contrast %&gt;% select(term, log2_ratio, direction)</span>
<span id="cb119-1618"><a href="#cb119-1618"></a><span class="in">```</span></span>
<span id="cb119-1619"><a href="#cb119-1619"></a></span>
<span id="cb119-1620"><a href="#cb119-1620"></a><span class="in">```{r checkpoint-save-secondpass-analysis, cache.lazy=FALSE}</span></span>
<span id="cb119-1621"><a href="#cb119-1621"></a><span class="in"># Checkpoint save (Second-pass analysis outputs)</span></span>
<span id="cb119-1622"><a href="#cb119-1622"></a><span class="in">save_checkpoint(top_contrast, "secondpass_key_terms")</span></span>
<span id="cb119-1623"><a href="#cb119-1623"></a><span class="in">```</span></span>
<span id="cb119-1624"><a href="#cb119-1624"></a></span>
<span id="cb119-1625"><a href="#cb119-1625"></a><span class="fu">## Second-pass semantic expansion (iteration 2)</span></span>
<span id="cb119-1626"><a href="#cb119-1626"></a></span>
<span id="cb119-1627"><a href="#cb119-1627"></a>We repeat the embedding approach on the second-pass corpus to identify framing shifts inside this narrower, more specific dataset. This provides a robustness check against the broader first-pass collection.</span>
<span id="cb119-1628"><a href="#cb119-1628"></a></span>
<span id="cb119-1629"><a href="#cb119-1629"></a>We run a second, focused embedding pass on the filtered second-pass corpus. The goal is to surface terms that describe feminicide framing across 5-year windows.</span>
<span id="cb119-1630"><a href="#cb119-1630"></a></span>
<span id="cb119-1631"><a href="#cb119-1631"></a><span class="in">```{r second-pass-word2vec-setup, cache.lazy=FALSE}</span></span>
<span id="cb119-1632"><a href="#cb119-1632"></a><span class="co"># Build 5-year windows based on available second-pass years</span></span>
<span id="cb119-1633"><a href="#cb119-1633"></a>min_year_sp <span class="ot">&lt;-</span> <span class="fu">min</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-1634"><a href="#cb119-1634"></a>max_year_sp <span class="ot">&lt;-</span> <span class="fu">max</span>(media_data_second<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-1635"><a href="#cb119-1635"></a>window_starts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">floor</span>(min_year_sp <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>, max_year_sp, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb119-1636"><a href="#cb119-1636"></a>time_windows_secondpass <span class="ot">&lt;-</span> <span class="fu">setNames</span>(</span>
<span id="cb119-1637"><a href="#cb119-1637"></a>  <span class="fu">lapply</span>(window_starts, <span class="cf">function</span>(y) <span class="fu">c</span>(y, <span class="fu">min</span>(y <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))),</span>
<span id="cb119-1638"><a href="#cb119-1638"></a>  <span class="fu">paste0</span>(window_starts, <span class="st">"-"</span>, <span class="fu">pmin</span>(window_starts <span class="sc">+</span> <span class="dv">4</span>, max_year_sp))</span>
<span id="cb119-1639"><a href="#cb119-1639"></a>)</span>
<span id="cb119-1640"><a href="#cb119-1640"></a></span>
<span id="cb119-1641"><a href="#cb119-1641"></a>seed_terms_secondpass <span class="ot">&lt;-</span> <span class="fu">unique</span>(target_map<span class="sc">$</span>normalized)</span>
<span id="cb119-1642"><a href="#cb119-1642"></a><span class="in">```</span></span>
<span id="cb119-1643"><a href="#cb119-1643"></a></span>
<span id="cb119-1644"><a href="#cb119-1644"></a><span class="in">```{r second-pass-word2vec-training, cache=FALSE}</span></span>
<span id="cb119-1645"><a href="#cb119-1645"></a><span class="co"># Train one model per window for the second-pass corpus.</span></span>
<span id="cb119-1646"><a href="#cb119-1646"></a><span class="co"># Always export plain vectors (no external pointers) for reuse.</span></span>
<span id="cb119-1647"><a href="#cb119-1647"></a>existing_vectors <span class="ot">&lt;-</span> <span class="fu">latest_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1648"><a href="#cb119-1648"></a><span class="cf">if</span> (<span class="sc">!</span>RUN_SECOND_PASS_W2V_TRAINING) {</span>
<span id="cb119-1649"><a href="#cb119-1649"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec training disabled (RUN_SECOND_PASS_W2V_TRAINING = FALSE)."</span>)</span>
<span id="cb119-1650"><a href="#cb119-1650"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb119-1651"><a href="#cb119-1651"></a>    <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1652"><a href="#cb119-1652"></a>  }</span>
<span id="cb119-1653"><a href="#cb119-1653"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>FORCE_SECOND_PASS_W2V_TRAINING <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(existing_vectors)) {</span>
<span id="cb119-1654"><a href="#cb119-1654"></a>  <span class="fu">message</span>(<span class="st">"Second-pass Word2Vec vectors already exist; skipping training."</span>)</span>
<span id="cb119-1655"><a href="#cb119-1655"></a>  <span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1656"><a href="#cb119-1656"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1657"><a href="#cb119-1657"></a>  word2vec_models_secondpass <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-1658"><a href="#cb119-1658"></a></span>
<span id="cb119-1659"><a href="#cb119-1659"></a>  <span class="cf">for</span> (window_name <span class="cf">in</span> <span class="fu">names</span>(time_windows_secondpass)) {</span>
<span id="cb119-1660"><a href="#cb119-1660"></a>    window_years <span class="ot">&lt;-</span> time_windows_secondpass[[window_name]]</span>
<span id="cb119-1661"><a href="#cb119-1661"></a>    window_corpus <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(</span>
<span id="cb119-1662"><a href="#cb119-1662"></a>      secondpass_corpus,</span>
<span id="cb119-1663"><a href="#cb119-1663"></a>      year <span class="sc">&gt;=</span> window_years[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> window_years[<span class="dv">2</span>]</span>
<span id="cb119-1664"><a href="#cb119-1664"></a>    )</span>
<span id="cb119-1665"><a href="#cb119-1665"></a>    model <span class="ot">&lt;-</span> <span class="fu">train_w2v</span>(window_name, window_corpus)</span>
<span id="cb119-1666"><a href="#cb119-1666"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(model)) {</span>
<span id="cb119-1667"><a href="#cb119-1667"></a>      word2vec_models_secondpass[[window_name]] <span class="ot">&lt;-</span> model</span>
<span id="cb119-1668"><a href="#cb119-1668"></a>    }</span>
<span id="cb119-1669"><a href="#cb119-1669"></a>  }</span>
<span id="cb119-1670"><a href="#cb119-1670"></a></span>
<span id="cb119-1671"><a href="#cb119-1671"></a>  word2vec_vectors_secondpass <span class="ot">&lt;-</span> <span class="fu">lapply</span>(word2vec_models_secondpass, as.matrix)</span>
<span id="cb119-1672"><a href="#cb119-1672"></a>  <span class="fu">save_checkpoint</span>(word2vec_vectors_secondpass, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1673"><a href="#cb119-1673"></a>}</span>
<span id="cb119-1674"><a href="#cb119-1674"></a><span class="in">```</span></span>
<span id="cb119-1675"><a href="#cb119-1675"></a></span>
<span id="cb119-1676"><a href="#cb119-1676"></a><span class="in">```{r checkpoint-load-word2vec-secondpass, cache.lazy=FALSE}</span></span>
<span id="cb119-1677"><a href="#cb119-1677"></a><span class="co"># Checkpoint load (Second-pass Word2Vec vectors)</span></span>
<span id="cb119-1678"><a href="#cb119-1678"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1679"><a href="#cb119-1679"></a><span class="in">```</span></span>
<span id="cb119-1680"><a href="#cb119-1680"></a></span>
<span id="cb119-1681"><a href="#cb119-1681"></a><span class="in">```{r second-pass-word2vec-neighbors, cache.lazy=FALSE}</span></span>
<span id="cb119-1682"><a href="#cb119-1682"></a><span class="co"># Collect nearest neighbors for seed terms across windows</span></span>
<span id="cb119-1683"><a href="#cb119-1683"></a><span class="fu">load_checkpoint</span>(<span class="st">"word2vec_vectors_secondpass"</span>, <span class="st">"word2vec_vectors_secondpass"</span>)</span>
<span id="cb119-1684"><a href="#cb119-1684"></a></span>
<span id="cb119-1685"><a href="#cb119-1685"></a>collect_neighbors_vectors <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, seeds, <span class="at">top_n =</span> <span class="dv">30</span>) {</span>
<span id="cb119-1686"><a href="#cb119-1686"></a>  seeds_in_vocab <span class="ot">&lt;-</span> <span class="fu">intersect</span>(seeds, <span class="fu">rownames</span>(vectors))</span>
<span id="cb119-1687"><a href="#cb119-1687"></a>  <span class="cf">if</span> (<span class="fu">length</span>(seeds_in_vocab) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb119-1688"><a href="#cb119-1688"></a></span>
<span id="cb119-1689"><a href="#cb119-1689"></a>  norms <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>(vectors<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb119-1690"><a href="#cb119-1690"></a>  norms[norms <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb119-1691"><a href="#cb119-1691"></a>  vectors_norm <span class="ot">&lt;-</span> vectors <span class="sc">/</span> norms</span>
<span id="cb119-1692"><a href="#cb119-1692"></a></span>
<span id="cb119-1693"><a href="#cb119-1693"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(seeds_in_vocab, <span class="cf">function</span>(seed) {</span>
<span id="cb119-1694"><a href="#cb119-1694"></a>    seed_vec <span class="ot">&lt;-</span> vectors_norm[seed, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1695"><a href="#cb119-1695"></a>    sims <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(vectors_norm <span class="sc">%*%</span> <span class="fu">t</span>(seed_vec))</span>
<span id="cb119-1696"><a href="#cb119-1696"></a>    <span class="fu">names</span>(sims) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(vectors_norm)</span>
<span id="cb119-1697"><a href="#cb119-1697"></a>    sims <span class="ot">&lt;-</span> sims[<span class="fu">names</span>(sims) <span class="sc">!=</span> seed]</span>
<span id="cb119-1698"><a href="#cb119-1698"></a>    top <span class="ot">&lt;-</span> <span class="fu">sort</span>(sims, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="fu">seq_len</span>(<span class="fu">min</span>(top_n, <span class="fu">length</span>(sims)))]</span>
<span id="cb119-1699"><a href="#cb119-1699"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb119-1700"><a href="#cb119-1700"></a>      <span class="at">seed =</span> seed,</span>
<span id="cb119-1701"><a href="#cb119-1701"></a>      <span class="at">term =</span> <span class="fu">names</span>(top),</span>
<span id="cb119-1702"><a href="#cb119-1702"></a>      <span class="at">similarity =</span> <span class="fu">as.numeric</span>(top),</span>
<span id="cb119-1703"><a href="#cb119-1703"></a>      <span class="at">rank =</span> <span class="fu">seq_along</span>(top),</span>
<span id="cb119-1704"><a href="#cb119-1704"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-1705"><a href="#cb119-1705"></a>    )</span>
<span id="cb119-1706"><a href="#cb119-1706"></a>  })</span>
<span id="cb119-1707"><a href="#cb119-1707"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(res)</span>
<span id="cb119-1708"><a href="#cb119-1708"></a>}</span>
<span id="cb119-1709"><a href="#cb119-1709"></a></span>
<span id="cb119-1710"><a href="#cb119-1710"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb119-1711"><a href="#cb119-1711"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb119-1712"><a href="#cb119-1712"></a>}</span>
<span id="cb119-1713"><a href="#cb119-1713"></a></span>
<span id="cb119-1714"><a href="#cb119-1714"></a>neighbors_secondpass <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(<span class="fu">names</span>(word2vec_vectors_secondpass), <span class="cf">function</span>(w) {</span>
<span id="cb119-1715"><a href="#cb119-1715"></a>  vectors <span class="ot">&lt;-</span> word2vec_vectors_secondpass[[w]]</span>
<span id="cb119-1716"><a href="#cb119-1716"></a>  df <span class="ot">&lt;-</span> <span class="fu">collect_neighbors_vectors</span>(vectors, seed_terms_secondpass, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb119-1717"><a href="#cb119-1717"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb119-1718"><a href="#cb119-1718"></a>  df</span>
<span id="cb119-1719"><a href="#cb119-1719"></a>}))</span>
<span id="cb119-1720"><a href="#cb119-1720"></a></span>
<span id="cb119-1721"><a href="#cb119-1721"></a><span class="fu">save_checkpoint</span>(neighbors_secondpass, <span class="st">"word2vec_neighbors_secondpass"</span>)</span>
<span id="cb119-1722"><a href="#cb119-1722"></a></span>
<span id="cb119-1723"><a href="#cb119-1723"></a>candidate_terms_secondpass <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb119-1724"><a href="#cb119-1724"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb119-1725"><a href="#cb119-1725"></a>  <span class="fu">summarise</span>(</span>
<span id="cb119-1726"><a href="#cb119-1726"></a>    <span class="at">mean_similarity =</span> <span class="fu">mean</span>(similarity),</span>
<span id="cb119-1727"><a href="#cb119-1727"></a>    <span class="at">seed_hits =</span> <span class="fu">n_distinct</span>(seed),</span>
<span id="cb119-1728"><a href="#cb119-1728"></a>    <span class="at">window_hits =</span> <span class="fu">n_distinct</span>(window),</span>
<span id="cb119-1729"><a href="#cb119-1729"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb119-1730"><a href="#cb119-1730"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1731"><a href="#cb119-1731"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_similarity)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1732"><a href="#cb119-1732"></a>  <span class="fu">filter</span>(seed_hits <span class="sc">&gt;=</span> <span class="dv">2</span>, window_hits <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1733"><a href="#cb119-1733"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb119-1734"><a href="#cb119-1734"></a></span>
<span id="cb119-1735"><a href="#cb119-1735"></a>candidate_terms_secondpass</span>
<span id="cb119-1736"><a href="#cb119-1736"></a><span class="in">```</span></span>
<span id="cb119-1737"><a href="#cb119-1737"></a></span>
<span id="cb119-1738"><a href="#cb119-1738"></a><span class="in">```{r second-pass-word2vec-3d, cache.lazy=FALSE}</span></span>
<span id="cb119-1739"><a href="#cb119-1739"></a><span class="co"># We align spaces across windows before projecting to 3D. Without alignment,</span></span>
<span id="cb119-1740"><a href="#cb119-1740"></a><span class="co"># apparent movement may be an artifact of arbitrary embedding rotations.</span></span>
<span id="cb119-1741"><a href="#cb119-1741"></a><span class="co"># Interactive 3D view across time windows (aligned spaces)</span></span>
<span id="cb119-1742"><a href="#cb119-1742"></a><span class="co"># Important: align vectors across windows before comparing positions.</span></span>
<span id="cb119-1743"><a href="#cb119-1743"></a><span class="cf">if</span> (<span class="fu">is.null</span>(word2vec_vectors_secondpass)) {</span>
<span id="cb119-1744"><a href="#cb119-1744"></a>  <span class="fu">stop</span>(<span class="st">"No word2vec vectors available. Run the training chunk once."</span>)</span>
<span id="cb119-1745"><a href="#cb119-1745"></a>}</span>
<span id="cb119-1746"><a href="#cb119-1746"></a></span>
<span id="cb119-1747"><a href="#cb119-1747"></a><span class="co"># Controls for density and focus</span></span>
<span id="cb119-1748"><a href="#cb119-1748"></a>TOP_NEIGHBORS_PER_TARGET <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb119-1749"><a href="#cb119-1749"></a>MAX_MOVERS <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb119-1750"><a href="#cb119-1750"></a>MAX_POINTS_PER_WINDOW <span class="ot">&lt;-</span> <span class="dv">250</span></span>
<span id="cb119-1751"><a href="#cb119-1751"></a>MAX_TARGETS <span class="ot">&lt;-</span> <span class="fu">length</span>(target_words)  <span class="co"># reduce for clarity if needed</span></span>
<span id="cb119-1752"><a href="#cb119-1752"></a></span>
<span id="cb119-1753"><a href="#cb119-1753"></a><span class="co"># Select neighbors per target and window</span></span>
<span id="cb119-1754"><a href="#cb119-1754"></a>targets_focus <span class="ot">&lt;-</span> <span class="fu">head</span>(target_words, MAX_TARGETS)</span>
<span id="cb119-1755"><a href="#cb119-1755"></a>targets_focus_norm <span class="ot">&lt;-</span> <span class="fu">normalize_terms_for_model</span>(targets_focus)</span>
<span id="cb119-1756"><a href="#cb119-1756"></a>target_label_map <span class="ot">&lt;-</span> target_map <span class="sc">%&gt;%</span></span>
<span id="cb119-1757"><a href="#cb119-1757"></a>  <span class="fu">select</span>(original, normalized) <span class="sc">%&gt;%</span></span>
<span id="cb119-1758"><a href="#cb119-1758"></a>  <span class="fu">distinct</span>()</span>
<span id="cb119-1759"><a href="#cb119-1759"></a>neighbors_top <span class="ot">&lt;-</span> neighbors_secondpass <span class="sc">%&gt;%</span></span>
<span id="cb119-1760"><a href="#cb119-1760"></a>  <span class="fu">filter</span>(seed <span class="sc">%in%</span> targets_focus_norm) <span class="sc">%&gt;%</span></span>
<span id="cb119-1761"><a href="#cb119-1761"></a>  <span class="fu">group_by</span>(window, seed) <span class="sc">%&gt;%</span></span>
<span id="cb119-1762"><a href="#cb119-1762"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> TOP_NEIGHBORS_PER_TARGET, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1763"><a href="#cb119-1763"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb119-1764"><a href="#cb119-1764"></a></span>
<span id="cb119-1765"><a href="#cb119-1765"></a><span class="co"># Dominant target per term/window (for coloring)</span></span>
<span id="cb119-1766"><a href="#cb119-1766"></a>dominant_seed <span class="ot">&lt;-</span> neighbors_top <span class="sc">%&gt;%</span></span>
<span id="cb119-1767"><a href="#cb119-1767"></a>  <span class="fu">group_by</span>(window, term) <span class="sc">%&gt;%</span></span>
<span id="cb119-1768"><a href="#cb119-1768"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> similarity, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-1769"><a href="#cb119-1769"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-1770"><a href="#cb119-1770"></a>  <span class="fu">select</span>(window, term, seed)</span>
<span id="cb119-1771"><a href="#cb119-1771"></a></span>
<span id="cb119-1772"><a href="#cb119-1772"></a><span class="co"># Build a compact term set: targets + top neighbors</span></span>
<span id="cb119-1773"><a href="#cb119-1773"></a>terms_all <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(targets_focus_norm, neighbors_top<span class="sc">$</span>term))</span>
<span id="cb119-1774"><a href="#cb119-1774"></a>terms_all <span class="ot">&lt;-</span> terms_all[<span class="sc">!</span><span class="fu">is.na</span>(terms_all)]</span>
<span id="cb119-1775"><a href="#cb119-1775"></a></span>
<span id="cb119-1776"><a href="#cb119-1776"></a>vectors_list <span class="ot">&lt;-</span> word2vec_vectors_secondpass</span>
<span id="cb119-1777"><a href="#cb119-1777"></a>windows <span class="ot">&lt;-</span> <span class="fu">names</span>(vectors_list)</span>
<span id="cb119-1778"><a href="#cb119-1778"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb119-1779"><a href="#cb119-1779"></a>  <span class="fu">stop</span>(<span class="st">"Need at least two time windows for an interactive timeline."</span>)</span>
<span id="cb119-1780"><a href="#cb119-1780"></a>}</span>
<span id="cb119-1781"><a href="#cb119-1781"></a></span>
<span id="cb119-1782"><a href="#cb119-1782"></a><span class="co"># Reference window for alignment</span></span>
<span id="cb119-1783"><a href="#cb119-1783"></a>ref_window <span class="ot">&lt;-</span> windows[<span class="dv">1</span>]</span>
<span id="cb119-1784"><a href="#cb119-1784"></a>ref_vectors <span class="ot">&lt;-</span> vectors_list[[ref_window]]</span>
<span id="cb119-1785"><a href="#cb119-1785"></a></span>
<span id="cb119-1786"><a href="#cb119-1786"></a><span class="co"># Common terms used for alignment (must exist in all windows)</span></span>
<span id="cb119-1787"><a href="#cb119-1787"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(vectors_list, rownames))</span>
<span id="cb119-1788"><a href="#cb119-1788"></a>common_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(common_terms, <span class="fu">rownames</span>(ref_vectors))</span>
<span id="cb119-1789"><a href="#cb119-1789"></a><span class="cf">if</span> (<span class="fu">length</span>(common_terms) <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb119-1790"><a href="#cb119-1790"></a>  <span class="fu">message</span>(<span class="st">"WARN: Few common terms for alignment ("</span>, <span class="fu">length</span>(common_terms), <span class="st">")."</span>)</span>
<span id="cb119-1791"><a href="#cb119-1791"></a>}</span>
<span id="cb119-1792"><a href="#cb119-1792"></a></span>
<span id="cb119-1793"><a href="#cb119-1793"></a>align_to_reference <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, ref_vec, anchor_terms) {</span>
<span id="cb119-1794"><a href="#cb119-1794"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchor_terms, <span class="fu">rownames</span>(vec))</span>
<span id="cb119-1795"><a href="#cb119-1795"></a>  anchors <span class="ot">&lt;-</span> <span class="fu">intersect</span>(anchors, <span class="fu">rownames</span>(ref_vec))</span>
<span id="cb119-1796"><a href="#cb119-1796"></a>  <span class="cf">if</span> (<span class="fu">length</span>(anchors) <span class="sc">&lt;</span> <span class="dv">10</span>) <span class="fu">return</span>(vec)</span>
<span id="cb119-1797"><a href="#cb119-1797"></a>  A <span class="ot">&lt;-</span> ref_vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1798"><a href="#cb119-1798"></a>  B <span class="ot">&lt;-</span> vec[anchors, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1799"><a href="#cb119-1799"></a>  M <span class="ot">&lt;-</span> <span class="fu">t</span>(B) <span class="sc">%*%</span> A</span>
<span id="cb119-1800"><a href="#cb119-1800"></a>  sv <span class="ot">&lt;-</span> <span class="fu">svd</span>(M)</span>
<span id="cb119-1801"><a href="#cb119-1801"></a>  R <span class="ot">&lt;-</span> sv<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">t</span>(sv<span class="sc">$</span>v)</span>
<span id="cb119-1802"><a href="#cb119-1802"></a>  vec <span class="sc">%*%</span> R</span>
<span id="cb119-1803"><a href="#cb119-1803"></a>}</span>
<span id="cb119-1804"><a href="#cb119-1804"></a></span>
<span id="cb119-1805"><a href="#cb119-1805"></a><span class="co"># Align all windows to reference</span></span>
<span id="cb119-1806"><a href="#cb119-1806"></a>aligned_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(vectors_list, <span class="cf">function</span>(v) {</span>
<span id="cb119-1807"><a href="#cb119-1807"></a>  <span class="fu">align_to_reference</span>(v, ref_vectors, common_terms)</span>
<span id="cb119-1808"><a href="#cb119-1808"></a>})</span>
<span id="cb119-1809"><a href="#cb119-1809"></a></span>
<span id="cb119-1810"><a href="#cb119-1810"></a><span class="co"># PCA basis from reference window on shared terms (for comparable axes)</span></span>
<span id="cb119-1811"><a href="#cb119-1811"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms_all, <span class="fu">rownames</span>(aligned_list[[ref_window]]))</span>
<span id="cb119-1812"><a href="#cb119-1812"></a>ref_anchor_terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(ref_anchor_terms, common_terms)</span>
<span id="cb119-1813"><a href="#cb119-1813"></a><span class="cf">if</span> (<span class="fu">length</span>(ref_anchor_terms) <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb119-1814"><a href="#cb119-1814"></a>  <span class="fu">stop</span>(<span class="st">"Not enough shared terms for stable PCA alignment."</span>)</span>
<span id="cb119-1815"><a href="#cb119-1815"></a>}</span>
<span id="cb119-1816"><a href="#cb119-1816"></a>ref_mat <span class="ot">&lt;-</span> aligned_list[[ref_window]][ref_anchor_terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1817"><a href="#cb119-1817"></a>pca_ref <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(ref_mat, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-1818"><a href="#cb119-1818"></a></span>
<span id="cb119-1819"><a href="#cb119-1819"></a>project_window <span class="ot">&lt;-</span> <span class="cf">function</span>(vectors, terms, pca_obj) {</span>
<span id="cb119-1820"><a href="#cb119-1820"></a>  terms <span class="ot">&lt;-</span> <span class="fu">intersect</span>(terms, <span class="fu">rownames</span>(vectors))</span>
<span id="cb119-1821"><a href="#cb119-1821"></a>  mat <span class="ot">&lt;-</span> vectors[terms, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb119-1822"><a href="#cb119-1822"></a>  coords <span class="ot">&lt;-</span> <span class="fu">scale</span>(mat, <span class="at">center =</span> pca_obj<span class="sc">$</span>center, <span class="at">scale =</span> <span class="cn">FALSE</span>) <span class="sc">%*%</span> pca_obj<span class="sc">$</span>rotation[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb119-1823"><a href="#cb119-1823"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb119-1824"><a href="#cb119-1824"></a>    <span class="at">term =</span> terms,</span>
<span id="cb119-1825"><a href="#cb119-1825"></a>    <span class="at">x =</span> coords[, <span class="dv">1</span>],</span>
<span id="cb119-1826"><a href="#cb119-1826"></a>    <span class="at">y =</span> coords[, <span class="dv">2</span>],</span>
<span id="cb119-1827"><a href="#cb119-1827"></a>    <span class="at">z =</span> coords[, <span class="dv">3</span>],</span>
<span id="cb119-1828"><a href="#cb119-1828"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb119-1829"><a href="#cb119-1829"></a>  )</span>
<span id="cb119-1830"><a href="#cb119-1830"></a>}</span>
<span id="cb119-1831"><a href="#cb119-1831"></a></span>
<span id="cb119-1832"><a href="#cb119-1832"></a>plot_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="fu">lapply</span>(windows, <span class="cf">function</span>(w) {</span>
<span id="cb119-1833"><a href="#cb119-1833"></a>  vectors <span class="ot">&lt;-</span> aligned_list[[w]]</span>
<span id="cb119-1834"><a href="#cb119-1834"></a>  df <span class="ot">&lt;-</span> <span class="fu">project_window</span>(vectors, terms_all, pca_ref)</span>
<span id="cb119-1835"><a href="#cb119-1835"></a>  df<span class="sc">$</span>window <span class="ot">&lt;-</span> w</span>
<span id="cb119-1836"><a href="#cb119-1836"></a>  df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>term <span class="sc">%in%</span> seed_terms_secondpass, <span class="st">"target"</span>, <span class="st">"neighbor"</span>)</span>
<span id="cb119-1837"><a href="#cb119-1837"></a>  df</span>
<span id="cb119-1838"><a href="#cb119-1838"></a>}))</span>
<span id="cb119-1839"><a href="#cb119-1839"></a></span>
<span id="cb119-1840"><a href="#cb119-1840"></a><span class="co"># Track movers: terms with largest displacement across windows</span></span>
<span id="cb119-1841"><a href="#cb119-1841"></a><span class="cf">if</span> (<span class="fu">length</span>(windows) <span class="sc">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb119-1842"><a href="#cb119-1842"></a>  mover_candidates <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb119-1843"><a href="#cb119-1843"></a>    <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb119-1844"><a href="#cb119-1844"></a>    <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">==</span> <span class="fu">length</span>(windows)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1845"><a href="#cb119-1845"></a>    <span class="fu">summarise</span>(</span>
<span id="cb119-1846"><a href="#cb119-1846"></a>      <span class="at">dx =</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x),</span>
<span id="cb119-1847"><a href="#cb119-1847"></a>      <span class="at">dy =</span> <span class="fu">max</span>(y) <span class="sc">-</span> <span class="fu">min</span>(y),</span>
<span id="cb119-1848"><a href="#cb119-1848"></a>      <span class="at">dz =</span> <span class="fu">max</span>(z) <span class="sc">-</span> <span class="fu">min</span>(z),</span>
<span id="cb119-1849"><a href="#cb119-1849"></a>      <span class="at">displacement =</span> <span class="fu">sqrt</span>(dx<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dy<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> dz<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb119-1850"><a href="#cb119-1850"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb119-1851"><a href="#cb119-1851"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1852"><a href="#cb119-1852"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(displacement)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1853"><a href="#cb119-1853"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_MOVERS) <span class="sc">%&gt;%</span></span>
<span id="cb119-1854"><a href="#cb119-1854"></a>    <span class="fu">pull</span>(term)</span>
<span id="cb119-1855"><a href="#cb119-1855"></a>} <span class="cf">else</span> {</span>
<span id="cb119-1856"><a href="#cb119-1856"></a>  mover_candidates <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb119-1857"><a href="#cb119-1857"></a>}</span>
<span id="cb119-1858"><a href="#cb119-1858"></a></span>
<span id="cb119-1859"><a href="#cb119-1859"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb119-1860"><a href="#cb119-1860"></a>  <span class="fu">left_join</span>(dominant_seed, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"window"</span>, <span class="st">"term"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1861"><a href="#cb119-1861"></a>  <span class="fu">left_join</span>(target_label_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"term"</span> <span class="ot">=</span> <span class="st">"normalized"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-1862"><a href="#cb119-1862"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-1863"><a href="#cb119-1863"></a>    <span class="at">is_mover =</span> term <span class="sc">%in%</span> mover_candidates,</span>
<span id="cb119-1864"><a href="#cb119-1864"></a>    <span class="at">label =</span> <span class="fu">ifelse</span>(type <span class="sc">==</span> <span class="st">"target"</span>, original, term)</span>
<span id="cb119-1865"><a href="#cb119-1865"></a>  )</span>
<span id="cb119-1866"><a href="#cb119-1866"></a></span>
<span id="cb119-1867"><a href="#cb119-1867"></a><span class="co"># Keep: all targets + top neighbors + movers</span></span>
<span id="cb119-1868"><a href="#cb119-1868"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb119-1869"><a href="#cb119-1869"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(seed) <span class="sc">|</span> is_mover)</span>
<span id="cb119-1870"><a href="#cb119-1870"></a></span>
<span id="cb119-1871"><a href="#cb119-1871"></a><span class="co"># Cap total points per window</span></span>
<span id="cb119-1872"><a href="#cb119-1872"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb119-1873"><a href="#cb119-1873"></a>  <span class="fu">group_by</span>(window) <span class="sc">%&gt;%</span></span>
<span id="cb119-1874"><a href="#cb119-1874"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> MAX_POINTS_PER_WINDOW) <span class="sc">%&gt;%</span></span>
<span id="cb119-1875"><a href="#cb119-1875"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb119-1876"><a href="#cb119-1876"></a></span>
<span id="cb119-1877"><a href="#cb119-1877"></a><span class="co"># Split targets vs neighbors for clearer rendering and stable traces</span></span>
<span id="cb119-1878"><a href="#cb119-1878"></a>targets_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"target"</span>)</span>
<span id="cb119-1879"><a href="#cb119-1879"></a>neighbors_plot <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"neighbor"</span>)</span>
<span id="cb119-1880"><a href="#cb119-1880"></a></span>
<span id="cb119-1881"><a href="#cb119-1881"></a>p_w2v_3d <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb119-1882"><a href="#cb119-1882"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb119-1883"><a href="#cb119-1883"></a>    <span class="at">data =</span> neighbors_plot,</span>
<span id="cb119-1884"><a href="#cb119-1884"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb119-1885"><a href="#cb119-1885"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb119-1886"><a href="#cb119-1886"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb119-1887"><a href="#cb119-1887"></a>    <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb119-1888"><a href="#cb119-1888"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"gray70"</span>),</span>
<span id="cb119-1889"><a href="#cb119-1889"></a>    <span class="at">text =</span> <span class="sc">~</span>label,</span>
<span id="cb119-1890"><a href="#cb119-1890"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb119-1891"><a href="#cb119-1891"></a>    <span class="at">name =</span> <span class="st">"Neighbors"</span></span>
<span id="cb119-1892"><a href="#cb119-1892"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1893"><a href="#cb119-1893"></a>  plotly<span class="sc">::</span><span class="fu">add_trace</span>(</span>
<span id="cb119-1894"><a href="#cb119-1894"></a>    <span class="at">data =</span> targets_plot,</span>
<span id="cb119-1895"><a href="#cb119-1895"></a>    <span class="at">x =</span> <span class="sc">~</span>x, <span class="at">y =</span> <span class="sc">~</span>y, <span class="at">z =</span> <span class="sc">~</span>z,</span>
<span id="cb119-1896"><a href="#cb119-1896"></a>    <span class="at">frame =</span> <span class="sc">~</span>window,</span>
<span id="cb119-1897"><a href="#cb119-1897"></a>    <span class="at">type =</span> <span class="st">"scatter3d"</span>,</span>
<span id="cb119-1898"><a href="#cb119-1898"></a>    <span class="at">mode =</span> <span class="st">"markers+text"</span>,</span>
<span id="cb119-1899"><a href="#cb119-1899"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.95</span>, <span class="at">color =</span> <span class="st">"crimson"</span>),</span>
<span id="cb119-1900"><a href="#cb119-1900"></a>    <span class="at">text =</span> <span class="sc">~</span>label,</span>
<span id="cb119-1901"><a href="#cb119-1901"></a>    <span class="at">textposition =</span> <span class="st">"top center"</span>,</span>
<span id="cb119-1902"><a href="#cb119-1902"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb119-1903"><a href="#cb119-1903"></a>    <span class="at">name =</span> <span class="st">"Targets"</span></span>
<span id="cb119-1904"><a href="#cb119-1904"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb119-1905"><a href="#cb119-1905"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb119-1906"><a href="#cb119-1906"></a>    <span class="at">title =</span> <span class="st">"Word2Vec 3D timeline (aligned windows)"</span>,</span>
<span id="cb119-1907"><a href="#cb119-1907"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb119-1908"><a href="#cb119-1908"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC1"</span>),</span>
<span id="cb119-1909"><a href="#cb119-1909"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC2"</span>),</span>
<span id="cb119-1910"><a href="#cb119-1910"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"PC3"</span>)</span>
<span id="cb119-1911"><a href="#cb119-1911"></a>    ),</span>
<span id="cb119-1912"><a href="#cb119-1912"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">"h"</span>)</span>
<span id="cb119-1913"><a href="#cb119-1913"></a>  )</span>
<span id="cb119-1914"><a href="#cb119-1914"></a></span>
<span id="cb119-1915"><a href="#cb119-1915"></a>p_w2v_3d</span>
<span id="cb119-1916"><a href="#cb119-1916"></a><span class="in">```</span></span>
<span id="cb119-1917"><a href="#cb119-1917"></a></span>
<span id="cb119-1918"><a href="#cb119-1918"></a><span class="fu">## Interpretation and limitations</span></span>
<span id="cb119-1919"><a href="#cb119-1919"></a></span>
<span id="cb119-1920"><a href="#cb119-1920"></a>The descriptive trends and embedding neighborhoods suggest a gradual shift from euphemistic/relational framings toward more explicit naming of gendered violence. This is consistent with a broader public discourse that increasingly recognizes feminicide as a distinct social problem. At the same time, these are correlational indicators: term usage is sensitive to genre, outlet, and event-driven spikes, and embeddings reflect co-occurrence patterns rather than causal mechanisms. We therefore treat the results as evidence of discursive change, not proof of underlying causes.</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>